<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kconfig - Tips and Best Practices &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script type="module" src="../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="Custom Kconfig Preprocessor Functions" href="preprocessor-functions.html" />
    <link rel="prev" title="Setting Kconfig configuration values" href="setting.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Build and Configuration Systems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#build-system-cmake">Build System (CMake)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#configuration-system-kconfig">Configuration System (Kconfig)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="menuconfig.html">Interactive Kconfig interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="setting.html">Setting Kconfig configuration values</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Kconfig - Tips and Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-to-turn-into-kconfig-options">What to turn into Kconfig options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-not-to-turn-into-kconfig-options">What not to turn into Kconfig options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#select-statements"><code class="docutils literal notranslate"><span class="pre">select</span></code> statements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lack-of-conditional-includes">(Lack of) conditional includes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stuck-symbols-in-menuconfig-and-guiconfig">“Stuck” symbols in menuconfig and guiconfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="#assignments-to-promptless-symbols-in-configuration-files">Assignments to promptless symbols in configuration files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#depends-on-and-string-int-hex-symbols"><code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>/<code class="docutils literal notranslate"><span class="pre">int</span></code>/<code class="docutils literal notranslate"><span class="pre">hex</span></code> symbols</a></li>
<li class="toctree-l4"><a class="reference internal" href="#menuconfig-symbols"><code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> symbols</a></li>
<li class="toctree-l4"><a class="reference internal" href="#checking-changes-in-menuconfig-guiconfig">Checking changes in menuconfig/guiconfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="#checking-changes-with-scripts-kconfig-lint-py">Checking changes with <code class="file docutils literal notranslate"><span class="pre">scripts/kconfig/lint.py</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#style-recommendations-and-shorthands">Style recommendations and shorthands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lesser-known-used-kconfig-features">Lesser-known/used Kconfig features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-resources">Other resources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="preprocessor-functions.html">Custom Kconfig Preprocessor Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions.html">Kconfig extensions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../index.html">Build and Configuration Systems</a> &raquo;</li>
  
  <li>Kconfig - Tips and Best Practices</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/guides/build/kconfig/tips.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="kconfig-tips-and-best-practices">
<span id="kconfig-tips-and-tricks"></span><h1>Kconfig - Tips and Best Practices<a class="headerlink" href="#kconfig-tips-and-best-practices" title="Permalink to this headline">¶</a></h1>
<p>This page covers some Kconfig best practices and explains some Kconfig
behaviors and features that might be cryptic or that are easily overlooked.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The official Kconfig documentation is <a class="reference external" href="https://www.kernel.org/doc/html/latest/kbuild/kconfig-language.html">kconfig-language.rst</a>
and <a class="reference external" href="https://www.kernel.org/doc/html/latest/kbuild/kconfig-macro-language.html">kconfig-macro-language.rst</a>.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#what-to-turn-into-kconfig-options" id="id1">What to turn into Kconfig options</a></p></li>
<li><p><a class="reference internal" href="#what-not-to-turn-into-kconfig-options" id="id2">What not to turn into Kconfig options</a></p>
<ul>
<li><p><a class="reference internal" href="#options-that-specify-a-device-in-the-system-by-name" id="id3">Options that specify a device in the system by name</a></p></li>
<li><p><a class="reference internal" href="#options-that-specify-fixed-hardware-configuration" id="id4">Options that specify fixed hardware configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#select-statements" id="id5"><code class="docutils literal notranslate"><span class="pre">select</span></code> statements</a></p>
<ul>
<li><p><a class="reference internal" href="#select-pitfalls" id="id6"><code class="docutils literal notranslate"><span class="pre">select</span></code> pitfalls</a></p></li>
<li><p><a class="reference internal" href="#alternatives-to-select" id="id7">Alternatives to <code class="docutils literal notranslate"><span class="pre">select</span></code></a></p></li>
<li><p><a class="reference internal" href="#using-select-for-helper-symbols" id="id8">Using <code class="docutils literal notranslate"><span class="pre">select</span></code> for helper symbols</a></p></li>
<li><p><a class="reference internal" href="#select-recommendations" id="id9"><code class="docutils literal notranslate"><span class="pre">select</span></code> recommendations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#lack-of-conditional-includes" id="id10">(Lack of) conditional includes</a></p></li>
<li><p><a class="reference internal" href="#stuck-symbols-in-menuconfig-and-guiconfig" id="id11">“Stuck” symbols in menuconfig and guiconfig</a></p></li>
<li><p><a class="reference internal" href="#assignments-to-promptless-symbols-in-configuration-files" id="id12">Assignments to promptless symbols in configuration files</a></p></li>
<li><p><a class="reference internal" href="#depends-on-and-string-int-hex-symbols" id="id13"><code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>/<code class="docutils literal notranslate"><span class="pre">int</span></code>/<code class="docutils literal notranslate"><span class="pre">hex</span></code> symbols</a></p></li>
<li><p><a class="reference internal" href="#menuconfig-symbols" id="id14"><code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> symbols</a></p></li>
<li><p><a class="reference internal" href="#checking-changes-in-menuconfig-guiconfig" id="id15">Checking changes in menuconfig/guiconfig</a></p></li>
<li><p><a class="reference internal" href="#checking-changes-with-scripts-kconfig-lint-py" id="id16">Checking changes with <code class="file docutils literal notranslate"><span class="pre">scripts/kconfig/lint.py</span></code></a></p></li>
<li><p><a class="reference internal" href="#style-recommendations-and-shorthands" id="id17">Style recommendations and shorthands</a></p>
<ul>
<li><p><a class="reference internal" href="#factoring-out-common-dependencies" id="id18">Factoring out common dependencies</a></p></li>
<li><p><a class="reference internal" href="#redundant-defaults" id="id19">Redundant defaults</a></p></li>
<li><p><a class="reference internal" href="#common-kconfig-shorthands" id="id20">Common Kconfig shorthands</a></p></li>
<li><p><a class="reference internal" href="#prompt-strings" id="id21">Prompt strings</a></p></li>
<li><p><a class="reference internal" href="#header-comments-and-other-nits" id="id22">Header comments and other nits</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#lesser-known-used-kconfig-features" id="id23">Lesser-known/used Kconfig features</a></p>
<ul>
<li><p><a class="reference internal" href="#the-imply-statement" id="id24">The <code class="docutils literal notranslate"><span class="pre">imply</span></code> statement</a></p></li>
<li><p><a class="reference internal" href="#optional-prompts" id="id25">Optional prompts</a></p></li>
<li><p><a class="reference internal" href="#optional-choices" id="id26">Optional choices</a></p></li>
<li><p><a class="reference internal" href="#visible-if-conditions" id="id27"><code class="docutils literal notranslate"><span class="pre">visible</span> <span class="pre">if</span></code> conditions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#other-resources" id="id28">Other resources</a></p></li>
</ul>
</div>
<div class="section" id="what-to-turn-into-kconfig-options">
<h2><a class="toc-backref" href="#id1">What to turn into Kconfig options</a><a class="headerlink" href="#what-to-turn-into-kconfig-options" title="Permalink to this headline">¶</a></h2>
<p>When deciding whether something belongs in Kconfig, it helps to distinguish
between symbols that have prompts and symbols that don’t.</p>
<p>If a symbol has a prompt (e.g. <code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">&quot;Enable</span> <span class="pre">foo&quot;</span></code>), then the user can change
the symbol’s value in the <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> or <code class="docutils literal notranslate"><span class="pre">guiconfig</span></code> interface (see
<a class="reference internal" href="menuconfig.html#menuconfig"><span class="std std-ref">Interactive Kconfig interfaces</span></a>), or by manually editing configuration files. Conversely, a
symbol without a prompt can never be changed directly by the user, not even by
manually editing configuration files.</p>
<p>Only put a prompt on a symbol if it makes sense for the user to change its
value.</p>
<p>Symbols without prompts are called <em>hidden</em> or <em>invisible</em> symbols, because
they don’t show up in <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> and <code class="docutils literal notranslate"><span class="pre">guiconfig</span></code>. Symbols that have
prompts can also be invisible, when their dependencies are not satisfied.</p>
<p>Symbols without prompts can’t be configured directly by the user (they derive
their value from other symbols), so less restrictions apply to them. If some
derived setting is easier to calculate in Kconfig than e.g. during the build,
then do it in Kconfig, but keep the distinction between symbols with and
without prompts in mind.</p>
<p>See the <a class="reference internal" href="#optional-prompts">optional prompts</a> section for a way to deal with settings that are
fixed on some machines and configurable on other machines.</p>
</div>
<div class="section" id="what-not-to-turn-into-kconfig-options">
<h2><a class="toc-backref" href="#id2">What not to turn into Kconfig options</a><a class="headerlink" href="#what-not-to-turn-into-kconfig-options" title="Permalink to this headline">¶</a></h2>
<p>In Zephyr, Kconfig configuration is done after selecting a target board. In
general, it does not make sense to use Kconfig for a value that corresponds to
a fixed machine-specific setting. Usually, such settings should be handled via
<a class="reference internal" href="../../dts/index.html#dt-guide"><span class="std std-ref">devicetree</span></a> instead.</p>
<p>In particular, avoid adding new Kconfig options of the following types:</p>
<div class="section" id="options-that-specify-a-device-in-the-system-by-name">
<h3><a class="toc-backref" href="#id3">Options that specify a device in the system by name</a><a class="headerlink" href="#options-that-specify-a-device-in-the-system-by-name" title="Permalink to this headline">¶</a></h3>
<p>For example, if you are writing an I2C device driver, avoid creating an option
named <code class="docutils literal notranslate"><span class="pre">MY_DEVICE_I2C_BUS_NAME</span></code> for specifying the bus node your device is
controlled by. See <a class="reference internal" href="../../dts/howtos.html#dt-drivers-that-depend"><span class="std std-ref">Device drivers that depend on other devices</span></a> for alternatives.</p>
<p>Similarly, if your application depends on a hardware-specific PWM device to
control an RGB LED, avoid creating an option like <code class="docutils literal notranslate"><span class="pre">MY_PWM_DEVICE_NAME</span></code>. See
<a class="reference internal" href="../../dts/howtos.html#dt-apps-that-depend"><span class="std std-ref">Applications that depend on board-specific devices</span></a> for alternatives.</p>
</div>
<div class="section" id="options-that-specify-fixed-hardware-configuration">
<h3><a class="toc-backref" href="#id4">Options that specify fixed hardware configuration</a><a class="headerlink" href="#options-that-specify-fixed-hardware-configuration" title="Permalink to this headline">¶</a></h3>
<p>For example, avoid Kconfig options specifying a GPIO pin.</p>
<p>An alternative applicable to device drivers is to define a GPIO specifier with
type phandle-array in the device binding, and using the
<a class="reference internal" href="../../../reference/devicetree/api.html#devicetree-gpio-api"><span class="std std-ref">GPIO</span></a> devicetree API from C. Similar advice applies to
other cases where devicetree.h provides <a class="reference internal" href="../../../reference/devicetree/api.html#devicetree-hw-api"><span class="std std-ref">Hardware specific APIs</span></a> for referring
to other nodes in the system. Search the source code for drivers using these
APIs for examples.</p>
<p>An application-specific devicetree <a class="reference internal" href="../../dts/bindings.html#dt-bindings"><span class="std std-ref">binding</span></a> to identify
board specific properties may be appropriate. See
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/tests/drivers/gpio/gpio_basic_api">tests/drivers/gpio/gpio_basic_api</a> for an example.</p>
<p>For applications, see <a class="reference internal" href="../../../samples/basic/blinky/README.html#blinky-sample"><span class="std std-ref">Blinky</span></a> for a devicetree-based alternative.</p>
</div>
</div>
<div class="section" id="select-statements">
<h2><a class="toc-backref" href="#id5"><code class="docutils literal notranslate"><span class="pre">select</span></code> statements</a><a class="headerlink" href="#select-statements" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">select</span></code> statement is used to force one symbol to <code class="docutils literal notranslate"><span class="pre">y</span></code> whenever another
symbol is <code class="docutils literal notranslate"><span class="pre">y</span></code>. For example, the following code forces <code class="docutils literal notranslate"><span class="pre">CONSOLE</span></code> to <code class="docutils literal notranslate"><span class="pre">y</span></code>
whenever <code class="docutils literal notranslate"><span class="pre">USB_CONSOLE</span></code> is <code class="docutils literal notranslate"><span class="pre">y</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config CONSOLE
     bool &quot;Console support&quot;

...

config USB_CONSOLE
     bool &quot;USB console support&quot;
     select CONSOLE
</pre></div>
</div>
<p>This section covers some pitfalls and good uses for <code class="docutils literal notranslate"><span class="pre">select</span></code>.</p>
<div class="section" id="select-pitfalls">
<h3><a class="toc-backref" href="#id6"><code class="docutils literal notranslate"><span class="pre">select</span></code> pitfalls</a><a class="headerlink" href="#select-pitfalls" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">select</span></code> might seem like a generally useful feature at first, but can cause
configuration issues if overused.</p>
<p>For example, say that a new dependency is added to the <code class="docutils literal notranslate"><span class="pre">CONSOLE</span></code> symbol
above, by a developer who is unaware of the <code class="docutils literal notranslate"><span class="pre">USB_CONSOLE</span></code> symbol (or simply
forgot about it):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config CONSOLE
     bool &quot;Console support&quot;
     depends on STRING_ROUTINES
</pre></div>
</div>
<p>Enabling <code class="docutils literal notranslate"><span class="pre">USB_CONSOLE</span></code> now forces <code class="docutils literal notranslate"><span class="pre">CONSOLE</span></code> to <code class="docutils literal notranslate"><span class="pre">y</span></code>, even if
<code class="docutils literal notranslate"><span class="pre">STRING_ROUTINES</span></code> is <code class="docutils literal notranslate"><span class="pre">n</span></code>.</p>
<p>To fix the problem, the <code class="docutils literal notranslate"><span class="pre">STRING_ROUTINES</span></code> dependency needs to be added to
<code class="docutils literal notranslate"><span class="pre">USB_CONSOLE</span></code> as well:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config USB_CONSOLE
     bool &quot;USB console support&quot;
     select CONSOLE
     depends on STRING_ROUTINES

...

config STRING_ROUTINES
     bool &quot;Include string routines&quot;
</pre></div>
</div>
<p>More insidious cases with dependencies inherited from <code class="docutils literal notranslate"><span class="pre">if</span></code> and <code class="docutils literal notranslate"><span class="pre">menu</span></code>
statements are common.</p>
<p>An alternative attempt to solve the issue might be to turn the <code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code>
into another <code class="docutils literal notranslate"><span class="pre">select</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config CONSOLE
     bool &quot;Console support&quot;
     select STRING_ROUTINES

...

config USB_CONSOLE
     bool &quot;USB console support&quot;
     select CONSOLE
</pre></div>
</div>
<p>In practice, this often amplifies the problem, because any dependencies added
to <code class="docutils literal notranslate"><span class="pre">STRING_ROUTINES</span></code> now need to be copied to both <code class="docutils literal notranslate"><span class="pre">CONSOLE</span></code> and
<code class="docutils literal notranslate"><span class="pre">USB_CONSOLE</span></code>.</p>
<p>In general, whenever the dependencies of a symbol are updated, the dependencies
of all symbols that (directly or indirectly) select it have to be updated as
well. This is very often overlooked in practice, even for the simplest case
above.</p>
<p>Chains of symbols selecting each other should be avoided in particular, except
for simple helper symbols, as covered below in <a class="reference internal" href="#good-select-use"><span class="std std-ref">Using select for helper symbols</span></a>.</p>
<p>Liberal use of <code class="docutils literal notranslate"><span class="pre">select</span></code> also tends to make Kconfig files harder to read, both
due to the extra dependencies and due to the non-local nature of <code class="docutils literal notranslate"><span class="pre">select</span></code>,
which hides ways in which a symbol might get enabled.</p>
</div>
<div class="section" id="alternatives-to-select">
<h3><a class="toc-backref" href="#id7">Alternatives to <code class="docutils literal notranslate"><span class="pre">select</span></code></a><a class="headerlink" href="#alternatives-to-select" title="Permalink to this headline">¶</a></h3>
<p>For the example in the previous section, a better solution is usually to turn
the <code class="docutils literal notranslate"><span class="pre">select</span></code> into a <code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config CONSOLE
     bool &quot;Console support&quot;

...

config USB_CONSOLE
     bool &quot;USB console support&quot;
     depends on CONSOLE
</pre></div>
</div>
<p>This makes it impossible to generate an invalid configuration, and means that
dependencies only ever have to be updated in a single spot.</p>
<p>An objection to using <code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code> here might be that configuration files
that enable <code class="docutils literal notranslate"><span class="pre">USB_CONSOLE</span></code> now also need to enable <code class="docutils literal notranslate"><span class="pre">CONSOLE</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_CONSOLE=y
CONFIG_USB_CONSOLE=y
</pre></div>
</div>
<p>This comes down to a trade-off, but if enabling <code class="docutils literal notranslate"><span class="pre">CONSOLE</span></code> is the norm, then a
mitigation is to make <code class="docutils literal notranslate"><span class="pre">CONSOLE</span></code> default to <code class="docutils literal notranslate"><span class="pre">y</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config CONSOLE
     bool &quot;Console support&quot;
     default y
</pre></div>
</div>
<p>This gives just a single assignment in configuration files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_USB_CONSOLE=y
</pre></div>
</div>
<p>Note that configuration files that do not want <code class="docutils literal notranslate"><span class="pre">CONSOLE</span></code> enabled now have to
explicitly disable it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_CONSOLE=n
</pre></div>
</div>
</div>
<div class="section" id="using-select-for-helper-symbols">
<span id="good-select-use"></span><h3><a class="toc-backref" href="#id8">Using <code class="docutils literal notranslate"><span class="pre">select</span></code> for helper symbols</a><a class="headerlink" href="#using-select-for-helper-symbols" title="Permalink to this headline">¶</a></h3>
<p>A good and safe use of <code class="docutils literal notranslate"><span class="pre">select</span></code> is for setting “helper” symbols that capture
some condition. Such helper symbols should preferably have no prompt or
dependencies.</p>
<p>For example, a helper symbol for indicating that a particular CPU/SoC has an
FPU could be defined as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config CPU_HAS_FPU
     bool
     help
       If y, the CPU has an FPU

...

config SOC_FOO
     bool &quot;FOO SoC&quot;
     select CPU_HAS_FPU

...

config SOC_BAR
     bool &quot;BAR SoC&quot;
     select CPU_HAS_FPU
</pre></div>
</div>
<p>This makes it possible for other symbols to check for FPU support in a generic
way, without having to look for particular architectures:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FPU
     bool &quot;Support floating point operations&quot;
     depends on CPU_HAS_FPU
</pre></div>
</div>
<p>The alternative would be to have dependencies like the following, possibly
duplicated in several spots:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FPU
     bool &quot;Support floating point operations&quot;
     depends on SOC_FOO || SOC_BAR || ...
</pre></div>
</div>
<p>Invisible helper symbols can also be useful without <code class="docutils literal notranslate"><span class="pre">select</span></code>. For example,
the following code defines a helper symbol that has the value <code class="docutils literal notranslate"><span class="pre">y</span></code> if the
machine has some arbitrarily-defined “large” amount of memory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config LARGE_MEM
     def_bool MEM_SIZE &gt;= 64
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is short for the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config LARGE_MEM
  bool
  default MEM_SIZE &gt;= 64
</pre></div>
</div>
</div>
</div>
<div class="section" id="select-recommendations">
<h3><a class="toc-backref" href="#id9"><code class="docutils literal notranslate"><span class="pre">select</span></code> recommendations</a><a class="headerlink" href="#select-recommendations" title="Permalink to this headline">¶</a></h3>
<p>In summary, here are some recommended practices for <code class="docutils literal notranslate"><span class="pre">select</span></code>:</p>
<ul>
<li><p>Avoid selecting symbols with prompts or dependencies. Prefer <code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code>.
If <code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code> causes annoying bloat in configuration files, consider
adding a Kconfig default for the most common value.</p>
<p>Rare exceptions might include cases where you’re sure that the dependencies
of the selecting and selected symbol will never drift out of sync, e.g. when
dealing with two simple symbols defined close to one another within the same
<code class="docutils literal notranslate"><span class="pre">if</span></code>.</p>
<p>Common sense applies, but be aware that <code class="docutils literal notranslate"><span class="pre">select</span></code> often causes issues in
practice. <code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code> is usually a cleaner and safer solution.</p>
</li>
<li><p>Select simple helper symbols without prompts and dependencies however much
you like. They’re a great tool for simplifying Kconfig files.</p></li>
</ul>
</div>
</div>
<div class="section" id="lack-of-conditional-includes">
<h2><a class="toc-backref" href="#id10">(Lack of) conditional includes</a><a class="headerlink" href="#lack-of-conditional-includes" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code> blocks add dependencies to each item within the <code class="docutils literal notranslate"><span class="pre">if</span></code>, as if <code class="docutils literal notranslate"><span class="pre">depends</span>
<span class="pre">on</span></code> was used.</p>
<p>A common misunderstanding related to <code class="docutils literal notranslate"><span class="pre">if</span></code> is to think that the following code
conditionally includes the file <code class="file docutils literal notranslate"><span class="pre">Kconfig.other</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if DEP
source &quot;Kconfig.other&quot;
endif
</pre></div>
</div>
<p>In reality, there are no conditional includes in Kconfig. <code class="docutils literal notranslate"><span class="pre">if</span></code> has no special
meaning around a <code class="docutils literal notranslate"><span class="pre">source</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Conditional includes would be impossible to implement, because <code class="docutils literal notranslate"><span class="pre">if</span></code>
conditions may contain (either directly or indirectly) forward references to
symbols that haven’t been defined yet.</p>
</div>
<p>Say that <code class="file docutils literal notranslate"><span class="pre">Kconfig.other</span></code> above contains this definition:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO
     bool &quot;Support foo&quot;
</pre></div>
</div>
<p>In this case, <code class="docutils literal notranslate"><span class="pre">FOO</span></code> will end up with this definition:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO
     bool &quot;Support foo&quot;
     depends on DEP
</pre></div>
</div>
<p>Note that it is redundant to add <code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span> <span class="pre">DEP</span></code> to the definition of
<code class="docutils literal notranslate"><span class="pre">FOO</span></code> in <code class="file docutils literal notranslate"><span class="pre">Kconfig.other</span></code>, because the <code class="docutils literal notranslate"><span class="pre">DEP</span></code> dependency has already
been added by <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">DEP</span></code>.</p>
<p>In general, try to avoid adding redundant dependencies. They can make the
structure of the Kconfig files harder to understand, and also make changes more
error-prone, since it can be hard to spot that the same dependency is added
twice.</p>
</div>
<div class="section" id="stuck-symbols-in-menuconfig-and-guiconfig">
<h2><a class="toc-backref" href="#id11">“Stuck” symbols in menuconfig and guiconfig</a><a class="headerlink" href="#stuck-symbols-in-menuconfig-and-guiconfig" title="Permalink to this headline">¶</a></h2>
<p>There is a common subtle gotcha related to interdependent configuration symbols
with prompts. Consider these symbols:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO
     bool &quot;Foo&quot;

config STACK_SIZE
     hex &quot;Stack size&quot;
     default 0x200 if FOO
     default 0x100
</pre></div>
</div>
<p>Assume that the intention here is to use a larger stack whenever <code class="docutils literal notranslate"><span class="pre">FOO</span></code> is
enabled, and that the configuration initially has <code class="docutils literal notranslate"><span class="pre">FOO</span></code> disabled. Also,
remember that Zephyr creates an initial configuration in <code class="file docutils literal notranslate"><span class="pre">zephyr/.config</span></code>
in the build directory by merging configuration files (including e.g.
<code class="file docutils literal notranslate"><span class="pre">prj.conf</span></code>). This configuration file exists before
<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> or <code class="docutils literal notranslate"><span class="pre">guiconfig</span></code> is run.</p>
<p>When first entering the configuration interface, the value of <code class="docutils literal notranslate"><span class="pre">STACK_SIZE</span></code> is
0x100, as expected. After enabling <code class="docutils literal notranslate"><span class="pre">FOO</span></code>, you might reasonably expect the
value of <code class="docutils literal notranslate"><span class="pre">STACK_SIZE</span></code> to change to 0x200, but it stays as 0x100.</p>
<p>To understand what’s going on, remember that <code class="docutils literal notranslate"><span class="pre">STACK_SIZE</span></code> has a prompt,
meaning it is user-configurable, and consider that all Kconfig has to go on
from the initial configuration is this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_STACK_SIZE=0x100
</pre></div>
</div>
<p>Since Kconfig can’t know if the 0x100 value came from a <code class="docutils literal notranslate"><span class="pre">default</span></code> or was
typed in by the user, it has to assume that it came from the user. Since
<code class="docutils literal notranslate"><span class="pre">STACK_SIZE</span></code> is user-configurable, the value from the configuration file is
respected, and any symbol defaults are ignored. This is why the value of
<code class="docutils literal notranslate"><span class="pre">STACK_SIZE</span></code> appears to be “frozen” at 0x100 when toggling <code class="docutils literal notranslate"><span class="pre">FOO</span></code>.</p>
<p>The right fix depends on what the intention is. Here’s some different scenarios
with suggestions:</p>
<ul>
<li><p>If <code class="docutils literal notranslate"><span class="pre">STACK_SIZE</span></code> can always be derived automatically and does not need to be
user-configurable, then just remove the prompt:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config STACK_SIZE
   hex
   default 0x200 if FOO
   default 0x100
</pre></div>
</div>
<p>Symbols without prompts ignore any value from the saved configuration.</p>
</li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">STACK_SIZE</span></code> should usually be user-configurable, but needs to be set to
0x200 when <code class="docutils literal notranslate"><span class="pre">FOO</span></code> is enabled, then disable its prompt when <code class="docutils literal notranslate"><span class="pre">FOO</span></code> is
enabled, as described in <a class="reference internal" href="#optional-prompts">optional prompts</a>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config STACK_SIZE
   hex &quot;Stack size&quot; if !FOO
   default 0x200 if FOO
   default 0x100
</pre></div>
</div>
</li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">STACK_SIZE</span></code> should usually be derived automatically, but needs to be
set to a custom value in rare circumstances, then add another option for
making <code class="docutils literal notranslate"><span class="pre">STACK_SIZE</span></code> user-configurable:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config CUSTOM_STACK_SIZE
   bool &quot;Use a custom stack size&quot;
   help
     Enable this if you need to use a custom stack size. When disabled, a
     suitable stack size is calculated automatically.

config STACK_SIZE
   hex &quot;Stack size&quot; if CUSTOM_STACK_SIZE
   default 0x200 if FOO
   default 0x100
</pre></div>
</div>
<p>As long as <code class="docutils literal notranslate"><span class="pre">CUSTOM_STACK_SIZE</span></code> is disabled, <code class="docutils literal notranslate"><span class="pre">STACK_SIZE</span></code> will ignore the
value from the saved configuration.</p>
</li>
</ul>
<p>It is a good idea to try out changes in the <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> or <code class="docutils literal notranslate"><span class="pre">guiconfig</span></code>
interface, to make sure that things behave the way you expect. This is
especially true when making moderately complex changes like these.</p>
</div>
<div class="section" id="assignments-to-promptless-symbols-in-configuration-files">
<h2><a class="toc-backref" href="#id12">Assignments to promptless symbols in configuration files</a><a class="headerlink" href="#assignments-to-promptless-symbols-in-configuration-files" title="Permalink to this headline">¶</a></h2>
<p>Assignments to hidden (promptless, also called <em>invisible</em>) symbols in
configuration files are always ignored. Hidden symbols get their value
indirectly from other symbols, via e.g. <code class="docutils literal notranslate"><span class="pre">default</span></code> and <code class="docutils literal notranslate"><span class="pre">select</span></code>.</p>
<p>A common source of confusion is opening the output configuration file
(<code class="file docutils literal notranslate"><span class="pre">zephyr/.config</span></code>), seeing a bunch of assignments to hidden symbols,
and assuming that those assignments must be respected when the configuration is
read back in by Kconfig. In reality, all assignments to hidden symbols in
<code class="file docutils literal notranslate"><span class="pre">zephyr/.config</span></code> are ignored by Kconfig, like for other configuration
files.</p>
<p>To understand why <code class="file docutils literal notranslate"><span class="pre">zephyr/.config</span></code> still includes assignments to hidden
symbols, it helps to realize that <code class="file docutils literal notranslate"><span class="pre">zephyr/.config</span></code> serves two separate
purposes:</p>
<ol class="arabic simple">
<li><p>It holds the saved configuration, and</p></li>
<li><p>it holds configuration output. <code class="file docutils literal notranslate"><span class="pre">zephyr/.config</span></code> is parsed by the CMake
files to let them query configuration settings, for example.</p></li>
</ol>
<p>The assignments to hidden symbols in <code class="file docutils literal notranslate"><span class="pre">zephyr/.config</span></code> are just
configuration output. Kconfig itself ignores assignments to hidden symbols when
calculating symbol values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A <em>minimal configuration</em>, which can be generated from within the
<a class="reference internal" href="menuconfig.html#menuconfig"><span class="std std-ref">menuconfig and guiconfig interfaces</span></a>, could be considered
closer to just a saved configuration, without the full configuration output.</p>
</div>
</div>
<div class="section" id="depends-on-and-string-int-hex-symbols">
<h2><a class="toc-backref" href="#id13"><code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>/<code class="docutils literal notranslate"><span class="pre">int</span></code>/<code class="docutils literal notranslate"><span class="pre">hex</span></code> symbols</a><a class="headerlink" href="#depends-on-and-string-int-hex-symbols" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code> works not just for <code class="docutils literal notranslate"><span class="pre">bool</span></code> symbols, but also for <code class="docutils literal notranslate"><span class="pre">string</span></code>,
<code class="docutils literal notranslate"><span class="pre">int</span></code>, and <code class="docutils literal notranslate"><span class="pre">hex</span></code> symbols (and for choices).</p>
<p>The Kconfig definitions below will hide the <code class="docutils literal notranslate"><span class="pre">FOO_DEVICE_FREQUENCY</span></code> symbol and
disable any configuration output for it when <code class="docutils literal notranslate"><span class="pre">FOO_DEVICE</span></code> is disabled.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO_DEVICE
     bool &quot;Foo device&quot;

config FOO_DEVICE_FREQUENCY
     int &quot;Foo device frequency&quot;
     depends on FOO_DEVICE
</pre></div>
</div>
<p>In general, it’s a good idea to check that only relevant symbols are ever shown
in the <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>/<code class="docutils literal notranslate"><span class="pre">guiconfig</span></code> interface. Having <code class="docutils literal notranslate"><span class="pre">FOO_DEVICE_FREQUENCY</span></code>
show up when <code class="docutils literal notranslate"><span class="pre">FOO_DEVICE</span></code> is disabled (and possibly hidden) makes the
relationship between the symbols harder to understand, even if code never looks
at <code class="docutils literal notranslate"><span class="pre">FOO_DEVICE_FREQUENCY</span></code> when <code class="docutils literal notranslate"><span class="pre">FOO_DEVICE</span></code> is disabled.</p>
</div>
<div class="section" id="menuconfig-symbols">
<h2><a class="toc-backref" href="#id14"><code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> symbols</a><a class="headerlink" href="#menuconfig-symbols" title="Permalink to this headline">¶</a></h2>
<p>If the definition of a symbol <code class="docutils literal notranslate"><span class="pre">FOO</span></code> is immediately followed by other symbols
that depend on <code class="docutils literal notranslate"><span class="pre">FOO</span></code>, then those symbols become children of <code class="docutils literal notranslate"><span class="pre">FOO</span></code>. If
<code class="docutils literal notranslate"><span class="pre">FOO</span></code> is defined with <code class="docutils literal notranslate"><span class="pre">config</span> <span class="pre">FOO</span></code>, then the children are shown indented
relative to <code class="docutils literal notranslate"><span class="pre">FOO</span></code>. Defining <code class="docutils literal notranslate"><span class="pre">FOO</span></code> with <code class="docutils literal notranslate"><span class="pre">menuconfig</span> <span class="pre">FOO</span></code> instead puts the
children in a separate menu rooted at <code class="docutils literal notranslate"><span class="pre">FOO</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> has no effect on evaluation. It’s just a display option.</p>
<p><code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> can cut down on the number of menus and make the menu structure
easier to navigate. For example, say you have the following definitions:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>menu &quot;Foo subsystem&quot;

config FOO_SUBSYSTEM
     bool &quot;Foo subsystem&quot;

if FOO_SUBSYSTEM

config FOO_FEATURE_1
     bool &quot;Foo feature 1&quot;

config FOO_FEATURE_2
     bool &quot;Foo feature 2&quot;

config FOO_FREQUENCY
     int &quot;Foo frequency&quot;

... lots of other FOO-related symbols

endif # FOO_SUBSYSTEM

endmenu
</pre></div>
</div>
<p>In this case, it’s probably better to get rid of the <code class="docutils literal notranslate"><span class="pre">menu</span></code> and turn
<code class="docutils literal notranslate"><span class="pre">FOO_SUBSYSTEM</span></code> into a <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> symbol:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>menuconfig FOO_SUBSYSTEM
     bool &quot;Foo subsystem&quot;

if FOO_SUBSYSTEM

config FOO_FEATURE_1
     bool &quot;Foo feature 1&quot;

config FOO_FEATURE_2
     bool &quot;Foo feature 2&quot;

config FOO_FREQUENCY
     int &quot;Foo frequency&quot;

... lots of other FOO-related symbols

endif # FOO_SUBSYSTEM
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> interface, this will be displayed as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[*] Foo subsystem  ---&gt;
</pre></div>
</div>
<p>Note that making a symbol without children a <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> is meaningless. It
should be avoided, because it looks identical to a symbol with all children
invisible:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[*] I have no children  ----
[*] All my children are invisible  ----
</pre></div>
</div>
</div>
<div class="section" id="checking-changes-in-menuconfig-guiconfig">
<h2><a class="toc-backref" href="#id15">Checking changes in menuconfig/guiconfig</a><a class="headerlink" href="#checking-changes-in-menuconfig-guiconfig" title="Permalink to this headline">¶</a></h2>
<p>When adding new symbols or making other changes to Kconfig files, it is a good
idea to look up the symbols in <a class="reference internal" href="menuconfig.html#menuconfig"><span class="std std-ref">menuconfig or guiconfig</span></a>
afterwards. To get to a symbol quickly, use the jump-to feature (press
<kbd class="kbd docutils literal notranslate">/</kbd>).</p>
<p>Here are some things to check:</p>
<ul>
<li><p>Are the symbols placed in a good spot? Check that they appear in a menu where
they make sense, close to related symbols.</p>
<p>If one symbol depends on another, then it’s often a good idea to place it
right after the symbol it depends on. It will then be shown indented relative
to the symbol it depends on in the <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> interface, and in a
separate menu rooted at the symbol in <code class="docutils literal notranslate"><span class="pre">guiconfig</span></code>. This also works if
several symbols are placed after the symbol they depend on.</p>
</li>
<li><p>Is it easy to guess what the symbols do from their prompts?</p></li>
<li><p>If many symbols are added, do all combinations of values they can be set to
make sense?</p>
<p>For example, if two symbols <code class="docutils literal notranslate"><span class="pre">FOO_SUPPORT</span></code> and <code class="docutils literal notranslate"><span class="pre">NO_FOO_SUPPORT</span></code> are added,
and both can be enabled at the same time, then that makes a nonsensical
configuration. In this case, it’s probably better to have a single
<code class="docutils literal notranslate"><span class="pre">FOO_SUPPORT</span></code> symbol.</p>
</li>
<li><p>Are there any duplicated dependencies?</p>
<p>This can be checked by selecting a symbol and pressing <kbd class="kbd docutils literal notranslate">?</kbd> to view the
symbol information. If there are duplicated dependencies, then use the
<code class="docutils literal notranslate"><span class="pre">Included</span> <span class="pre">via</span> <span class="pre">...</span></code> path shown in the symbol information to figure out where
they come from.</p>
</li>
</ul>
</div>
<div class="section" id="checking-changes-with-scripts-kconfig-lint-py">
<h2><a class="toc-backref" href="#id16">Checking changes with <code class="file docutils literal notranslate"><span class="pre">scripts/kconfig/lint.py</span></code></a><a class="headerlink" href="#checking-changes-with-scripts-kconfig-lint-py" title="Permalink to this headline">¶</a></h2>
<p>After you make Kconfig changes, you can use the
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/scripts/kconfig/lint.py">scripts/kconfig/lint.py</a> script to check for some potential
issues, like unused symbols and symbols that are impossible to enable. Use
<code class="docutils literal notranslate"><span class="pre">--help</span></code> to see available options.</p>
<p>Some checks are necessarily a bit heuristic, so a symbol being flagged by a
check does not necessarily mean there’s a problem. If a check returns a false
positive e.g. due to token pasting in C (<code class="docutils literal notranslate"><span class="pre">CONFIG_FOO_##index##_BAR</span></code>), just
ignore it.</p>
<p>When investigating an unknown symbol <code class="docutils literal notranslate"><span class="pre">FOO_BAR</span></code>, it is a good idea to run
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">grep</span> <span class="pre">FOO_BAR</span></code> to look for references. It is also a good idea to search
for some components of the symbol name with e.g. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">grep</span> <span class="pre">FOO</span></code> and
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">grep</span> <span class="pre">BAR</span></code>, as it can help uncover token pasting.</p>
</div>
<div class="section" id="style-recommendations-and-shorthands">
<h2><a class="toc-backref" href="#id17">Style recommendations and shorthands</a><a class="headerlink" href="#style-recommendations-and-shorthands" title="Permalink to this headline">¶</a></h2>
<p>This section gives some style recommendations and explains some common Kconfig
shorthands.</p>
<div class="section" id="factoring-out-common-dependencies">
<h3><a class="toc-backref" href="#id18">Factoring out common dependencies</a><a class="headerlink" href="#factoring-out-common-dependencies" title="Permalink to this headline">¶</a></h3>
<p>If a sequence of symbols/choices share a common dependency, the dependency can
be factored out with an <code class="docutils literal notranslate"><span class="pre">if</span></code>.</p>
<p>As an example, consider the following code:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO
     bool &quot;Foo&quot;
     depends on DEP

config BAR
     bool &quot;Bar&quot;
     depends on DEP

choice
     prompt &quot;Choice&quot;
     depends on DEP

config BAZ
     bool &quot;Baz&quot;

config QAZ
     bool &quot;Qaz&quot;

endchoice
</pre></div>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">DEP</span></code> dependency can be factored out like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if DEP

config FOO
     bool &quot;Foo&quot;

config BAR
     bool &quot;Bar&quot;

choice
     prompt &quot;Choice&quot;

config BAZ
     bool &quot;Baz&quot;

config QAZ
     bool &quot;Qaz&quot;

endchoice

endif # DEP
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Internally, the second version of the code is transformed into the first.</p>
</div>
<p>If a sequence of symbols/choices with shared dependencies are all in the same
menu, the dependency can be put on the menu itself:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>menu &quot;Foo features&quot;
     depends on FOO_SUPPORT

config FOO_FEATURE_1
     bool &quot;Foo feature 1&quot;

config FOO_FEATURE_2
     bool &quot;Foo feature 2&quot;

endmenu
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">FOO_SUPPORT</span></code> is <code class="docutils literal notranslate"><span class="pre">n</span></code>, the entire menu disappears.</p>
</div>
<div class="section" id="redundant-defaults">
<h3><a class="toc-backref" href="#id19">Redundant defaults</a><a class="headerlink" href="#redundant-defaults" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">bool</span></code> symbols implicitly default to <code class="docutils literal notranslate"><span class="pre">n</span></code>, and <code class="docutils literal notranslate"><span class="pre">string</span></code> symbols implicitly
default to the empty string. Therefore, <code class="docutils literal notranslate"><span class="pre">default</span> <span class="pre">n</span></code> and <code class="docutils literal notranslate"><span class="pre">default</span> <span class="pre">&quot;&quot;</span></code> are
(almost) always redundant.</p>
<p>The recommended style in Zephyr is to skip redundant defaults for <code class="docutils literal notranslate"><span class="pre">bool</span></code> and
<code class="docutils literal notranslate"><span class="pre">string</span></code> symbols. That also generates clearer documentation: (<em>Implicitly
defaults to n</em> instead of <em>n if &lt;dependencies, possibly inherited&gt;</em>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The one case where <code class="docutils literal notranslate"><span class="pre">default</span> <span class="pre">n</span></code>/<code class="docutils literal notranslate"><span class="pre">default</span> <span class="pre">&quot;&quot;</span></code> is not redundant is when
defining a symbol in multiple locations and wanting to override e.g. a
<code class="docutils literal notranslate"><span class="pre">default</span> <span class="pre">y</span></code> on a later definition.</p>
</div>
<p>Defaults <em>should</em> always be given for <code class="docutils literal notranslate"><span class="pre">int</span></code> and <code class="docutils literal notranslate"><span class="pre">hex</span></code> symbols, however, as
they implicitly default to the empty string. This is partly for compatibility
with the C Kconfig tools, though an implicit 0 default might be less likely to
be what was intended compared to other symbol types as well.</p>
</div>
<div class="section" id="common-kconfig-shorthands">
<span id="kconfig-shorthands"></span><h3><a class="toc-backref" href="#id20">Common Kconfig shorthands</a><a class="headerlink" href="#common-kconfig-shorthands" title="Permalink to this headline">¶</a></h3>
<p>Kconfig has two shorthands that deal with prompts and defaults.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span> <span class="pre">&quot;prompt&quot;</span></code> is a shorthand for giving a symbol/choice a type and a
prompt at the same time. These two definitions are equal:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO
   bool &quot;foo&quot;
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO
   bool
   prompt &quot;foo&quot;
</pre></div>
</div>
<p>The first style, with the shorthand, is preferred in Zephyr.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">def_&lt;type&gt;</span> <span class="pre">&lt;value&gt;</span></code> is a shorthand for giving a type and a value at the
same time. These two definitions are equal:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO
   def_bool BAR &amp;&amp; BAZ
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO
   bool
   default BAR &amp;&amp; BAZ
</pre></div>
</div>
</li>
</ul>
<p>Using both the <code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span> <span class="pre">&quot;prompt&quot;</span></code> and the <code class="docutils literal notranslate"><span class="pre">def_&lt;type&gt;</span> <span class="pre">&lt;value&gt;</span></code> shorthand in
the same definition is redundant, since it gives the type twice.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">def_&lt;type&gt;</span> <span class="pre">&lt;value&gt;</span></code> shorthand is generally only useful for symbols
without prompts, and somewhat obscure.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a symbol defined in multiple locations (e.g., in a <code class="docutils literal notranslate"><span class="pre">Kconfig.defconfig</span></code>
file in Zephyr), it is best to only give the symbol type for the “base”
definition of the symbol, and to use <code class="docutils literal notranslate"><span class="pre">default</span></code> (instead of <code class="docutils literal notranslate"><span class="pre">def_&lt;type&gt;</span>
<span class="pre">value</span></code>) for the remaining definitions. That way, if the base definition of
the symbol is removed, the symbol ends up without a type, which generates a
warning that points to the other definitions. That makes the extra
definitions easier to discover and remove.</p>
</div>
</div>
<div class="section" id="prompt-strings">
<h3><a class="toc-backref" href="#id21">Prompt strings</a><a class="headerlink" href="#prompt-strings" title="Permalink to this headline">¶</a></h3>
<p>For a Kconfig symbol that enables a driver/subsystem FOO, consider having just
“Foo” as the prompt, instead of “Enable Foo support” or the like. It will
usually be clear in the context of an option that can be toggled on/off, and
makes things consistent.</p>
</div>
<div class="section" id="header-comments-and-other-nits">
<h3><a class="toc-backref" href="#id22">Header comments and other nits</a><a class="headerlink" href="#header-comments-and-other-nits" title="Permalink to this headline">¶</a></h3>
<p>A few formatting nits, to help keep things consistent:</p>
<ul>
<li><p>Use this format for any header comments at the top of <code class="docutils literal notranslate"><span class="pre">Kconfig</span></code> files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># &lt;Overview of symbols defined in the file, preferably in plain English&gt;
(Blank line)
# Copyright (c) 2019 ...
# SPDX-License-Identifier: &lt;License&gt;
(Blank line)
(Kconfig definitions)
</pre></div>
</div>
</li>
<li><p>Format comments as <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Comment</span></code> rather than <code class="docutils literal notranslate"><span class="pre">#Comment</span></code></p></li>
<li><p>Put a blank line before/after each top-level <code class="docutils literal notranslate"><span class="pre">if</span></code> and <code class="docutils literal notranslate"><span class="pre">endif</span></code></p></li>
<li><p>Use a single tab for each indentation</p></li>
<li><p>Indent help text with two extra spaces</p></li>
</ul>
</div>
</div>
<div class="section" id="lesser-known-used-kconfig-features">
<h2><a class="toc-backref" href="#id23">Lesser-known/used Kconfig features</a><a class="headerlink" href="#lesser-known-used-kconfig-features" title="Permalink to this headline">¶</a></h2>
<p>This section lists some more obscure Kconfig behaviors and features that might
still come in handy.</p>
<div class="section" id="the-imply-statement">
<h3><a class="toc-backref" href="#id24">The <code class="docutils literal notranslate"><span class="pre">imply</span></code> statement</a><a class="headerlink" href="#the-imply-statement" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">imply</span></code> statement is similar to <code class="docutils literal notranslate"><span class="pre">select</span></code>, but respects dependencies and
doesn’t force a value. For example, the following code could be used to enable
USB keyboard support by default on the FOO SoC, while still allowing the user
to turn it off:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config SOC_FOO
     bool &quot;FOO SoC&quot;
     imply USB_KEYBOARD

...

config USB_KEYBOARD
     bool &quot;USB keyboard support&quot;
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">imply</span></code> acts like a suggestion, whereas <code class="docutils literal notranslate"><span class="pre">select</span></code> forces a value.</p>
</div>
<div class="section" id="optional-prompts">
<h3><a class="toc-backref" href="#id25">Optional prompts</a><a class="headerlink" href="#optional-prompts" title="Permalink to this headline">¶</a></h3>
<p>A condition can be put on a symbol’s prompt to make it optionally configurable
by the user. For example, a value <code class="docutils literal notranslate"><span class="pre">MASK</span></code> that’s hardcoded to 0xFF on some
boards and configurable on others could be expressed as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config MASK
     hex &quot;Bitmask&quot; if HAS_CONFIGURABLE_MASK
     default 0xFF
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is short for the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config MASK
  hex
  prompt &quot;Bitmask&quot; if HAS_CONFIGURABLE_MASK
  default 0xFF
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">HAS_CONFIGURABLE_MASK</span></code> helper symbol would get selected by boards to
indicate that <code class="docutils literal notranslate"><span class="pre">MASK</span></code> is configurable. When <code class="docutils literal notranslate"><span class="pre">MASK</span></code> is configurable, it will
also default to 0xFF.</p>
</div>
<div class="section" id="optional-choices">
<h3><a class="toc-backref" href="#id26">Optional choices</a><a class="headerlink" href="#optional-choices" title="Permalink to this headline">¶</a></h3>
<p>Defining a choice with the <code class="docutils literal notranslate"><span class="pre">optional</span></code> keyword allows the whole choice to be
toggled off to select none of the symbols:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>choice
     prompt &quot;Use legacy protocol&quot;
     optional

config LEGACY_PROTOCOL_1
     bool &quot;Legacy protocol 1&quot;

config LEGACY_PROTOCOL_2
     bool &quot;Legacy protocol 2&quot;

endchoice
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> interface, this will be displayed e.g. as
<code class="docutils literal notranslate"><span class="pre">[*]</span> <span class="pre">Use</span> <span class="pre">legacy</span> <span class="pre">protocol</span> <span class="pre">(Legacy</span> <span class="pre">protocol</span> <span class="pre">1)</span> <span class="pre">---&gt;</span></code>, where the choice can be
toggled off to enable neither of the symbols.</p>
</div>
<div class="section" id="visible-if-conditions">
<h3><a class="toc-backref" href="#id27"><code class="docutils literal notranslate"><span class="pre">visible</span> <span class="pre">if</span></code> conditions</a><a class="headerlink" href="#visible-if-conditions" title="Permalink to this headline">¶</a></h3>
<p>Putting a <code class="docutils literal notranslate"><span class="pre">visible</span> <span class="pre">if</span></code> condition on a menu hides the menu and all the symbols
within it, while still allowing symbol default values to kick in.</p>
<p>As a motivating example, consider the following code:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>menu &quot;Foo subsystem&quot;
     depends on HAS_CONFIGURABLE_FOO

config FOO_SETTING_1
     int &quot;Foo setting 1&quot;
     default 1

config FOO_SETTING_2
     int &quot;Foo setting 2&quot;
     default 2

endmenu
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">HAS_CONFIGURABLE_FOO</span></code> is <code class="docutils literal notranslate"><span class="pre">n</span></code>, no configuration output is generated
for <code class="docutils literal notranslate"><span class="pre">FOO_SETTING_1</span></code> and <code class="docutils literal notranslate"><span class="pre">FOO_SETTING_2</span></code>, as the code above is logically
equivalent to the following code:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO_SETTING_1
     int &quot;Foo setting 1&quot;
     default 1
     depends on HAS_CONFIGURABLE_FOO

config FOO_SETTING_2
     int &quot;Foo setting 2&quot;
     default 2
     depends on HAS_CONFIGURABLE_FOO
</pre></div>
</div>
<p>If we want the symbols to still get their default values even when
<code class="docutils literal notranslate"><span class="pre">HAS_CONFIGURABLE_FOO</span></code> is <code class="docutils literal notranslate"><span class="pre">n</span></code>, but not be configurable by the user, then we
can use <code class="docutils literal notranslate"><span class="pre">visible</span> <span class="pre">if</span></code> instead:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>menu &quot;Foo subsystem&quot;
     visible if HAS_CONFIGURABLE_FOO

config FOO_SETTING_1
     int &quot;Foo setting 1&quot;
     default 1

config FOO_SETTING_2
     int &quot;Foo setting 2&quot;
     default 2

endmenu
</pre></div>
</div>
<p>This is logically equivalent to the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO_SETTING_1
     int &quot;Foo setting 1&quot; if HAS_CONFIGURABLE_FOO
     default 1

config FOO_SETTING_2
     int &quot;Foo setting 2&quot; if HAS_CONFIGURABLE_FOO
     default 2
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a class="reference internal" href="#optional-prompts">optional prompts</a> section for the meaning of the conditions on the
prompts.</p>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">HAS_CONFIGURABLE</span></code> is <code class="docutils literal notranslate"><span class="pre">n</span></code>, we now get the following configuration
output for the symbols, instead of no output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
CONFIG_FOO_SETTING_1=1
CONFIG_FOO_SETTING_2=2
...
</pre></div>
</div>
</div>
</div>
<div class="section" id="other-resources">
<h2><a class="toc-backref" href="#id28">Other resources</a><a class="headerlink" href="#other-resources" title="Permalink to this headline">¶</a></h2>
<p>The <em>Intro to symbol values</em> section in the <a class="reference external" href="https://github.com/ulfalizer/Kconfiglib/blob/master/kconfiglib.py">Kconfiglib docstring</a> goes
over how symbols values are calculated in more detail.</p>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>