<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modules (External projects) &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script type="module" src="../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../_static/js/ga-tracker.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Networking" href="networking/index.html" />
    <link rel="prev" title="Peripheral and Hardware Emulators" href="emulator/index.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User and Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="beyond-GSG.html">Beyond the Getting Started Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="arch/index.html">Architecture-related Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="docs/index.html">Documentation Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="coccinelle.html">Coccinelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="code-relocation.html">Code And Data Relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="crypto/index.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="flash_debug/index.html">Flashing and Hardware Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug_tools/index.html">Debugging and Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_mgmt/index.html">Device Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="dts/index.html">Devicetree Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_vars.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="emulator/index.html">Peripheral and Hardware Emulators</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Modules (External projects)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-repositories">Module Repositories</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#synchronizing-with-upstream">Synchronizing with upstream</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#contributing-to-zephyr-modules">Contributing to Zephyr modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#individual-roles-responsibilities">Individual Roles &amp; Responsibilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#maintaining-the-module-codebase">Maintaining the module codebase</a></li>
<li class="toctree-l4"><a class="reference internal" href="#contributing-changes-to-modules">Contributing changes to modules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#licensing-requirements-and-policies">Licensing requirements and policies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#license-policies">License policies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#documentation-requirements">Documentation requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-requirements">Testing requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deprecating-and-removing-modules">Deprecating and removing modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integrate-modules-in-zephyr-build-system">Integrate modules in Zephyr build system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-yaml-file-description">Module yaml file description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#module-name">Module name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-integration-files-in-module">Module integration files (in-module)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-system-integration">Build system integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#zephyr-module-dependencies">Zephyr module dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-integration-files-external">Module integration files (external)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-settings">Build settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#twister-test-runner">Twister (Test Runner)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-inclusion">Module Inclusion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#submitting-changes-to-modules">Submitting changes to modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#process-for-submitting-a-new-module">Process for submitting a new module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#process-for-submitting-changes-to-existing-modules">Process for submitting changes to existing modules</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="platformio/index.html">Using with PlatformIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="portability/index.html">OS Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting/index.html">Porting</a></li>
<li class="toctree-l2"><a class="reference internal" href="smf/index.html">State Machine Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="test/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm/index.html">Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="west/index.html">West (Zephyr’s meta-tool)</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimizations/index.html">Optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="zephyr_cmake_package.html">Zephyr CMake Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="index.html">User and Developer Guides</a> &raquo;</li>
  
  <li>Modules (External projects)</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/guides/modules.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="modules-external-projects">
<span id="modules"></span><h1>Modules (External projects)<a class="headerlink" href="#modules-external-projects" title="Permalink to this headline">¶</a></h1>
<p>Zephyr relies on the source code of several externally maintained projects in
order to avoid reinventing the wheel and to reuse as much well-established,
mature code as possible when it makes sense. In the context of Zephyr’s build
system those are called <em>modules</em>. These modules must be integrated with the
Zephyr build system, as described in more detail in other sections on
this page.</p>
<p>To be classified as a candidate for being included in the default list of
modules, an external project is required to have its own life-cycle outside
the Zephyr Project, that is, reside in its own repository, and have its own
contribution and maintenance workfow and release process. Zephyr modules
should not contain code that is written exclusively for Zephyr. Instead,
such code should be contributed to the main zephyr tree.</p>
<p>Modules to be included in the default manifest of the Zephyr project need to
provide functionality or features endorsed and approved by the project Technical
Steering Committee and should comply with the
<a class="reference internal" href="#modules-licensing"><span class="std std-ref">module licensing requirements</span></a> and
<a class="reference internal" href="#modules-contributing"><span class="std std-ref">contribution guidelines</span></a>. They should also have a
Zephyr developer that is committed to maintain the module codebase.</p>
<p>Zephyr depends on several categories of modules, including but not limited to:</p>
<ul class="simple">
<li><p>Debugger integration</p></li>
<li><p>Silicon vendor Hardware Abstraction Layers (HALs)</p></li>
<li><p>Cryptography libraries</p></li>
<li><p>File Systems</p></li>
<li><p>Inter-Process Communication (IPC) libraries</p></li>
</ul>
<p>This page summarizes a list of policies and best practices which aim at
better organizing the workflow in Zephyr modules.</p>
<div class="section" id="module-repositories">
<h2>Module Repositories<a class="headerlink" href="#module-repositories" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>All modules included in the default manifest shall be hosted in repositories
under the zephyrproject-rtos GitHub organization.</p></li>
<li><p>The module repository codebase shall include a <em>module.yml</em> file in a
<code class="file docutils literal notranslate"><span class="pre">zephyr/</span></code> folder at the root of the repository.</p></li>
<li><p>Module repository names should follow the convention of using lowercase
letters and dashes instead of underscores. This rule will apply to all
new module repositories, except for repositories that are directly
tracking external projects (hosted in Git repositories); such modules
may be named as their external project counterparts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Existing module repositories that do not conform to the above convention
do not need to be renamed to comply with the above convention.</p>
</div>
</li>
<li><p>Modules should use “zephyr” as the default name for the repository main
branch. Branches for specific purposes, for example, a module branch for
an LTS Zephyr version, shall have names starting with the ‘zephyr_’ prefix.</p></li>
<li><p>If the module has an external (upstream) project repository, the module
repository should preserve the upstream repository folder structure.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not required in module repositories to maintain a ‘master’
branch mirroring the master branch of the external repository. It
is not recommended as this may generate confusion around the module’s
main branch, which should be ‘zephyr’.</p>
</div>
</li>
</ul>
<div class="section" id="synchronizing-with-upstream">
<span id="modules-synchronization"></span><h3>Synchronizing with upstream<a class="headerlink" href="#synchronizing-with-upstream" title="Permalink to this headline">¶</a></h3>
<p>It is preferred to synchronize a module respository with the latest stable
release of the corresponding external project. It is permitted, however, to
update a Zephyr module repository with the latest development branch tip,
if this is required to get important updates in the module codebase. When
synchronizing a module with upstream it is mandatory to document the
rationale for performing the particular update.</p>
<div class="section" id="requirements-for-allowed-practices">
<h4>Requirements for allowed practices<a class="headerlink" href="#requirements-for-allowed-practices" title="Permalink to this headline">¶</a></h4>
<p>Changes to the main branch of a module repository, including synchronization
with upstream code base, may only be applied via pull requests. These pull
requests shall be <em>verifiable</em> by Zephyr CI and <em>mergeable</em> (e.g. with the
<em>Rebase and merge</em>, or <em>Create a merge commit</em> option using Github UI). This
ensures that the incoming changes are always <strong>reviewable</strong>, and the
<em>downstream</em> module repository history is incremental (that is, existing
commits, tags, etc. are always preserved). This policy also allows to run
Zephyr CI, git lint, identity, and license checks directly on the set of
changes that are to be brought into the module repository.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Force-pushing to a module’s main branch is not allowed.</p>
</div>
</div>
<div class="section" id="allowed-practices">
<h4>Allowed practices<a class="headerlink" href="#allowed-practices" title="Permalink to this headline">¶</a></h4>
<p>The following practices conform to the above requirements and should be
followed in all modules repositories. It is up to the module code owner
to select the preferred synchronization practice, however, it is required
that the selected practice is consistently followed in the respective
module repository.</p>
<p><strong>Updating modules with a diff from upstream:</strong>
Upstream changes brought as a single <em>snapshot</em> commit (manual diff) in a
pull request against the module’s main branch, which may be merged using
the <em>Rebase &amp; merge</em> operation. This approach is simple and
should be applicable to all modules with the downside of supressing the
upstream history in the module repository.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above practice is the only allowed practice in modules where
the external project is not hosted in an upstream Git repository.</p>
</div>
</div></blockquote>
<p>The commit message is expected to identify the upstream project URL, the
version to which the module is updated (upstream version, tag, commit SHA,
if applicable, etc.), and the reason for the doing the update.</p>
<p><strong>Updating modules by merging the upstream branch:</strong>
Upstream changes brought in by performing a Git merge of the intended upstream
branch (e.g. main branch, latest release branch, etc.) submitting the result in
pull request against the module main branch, and merging the pull request using
the <em>Create a merge commit</em> operation.
This approach is applicable to modules with an upstream project Git repository.
The main advantages of this approach is that the upstream repository history
(that is, the original commit SHAs) is preserved in the module repository. The
downside of this approach is that two additional merge commits are generated in
the downstream main branch.</p>
</div>
</div>
</div>
<div class="section" id="contributing-to-zephyr-modules">
<h2>Contributing to Zephyr modules<a class="headerlink" href="#contributing-to-zephyr-modules" title="Permalink to this headline">¶</a></h2>
<div class="section" id="individual-roles-responsibilities">
<span id="modules-contributing"></span><h3>Individual Roles &amp; Responsibilities<a class="headerlink" href="#individual-roles-responsibilities" title="Permalink to this headline">¶</a></h3>
<p>To facilitate management of Zephyr module repositories, the following
individual roles are defined.</p>
<p><strong>Administrator:</strong> Each Zephyr module shall have an administrator
who is responsible for managing access to the module repository,
for example, for adding individuals as Collaborators in the repository
at the request of the module owner. Module administrators are
members of the Administrators team, that is a group of project
members with admin rights to module GitHub repositories.</p>
<p><strong>Module owner:</strong> Each module shall have a module code owner. Module
owners will have the overall responsibility of the contents of a
Zephyr module repository. In particular, a module owner will:</p>
<ul>
<li><p>coordinate code reviewing in the module repository</p></li>
<li><p>be the default assignee in pull-requests against the repository’s
main branch</p></li>
<li><p>request additional collaborators to be added to the repository, as
they see fit</p></li>
<li><p>regularly synchronize the module repository with its upstream
counterpart following the policies described in
<a class="reference internal" href="#modules-synchronization"><span class="std std-ref">Synchronizing with upstream</span></a></p></li>
<li><p>be aware of security vulnerability issues in the external project
and update the module repository to include security fixes, as
soon as the fixes are available in the upstream code base</p></li>
<li><p>list any known security vulnerability issues, present in the
module codebase, in Zephyr release notes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Module owners are not required to be Zephyr
<a class="reference internal" href="../development_process/project_roles.html#project-roles"><span class="std std-ref">Maintainers</span></a>.</p>
</div>
</li>
</ul>
<p><strong>Merger:</strong> The Zephyr Release Engineering team has the right and the
responsibility to merge approved pull requests in the main branch of a
module repository.</p>
</div>
<div class="section" id="maintaining-the-module-codebase">
<h3>Maintaining the module codebase<a class="headerlink" href="#maintaining-the-module-codebase" title="Permalink to this headline">¶</a></h3>
<p>Updates in the zephyr main tree, for example, in public Zephyr APIs,
may require patching a module’s codebase. The responsibility for keeping
the module codebase up to date is shared between the <strong>contributor</strong> of
such updates in Zephyr and the module <strong>owner</strong>. In particular:</p>
<ul class="simple">
<li><p>the contributor of the original changes in Zephyr is required to submit
the corresponding changes that are required in module repositories, to
ensure that Zephyr CI on the pull request with the original changes, as
well as the module integration testing are successful.</p></li>
<li><p>the module owner has the overall responsibility for synchronizing
and testing the module codebase with the zephyr main tree.
This includes occasional advanced testing of the module’s codebase
in addition to the testing performed by Zephyr’s CI.
The module owner is required to fix issues in the module’s codebase that
have not been caught by Zephyr pull request CI runs.</p></li>
</ul>
</div>
<div class="section" id="contributing-changes-to-modules">
<h3>Contributing changes to modules<a class="headerlink" href="#contributing-changes-to-modules" title="Permalink to this headline">¶</a></h3>
<p>Submitting and merging changes directly to a module’s codebase, that is,
before they have been merged in the corresponding external project
repository, should be limited to:</p>
<ul class="simple">
<li><p>changes required due to updates in the zephyr main tree</p></li>
<li><p>urgent changes that should not wait to be merged in the external project
first, such as fixes to security vulnerabilities.</p></li>
</ul>
<p>Non-trivial changes to a module’s codebase, including changes in the module
design or functionality should be discouraged, if the module has an upstream
project repository. In that case, such changes shall be submitted to the
upstream project, directly.</p>
<p><a class="reference internal" href="#submitting-new-modules"><span class="std std-ref">Submitting changes to modules</span></a> describes in
detail the process of contributing changes to module repositories.</p>
<div class="section" id="contribution-guidelines">
<h4>Contribution guidelines<a class="headerlink" href="#contribution-guidelines" title="Permalink to this headline">¶</a></h4>
<p>Contributing to Zephyr modules shall follow the generic project
<a class="reference internal" href="../contribute/index.html#contribute-guidelines"><span class="std std-ref">Contribution guidelines</span></a>.</p>
<p><strong>Pull Requests:</strong> may be merged with minimum of 2 approvals, including
an approval by the PR assignee. In addition to this, pull requests in module
repositories may only be merged if the introduced changes are verified
with Zephyr CI tools, as described in more detail in other sections on
this page.</p>
<p>The merging of pull requests in the main branch of a module
repository must be coupled with the corresponding manifest
file update in the zephyr main tree.</p>
<p><strong>Issue Reporting:</strong> GitHub issues are intentionally disabled in module
repositories, in
favor of a centralized policy for issue reporting. Tickets concerning, for
example, bugs or enhancements in modules shall be opened in the main
zephyr repository. Issues should be appropriately labeled using GitHub
labels corresponding to each module, where applicable.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is allowed to file bug reports for zephyr modules to track
the corresponding upstream project bugs in Zephyr. These bug reports
shall not affect the
<a class="reference internal" href="../development_process/release_process.html#release-quality-criteria"><span class="std std-ref">Release Quality Criteria</span></a>.</p>
</div>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="licensing-requirements-and-policies">
<span id="modules-licensing"></span><h2>Licensing requirements and policies<a class="headerlink" href="#licensing-requirements-and-policies" title="Permalink to this headline">¶</a></h2>
<p>All source files in a module’s codebase shall include a license header,
unless the module repository has <strong>main license file</strong> that covers source
files that do not include license headers.</p>
<p>Main license files shall be added in the module’s codebase by Zephyr
developers, only if they exist as part of the external project,
and they contain a permissive OSI-compliant license. Main license files
should preferably contain the full license text instead of including an
SPDX license identifier. If multiple main license files are present it
shall be made clear which license applies to each source file in a module’s
codebase.</p>
<p>Individual license headers in module source files supersede the main license.</p>
<p>Any new content to be added in a module repository will require to have
license coverage.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Zephyr recommends conveying module licensing via individual license
headers and main license files. This not a hard requirement; should
an external project have its own practice of conveying how licensing
applies in the module’s codebase (for example, by having a single or
multiple main license files), this practice may be accepted by and
be referred to in the Zephyr module, as long as licensing requirements,
for example OSI compliance, are satisfied.</p>
</div>
</div></blockquote>
<div class="section" id="license-policies">
<h3>License policies<a class="headerlink" href="#license-policies" title="Permalink to this headline">¶</a></h3>
<p>When creating a module repository a developer shall:</p>
<ul class="simple">
<li><p>import the main license files, if they exist in the external project, and</p></li>
<li><p>document (for example in the module README or .yml file) the default license
that covers the module’s codebase.</p></li>
</ul>
<div class="section" id="license-checks">
<h4>License checks<a class="headerlink" href="#license-checks" title="Permalink to this headline">¶</a></h4>
<p>License checks (via CI tools) shall be enabled on every pull request that
adds new content in module repositories.</p>
</div>
</div>
</div>
<div class="section" id="documentation-requirements">
<h2>Documentation requirements<a class="headerlink" href="#documentation-requirements" title="Permalink to this headline">¶</a></h2>
<p>All Zephyr module repositories shall include an .rst file documenting:</p>
<ul class="simple">
<li><p>the scope and the purpose of the module</p></li>
<li><p>how the module integrates with Zephyr</p></li>
<li><p>the owner of the module repository</p></li>
<li><p>synchronization information with the external project (commit, SHA, version etc.)</p></li>
<li><p>licensing information as described in <a class="reference internal" href="#modules-licensing"><span class="std std-ref">Licensing requirements and policies</span></a>.</p></li>
</ul>
<p>The file shall be required for the inclusion of the module and the contained
information should be kept up to date.</p>
</div>
<div class="section" id="testing-requirements">
<h2>Testing requirements<a class="headerlink" href="#testing-requirements" title="Permalink to this headline">¶</a></h2>
<p>All Zephyr modules should provide some level of <strong>integration</strong> testing,
ensuring that the integration with Zephyr works correctly.
Integration tests:</p>
<ul>
<li><p>may be in the form of a minimal set of samples and tests that reside
in the zephyr main tree</p></li>
<li><p>should verify basic usage of the module (configuration,
functional APIs, etc.) that is integrated with Zephyr.</p></li>
<li><p>shall be built and executed (for example in QEMU) as part of
twister runs in pull requests that introduce changes in module
repositories.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>New modules, that are candidates for being included in the Zephyr
default manifest, shall provide some level of integration testing.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Vendor HALs are implicitly tested via Zephyr tests built or executed
on target platforms, so they do not need to provide integration tests.</p>
</div>
</li>
</ul>
<p>The purpose of integration testing is not to provide functional verification
of the module; this should be part of the testing framework of the external
project.</p>
<p>Certain external projects provide test suites that reside in the upstream
testing infrastructure but are written explicitly for Zephyr. These tests
may (but are not required to) be part of the Zephyr test framework.</p>
</div>
<div class="section" id="deprecating-and-removing-modules">
<h2>Deprecating and removing modules<a class="headerlink" href="#deprecating-and-removing-modules" title="Permalink to this headline">¶</a></h2>
<p>Modules may be deprecated for reasons including, but not limited to:</p>
<ul class="simple">
<li><p>Lack of maintainership in the module</p></li>
<li><p>Licensing changes in the external project</p></li>
<li><p>Codebase becoming obsolete</p></li>
</ul>
<p>The module information shall indicate whether a module is
deprecated and the build system shall issue a warning
when trying to build Zephyr using a deprecated module.</p>
<p>Deprecated modules may be removed from the Zephyr default manifest
after 2 Zephyr releases.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Repositories of removed modules shall remain accessible via their
original URL, as they are required by older Zephyr versions.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="integrate-modules-in-zephyr-build-system">
<h2>Integrate modules in Zephyr build system<a class="headerlink" href="#integrate-modules-in-zephyr-build-system" title="Permalink to this headline">¶</a></h2>
<p>The build system variable <strong class="makevar">ZEPHYR_MODULES</strong> is a <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake-language.7.html#lists">CMake list</a> of
absolute paths to the directories containing Zephyr modules. These modules
contain <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and <code class="file docutils literal notranslate"><span class="pre">Kconfig</span></code> files describing how to
build and configure them, respectively. Module <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files are
added to the build using CMake’s <a class="reference external" href="https://cmake.org/cmake/help/latest/command/add_subdirectory.html">add_subdirectory()</a> command, and the
<code class="file docutils literal notranslate"><span class="pre">Kconfig</span></code> files are included in the build’s Kconfig menu tree.</p>
<p>If you have <a class="reference internal" href="west/index.html#west"><span class="std std-ref">west</span></a> installed, you don’t need to worry about how
this variable is defined unless you are adding a new module. The build system
knows how to use west to set <strong class="makevar">ZEPHYR_MODULES</strong>. You can add additional
modules to this list by setting the <strong class="makevar">ZEPHYR_EXTRA_MODULES</strong> CMake
variable or by adding a <strong class="makevar">ZEPHYR_EXTRA_MODULES</strong> line to <code class="docutils literal notranslate"><span class="pre">.zephyrrc</span></code>
(See the section on <a class="reference internal" href="env_vars.html#env-vars"><span class="std std-ref">Environment Variables</span></a> for more details). This can be
useful if you want to keep the list of modules found with west and also add
your own.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the module <code class="docutils literal notranslate"><span class="pre">FOO</span></code> is provided by <a class="reference internal" href="west/index.html#west"><span class="std std-ref">west</span></a> but also given with
<code class="docutils literal notranslate"><span class="pre">-DZEPHYR_EXTRA_MODULES=/&lt;path&gt;/foo</span></code> then the module given by the command
line variable <strong class="makevar">ZEPHYR_EXTRA_MODULES</strong> will take precedence.
This allows you to use a custom version of <code class="docutils literal notranslate"><span class="pre">FOO</span></code> when building and still
use other Zephyr modules provided by <a class="reference internal" href="west/index.html#west"><span class="std std-ref">west</span></a>.
This can for example be useful for special test purposes.</p>
</div>
<p>If you want to permanently add modules to the zephyr workspace and you are
using zephyr as your manifest repository, you can also add a west manifest file
into the <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/submanifests">submanifests</a> directory. See
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/submanifests/README.txt">submanifests/README.txt</a> for more details.</p>
<p>See <a class="reference internal" href="west/basics.html#west-basics"><span class="std std-ref">Basics</span></a> for more on west workspaces.</p>
<p>Finally, you can also specify the list of modules yourself in various ways, or
not use modules at all if your application doesn’t need them.</p>
</div>
<div class="section" id="module-yaml-file-description">
<h2>Module yaml file description<a class="headerlink" href="#module-yaml-file-description" title="Permalink to this headline">¶</a></h2>
<p>A module can be described using a file named <code class="file docutils literal notranslate"><span class="pre">zephyr/module.yml</span></code>.
The format of <code class="file docutils literal notranslate"><span class="pre">zephyr/module.yml</span></code> is described in the following:</p>
<div class="section" id="module-name">
<h3>Module name<a class="headerlink" href="#module-name" title="Permalink to this headline">¶</a></h3>
<p>Each Zephyr module is given a name by which it can be referred to in the build
system.</p>
<p>The name may be specified in the <code class="file docutils literal notranslate"><span class="pre">zephyr/module.yml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;name&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>In CMake the location of the Zephyr module can then be referred to using the
CMake variable <code class="docutils literal notranslate"><span class="pre">ZEPHYR_&lt;MODULE_NAME&gt;_MODULE_DIR</span></code> and the variable
<code class="docutils literal notranslate"><span class="pre">ZEPHYR_&lt;MODULE_NAME&gt;_CMAKE_DIR</span></code> holds the location of the directory
containing the module’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When used for CMake and Kconfig variables, all letters in module names are
converted to uppercase and all non-alphanumeric characters are converted
to underscores (_).
As example, the module <code class="docutils literal notranslate"><span class="pre">foo-bar</span></code> must be referred to as
<code class="docutils literal notranslate"><span class="pre">ZEPHYR_FOO_BAR_MODULE_DIR</span></code> in CMake and Kconfig.</p>
</div>
<p>Here is an example for the Zephyr module <code class="docutils literal notranslate"><span class="pre">foo</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">name</span></code> field is not specified then the Zephyr module name will be
set to the name of the module folder.
As example, the Zephyr module located in <code class="file docutils literal notranslate"><span class="pre">&lt;workspace&gt;/modules/bar</span></code> will
use <code class="docutils literal notranslate"><span class="pre">bar</span></code> as its module name if nothing is specified in
<code class="file docutils literal notranslate"><span class="pre">zephyr/module.yml</span></code>.</p>
</div>
</div>
<div class="section" id="module-integration-files-in-module">
<h3>Module integration files (in-module)<a class="headerlink" href="#module-integration-files-in-module" title="Permalink to this headline">¶</a></h3>
<p>Inclusion of build files, <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and <code class="file docutils literal notranslate"><span class="pre">Kconfig</span></code>, can be
described as:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">cmake</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;cmake-directory&gt;</span><span class="w"></span>
<span class="w">  </span><span class="nt">kconfig</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;directory&gt;/Kconfig</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">cmake:</span> <span class="pre">&lt;cmake-directory&gt;</span></code> part specifies that
<code class="file docutils literal notranslate"><span class="pre">&lt;cmake-directory&gt;</span></code> contains the <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> to use. The
<code class="docutils literal notranslate"><span class="pre">kconfig:</span> <span class="pre">&lt;directory&gt;/Kconfig</span></code> part specifies the Kconfig file to use.
Neither is required: <code class="docutils literal notranslate"><span class="pre">cmake</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">zephyr</span></code>, and <code class="docutils literal notranslate"><span class="pre">kconfig</span></code>
defaults to <code class="docutils literal notranslate"><span class="pre">zephyr/Kconfig</span></code>.</p>
<p>Here is an example <code class="file docutils literal notranslate"><span class="pre">module.yml</span></code> file referring to
<code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and <code class="file docutils literal notranslate"><span class="pre">Kconfig</span></code> files in the root directory of the
module:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">cmake</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span><span class="w"></span>
<span class="w">  </span><span class="nt">kconfig</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kconfig</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="build-system-integration">
<h3>Build system integration<a class="headerlink" href="#build-system-integration" title="Permalink to this headline">¶</a></h3>
<p>When a module has a <code class="file docutils literal notranslate"><span class="pre">module.yml</span></code> file, it will automatically be included into
the Zephyr build system. The path to the module is then accessible through Kconfig
and CMake variables.</p>
<p>In both Kconfig and CMake, the variable <code class="docutils literal notranslate"><span class="pre">ZEPHYR_&lt;MODULE_NAME&gt;_MODULE_DIR</span></code>
contains the absolute path to the module.</p>
<p>In CMake, <code class="docutils literal notranslate"><span class="pre">ZEPHYR_&lt;MODULE_NAME&gt;_CMAKE_DIR</span></code> contains the
absolute path to the directory containing the <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file that
is included into CMake build system. This variable’s value is empty if the
module.yml file does not specify a CMakeLists.txt.</p>
<p>To read these variables for a Zephyr module named <code class="docutils literal notranslate"><span class="pre">foo</span></code>:</p>
<ul class="simple">
<li><p>In CMake: use <code class="docutils literal notranslate"><span class="pre">${ZEPHYR_FOO_MODULE_DIR}</span></code> for the module’s top level directory, and <code class="docutils literal notranslate"><span class="pre">${ZEPHYR_FOO_CMAKE_DIR}</span></code> for the directory containing its <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code></p></li>
<li><p>In Kconfig: use <code class="docutils literal notranslate"><span class="pre">$(ZEPHYR_FOO_MODULE_DIR)</span></code> for the module’s top level directory</p></li>
</ul>
<p>Notice how a lowercase module name <code class="docutils literal notranslate"><span class="pre">foo</span></code> is capitalized to <code class="docutils literal notranslate"><span class="pre">FOO</span></code>
in both CMake and Kconfig.</p>
<p>These variables can also be used to test whether a given module exists.
For example, to verify that <code class="docutils literal notranslate"><span class="pre">foo</span></code> is the name of a Zephyr module:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="s">ZEPHYR_FOO_MODULE_DIR</span><span class="p">)</span>
<span class="w">  </span><span class="c"># Do something if FOO exists.</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>In Kconfig, the variable may be used to find additional files to include.
For example, to include the file <code class="file docutils literal notranslate"><span class="pre">some/Kconfig</span></code> in module <code class="docutils literal notranslate"><span class="pre">foo</span></code>:</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="k">source</span><span class="w"> </span><span class="s2">&quot;$(ZEPHYR_FOO_MODULE_DIR)/some/Kconfig&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>During CMake processing of each Zephyr module, the following two variables are
also available:</p>
<ul class="simple">
<li><p>the current module’s top level directory: <code class="docutils literal notranslate"><span class="pre">${ZEPHYR_CURRENT_MODULE_DIR}</span></code></p></li>
<li><p>the current module’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> directory: <code class="docutils literal notranslate"><span class="pre">${ZEPHYR_CURRENT_CMAKE_DIR}</span></code></p></li>
</ul>
<p>This removes the need for a Zephyr module to know its own name during CMake
processing. The module can source additional CMake files using these <code class="docutils literal notranslate"><span class="pre">CURRENT</span></code>
variables. For example:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">include</span><span class="p">(</span><span class="o">${</span><span class="nv">ZEPHYR_CURRENT_MODULE_DIR</span><span class="o">}</span><span class="s">/cmake/code.cmake</span><span class="p">)</span>
</pre></div>
</div>
<p>It is possible to append values to a Zephyr CMake list variable from the module’s first
CMakeLists.txt file.
To do so, append the value to the list and then set the list in the PARENT_SCOPE
of the CMakeLists.txt file. For example, to append <code class="docutils literal notranslate"><span class="pre">bar</span></code> to the <code class="docutils literal notranslate"><span class="pre">FOO_LIST</span></code> variable in the
Zephyr CMakeLists.txt scope:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="s">APPEND</span><span class="w"> </span><span class="s">FOO_LIST</span><span class="w"> </span><span class="s">bar</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">FOO_LIST</span><span class="w"> </span><span class="o">${</span><span class="nv">FOO_LIST</span><span class="o">}</span><span class="w"> </span><span class="s">PARENT_SCOPE</span><span class="p">)</span>
</pre></div>
</div>
<p>An example of a Zephyr list where this is useful is when adding additional
directories to the <code class="docutils literal notranslate"><span class="pre">SYSCALL_INCLUDE_DIRS</span></code> list.</p>
</div>
<div class="section" id="zephyr-module-dependencies">
<h3>Zephyr module dependencies<a class="headerlink" href="#zephyr-module-dependencies" title="Permalink to this headline">¶</a></h3>
<p>A Zephyr module may be dependent on other Zephyr modules to be present in order
to function correctly. Or it might be that a given Zephyr module must be
processed after another Zephyr module, due to dependencies of certain CMake
targets.</p>
<p>Such a dependency can be described using the <code class="docutils literal notranslate"><span class="pre">depends</span></code> field.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">depends</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;module&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>Here is an example for the Zephyr module <code class="docutils literal notranslate"><span class="pre">foo</span></code> that is dependent on the Zephyr
module <code class="docutils literal notranslate"><span class="pre">bar</span></code> to be present in the build system:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span><span class="w"></span>
<span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">depends</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span><span class="w"></span>
</pre></div>
</div>
<p>This example will ensure that <code class="docutils literal notranslate"><span class="pre">bar</span></code> is present when <code class="docutils literal notranslate"><span class="pre">foo</span></code> is included into
the build system, and it will also ensure that <code class="docutils literal notranslate"><span class="pre">bar</span></code> is processed before
<code class="docutils literal notranslate"><span class="pre">foo</span></code>.</p>
</div>
<div class="section" id="module-integration-files-external">
<span id="modules-module-ext-root"></span><h3>Module integration files (external)<a class="headerlink" href="#module-integration-files-external" title="Permalink to this headline">¶</a></h3>
<p>Module integration files can be located externally to the Zephyr module itself.
The <code class="docutils literal notranslate"><span class="pre">MODULE_EXT_ROOT</span></code> variable holds a list of roots containing integration
files located externally to Zephyr modules.</p>
<div class="section" id="module-integration-files-in-zephyr">
<h4>Module integration files in Zephyr<a class="headerlink" href="#module-integration-files-in-zephyr" title="Permalink to this headline">¶</a></h4>
<p>The Zephyr repository contain <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and <code class="file docutils literal notranslate"><span class="pre">Kconfig</span></code> build
files for certain known Zephyr modules.</p>
<p>Those files are located under</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;ZEPHYR_BASE&gt;
└── modules
    └── &lt;module_name&gt;
        ├── CMakeLists.txt
        └── Kconfig
</pre></div>
</div>
</div>
<div class="section" id="module-integration-files-in-a-custom-location">
<h4>Module integration files in a custom location<a class="headerlink" href="#module-integration-files-in-a-custom-location" title="Permalink to this headline">¶</a></h4>
<p>You can create a similar <code class="docutils literal notranslate"><span class="pre">MODULE_EXT_ROOT</span></code> for additional modules, and make
those modules known to Zephyr build system.</p>
<p>Create a <code class="docutils literal notranslate"><span class="pre">MODULE_EXT_ROOT</span></code> with the following structure</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;MODULE_EXT_ROOT&gt;
└── modules
    ├── modules.cmake
    └── &lt;module_name&gt;
        ├── CMakeLists.txt
        └── Kconfig
</pre></div>
</div>
<p>and then build your application by specifying <code class="docutils literal notranslate"><span class="pre">-DMODULE_EXT_ROOT</span></code> parameter to
the CMake build system. The <code class="docutils literal notranslate"><span class="pre">MODULE_EXT_ROOT</span></code> accepts a CMake list of roots as
argument.</p>
<p>A Zephyr module can automatically be added to the <code class="docutils literal notranslate"><span class="pre">MODULE_EXT_ROOT</span></code>
list using the module description file <code class="file docutils literal notranslate"><span class="pre">zephyr/module.yml</span></code>, see
<a class="reference internal" href="#modules-build-settings"><span class="std std-ref">Build settings</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">ZEPHYR_BASE</span></code> is always added as a <code class="docutils literal notranslate"><span class="pre">MODULE_EXT_ROOT</span></code> with the lowest
priority.
This allows you to overrule any integration files under
<code class="docutils literal notranslate"><span class="pre">&lt;ZEPHYR_BASE&gt;/modules/&lt;module_name&gt;</span></code> with your own implementation your own
<code class="docutils literal notranslate"><span class="pre">MODULE_EXT_ROOT</span></code>.</p>
</div>
<p>The <code class="file docutils literal notranslate"><span class="pre">modules.cmake</span></code> file must contain the logic that specifies the
integration files for Zephyr modules via specifically named CMake variables.</p>
<p>To include a module’s CMake file, set the variable <code class="docutils literal notranslate"><span class="pre">ZEPHYR_&lt;MODULE_NAME&gt;_CMAKE_DIR</span></code>
to the path containing the CMake file.</p>
<p>To include a module’s Kconfig file, set the variable <code class="docutils literal notranslate"><span class="pre">ZEPHYR_&lt;MODULE_NAME&gt;_KCONFIG</span></code>
to the path to the Kconfig file.</p>
<p>The following is an example on how to add support the the <code class="docutils literal notranslate"><span class="pre">FOO</span></code> module.</p>
<p>Create the following structure</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;MODULE_EXT_ROOT&gt;
└── modules
    ├── modules.cmake
    └── foo
        ├── CMakeLists.txt
        └── Kconfig
</pre></div>
</div>
<p>and inside the <code class="file docutils literal notranslate"><span class="pre">modules.cmake</span></code> file, add the following content</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">ZEPHYR_FOO_CMAKE_DIR</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="o">}</span><span class="s">/foo</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">ZEPHYR_FOO_KCONFIG</span><span class="w">   </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="o">}</span><span class="s">/foo/Kconfig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="module-integration-files-zephyr-module-yml">
<h4>Module integration files (zephyr/module.yml)<a class="headerlink" href="#module-integration-files-zephyr-module-yml" title="Permalink to this headline">¶</a></h4>
<p>The module description file <code class="file docutils literal notranslate"><span class="pre">zephyr/module.yml</span></code> can be used to specify
that the build files, <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and <code class="file docutils literal notranslate"><span class="pre">Kconfig</span></code>, are located
in a <a class="reference internal" href="#modules-module-ext-root"><span class="std std-ref">Module integration files (external)</span></a>.</p>
<p>Build files located in a <code class="docutils literal notranslate"><span class="pre">MODULE_EXT_ROOT</span></code> can be described as:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">cmake-ext</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"></span>
<span class="w">  </span><span class="nt">kconfig-ext</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"></span>
</pre></div>
</div>
<p>This allows control of the build inclusion to be described externally to the
Zephyr module.</p>
<p>The Zephyr repository itself is always added as a Zephyr module ext root.</p>
</div>
</div>
<div class="section" id="build-settings">
<span id="modules-build-settings"></span><h3>Build settings<a class="headerlink" href="#build-settings" title="Permalink to this headline">¶</a></h3>
<p>It is possible to specify additional build settings that must be used when
including the module into the build system.</p>
<p>All <code class="docutils literal notranslate"><span class="pre">root</span></code> settings are relative to the root of the module.</p>
<p>Build settings supported in the <code class="file docutils literal notranslate"><span class="pre">module.yml</span></code> file are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">board_root</span></code>: Contains additional boards that are available to the build
system. Additional boards must be located in a <code class="file docutils literal notranslate"><span class="pre">&lt;board_root&gt;/boards</span></code>
folder.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dts_root</span></code>: Contains additional dts files related to the architecture/soc
families. Additional dts files must be located in a <code class="file docutils literal notranslate"><span class="pre">&lt;dts_root&gt;/dts</span></code>
folder.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">soc_root</span></code>: Contains additional SoCs that are available to the build
system. Additional SoCs must be located in a <code class="file docutils literal notranslate"><span class="pre">&lt;soc_root&gt;/soc</span></code> folder.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">arch_root</span></code>: Contains additional architectures that are available to the
build system. Additional architectures must be located in a
<code class="file docutils literal notranslate"><span class="pre">&lt;arch_root&gt;/arch</span></code> folder.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">module_ext_root</span></code>: Contains <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and <code class="file docutils literal notranslate"><span class="pre">Kconfig</span></code> files
for Zephyr modules, see also <a class="reference internal" href="#modules-module-ext-root"><span class="std std-ref">Module integration files (external)</span></a>.</p></li>
</ul>
<p>Example of a <code class="file docutils literal notranslate"><span class="pre">module.yaml</span></code> file containing additional roots, and the
corresponding file system layout.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">settings</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">board_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span><span class="w"></span>
<span class="w">    </span><span class="nt">dts_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span><span class="w"></span>
<span class="w">    </span><span class="nt">soc_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span><span class="w"></span>
<span class="w">    </span><span class="nt">arch_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span><span class="w"></span>
<span class="w">    </span><span class="nt">module_ext_root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span><span class="w"></span>
</pre></div>
</div>
<p>requires the following folder structure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;zephyr-module-root&gt;
├── arch
├── boards
├── dts
├── modules
└── soc
</pre></div>
</div>
</div>
<div class="section" id="twister-test-runner">
<h3>Twister (Test Runner)<a class="headerlink" href="#twister-test-runner" title="Permalink to this headline">¶</a></h3>
<p>To execute both tests and samples available in modules, the Zephyr test runner
(twister) should be pointed to the directories containing those samples and
tests. This can be done by specifying the path to both samples and tests in the
<code class="file docutils literal notranslate"><span class="pre">zephyr/module.yml</span></code> file.  Additionally, if a module defines out of tree
boards, the module file can point twister to the path where those files
are maintained in the module. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">cmake</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span><span class="w"></span>
<span class="nt">samples</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">samples</span><span class="w"></span>
<span class="nt">tests</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tests</span><span class="w"></span>
<span class="nt">boards</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boards</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="module-inclusion">
<h3>Module Inclusion<a class="headerlink" href="#module-inclusion" title="Permalink to this headline">¶</a></h3>
<div class="section" id="using-west">
<span id="modules-using-west"></span><h4>Using West<a class="headerlink" href="#using-west" title="Permalink to this headline">¶</a></h4>
<p>If west is installed and <strong class="makevar">ZEPHYR_MODULES</strong> is not already set, the
build system finds all the modules in your <a class="reference internal" href="../glossary.html#term-west-installation"><span class="xref std std-term">west installation</span></a> and uses
those. It does this by running <a class="reference internal" href="west/built-in.html#west-built-in-misc"><span class="std std-ref">west list</span></a> to get
the paths of all the projects in the installation, then filters the results to
just those projects which have the necessary module metadata files.</p>
<p>Each project in the <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">list</span></code> output is tested like this:</p>
<ul class="simple">
<li><p>If the project contains a file named <code class="file docutils literal notranslate"><span class="pre">zephyr/module.yml</span></code>, then the
content of that file will be used to determine which files should be added
to the build, as described in the previous section.</p></li>
<li><p>Otherwise (i.e. if the project has no <code class="file docutils literal notranslate"><span class="pre">zephyr/module.yml</span></code>), the
build system looks for <code class="file docutils literal notranslate"><span class="pre">zephyr/CMakeLists.txt</span></code> and
<code class="file docutils literal notranslate"><span class="pre">zephyr/Kconfig</span></code> files in the project. If both are present, the project
is considered a module, and those files will be added to the build.</p></li>
<li><p>If neither of those checks succeed, the project is not considered a module,
and is not added to <strong class="makevar">ZEPHYR_MODULES</strong>.</p></li>
</ul>
</div>
<div class="section" id="without-west">
<span id="modules-without-west"></span><h4>Without West<a class="headerlink" href="#without-west" title="Permalink to this headline">¶</a></h4>
<p>If you don’t have west installed or don’t want the build system to use it to
find Zephyr modules, you can set <strong class="makevar">ZEPHYR_MODULES</strong> yourself using one
of the following options. Each of the directories in the list must contain
either a <code class="file docutils literal notranslate"><span class="pre">zephyr/module.yml</span></code> file or the files
<code class="file docutils literal notranslate"><span class="pre">zephyr/CMakeLists.txt</span></code> and <code class="file docutils literal notranslate"><span class="pre">Kconfig</span></code>, as described in the previous
section.</p>
<ol class="arabic">
<li><p>At the CMake command line, like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cmake -DZEPHYR_MODULES=&lt;path-to-module1&gt;[;&lt;path-to-module2&gt;[...]] ...</span>
</pre></div>
</div>
</li>
<li><p>At the top of your application’s top level <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>, like this:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">ZEPHYR_MODULES</span><span class="w"> </span><span class="s">&lt;path-to-module1&gt;</span><span class="w"> </span><span class="s">&lt;path-to-module2&gt;</span><span class="w"> </span><span class="s">[...]</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">Zephyr</span><span class="w"> </span><span class="s">REQUIRED</span><span class="w"> </span><span class="s">HINTS</span><span class="w"> </span><span class="o">$ENV{</span><span class="nv">ZEPHYR_BASE</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<p>If you choose this option, make sure to set the variable <strong>before</strong>  calling
<code class="docutils literal notranslate"><span class="pre">find_package(Zephyr</span> <span class="pre">...)</span></code>, as shown above.</p>
</li>
<li><p>In a separate CMake script which is pre-loaded to populate the CMake cache,
like this:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># Put this in a file with a name like &quot;zephyr-modules.cmake&quot;</span>
<span class="nb">set</span><span class="p">(</span><span class="s">ZEPHYR_MODULES</span><span class="w"> </span><span class="s">&lt;path-to-module1&gt;</span><span class="w"> </span><span class="s">&lt;path-to-module2&gt;</span>
<span class="w">  </span><span class="s">CACHE</span><span class="w"> </span><span class="s">STRING</span><span class="w"> </span><span class="s2">&quot;pre-cached modules&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can tell the build system to use this file by adding <code class="docutils literal notranslate"><span class="pre">-C</span>
<span class="pre">zephyr-modules.cmake</span></code> to your CMake command line.</p>
</li>
</ol>
</div>
<div class="section" id="not-using-modules">
<h4>Not using modules<a class="headerlink" href="#not-using-modules" title="Permalink to this headline">¶</a></h4>
<p>If you don’t have west installed and don’t specify <strong class="makevar">ZEPHYR_MODULES</strong>
yourself, then no additional modules are added to the build. You will still be
able to build any applications that don’t require code or Kconfig options
defined in an external repository.</p>
</div>
</div>
</div>
<div class="section" id="submitting-changes-to-modules">
<h2>Submitting changes to modules<a class="headerlink" href="#submitting-changes-to-modules" title="Permalink to this headline">¶</a></h2>
<p>When submitting new or making changes to existing modules the main repository
Zephyr needs a reference to the changes to be able to verify the changes. In the
main tree this is done using revisions. For code that is already merged and part
of the tree we use the commit hash, a tag, or a branch name. For pull requests
however, we require specifying the pull request number in the revision field to
allow building the zephyr main tree with the changes submitted to the
module.</p>
<p>To avoid merging changes to master with pull request information, the pull
request should be marked as <code class="docutils literal notranslate"><span class="pre">DNM</span></code> (Do Not Merge) or preferably a draft pull
request to make sure it is not merged by mistake and to allow for the module to
be merged first and be assigned a permanent commit hash. Once the module is
merged, the revision will need to be changed either by the submitter or by the
maintainer to the commit hash of the module which reflects the changes.</p>
<p>Note that multiple and dependent changes to different modules can be submitted
using exactly the same process. In this case you will change multiple entries of
all modules that have a pull request against them.</p>
<div class="section" id="process-for-submitting-a-new-module">
<span id="submitting-new-modules"></span><h3>Process for submitting a new module<a class="headerlink" href="#process-for-submitting-a-new-module" title="Permalink to this headline">¶</a></h3>
<p>Please follow the process in <a class="reference internal" href="../contribute/external.html#external-src-process"><span class="std std-ref">Submission and review process</span></a> and obtain the TSC
approval to integrate the external source code as a module</p>
<p>If the request is approved, a new repository will
created by the project team and initialized with basic information that would
allow submitting code to the module project following the project contribution
guidelines.</p>
<p>If a module is maintained as a fork of another project on Github, the Zephyr
module related files and changes in relation to upstream need to be maintained
in a special branch named <code class="docutils literal notranslate"><span class="pre">zephyr</span></code>.</p>
<p>Maintainers from the Zephyr project will create the repository and initialize
it. You will be added as a collaborator in the new repository.  Submit the
module content (code) to the new repository following the guidelines described
<a class="reference internal" href="#modules-using-west"><span class="std std-ref">here</span></a>, and then add a new entry to the
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/west.yml">west.yml</a> with the following information:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">- name: &lt;name of repository&gt;</span>
<span class="go">  path: &lt;path to where the repository should be cloned&gt;</span>
<span class="go">  revision: &lt;ref pointer to module pull request&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>For example, to add <em>my_module</em> to the manifest:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">- name: my_module</span>
<span class="go">  path: modules/lib/my_module</span>
<span class="go">  revision: pull/23/head</span>
</pre></div>
</div>
<p>Where 23 in the example above indicated the pull request number submitted to the
<em>my_module</em> repository. Once the module changes are reviewed and merged, the
revision needs to be changed to the commit hash from the module repository.</p>
</div>
<div class="section" id="process-for-submitting-changes-to-existing-modules">
<span id="changes-to-existing-module"></span><h3>Process for submitting changes to existing modules<a class="headerlink" href="#process-for-submitting-changes-to-existing-modules" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Submit the changes using a pull request to an existing repository following
the <a class="reference internal" href="../contribute/index.html#contribute-guidelines"><span class="std std-ref">contribution guidelines</span></a>.</p></li>
<li><p>Submit a pull request changing the entry referencing the module into the
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/west.yml">west.yml</a> of the main Zephyr tree with the following
information:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">- name: &lt;name of repository&gt;</span>
<span class="go">  path: &lt;path to where the repository should be cloned&gt;</span>
<span class="go">  revision: &lt;ref pointer to module pull request&gt;</span>
</pre></div>
</div>
</li>
</ol>
<p>For example, to add <em>my_module</em> to the manifest:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">- name: my_module</span>
<span class="go">  path: modules/lib/my_module</span>
<span class="go">  revision: pull/23/head</span>
</pre></div>
</div>
<p>Where 23 in the example above indicated the pull request number submitted to the
<em>my_module</em> repository. Once the module changes are reviewed and merged, the
revision needs to be changed to the commit hash from the module repository.</p>
</div>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>