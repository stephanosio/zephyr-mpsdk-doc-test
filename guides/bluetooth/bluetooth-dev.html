<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Developing Bluetooth Applications &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script type="module" src="../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="AutoPTS on Windows 10 with nRF52 board" href="autopts/autopts-win10.html" />
    <link rel="prev" title="Bluetooth tools" href="bluetooth-tools.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User and Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../beyond-GSG.html">Beyond the Getting Started Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch/index.html">Architecture-related Guides</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Bluetooth</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="bluetooth-arch.html">Bluetooth Stack Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="bluetooth-qual.html">Bluetooth Qualification</a></li>
<li class="toctree-l3"><a class="reference internal" href="bluetooth-tools.html">Bluetooth tools</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Developing Bluetooth Applications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hardware-setup">Hardware setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialization">Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bluetooth-application-example">Bluetooth Application Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="autopts/autopts-win10.html">AutoPTS on Windows 10 with nRF52 board</a></li>
<li class="toctree-l3"><a class="reference internal" href="autopts/autopts-linux.html">AutoPTS on Linux</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../docs/index.html">Documentation Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../coccinelle.html">Coccinelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code-relocation.html">Code And Data Relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crypto/index.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flash_debug/index.html">Flashing and Hardware Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debug_tools/index.html">Debugging and Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_mgmt/index.html">Device Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dts/index.html">Devicetree Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../env_vars.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../emulator/index.html">Peripheral and Hardware Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">Modules (External projects)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platformio/index.html">Using with PlatformIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../portability/index.html">OS Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../porting/index.html">Porting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../smf/index.html">State Machine Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../west/index.html">West (Zephyr’s meta-tool)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimizations/index.html">Optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zephyr_cmake_package.html">Zephyr CMake Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../index.html">User and Developer Guides</a> &raquo;</li>
  
     <li><a href="index.html">Bluetooth</a> &raquo;</li>
  
  <li>Developing Bluetooth Applications</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/guides/bluetooth/bluetooth-dev.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="developing-bluetooth-applications">
<span id="bluetooth-dev"></span><h1>Developing Bluetooth Applications<a class="headerlink" href="#developing-bluetooth-applications" title="Permalink to this headline">¶</a></h1>
<p>Bluetooth applications are developed using the common infrastructure and
approach that is described in the <a class="reference internal" href="../../application/index.html#application"><span class="std std-ref">Application Development</span></a> section of the
documentation.</p>
<p>Additional information that is only relevant to Bluetooth applications can be
found in this page.</p>
<div class="section" id="hardware-setup">
<span id="bluetooth-hw-setup"></span><h2>Hardware setup<a class="headerlink" href="#hardware-setup" title="Permalink to this headline">¶</a></h2>
<p>This section describes the options you have when building and debugging Bluetooth
applications with Zephyr. Depending on the hardware that is available to you,
the requirements you have and the type of development you prefer you may pick
one or another setup to match your needs.</p>
<p>There are 4 possible hardware setups to use with Zephyr and Bluetooth:</p>
<ol class="arabic simple">
<li><p>Embedded</p></li>
<li><p>QEMU with an external Controller</p></li>
<li><p>Native POSIX with an external Controller</p></li>
<li><p>Simulated nRF52 with BabbleSim</p></li>
</ol>
<div class="section" id="embedded">
<h3>Embedded<a class="headerlink" href="#embedded" title="Permalink to this headline">¶</a></h3>
<p>This setup relies on all software running directly on the embedded platform(s)
that the application is targeting.
All the <a class="reference internal" href="bluetooth-arch.html#bluetooth-configs"><span class="std std-ref">Configurations</span></a> and <a class="reference internal" href="bluetooth-arch.html#bluetooth-build-types"><span class="std std-ref">Build Types</span></a> are supported
but you might need to build Zephyr more than once if you are using a dual-chip
configuration or if you have multiple cores in your SoC each running a different
build type (e.g., one running the Host, the other the Controller).</p>
<p>To start developing using this setup follow the <a class="reference internal" href="../../getting_started/index.html#getting-started"><span class="std std-ref">Getting Started Guide</span></a>, choose one (or more if you are using a dual-chip solution)
boards that support Bluetooth and then <a class="reference internal" href="../../application/index.html#application-run-board"><span class="std std-ref">run the application</span></a>).</p>
<div class="section" id="embedded-hci-tracing">
<span id="bluetooth-hci-tracing"></span><h4>Embedded HCI tracing<a class="headerlink" href="#embedded-hci-tracing" title="Permalink to this headline">¶</a></h4>
<p>When running both Host and Controller in actual Integrated Circuits, you will
only see normal log messages on the console by default, without any way of
accessing the HCI traffic between the Host and the Controller.  However, there
is a special Bluetooth logging mode that converts the console to use a binary
protocol that interleaves both normal log messages as well as the HCI traffic.
Set the following Kconfig options to enable this protocol before building your
application:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CONFIG_BT_DEBUG_MONITOR_UART=y</span>
<span class="go">CONFIG_UART_CONSOLE=n</span>
</pre></div>
</div>
<p>Setting <a class="reference internal" href="../../reference/kconfig/dummy-syms.html#std-kconfig-CONFIG_BT_DEBUG_MONITOR_UART"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_BT_DEBUG_MONITOR_UART</span></code></a> to <code class="docutils literal notranslate"><span class="pre">y</span></code> replaces the
<a class="reference internal" href="../../reference/kconfig/dummy-syms.html#std-kconfig-CONFIG_BT_DEBUG_LOG"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_BT_DEBUG_LOG</span></code></a> option, and setting <a class="reference internal" href="../../reference/kconfig/dummy-syms.html#std-kconfig-CONFIG_UART_CONSOLE"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_UART_CONSOLE</span></code></a>
to <code class="docutils literal notranslate"><span class="pre">n</span></code> disables the default <code class="docutils literal notranslate"><span class="pre">printk</span></code>/<code class="docutils literal notranslate"><span class="pre">printf</span></code> hooks.</p>
<p>To decode the binary protocol that will now be sent to the console UART you need
to use the btmon tool from <a class="reference internal" href="bluetooth-tools.html#bluetooth-bluez"><span class="std std-ref">BlueZ</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>btmon --tty &lt;console TTY&gt; --tty-speed <span class="m">115200</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="host-on-linux-with-an-external-controller">
<h3>Host on Linux with an external Controller<a class="headerlink" href="#host-on-linux-with-an-external-controller" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is currently only available on GNU/Linux</p>
</div>
<p>This setup relies on a “dual-chip” <a class="reference internal" href="bluetooth-arch.html#bluetooth-configs"><span class="std std-ref">configuration</span></a>
which is comprised of the following devices:</p>
<ol class="arabic simple">
<li><p>A <a class="reference internal" href="bluetooth-arch.html#bluetooth-build-types"><span class="std std-ref">Host-only</span></a> application running in the
<a class="reference internal" href="../../application/index.html#application-run-qemu"><span class="std std-ref">QEMU</span></a> emulator or the <code class="docutils literal notranslate"><span class="pre">native_posix</span></code> native
port of Zephyr</p></li>
<li><p>A Controller, which can be one of two types:</p>
<ul class="simple">
<li><p>A commercially available Controller</p></li>
<li><p>A <a class="reference internal" href="bluetooth-arch.html#bluetooth-build-types"><span class="std std-ref">Controller-only</span></a> build of Zephyr</p></li>
</ul>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Certain external Controllers are either unable to accept the Host to
Controller flow control parameters that Zephyr sets by default (Qualcomm), or
do not transmit any data from the Controller to the Host (Realtek). If you
see a message similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">wrn</span><span class="o">&gt;</span> <span class="n">bt_hci_core</span><span class="p">:</span> <span class="n">opcode</span> <span class="mh">0x0c33</span> <span class="n">status</span> <span class="mh">0x12</span>
</pre></div>
</div>
<p>when booting your sample of choice (make sure you have enabled
<a class="reference internal" href="../../reference/kconfig/dummy-syms.html#std-kconfig-CONFIG_BT_DEBUG_LOG"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_BT_DEBUG_LOG</span></code></a> in your <code class="file docutils literal notranslate"><span class="pre">prj.conf</span></code> before running the
sample), or if there is no data flowing from the Controller to the Host, then
you need to disable Host to Controller flow control. To do so, set
<code class="docutils literal notranslate"><span class="pre">CONFIG_BT_HCI_ACL_FLOW_CONTROL=n</span></code> in your <code class="file docutils literal notranslate"><span class="pre">prj.conf</span></code>.</p>
</div>
<div class="section" id="qemu">
<h4>QEMU<a class="headerlink" href="#qemu" title="Permalink to this headline">¶</a></h4>
<p>You can run the Zephyr Host on the <a class="reference internal" href="../../application/index.html#application-run-qemu"><span class="std std-ref">QEMU emulator</span></a>
and have it interact with a physical external Bluetooth Controller.
Refer to <a class="reference internal" href="bluetooth-tools.html#bluetooth-qemu-posix"><span class="std std-ref">Running on QEMU and Native POSIX</span></a> for full instructions on how to build and
run an application in this setup.</p>
</div>
<div class="section" id="native-posix">
<h4>Native POSIX<a class="headerlink" href="#native-posix" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is currently only available on GNU/Linux</p>
</div>
<p>The <a class="reference internal" href="../../boards/posix/native_posix/doc/index.html#native-posix"><span class="std std-ref">Native POSIX</span></a> target builds your Zephyr application
with the Zephyr kernel, and some minimal HW emulation as a native Linux
executable.
This executable is a normal Linux program, which can be debugged and
instrumented like any other, and it communicates with a physical external
Controller.</p>
<p>Refer to <a class="reference internal" href="bluetooth-tools.html#bluetooth-qemu-posix"><span class="std std-ref">Running on QEMU and Native POSIX</span></a> for full instructions on how to build and
run an application in this setup.</p>
</div>
</div>
<div class="section" id="simulated-nrf52-with-babblesim">
<h3>Simulated nRF52 with BabbleSim<a class="headerlink" href="#simulated-nrf52-with-babblesim" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is currently only available on GNU/Linux</p>
</div>
<p>The <a class="reference internal" href="../../boards/posix/nrf52_bsim/doc/index.html#nrf52-bsim"><span class="std std-ref">nrf52_bsim board</span></a>, is a simulated target board
which emulates the necessary peripherals of a nrf52 SOC to be able to develop
and test BLE applications.
This board, uses:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://babblesim.github.io/">BabbleSim</a> to simulate the nrf52 modem and the radio environment.</p></li>
<li><p>The POSIX arch to emulate the processor.</p></li>
<li><p><a class="reference external" href="https://github.com/BabbleSim/ext_NRF52_hw_models/">Models of the nrf52 HW</a></p></li>
</ul>
</div></blockquote>
<p>Just like with the <code class="docutils literal notranslate"><span class="pre">native_posix</span></code> target, the build result is a normal Linux
executable.
You can find more information on how to run simulations with one or several
devices in
<a class="reference internal" href="../../boards/posix/nrf52_bsim/doc/index.html#nrf52bsim-build-and-run"><span class="std std-ref">this board’s documentation</span></a></p>
<p>Currently, only <a class="reference internal" href="bluetooth-arch.html#bluetooth-build-types"><span class="std std-ref">Combined builds</span></a> are possible, as this board does not yet have
any models of a UART, or USB which could be used for an HCI interface towards
another real or simulated device.</p>
</div>
</div>
<div class="section" id="initialization">
<h2>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h2>
<p>The Bluetooth subsystem is initialized using the <a class="reference internal" href="../../reference/bluetooth/gap.html#c.bt_enable" title="bt_enable"><code class="xref c c-func docutils literal notranslate"><span class="pre">bt_enable()</span></code></a>
function. The caller should ensure that function succeeds by checking
the return code for errors. If a function pointer is passed to
<a class="reference internal" href="../../reference/bluetooth/gap.html#c.bt_enable" title="bt_enable"><code class="xref c c-func docutils literal notranslate"><span class="pre">bt_enable()</span></code></a>, the initialization happens asynchronously, and the
completion is notified through the given function.</p>
</div>
<div class="section" id="bluetooth-application-example">
<h2>Bluetooth Application Example<a class="headerlink" href="#bluetooth-application-example" title="Permalink to this headline">¶</a></h2>
<p>A simple Bluetooth beacon application is shown below. The application
initializes the Bluetooth Subsystem and enables non-connectable
advertising, effectively acting as a Bluetooth Low Energy broadcaster.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>
<span class="linenos"> 2</span><span class="cm">/*</span>
<span class="linenos"> 3</span><span class="cm"> * Set Advertisement data. Based on the Eddystone specification:</span>
<span class="linenos"> 4</span><span class="cm"> * https://github.com/google/eddystone/blob/master/protocol-specification.md</span>
<span class="linenos"> 5</span><span class="cm"> * https://github.com/google/eddystone/tree/master/eddystone-url</span>
<span class="linenos"> 6</span><span class="cm"> */</span><span class="w"></span>
<span class="linenos"> 7</span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_data</span><span class="w"> </span><span class="n">ad</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">	</span><span class="n">BT_DATA_BYTES</span><span class="p">(</span><span class="n">BT_DATA_FLAGS</span><span class="p">,</span><span class="w"> </span><span class="n">BT_LE_AD_NO_BREDR</span><span class="p">),</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">	</span><span class="n">BT_DATA_BYTES</span><span class="p">(</span><span class="n">BT_DATA_UUID16_ALL</span><span class="p">,</span><span class="w"> </span><span class="mh">0xaa</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfe</span><span class="p">),</span><span class="w"></span>
<span class="linenos">10</span><span class="w">	</span><span class="n">BT_DATA_BYTES</span><span class="p">(</span><span class="n">BT_DATA_SVC_DATA16</span><span class="p">,</span><span class="w"></span>
<span class="linenos">11</span><span class="w">		      </span><span class="mh">0xaa</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfe</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Eddystone UUID */</span><span class="w"></span>
<span class="linenos">12</span><span class="w">		      </span><span class="mh">0x10</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Eddystone-URL frame type */</span><span class="w"></span>
<span class="linenos">13</span><span class="w">		      </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Calibrated Tx power at 0m */</span><span class="w"></span>
<span class="linenos">14</span><span class="w">		      </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="cm">/* URL Scheme Prefix http://www. */</span><span class="w"></span>
<span class="linenos">15</span><span class="w">		      </span><span class="sc">&#39;z&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;e&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;p&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;h&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;y&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;r&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos">16</span><span class="w">		      </span><span class="sc">&#39;p&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;r&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;o&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;j&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;e&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;c&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;t&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos">17</span><span class="w">		      </span><span class="mh">0x08</span><span class="p">)</span><span class="w"> </span><span class="cm">/* .org */</span><span class="w"></span>
<span class="linenos">18</span><span class="p">};</span><span class="w"></span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="cm">/* Set Scan Response data */</span><span class="w"></span>
<span class="linenos">21</span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">bt_data</span><span class="w"> </span><span class="n">sd</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">22</span><span class="w">	</span><span class="n">BT_DATA</span><span class="p">(</span><span class="n">BT_DATA_NAME_COMPLETE</span><span class="p">,</span><span class="w"> </span><span class="n">DEVICE_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">DEVICE_NAME_LEN</span><span class="p">),</span><span class="w"></span>
<span class="linenos">23</span><span class="p">};</span><span class="w"></span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">bt_ready</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"></span>
<span class="linenos">26</span><span class="p">{</span><span class="w"></span>
<span class="linenos">27</span><span class="w">	</span><span class="kt">char</span><span class="w"> </span><span class="n">addr_s</span><span class="p">[</span><span class="n">BT_ADDR_LE_STR_LEN</span><span class="p">];</span><span class="w"></span>
<span class="linenos">28</span><span class="w">	</span><span class="n">bt_addr_le_t</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span><span class="w"></span>
<span class="linenos">29</span><span class="w">	</span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">32</span><span class="w">		</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Bluetooth init failed (err %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
<span class="linenos">33</span><span class="w">		</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="linenos">34</span><span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="linenos">35</span>
<span class="linenos">36</span><span class="w">	</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Bluetooth initialized</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">37</span>
<span class="linenos">38</span><span class="w">	</span><span class="cm">/* Start advertising */</span><span class="w"></span>
<span class="linenos">39</span><span class="w">	</span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bt_le_adv_start</span><span class="p">(</span><span class="n">BT_LE_ADV_NCONN_IDENTITY</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">,</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad</span><span class="p">),</span><span class="w"></span>
<span class="linenos">40</span><span class="w">			      </span><span class="n">sd</span><span class="p">,</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sd</span><span class="p">));</span><span class="w"></span>
<span class="linenos">41</span><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">42</span><span class="w">		</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Advertising failed to start (err %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
<span class="linenos">43</span><span class="w">		</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="linenos">44</span><span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="linenos">45</span>
<span class="linenos">46</span>
<span class="linenos">47</span><span class="w">	</span><span class="cm">/* For connectable advertising you would use</span>
<span class="linenos">48</span><span class="cm">	 * bt_le_oob_get_local().  For non-connectable non-identity</span>
<span class="linenos">49</span><span class="cm">	 * advertising an non-resolvable private address is used;</span>
<span class="linenos">50</span><span class="cm">	 * there is no API to retrieve that.</span>
<span class="linenos">51</span><span class="cm">	 */</span><span class="w"></span>
<span class="linenos">52</span>
<span class="linenos">53</span><span class="w">	</span><span class="n">bt_id_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">count</span><span class="p">);</span><span class="w"></span>
<span class="linenos">54</span><span class="w">	</span><span class="n">bt_addr_le_to_str</span><span class="p">(</span><span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">addr_s</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">addr_s</span><span class="p">));</span><span class="w"></span>
<span class="linenos">55</span>
<span class="linenos">56</span><span class="w">	</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Beacon started, advertising as %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">addr_s</span><span class="p">);</span><span class="w"></span>
<span class="linenos">57</span><span class="p">}</span><span class="w"></span>
<span class="linenos">58</span>
<span class="linenos">59</span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="linenos">60</span><span class="p">{</span><span class="w"></span>
<span class="linenos">61</span><span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>
<span class="linenos">62</span>
<span class="linenos">63</span><span class="w">	</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Starting Beacon Demo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">64</span>
<span class="linenos">65</span><span class="w">	</span><span class="cm">/* Initialize the Bluetooth Subsystem */</span><span class="w"></span>
<span class="linenos">66</span><span class="w">	</span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bt_enable</span><span class="p">(</span><span class="n">bt_ready</span><span class="p">);</span><span class="w"></span>
<span class="linenos">67</span><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">68</span><span class="w">		</span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Bluetooth init failed (err %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"></span>
<span class="linenos">69</span><span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="linenos">70</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The key APIs employed by the beacon sample are <a class="reference internal" href="../../reference/bluetooth/gap.html#c.bt_enable" title="bt_enable"><code class="xref c c-func docutils literal notranslate"><span class="pre">bt_enable()</span></code></a>
that’s used to initialize Bluetooth and then <a class="reference internal" href="../../reference/bluetooth/gap.html#c.bt_le_adv_start" title="bt_le_adv_start"><code class="xref c c-func docutils literal notranslate"><span class="pre">bt_le_adv_start()</span></code></a>
that’s used to start advertising a specific combination of advertising
and scan response data.</p>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>