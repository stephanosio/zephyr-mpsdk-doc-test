<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zephyr CMake Package &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script type="module" src="../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../_static/js/ga-tracker.js"></script>
        <script src="../_static/tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Security" href="../security/index.html" />
    <link rel="prev" title="Optimization Tools" href="optimizations/tools.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User and Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="beyond-GSG.html">Beyond the Getting Started Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="arch/index.html">Architecture-related Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="docs/index.html">Documentation Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="coccinelle.html">Coccinelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="code-relocation.html">Code And Data Relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="crypto/index.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="flash_debug/index.html">Flashing and Hardware Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug_tools/index.html">Debugging and Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_mgmt/index.html">Device Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="dts/index.html">Devicetree Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_vars.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="emulator/index.html">Peripheral and Hardware Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Modules (External projects)</a></li>
<li class="toctree-l2"><a class="reference internal" href="networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="platformio/index.html">Using with PlatformIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="portability/index.html">OS Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting/index.html">Porting</a></li>
<li class="toctree-l2"><a class="reference internal" href="smf/index.html">State Machine Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="test/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm/index.html">Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="west/index.html">West (Zephyrâ€™s meta-tool)</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimizations/index.html">Optimizations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Zephyr CMake Package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#zephyr-cmake-package-export-west">Zephyr CMake package export (west)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zephyr-cmake-package-export-without-west">Zephyr CMake package export (without west)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zephyr-application-structure">Zephyr application structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#zephyr-repository-application">Zephyr repository application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#zephyr-workspace-application">Zephyr workspace application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#zephyr-freestanding-application">Zephyr freestanding application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#zephyr-base-environment-setting">Zephyr Base Environment Setting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zephyr-cmake-package-search-order">Zephyr CMake Package Search Order</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zephyr-cmake-package-version">Zephyr CMake Package Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-zephyr-installations-zephyr-workspace">Multiple Zephyr Installations (Zephyr workspace)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zephyr-build-configuration-cmake-package">Zephyr Build Configuration CMake package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zephyr-build-configuration-cmake-package-freestanding-application">Zephyr Build Configuration CMake package (Freestanding application)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zephyr-cmake-package-source-code">Zephyr CMake package source code</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="index.html">User and Developer Guides</a> &raquo;</li>
  
  <li>Zephyr CMake Package</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/guides/zephyr_cmake_package.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="zephyr-cmake-package">
<span id="cmake-pkg"></span><h1>Zephyr CMake Package<a class="headerlink" href="#zephyr-cmake-package" title="Permalink to this headline">Â¶</a></h1>
<p>The Zephyr <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake-packages.7.html">CMake package</a> is a convenient way to create a Zephyr-based application.</p>
<p>The Zephyr CMake package ensures that CMake can automatically select a Zephyr to use for building
the application, whether it is a Zephyr repository application, Zephyr workspace application, or a
Zephyr freestanding application.</p>
<p>When developing a Zephyr-based application, then a developer simply needs to write
<code class="docutils literal notranslate"><span class="pre">find_package(Zephyr)</span></code> in the beginning of the application <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.</p>
<p>To use the Zephyr CMake package it must first be exported to the <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake-packages.7.html#user-package-registry">CMake user package registry</a>.
This is means creating a reference to the current Zephyr installation inside the
CMake user package registry.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-VWJ1bnR1" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-VWJ1bnR1" name="VWJ1bnR1" role="tab" tabindex="0">Ubuntu</button><button aria-controls="panel-0-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-0-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-0-VWJ1bnR1" class="sphinx-tabs-panel group-tab" id="panel-0-VWJ1bnR1" name="VWJ1bnR1" role="tabpanel" tabindex="0"><p>In Linux, the CMake user package registry is found in:</p>
<p><code class="docutils literal notranslate"><span class="pre">~/.cmake/package/Zephyr</span></code></p>
</div><div aria-labelledby="tab-0-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><p>In macOS, the CMake user package registry is found in:</p>
<p><code class="docutils literal notranslate"><span class="pre">~/.cmake/package/Zephyr</span></code></p>
</div><div aria-labelledby="tab-0-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><p>In Windows, the CMake user package registry is found in:</p>
<p><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Kitware\CMake\Packages\Zephyr</span></code></p>
</div></div>
<p>The Zephyr CMake package allows CMake to automatically find a Zephyr base.
One or more Zephyr installations must be exported.
Exporting multiple Zephyr installations may be useful when developing or testing
Zephyr freestanding applications, Zephyr workspace application with vendor forks, etc..</p>
<div class="section" id="zephyr-cmake-package-export-west">
<h2>Zephyr CMake package export (west)<a class="headerlink" href="#zephyr-cmake-package-export-west" title="Permalink to this headline">Â¶</a></h2>
<p>When installing Zephyr using <a class="reference internal" href="../getting_started/index.html#get-the-code"><span class="std std-ref">west</span></a> then it is recommended
to export Zephyr using <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">zephyr-export</span></code>.</p>
</div>
<div class="section" id="zephyr-cmake-package-export-without-west">
<h2>Zephyr CMake package export (without west)<a class="headerlink" href="#zephyr-cmake-package-export-without-west" title="Permalink to this headline">Â¶</a></h2>
<p>Zephyr CMake package is exported to the CMake user package registry using the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -P &lt;PATH-TO-ZEPHYR&gt;/share/zephyr-package/cmake/zephyr_export.cmake
</pre></div>
</div>
<p>This will export the current Zephyr to the CMake user package registry.</p>
<p>To also export the Zephyr Unittest CMake package, run the following command in addition:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -P &lt;PATH-TO-ZEPHYR&gt;/share/zephyrunittest-package/cmake/zephyr_export.cmake
</pre></div>
</div>
</div>
<div class="section" id="zephyr-application-structure">
<span id="zephyr-cmake-package-zephyr-base"></span><h2>Zephyr application structure<a class="headerlink" href="#zephyr-application-structure" title="Permalink to this headline">Â¶</a></h2>
<p>An application can be placed anywhere on your disk, but to better understand how the Zephyr
package is used, we will name three specific layouts.</p>
<div class="section" id="zephyr-repository-application">
<h3>Zephyr repository application<a class="headerlink" href="#zephyr-repository-application" title="Permalink to this headline">Â¶</a></h3>
<p>A Zephyr repository has the following structure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;projects&gt;/zephyr-workspace
â””â”€â”€ zephyr
     â”œâ”€â”€ arch
     â”œâ”€â”€ boards
     â”œâ”€â”€ cmake
     â”œâ”€â”€ samples
     â”‚    â”œâ”€â”€ hello_world
     â”‚    â””â”€â”€ ...
     â”œâ”€â”€ tests
     â””â”€â”€ ...
</pre></div>
</div>
<p>Any application located inside this tree, is simply referred to as a Zephyr repository application.
In this example <code class="docutils literal notranslate"><span class="pre">hello_world</span></code> is a Zephyr repository application.</p>
</div>
<div class="section" id="zephyr-workspace-application">
<h3>Zephyr workspace application<a class="headerlink" href="#zephyr-workspace-application" title="Permalink to this headline">Â¶</a></h3>
<p>A Zephyr workspace has the following structure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;projects&gt;/zephyr-workspace
â”œâ”€â”€ zephyr
â”œâ”€â”€ bootloader
â”œâ”€â”€ modules
â”œâ”€â”€ tools
â”œâ”€â”€ &lt;vendor/private-repositories&gt;
â””â”€â”€ my_applications
     â””â”€â”€ my_first_app
</pre></div>
</div>
<p>Any application located in such workspace, but outside the Zephyr repository itself, is referred to
as a Zephyr workspace application.
In this example <code class="docutils literal notranslate"><span class="pre">my_first_app</span></code> is a Zephyr workspace application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The root of a Zephyr workspace is identical to <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">topdir</span></code> if the workspace was
installed using <code class="docutils literal notranslate"><span class="pre">west</span></code></p>
</div>
</div>
<div class="section" id="zephyr-freestanding-application">
<span id="freestanding-application"></span><h3>Zephyr freestanding application<a class="headerlink" href="#zephyr-freestanding-application" title="Permalink to this headline">Â¶</a></h3>
<p>A Zephyr freestanding application is a Zephyr application located outside of a Zephyr workspace.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;projects&gt;/zephyr-workspace
â”œâ”€â”€ zephyr
â”œâ”€â”€ bootloader
â””â”€â”€ ...

&lt;home&gt;/app
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ prj.conf
â””â”€â”€ src
    â””â”€â”€ main.c
</pre></div>
</div>
<p>In this example <code class="docutils literal notranslate"><span class="pre">app</span></code> is a Zephyr freestanding application.</p>
</div>
</div>
<div class="section" id="zephyr-base-environment-setting">
<h2>Zephyr Base Environment Setting<a class="headerlink" href="#zephyr-base-environment-setting" title="Permalink to this headline">Â¶</a></h2>
<p>The Zephyr CMake package search functionality allows for explicitly specifying
a Zephyr base using an environment variable.</p>
<p>To do this, use the following <code class="docutils literal notranslate"><span class="pre">find_package()</span></code> syntax:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">Zephyr</span><span class="w"> </span><span class="s">REQUIRED</span><span class="w"> </span><span class="s">HINTS</span><span class="w"> </span><span class="o">$ENV{</span><span class="nv">ZEPHYR_BASE</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<p>This syntax instructs CMake to first search for Zephyr using the Zephyr base environment setting
<span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">ZEPHYR_BASE</span></code> and then use the normal search paths.</p>
</div>
<div class="section" id="zephyr-cmake-package-search-order">
<span id="zephyr-cmake-search-order"></span><h2>Zephyr CMake Package Search Order<a class="headerlink" href="#zephyr-cmake-package-search-order" title="Permalink to this headline">Â¶</a></h2>
<p>When Zephyr base environment setting is not used for searching, the Zephyr installation matching
the following criteria will be used:</p>
<ul>
<li><p>A Zephyr repository application will use the Zephyr in which it is located.
For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;projects&gt;/zephyr-workspace/zephyr
â””â”€â”€ samples
    â””â”€â”€ hello_world
</pre></div>
</div>
<p>in this example, <code class="docutils literal notranslate"><span class="pre">hello_world</span></code> will use <code class="docutils literal notranslate"><span class="pre">&lt;projects&gt;/zephyr-workspace/zephyr</span></code>.</p>
</li>
<li><p>Zephyr workspace application will use the Zephyr that share the same workspace.
For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;projects&gt;/zephyr-workspace
â”œâ”€â”€ zephyr
â”œâ”€â”€ ...
â””â”€â”€ my_applications
     â””â”€â”€ my_first_app
</pre></div>
</div>
<p>in this example, <code class="docutils literal notranslate"><span class="pre">my_first_app</span></code> will use <code class="docutils literal notranslate"><span class="pre">&lt;projects&gt;/zephyr-workspace/zephyr</span></code> as this Zephyr
is located in the same workspace as the Zephyr workspace application.</p>
</li>
<li><p>Zephyr freestanding application will use the Zephyr registered in the CMake user package registry.
For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;projects&gt;/zephyr-workspace-1
â””â”€â”€ zephyr                       (Not exported to CMake)

&lt;projects&gt;/zephyr-workspace-2
â””â”€â”€ zephyr                       (Exported to CMake)

&lt;home&gt;/app
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ prj.conf
â””â”€â”€ src
    â””â”€â”€ main.c
</pre></div>
</div>
<p>in this example, only <code class="docutils literal notranslate"><span class="pre">&lt;projects&gt;/zephyr-workspace-2/zephyr</span></code> is exported to the CMake package
registry and therefore this Zephyr will be used by the Zephyr freestanding application
<code class="docutils literal notranslate"><span class="pre">&lt;home&gt;/app</span></code>.</p>
<p>If user wants to test the application with <code class="docutils literal notranslate"><span class="pre">&lt;projects&gt;/zephyr-workspace-1/zephyr</span></code>, this can be
done by using the Zephyr Base environment setting, meaning set
<code class="docutils literal notranslate"><span class="pre">ZEPHYR_BASE=&lt;projects&gt;/zephyr-workspace-1/zephyr</span></code>, before
running CMake.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Zephyr package selected on the first CMake invocation will be used for all subsequent
builds. To change the Zephyr package, for example to test the application using Zephyr base
environment setting, then it is necessary to do a pristine build first
(See <a class="reference internal" href="../application/index.html#application-rebuild"><span class="std std-ref">Rebuilding an Application</span></a>).</p>
</div>
</li>
</ul>
</div>
<div class="section" id="zephyr-cmake-package-version">
<h2>Zephyr CMake Package Version<a class="headerlink" href="#zephyr-cmake-package-version" title="Permalink to this headline">Â¶</a></h2>
<p>When writing an application then it is possible to specify a Zephyr version number <code class="docutils literal notranslate"><span class="pre">x.y.z</span></code> that
must be used in order to build the application.</p>
<p>Specifying a version is especially useful for a Zephyr freestanding application as it ensures the
application is built with a minimal Zephyr version.</p>
<p>It also helps CMake to select the correct Zephyr to use for building, when there are multiple
Zephyr installations in the system.</p>
<p>For example:</p>
<blockquote>
<div><div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">Zephyr</span><span class="w"> </span><span class="s">2.2.0</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">app</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>will require <code class="docutils literal notranslate"><span class="pre">app</span></code> to be built with Zephyr 2.2.0 as minimum.
CMake will search all exported candidates to find a Zephyr installation which matches this version
criteria.</p>
<p>Thus it is possible to have multiple Zephyr installations and have CMake automatically select
between them based on the version number provided, see <a class="reference external" href="https://cmake.org/cmake/help/latest/command/find_package.html#version-selection">CMake package version</a> for details.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;projects&gt;/zephyr-workspace-2.a
â””â”€â”€ zephyr                       (Exported to CMake)

&lt;projects&gt;/zephyr-workspace-2.b
â””â”€â”€ zephyr                       (Exported to CMake)

&lt;home&gt;/app
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ prj.conf
â””â”€â”€ src
    â””â”€â”€ main.c
</pre></div>
</div>
<p>in this case, there are two released versions of Zephyr installed at their own workspaces.
Workspace 2.a and 2.b, corresponding to the Zephyr version.</p>
<p>To ensure <code class="docutils literal notranslate"><span class="pre">app</span></code> is built with minimum version <code class="docutils literal notranslate"><span class="pre">2.a</span></code> the following <code class="docutils literal notranslate"><span class="pre">find_package</span></code>
syntax may be used:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">Zephyr</span><span class="w"> </span><span class="s">2.a</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">app</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that both <code class="docutils literal notranslate"><span class="pre">2.a</span></code> and <code class="docutils literal notranslate"><span class="pre">2.b</span></code> fulfill this requirement.</p>
<p>CMake also supports the keyword <code class="docutils literal notranslate"><span class="pre">EXACT</span></code>, to ensure an exact version is used, if that is required.
In this case, the application CMakeLists.txt could be written as:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">Zephyr</span><span class="w"> </span><span class="s">2.a</span><span class="w"> </span><span class="s">EXACT</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">app</span><span class="p">)</span>
</pre></div>
</div>
<p>In case no Zephyr is found which satisfies the version required, as example, the application specifies</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">Zephyr</span><span class="w"> </span><span class="s">2.z</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">app</span><span class="p">)</span>
</pre></div>
</div>
<p>then an error similar to below will be printed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">a</span> <span class="n">configuration</span> <span class="n">file</span> <span class="k">for</span> <span class="n">package</span> <span class="s2">&quot;Zephyr&quot;</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">compatible</span>
<span class="k">with</span> <span class="n">requested</span> <span class="n">version</span> <span class="s2">&quot;2.z&quot;</span><span class="o">.</span>

<span class="n">The</span> <span class="n">following</span> <span class="n">configuration</span> <span class="n">files</span> <span class="n">were</span> <span class="n">considered</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">accepted</span><span class="p">:</span>

  <span class="o">&lt;</span><span class="n">projects</span><span class="o">&gt;/</span><span class="n">zephyr</span><span class="o">-</span><span class="n">workspace</span><span class="o">-</span><span class="mf">2.</span><span class="n">a</span><span class="o">/</span><span class="n">zephyr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">zephyr</span><span class="o">-</span><span class="n">package</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">ZephyrConfig</span><span class="o">.</span><span class="n">cmake</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="mf">2.</span><span class="n">a</span><span class="mf">.0</span>
  <span class="o">&lt;</span><span class="n">projects</span><span class="o">&gt;/</span><span class="n">zephyr</span><span class="o">-</span><span class="n">workspace</span><span class="o">-</span><span class="mf">2.</span><span class="n">b</span><span class="o">/</span><span class="n">zephyr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">zephyr</span><span class="o">-</span><span class="n">package</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">ZephyrConfig</span><span class="o">.</span><span class="n">cmake</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="mf">2.</span><span class="n">b</span><span class="mf">.0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It can also be beneficial to specify a version number for Zephyr repository applications
and Zephyr workspace applications. Specifying a version in those cases ensures the
application will only build if the Zephyr repository or workspace is matching.
This can be useful to avoid accidental builds when only part of a workspace has been
updated.</p>
</div>
</div>
<div class="section" id="multiple-zephyr-installations-zephyr-workspace">
<h2>Multiple Zephyr Installations (Zephyr workspace)<a class="headerlink" href="#multiple-zephyr-installations-zephyr-workspace" title="Permalink to this headline">Â¶</a></h2>
<p>Testing out a new Zephyr version, while at the same time keeping the existing Zephyr in the
workspace untouched is sometimes beneficial.</p>
<p>Or having both an upstream Zephyr, Vendor specific, and a custom Zephyr in same workspace.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;projects&gt;/zephyr-workspace
â”œâ”€â”€ zephyr
â”œâ”€â”€ zephyr-vendor
â”œâ”€â”€ zephyr-custom
â”œâ”€â”€ ...
â””â”€â”€ my_applications
     â””â”€â”€ my_first_app
</pre></div>
</div>
<p>in this setup, <code class="docutils literal notranslate"><span class="pre">find_package(Zephyr)</span></code> has the following order of precedence for selecting
which Zephyr to use:</p>
<ul class="simple">
<li><p>Project name: <code class="docutils literal notranslate"><span class="pre">zephyr</span></code></p></li>
<li><p>First project, when Zephyr projects are ordered lexicographical, in this case.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">zephyr-custom</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zephyr-vendor</span></code></p></li>
</ul>
</li>
</ul>
<p>This means that <code class="docutils literal notranslate"><span class="pre">my_first_app</span></code> will use <code class="docutils literal notranslate"><span class="pre">&lt;projects&gt;/zephyr-workspace/zephyr</span></code>.</p>
<p>It is possible to specify a Zephyr preference list in the application.</p>
<p>A Zephyr preference list can be specified as:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">ZEPHYR_PREFER</span><span class="w"> </span><span class="s2">&quot;zephyr-custom&quot;</span><span class="w"> </span><span class="s2">&quot;zephyr-vendor&quot;</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">Zephyr</span><span class="p">)</span>

<span class="nb">project</span><span class="p">(</span><span class="s">my_first_app</span><span class="p">)</span>
</pre></div>
</div>
<p>the <code class="docutils literal notranslate"><span class="pre">ZEPHYR_PREFER</span></code> is a list, allowing for multiple Zephyrs.
If a Zephyr is specified in the list, but not found in the system, it is simply ignored and
<code class="docutils literal notranslate"><span class="pre">find_package(Zephyr)</span></code> will continue to the next candidate.</p>
<p>This allows for temporary creation of a new Zephyr release to be tested, without touching current
Zephyr. When testing is done, the <code class="docutils literal notranslate"><span class="pre">zephyr-test</span></code> folder can simply be removed.
Such a CMakeLists.txt could look as:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">ZEPHYR_PREFER</span><span class="w"> </span><span class="s2">&quot;zephyr-test&quot;</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">Zephyr</span><span class="p">)</span>

<span class="nb">project</span><span class="p">(</span><span class="s">my_first_app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="zephyr-build-configuration-cmake-package">
<span id="cmake-build-config-package"></span><h2>Zephyr Build Configuration CMake package<a class="headerlink" href="#zephyr-build-configuration-cmake-package" title="Permalink to this headline">Â¶</a></h2>
<p>The Zephyr Build Configuration CMake package provides a possibility for a Zephyr based project to
control Zephyr build settings in a generic way.</p>
<p>It is similar to the per-user <code class="docutils literal notranslate"><span class="pre">.zephyrrc</span></code> file that can be used to set <a class="reference internal" href="env_vars.html#env-vars"><span class="std std-ref">Environment Variables</span></a>, but it
sets CMake variables instead. It also allows you to automatically share the build configuration
among all users through the project repository. It also allows more advanced use cases, such as loading
of additional CMake boilerplate code.</p>
<p>The Zephyr Build Configuration CMake package will be loaded in the Zephyr boilerplate code after
initial properties and <code class="docutils literal notranslate"><span class="pre">ZEPHYR_BASE</span></code> has been defined, but before CMake code execution.
This allows the Zephyr Build Configuration CMake package to setup or extend properties such as:
<code class="docutils literal notranslate"><span class="pre">DTS_ROOT</span></code>, <code class="docutils literal notranslate"><span class="pre">BOARD_ROOT</span></code>, <code class="docutils literal notranslate"><span class="pre">TOOLCHAIN_ROOT</span></code> / other toolchain setup, fixed overlays, and any
other property that can be controlled. It also allows inclusion of additional boilerplate code.</p>
<p>To provide a Zephyr Build Configuration CMake package, create <code class="docutils literal notranslate"><span class="pre">ZephyrBuildConfig.cmake</span></code> and place
it in a Zephyr workspace top-level folder as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;projects&gt;/zephyr-workspace
â”œâ”€â”€ zephyr
â”œâ”€â”€ ...
â””â”€â”€ zephyr application (can be named anything)
     â””â”€â”€ share/zephyrbuild-package/cmake/ZephyrBuildConfig.cmake
</pre></div>
</div>
<p>The Zephyr Build Configuration CMake package will not search in any CMake default search paths, and
thus cannot be installed in the CMake package registry. There will be no version checking on the
Zephyr Build Configuration package.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">share/zephyrbuild-package/cmake/ZephyrBuildConfig.cmake</span></code> follows the same folder
structure as the Zephyr CMake package.</p>
<p>It is possible to place <code class="docutils literal notranslate"><span class="pre">ZephyrBuildConfig.cmake</span></code> directly in a
<code class="docutils literal notranslate"><span class="pre">&lt;zephyr</span> <span class="pre">application&gt;/cmake</span></code> folder or another folder, as long as that folder is
honoring the <a class="reference external" href="https://cmake.org/cmake/help/latest/command/find_package.html#search-procedure">CMake package search</a> algorithm.</p>
</div>
<p>A sample <code class="docutils literal notranslate"><span class="pre">ZephyrBuildConfig.cmake</span></code> can be seen below.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># ZephyrBuildConfig.cmake sample code</span>

<span class="c"># To ensure final path is absolute and does not contain ../.. in variable.</span>
<span class="nb">get_filename_component</span><span class="p">(</span><span class="s">APPLICATION_PROJECT_DIR</span>
<span class="w">                       </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="o">}</span><span class="s">/../../..</span>
<span class="w">                       </span><span class="s">ABSOLUTE</span>
<span class="p">)</span>

<span class="c"># Add this project to list of board roots</span>
<span class="nb">list</span><span class="p">(</span><span class="s">APPEND</span><span class="w"> </span><span class="s">BOARD_ROOT</span><span class="w"> </span><span class="o">${</span><span class="nv">APPLICATION_PROJECT_DIR</span><span class="o">}</span><span class="p">)</span>

<span class="c"># Default to GNU Arm Embedded toolchain if no toolchain is set</span>
<span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">ENV{ZEPHYR_TOOLCHAIN_VARIANT}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">set</span><span class="p">(</span><span class="s">ZEPHYR_TOOLCHAIN_VARIANT</span><span class="w"> </span><span class="s">gnuarmemb</span><span class="p">)</span>
<span class="w">    </span><span class="nb">find_program</span><span class="p">(</span><span class="s">GNU_ARM_GCC</span><span class="w"> </span><span class="s">arm-none-eabi-gcc</span><span class="p">)</span>
<span class="w">    </span><span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="o">${</span><span class="nv">GNU_ARM_GCC</span><span class="o">}</span><span class="w"> </span><span class="s">STREQUAL</span><span class="w"> </span><span class="s">GNU_ARM_GCC-NOTFOUND</span><span class="p">)</span>
<span class="w">        </span><span class="c"># The toolchain root is located above the path to the compiler.</span>
<span class="w">        </span><span class="nb">get_filename_component</span><span class="p">(</span><span class="s">GNUARMEMB_TOOLCHAIN_PATH</span><span class="w"> </span><span class="o">${</span><span class="nv">GNU_ARM_GCC</span><span class="o">}</span><span class="s">/../..</span><span class="w"> </span><span class="s">ABSOLUTE</span><span class="p">)</span>
<span class="w">    </span><span class="nb">endif</span><span class="p">()</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="zephyr-build-configuration-cmake-package-freestanding-application">
<h2>Zephyr Build Configuration CMake package (Freestanding application)<a class="headerlink" href="#zephyr-build-configuration-cmake-package-freestanding-application" title="Permalink to this headline">Â¶</a></h2>
<p>The Zephyr Build Configuration CMake package can be located outside a Zephyr
workspace, for example located with a <a class="reference internal" href="#freestanding-application"><span class="std std-ref">Zephyr freestanding application</span></a>.</p>
<p>Create the build configuration as described in the previous section, and then
refer to the location of your Zephyr Build Configuration CMake package using
the CMake variable <code class="docutils literal notranslate"><span class="pre">ZephyrBuildConfiguration_ROOT</span></code>.</p>
<ol class="arabic">
<li><p>At the CMake command line, like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cmake -DZephyrBuildConfiguration_ROOT=&lt;path-to-build-config&gt; ...</span>
</pre></div>
</div>
</li>
<li><p>At the top of your applicationâ€™s top level <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>, like this:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">ZephyrBuildConfiguration_ROOT</span><span class="w"> </span><span class="s">&lt;path-to-build-config&gt;</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">Zephyr</span><span class="w"> </span><span class="s">REQUIRED</span><span class="w"> </span><span class="s">HINTS</span><span class="w"> </span><span class="o">$ENV{</span><span class="nv">ZEPHYR_BASE</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<p>If you choose this option, make sure to set the variable <strong>before</strong>  calling
<code class="docutils literal notranslate"><span class="pre">find_package(Zephyr</span> <span class="pre">...)</span></code>, as shown above.</p>
</li>
<li><p>In a separate CMake script which is pre-loaded to populate the CMake cache,
like this:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># Put this in a file with a name like &quot;zephyr-settings.cmake&quot;</span>
<span class="nb">set</span><span class="p">(</span><span class="s">ZephyrBuildConfiguration_ROOT</span><span class="w"> </span><span class="s">&lt;path-to-build-config&gt;</span>
<span class="w">    </span><span class="s">CACHE</span><span class="w"> </span><span class="s">STRING</span><span class="w"> </span><span class="s2">&quot;pre-cached build config&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>You can tell the build system to use this file by adding <code class="docutils literal notranslate"><span class="pre">-C</span>
<span class="pre">zephyr-settings.cmake</span></code> to your CMake command line.
This principle is useful when not using <code class="docutils literal notranslate"><span class="pre">west</span></code> as both this setting and
Zephyr modules can be specified using the same file.
See Zephyr module <a class="reference internal" href="modules.html#modules-without-west"><span class="std std-ref">Without West</span></a>.</p>
</li>
</ol>
</div>
<div class="section" id="zephyr-cmake-package-source-code">
<h2>Zephyr CMake package source code<a class="headerlink" href="#zephyr-cmake-package-source-code" title="Permalink to this headline">Â¶</a></h2>
<p>The Zephyr CMake package source code in
<code class="docutils literal notranslate"><span class="pre">&lt;PATH-TO-ZEPHYR&gt;/share/zephyr-package/cmake</span></code> contains the CMake config package
which is used by CMake <code class="docutils literal notranslate"><span class="pre">find_package</span></code> function.</p>
<p>It also contains code for exporting Zephyr as a CMake config package.</p>
<p>The following is an overview of those files</p>
<dl class="simple">
<dt><code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code></dt><dd><p>The CMakeLists.txt file for the CMake build system which is responsible for
exporting Zephyr as a package to the CMake user package registry.</p>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">ZephyrConfigVersion.cmake</span></code></dt><dd><p>The Zephyr package version file. This file is called by CMake to determine
if this installation fulfils the requirements specified by user when calling
<code class="docutils literal notranslate"><span class="pre">find_package(Zephyr</span> <span class="pre">...)</span></code>. It is also responsible for detection of Zephyr
repository or workspace only installations.</p>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">ZephyrUnittestConfigVersion.cmake</span></code></dt><dd><p>Same responsibility as <code class="docutils literal notranslate"><span class="pre">ZephyrConfigVersion.cmake</span></code>, but for unit tests.
Includes <code class="docutils literal notranslate"><span class="pre">ZephyrConfigVersion.cmake</span></code>.</p>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">ZephyrConfig.cmake</span></code></dt><dd><p>The Zephyr package file. This file is called by CMake to for the package
meeting which fulfils the requirements specified by user when calling
<code class="docutils literal notranslate"><span class="pre">find_package(Zephyr</span> <span class="pre">...)</span></code>. This file is responsible for sourcing of
boilerplate code.</p>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">ZephyrUnittestConfig.cmake</span></code></dt><dd><p>Same responsibility as <code class="docutils literal notranslate"><span class="pre">ZephyrConfig.cmake</span></code>, but for unit tests.
Includes <code class="docutils literal notranslate"><span class="pre">ZephyrConfig.cmake</span></code>.</p>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">zephyr_package_search.cmake</span></code></dt><dd><p>Common file used for detection of Zephyr repository and workspace candidates.
Used by <code class="docutils literal notranslate"><span class="pre">ZephyrConfigVersion.cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">ZephyrConfig.cmake</span></code> for common code.</p>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">pristine.cmake</span></code></dt><dd><p>Pristine file for removing all files created by CMake during configure and generator time when
exporting Zephyr CMake package. Running pristine keeps all package related files mentioned above.</p>
</dd>
</dl>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>