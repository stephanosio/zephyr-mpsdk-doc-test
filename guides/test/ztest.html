<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test Framework &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script type="module" src="../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Test Runner (Twister)" href="twister.html" />
    <link rel="prev" title="Testing" href="index.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.99
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/3.0.0/">3.0.0</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User and Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../beyond-GSG.html">Beyond the Getting Started Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch/index.html">Architecture-related Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../docs/index.html">Documentation Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../coccinelle.html">Coccinelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code-relocation.html">Code And Data Relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crypto/index.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flash_debug/index.html">Flashing and Hardware Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debug_tools/index.html">Debugging and Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_mgmt/index.html">Device Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dts/index.html">Devicetree Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../env_vars.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../emulator/index.html">Peripheral and Hardware Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">Modules (External projects)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platformio/index.html">Using with PlatformIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../portability/index.html">OS Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../porting/index.html">Porting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../smf/index.html">State Machine Framework</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Testing</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Test Framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#quick-start-integration-testing">Quick start - Integration testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quick-start-unit-testing">Quick start - Unit testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stress-test-framework">Stress test framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-reference">API reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-test-output">Customizing Test Output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="twister.html">Test Runner (Twister)</a></li>
<li class="toctree-l3"><a class="reference internal" href="coverage.html">Generating coverage reports</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../west/index.html">West (Zephyr’s meta-tool)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimizations/index.html">Optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zephyr_cmake_package.html">Zephyr CMake Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/kconfig.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../index.html">User and Developer Guides</a> &raquo;</li>
  
     <li><a href="index.html">Testing</a> &raquo;</li>
  
  <li>Test Framework</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/guides/test/ztest.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="test-framework">
<span id="id1"></span><h1>Test Framework<a class="headerlink" href="#test-framework" title="Permalink to this headline">¶</a></h1>
<p>The Zephyr Test Framework (Ztest) provides a simple testing framework intended
to be used during development.  It provides basic assertion macros and a generic
test structure.</p>
<p>The framework can be used in two ways, either as a generic framework for
integration testing, or for unit testing specific modules.</p>
<div class="section" id="quick-start-integration-testing">
<h2>Quick start - Integration testing<a class="headerlink" href="#quick-start-integration-testing" title="Permalink to this headline">¶</a></h2>
<p>A simple working base is located at <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/subsys/testsuite/integration">samples/subsys/testsuite/integration</a>.  Just
copy the files to <code class="docutils literal notranslate"><span class="pre">tests/</span></code> and edit them for your needs. The test will then
be automatically built and run by the twister script. If you are testing
the <strong>bar</strong> component of <strong>foo</strong>, you should copy the sample folder to
<code class="docutils literal notranslate"><span class="pre">tests/foo/bar</span></code>. It can then be tested with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">twister</span> <span class="o">-</span><span class="n">s</span> <span class="n">tests</span><span class="o">/</span><span class="n">foo</span><span class="o">/</span><span class="n">bar</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">identifier</span>
</pre></div>
</div>
<p>In the example above <code class="docutils literal notranslate"><span class="pre">tests/foo/bar</span></code> signifies the path to the test and the
<code class="docutils literal notranslate"><span class="pre">test-identifier</span></code> references a test defined in the <code class="file docutils literal notranslate"><span class="pre">testcase.yaml</span></code> file.</p>
<p>To run all tests defined in a test project, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">twister</span> <span class="o">-</span><span class="n">T</span> <span class="n">tests</span><span class="o">/</span><span class="n">foo</span><span class="o">/</span><span class="n">bar</span><span class="o">/</span>
</pre></div>
</div>
<p>The sample contains the following files:</p>
<p>CMakeLists.txt</p>
<div class="highlight-CMake notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c"># SPDX-License-Identifier: Apache-2.0</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.20.0</span><span class="p">)</span>
<span class="linenos">4</span><span class="nb">find_package</span><span class="p">(</span><span class="s">Zephyr</span><span class="w"> </span><span class="s">REQUIRED</span><span class="w"> </span><span class="s">HINTS</span><span class="w"> </span><span class="o">$ENV{</span><span class="nv">ZEPHYR_BASE</span><span class="o">}</span><span class="p">)</span>
<span class="linenos">5</span><span class="nb">project</span><span class="p">(</span><span class="s">integration</span><span class="p">)</span>
<span class="linenos">6</span>
<span class="linenos">7</span><span class="nb">FILE</span><span class="p">(</span><span class="s">GLOB</span><span class="w"> </span><span class="s">app_sources</span><span class="w"> </span><span class="s">src/*.c</span><span class="p">)</span>
<span class="linenos">8</span><span class="nb">target_sources</span><span class="p">(</span><span class="s">app</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="o">${</span><span class="nv">app_sources</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<p>testcase.yaml</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nt">tests</span><span class="p">:</span><span class="w"></span>
<span class="linenos">2</span><span class="w">  </span><span class="c1"># section.subsection</span><span class="w"></span>
<span class="linenos">3</span><span class="w">  </span><span class="nt">testing.ztest</span><span class="p">:</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="nt">build_only</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="linenos">5</span><span class="w">    </span><span class="nt">platform_allow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">native_posix</span><span class="w"></span>
<span class="linenos">6</span><span class="w">    </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testing</span><span class="w"></span>
</pre></div>
</div>
<p>prj.conf</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>CONFIG_ZTEST=y
<span class="linenos">2</span>CONFIG_ZTEST_NEW_API=y
</pre></div>
</div>
<p>src/main.c (see <a class="reference internal" href="#main-c-bp"><span class="std std-ref">best practices</span></a>)</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/*</span>
<span class="linenos"> 2</span><span class="cm"> * Copyright (c) 2016 Intel Corporation</span>
<span class="linenos"> 3</span><span class="cm"> *</span>
<span class="linenos"> 4</span><span class="cm"> * SPDX-License-Identifier: Apache-2.0</span>
<span class="linenos"> 5</span><span class="cm"> */</span><span class="w"></span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ztest.h&gt;</span><span class="cp"></span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="n">ZTEST_SUITE</span><span class="p">(</span><span class="n">framework_tests</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="cm">/**</span>
<span class="linenos">13</span><span class="cm"> * @brief Test Asserts</span>
<span class="linenos">14</span><span class="cm"> *</span>
<span class="linenos">15</span><span class="cm"> * This test verifies various assert macros provided by ztest.</span>
<span class="linenos">16</span><span class="cm"> *</span>
<span class="linenos">17</span><span class="cm"> */</span><span class="w"></span>
<span class="linenos">18</span><span class="n">ZTEST</span><span class="p">(</span><span class="n">framework_tests</span><span class="p">,</span><span class="w"> </span><span class="n">test_assert</span><span class="p">)</span><span class="w"></span>
<span class="linenos">19</span><span class="p">{</span><span class="w"></span>
<span class="linenos">20</span><span class="w">	</span><span class="n">zassert_true</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1 was false&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">21</span><span class="w">	</span><span class="n">zassert_false</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0 was true&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">22</span><span class="w">	</span><span class="n">zassert_is_null</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NULL was not NULL&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">23</span><span class="w">	</span><span class="n">zassert_not_null</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">foo</span><span class="se">\&quot;</span><span class="s"> was NULL&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">24</span><span class="w">	</span><span class="n">zassert_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1 was not equal to 1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">25</span><span class="w">	</span><span class="n">zassert_equal_ptr</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NULL was not equal to NULL&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">26</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#listing-tests" id="id2">Listing Tests</a></p></li>
<li><p><a class="reference internal" href="#skipping-tests" id="id3">Skipping Tests</a></p></li>
</ul>
</div>
<p>A test case project may consist of multiple sub-tests or smaller tests that
either can be testing functionality or APIs. Functions implementing a test
should follow the guidelines below:</p>
<ul class="simple">
<li><p>Test cases function names should be prefix with <strong>test_</strong></p></li>
<li><p>Test cases should be documented using doxygen</p></li>
<li><p>Test function names should be unique within the section or component being
tested</p></li>
</ul>
<p>An example can be seen below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/**</span>
 <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Test</span> <span class="n">Asserts</span>
 <span class="o">*</span>
 <span class="o">*</span> <span class="n">This</span> <span class="n">test</span> <span class="n">verifies</span> <span class="n">the</span> <span class="n">zassert_true</span> <span class="n">macro</span><span class="o">.</span>
 <span class="o">*/</span>
<span class="n">static</span> <span class="n">void</span> <span class="n">test_assert</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">zassert_true</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1 was false&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above test is then enabled as part of the testsuite using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_assert</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="listing-tests">
<h3><a class="toc-backref" href="#contents">Listing Tests</a><a class="headerlink" href="#listing-tests" title="Permalink to this headline">¶</a></h3>
<p>Tests (test projects) in the Zephyr tree consist of many testcases that run as
part of a project and test similar functionality, for example an API or a
feature. The <code class="docutils literal notranslate"><span class="pre">twister</span></code> script can parse the testcases in all
test projects or a subset of them, and can generate reports on a granular
level, i.e. if cases have passed or failed or if they were blocked or skipped.</p>
<p>Twister parses the source files looking for test case names, so you
can list all kernel test cases, for example, by entering:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">twister</span> <span class="o">--</span><span class="nb">list</span><span class="o">-</span><span class="n">tests</span> <span class="o">-</span><span class="n">T</span> <span class="n">tests</span><span class="o">/</span><span class="n">kernel</span>
</pre></div>
</div>
</div>
<div class="section" id="skipping-tests">
<h3><a class="toc-backref" href="#contents">Skipping Tests</a><a class="headerlink" href="#skipping-tests" title="Permalink to this headline">¶</a></h3>
<p>Special- or architecture-specific tests cannot run on all
platforms and architectures, however we still want to count those and
report them as being skipped.  Because the test inventory and
the list of tests is extracted from the code, adding
conditionals inside the test suite is sub-optimal.  Tests that need
to be skipped for a certain platform or feature need to explicitly
report a skip using <a class="reference internal" href="#c.ztest_test_skip" title="ztest_test_skip"><code class="xref c c-func docutils literal notranslate"><span class="pre">ztest_test_skip()</span></code></a>. If the test runs,
it needs to report either a pass or fail.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#ifdef CONFIG_TEST1</span>
<span class="n">void</span> <span class="n">test_test1</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">zassert_true</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">#else</span>
<span class="n">void</span> <span class="n">test_test1</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">ztest_test_skip</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">#endif</span>


<span class="n">void</span> <span class="n">test_main</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">common</span><span class="p">,</span>
                         <span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_test1</span><span class="p">),</span>
                         <span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_test2</span><span class="p">)</span>
                         <span class="p">);</span>
        <span class="n">ztest_run_test_suite</span><span class="p">(</span><span class="n">common</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="quick-start-unit-testing">
<h2>Quick start - Unit testing<a class="headerlink" href="#quick-start-unit-testing" title="Permalink to this headline">¶</a></h2>
<p>Ztest can be used for unit testing. This means that rather than including the
entire Zephyr OS for testing a single function, you can focus the testing
efforts into the specific module in question. This will speed up testing since
only the module will have to be compiled in, and the tested functions will be
called directly.</p>
<p>Since you won’t be including basic kernel data structures that most code
depends on, you have to provide function stubs in the test. Ztest provides
some helpers for mocking functions, as demonstrated below.</p>
<p>In a unit test, mock objects can simulate the behavior of complex real objects
and are used to decide whether a test failed or passed by verifying whether an
interaction with an object occurred, and if required, to assert the order of
that interaction.</p>
<div class="section" id="best-practices-for-declaring-the-test-suite">
<span id="main-c-bp"></span><h3>Best practices for declaring the test suite<a class="headerlink" href="#best-practices-for-declaring-the-test-suite" title="Permalink to this headline">¶</a></h3>
<p><em>twister</em> and other validation tools need to obtain the list of
subcases that a Zephyr <em>ztest</em> test image will expose.</p>
<div class="admonition-rationale admonition">
<p class="admonition-title">Rationale</p>
<p>This all is for the purpose of traceability. It’s not enough to
have only a semaphore test project.  We also need to show that we
have testpoints for all APIs and functionality, and we trace back
to documentation of the API, and functional requirements.</p>
<p>The idea is that test reports show results for every sub-testcase
as passed, failed, blocked, or skipped.  Reporting on only the
high-level test project level, particularly when tests do too
many things, is too vague.</p>
</div>
<p>There exist two alternatives to writing tests. The first, and more verbose,
approach is to directly declare and run the test suites.
Here is a generic template for a test showing the expected use of
<code class="xref c c-func docutils literal notranslate"><span class="pre">ztest_test_suite()</span></code>:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ztest.h&gt;</span><span class="cp"></span>

<span class="k">extern</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test_sometest1</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="k">extern</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test_sometest2</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="cp">#ifndef CONFIG_WHATEVER              </span><span class="cm">/* Conditionally skip test_sometest3 */</span><span class="cp"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">test_sometest3</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="n">ztest_test_skip</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="cp">#else</span>
<span class="k">extern</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test_sometest3</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="k">extern</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test_sometest4</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="n">test_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">common</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest1</span><span class="p">),</span><span class="w"></span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest2</span><span class="p">),</span><span class="w"></span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest3</span><span class="p">),</span><span class="w"></span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest4</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">);</span><span class="w"></span>
<span class="w">     </span><span class="n">ztest_run_test_suite</span><span class="p">(</span><span class="n">common</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Alternatively, it is possible to split tests across multiple files using
<code class="xref c c-func docutils literal notranslate"><span class="pre">ztest_register_test_suite()</span></code> which bypasses the need for <code class="docutils literal notranslate"><span class="pre">extern</span></code>:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ztest.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">test_sometest1</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">zassert_true</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">ztest_register_test_suite</span><span class="p">(</span><span class="n">common</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">                          </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest1</span><span class="p">)</span><span class="w"></span>
<span class="w">                          </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The above sample simple registers the test suite and uses a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> pragma
function (more on that later). It is important to note that the test suite isn’t
directly run in this file. Instead two alternatives exist for running the suite.
First, if to do nothing. A default <code class="docutils literal notranslate"><span class="pre">test_main</span></code> function is provided by
ztest. This is the preferred approach if the test doesn’t involve a state and
doesn’t require use of the pragma.</p>
<p>In cases of an integration test it is possible that some general state needs to
be set between test suites. This can be thought of as a state diagram in which
<code class="docutils literal notranslate"><span class="pre">test_main</span></code> simply goes through various actions that modify the board’s
state and different test suites need to run. This is achieved in the following:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ztest.h&gt;</span><span class="cp"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">state</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_hibernating</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_usb_connected</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">pragma_always</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">state</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">pragma_not_hibernating_not_connected</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">struct</span><span class="w"> </span><span class="nc">state</span><span class="w"> </span><span class="o">*</span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">is_hibernating</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">is_usb_connected</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">pragma_usb_connected</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="k">struct</span><span class="w"> </span><span class="nc">state</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">is_usb_connected</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">ztest_register_test_suite</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span><span class="w"> </span><span class="n">pragma_always</span><span class="p">,</span><span class="w"></span>
<span class="w">                          </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_case0</span><span class="p">));</span><span class="w"></span>
<span class="n">ztest_register_test_suite</span><span class="p">(</span><span class="n">before_usb</span><span class="p">,</span><span class="w"> </span><span class="n">pragma_not_hibernating_not_connected</span><span class="p">,</span><span class="w"></span>
<span class="w">                          </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_case1</span><span class="p">),</span><span class="w"></span>
<span class="w">                          </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_case2</span><span class="p">));</span><span class="w"></span>
<span class="n">ztest_register_test_suite</span><span class="p">(</span><span class="n">with_usb</span><span class="p">,</span><span class="w"> </span><span class="n">pragma_usb_connected</span><span class="p">,,</span><span class="w"></span>
<span class="w">                          </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_case3</span><span class="p">),</span><span class="w"></span>
<span class="w">                          </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_case4</span><span class="p">));</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">test_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">struct</span><span class="w"> </span><span class="nc">state</span><span class="w"> </span><span class="n">state</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="cm">/* Should run `baseline` test suite only. */</span><span class="w"></span>
<span class="w">      </span><span class="n">ztest_run_registered_test_suites</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="cm">/* Simulate power on and update state. */</span><span class="w"></span>
<span class="w">      </span><span class="n">emulate_power_on</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="cm">/* Should run `baseline` and `before_usb` test suites. */</span><span class="w"></span>
<span class="w">      </span><span class="n">ztest_run_registered_test_suites</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="cm">/* Simulate plugging in a USB device. */</span><span class="w"></span>
<span class="w">      </span><span class="n">emulate_plugging_in_usb</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="cm">/* Should run `baseline` and `with_usb` test suites. */</span><span class="w"></span>
<span class="w">      </span><span class="n">ztest_run_registered_test_suites</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="cm">/* Verify that all the registered test suites actually ran. */</span><span class="w"></span>
<span class="w">      </span><span class="n">ztest_verify_all_registered_test_suites_ran</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>For <em>twister</em> to parse source files and create a list of subcases,
the declarations of <code class="xref c c-func docutils literal notranslate"><span class="pre">ztest_test_suite()</span></code> and
<code class="xref c c-func docutils literal notranslate"><span class="pre">ztest_register_test_suite()</span></code> must follow a few rules:</p>
<ul class="simple">
<li><p>one declaration per line</p></li>
<li><p>conditional execution by using <a class="reference internal" href="#c.ztest_test_skip" title="ztest_test_skip"><code class="xref c c-func docutils literal notranslate"><span class="pre">ztest_test_skip()</span></code></a></p></li>
</ul>
<p>What to avoid:</p>
<ul>
<li><p>packing multiple testcases in one source file</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">test_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="cp">#ifdef TEST_feature1</span>
<span class="w">        </span><span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">feature1</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_1a</span><span class="p">),</span><span class="w"></span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_1b</span><span class="p">),</span><span class="w"></span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_1c</span><span class="p">)</span><span class="w"></span>
<span class="w">                         </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">ztest_run_test_suite</span><span class="p">(</span><span class="n">feature1</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="cp">#ifdef TEST_feature2</span>
<span class="w">        </span><span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">feature2</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_2a</span><span class="p">),</span><span class="w"></span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_2b</span><span class="p">)</span><span class="w"></span>
<span class="w">                         </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">ztest_run_test_suite</span><span class="p">(</span><span class="n">feature2</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Do not use <code class="docutils literal notranslate"><span class="pre">#if</span></code></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">common</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest1</span><span class="p">),</span><span class="w"></span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest2</span><span class="p">),</span><span class="w"></span>
<span class="cp">#ifdef CONFIG_WHATEVER</span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest3</span><span class="p">),</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">                         </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest4</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Do not add comments on lines with a call to <code class="xref c c-func docutils literal notranslate"><span class="pre">ztest_unit_test()</span></code>:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">common</span><span class="p">,</span><span class="w"></span>
<span class="w">                 </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest1</span><span class="p">),</span><span class="w"></span>
<span class="w">                 </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest2</span><span class="p">)</span><span class="w"> </span><span class="cm">/* will fail */</span><span class="p">,</span><span class="w"></span>
<span class="cm">/* will fail! */</span><span class="w"> </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest3</span><span class="p">),</span><span class="w"></span>
<span class="w">                 </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest4</span><span class="p">),</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Do not define multiple definitions of unit / user unit test case per
line</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">common</span><span class="p">,</span><span class="w"></span>
<span class="w">                 </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest1</span><span class="p">),</span><span class="w"> </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest2</span><span class="p">),</span><span class="w"></span>
<span class="w">                 </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest3</span><span class="p">),</span><span class="w"></span>
<span class="w">                 </span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_sometest4</span><span class="p">),</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
</pre></div>
</div>
</li>
</ul>
<p>Other questions:</p>
<ul>
<li><p>Why not pre-scan with CPP and then parse? or post scan the ELF file?</p>
<p>If C pre-processing or building fails because of any issue, then we
won’t be able to tell the subcases.</p>
</li>
<li><p>Why not declare them in the YAML testcase description?</p>
<p>A separate testcase description file would be harder to maintain
than just keeping the information in the test source files
themselves – only one file to update when changes are made
eliminates duplication.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="stress-test-framework">
<h2>Stress test framework<a class="headerlink" href="#stress-test-framework" title="Permalink to this headline">¶</a></h2>
<p>Zephyr stress test framework (Ztress) provides an environment for executing user
functions in multiple priority contexts. It can be used to validate that code is
resilient to preemptions. The framework tracks the number of executions and preemptions
for each context. Execution can have various completion conditions like timeout,
number of executions or number of preemptions.</p>
<p>The framework is setting up the environment by creating the requested number of threads
(each on different priority), optionally starting a timer. For each context, a user
function (different for each context) is called and then the context sleeps for
a randomized amount of system ticks. The framework is tracking CPU load and adjusts sleeping
periods to achieve higher CPU load. In order to increase the probability of preemptions,
the system clock frequency should be relatively high. The default 100 Hz on QEMU x86
is much too low and it is recommended to increase it to 100 kHz.</p>
<p>The stress test environment is setup and executed using <code class="xref c c-macro docutils literal notranslate"><span class="pre">ZTRESS_EXECUTE</span></code> which
accepts a variable number of arguments. Each argument is a context that is
specified by <code class="xref c c-macro docutils literal notranslate"><span class="pre">ZTRESS_TIMER</span></code> or <code class="xref c c-macro docutils literal notranslate"><span class="pre">ZTRESS_THREAD</span></code> macros. Contexts
are specified in priority descending order. Each context specifies completion
conditions by providing the minimum number of executions and preemptions. When all
conditions are met and the execution has completed, an execution report is printed
and the macro returns. Note that while the test is executing, a progress report is
periodically printed.</p>
<p>Execution can be prematurely completed by specifying a test timeout (<code class="xref c c-func docutils literal notranslate"><span class="pre">ztress_set_timeout()</span></code>)
or an explicit abort (<code class="xref c c-func docutils literal notranslate"><span class="pre">ztress_abort()</span></code>).</p>
<p>User function parameters contains an execution counter and a flag indicating if it is
the last execution.</p>
<p>The example below presents how to setup and run 3 contexts (one of which is k_timer
interrupt handler context). Completion criteria is set to at least 10000 executions
of each context and 1000 preemptions of the lowest priority context. Additionally,
the timeout is configured to complete after 10 seconds if those conditions are not met.
The last argument of each context is the initial sleep time which will be adjusted throughout
the test to achieve the highest CPU load.</p>
<blockquote>
<div><div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ztress_set_timeout</span><span class="p">(</span><span class="n">K_MSEC</span><span class="p">(</span><span class="mi">10000</span><span class="p">));</span><span class="w"></span>
<span class="n">ZTRESS_EXECUTE</span><span class="p">(</span><span class="n">ZTRESS_TIMER</span><span class="p">(</span><span class="n">foo_0</span><span class="p">,</span><span class="w"> </span><span class="n">user_data_0</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="n">Z_TIMEOUT_TICKS</span><span class="p">(</span><span class="mi">20</span><span class="p">)),</span><span class="w"></span>
<span class="w">               </span><span class="n">ZTRESS_THREAD</span><span class="p">(</span><span class="n">foo_1</span><span class="p">,</span><span class="w"> </span><span class="n">user_data_1</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Z_TIMEOUT_TICKS</span><span class="p">(</span><span class="mi">20</span><span class="p">)),</span><span class="w"></span>
<span class="w">               </span><span class="n">ZTRESS_THREAD</span><span class="p">(</span><span class="n">foo_2</span><span class="p">,</span><span class="w"> </span><span class="n">user_data_2</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="n">Z_TIMEOUT_TICKS</span><span class="p">(</span><span class="mi">20</span><span class="p">)));</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>Static configuration of Ztress contains:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="xref c c-macro docutils literal notranslate"><span class="pre">ZTRESS_MAX_THREADS</span></code> - number of supported threads.</p></li>
<li><p><code class="xref c c-macro docutils literal notranslate"><span class="pre">ZTRESS_STACK_SIZE</span></code> - Stack size of created threads.</p></li>
<li><p><code class="xref c c-macro docutils literal notranslate"><span class="pre">ZTRESS_REPORT_PROGRESS_MS</span></code> - Test progress report interval.</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="api-reference">
<h2>API reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="running-tests">
<h3>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h3>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__ztest__test"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">ztest_test</span></span></dt>
<dd><p>This module eases the testing process by providing helpful macros and other testing structures. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.ZTEST">
<span class="target" id="group__ztest__test_1gac25858f76ea667d07de422a3b489cb15"></span><span class="sig-name descname"><span class="n"><span class="pre">ZTEST</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">suite</span></span>, <span class="n"><span class="pre">fn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ZTEST" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Create and register a new unit test. </p>
<p>Calling this macro will create a new unit test and attach it to the declared <code class="docutils literal notranslate"><span class="pre">suite</span></code>. The <code class="docutils literal notranslate"><span class="pre">suite</span></code> does not need to be defined in the same compilational unit.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>suite</strong> – The name of the test suite to attach this test </p></li>
<li><p><strong>fn</strong> – The test function to call. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ZTEST_USER">
<span class="target" id="group__ztest__test_1ga7121acc7ee00646cacefa773ff9631c8"></span><span class="sig-name descname"><span class="n"><span class="pre">ZTEST_USER</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">suite</span></span>, <span class="n"><span class="pre">fn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ZTEST_USER" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Define a test function that should run as a user thread. </p>
<p>This macro behaves exactly the same as ZTEST, but calls the test function in user space if <code class="docutils literal notranslate"><span class="pre">CONFIG_USERSPACE</span></code> was enabled.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>suite</strong> – The name of the test suite to attach this test </p></li>
<li><p><strong>fn</strong> – The test function to call. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ZTEST_F">
<span class="target" id="group__ztest__test_1gacd3ab522e0e5c8a270e86b0cb6bd81b2"></span><span class="sig-name descname"><span class="n"><span class="pre">ZTEST_F</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">suite</span></span>, <span class="n"><span class="pre">fn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ZTEST_F" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Define a test function. </p>
<p>This macro behaves exactly the same as <a class="reference internal" href="#group__ztest__test_1gac25858f76ea667d07de422a3b489cb15"><span class="std std-ref">ZTEST()</span></a>, but the function takes an argument for the fixture of type <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">suite##_fixture*</span></code> named <code class="docutils literal notranslate"><span class="pre">this</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>suite</strong> – The name of the test suite to attach this test </p></li>
<li><p><strong>fn</strong> – The test function to call. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ZTEST_USER_F">
<span class="target" id="group__ztest__test_1ga12ccce144e577cac6ba763982ad14def"></span><span class="sig-name descname"><span class="n"><span class="pre">ZTEST_USER_F</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">suite</span></span>, <span class="n"><span class="pre">fn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ZTEST_USER_F" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Define a test function that should run as a user thread. </p>
<p>If CONFIG_USERSPACE is not enabled, this is functionally identical to <a class="reference internal" href="#group__ztest__test_1gacd3ab522e0e5c8a270e86b0cb6bd81b2"><span class="std std-ref">ZTEST_F()</span></a>. The test function takes a single fixture argument of type <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">suite##_fixture*</span></code> named <code class="docutils literal notranslate"><span class="pre">this</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>suite</strong> – The name of the test suite to attach this test </p></li>
<li><p><strong>fn</strong> – The test function to call. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ZTEST_RULE">
<span class="target" id="group__ztest__test_1ga2a0a5e3b6e8fa1c9a03e7600895d875f"></span><span class="sig-name descname"><span class="n"><span class="pre">ZTEST_RULE</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">name</span></span>, <span class="n"><span class="pre">before_each_fn</span></span>, <span class="n"><span class="pre">after_each_fn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ZTEST_RULE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Define a test rule that will run before/after each unit test. </p>
<p>Functions defined here will run before/after each unit test for every test suite. Along with the callback, the test functions are provided a pointer to the test being run, and the data. This provides a mechanism for tests to perform custom operations depending on the specific test or the data (for example logging may use the test’s name).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – The name for the test rule (must be unique within the compilational unit) </p></li>
<li><p><strong>before_each_fn</strong> – The callback function to call before each test (may be NULL) </p></li>
<li><p><strong>after_each_fn</strong> – The callback function to call after each test (may be NULL) </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ZTEST_DMEM">
<span class="target" id="group__ztest__test_1ga2c7d0aa85e7f320d582395c5ded90133"></span><span class="sig-name descname"><span class="n"><span class="pre">ZTEST_DMEM</span></span></span><a class="headerlink" href="#c.ZTEST_DMEM" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ZTEST_BMEM">
<span class="target" id="group__ztest__test_1gac3de5965061b1164a8033712c9094e23"></span><span class="sig-name descname"><span class="n"><span class="pre">ZTEST_BMEM</span></span></span><a class="headerlink" href="#c.ZTEST_BMEM" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ZTEST_SECTION">
<span class="target" id="group__ztest__test_1ga44777f5011728bbff63fe3639c1b4aa8"></span><span class="sig-name descname"><span class="n"><span class="pre">ZTEST_SECTION</span></span></span><a class="headerlink" href="#c.ZTEST_SECTION" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ztest_run_test_suite">
<span class="target" id="group__ztest__test_1ga7f76df4df4bf68a605b923fed8e5465c"></span><span class="sig-name descname"><span class="n"><span class="pre">ztest_run_test_suite</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">suite</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_run_test_suite" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Run the specified test suite. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>suite</strong> – Test suite to run. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-typedefs">Typedefs</p>
<dl class="c type">
<dt class="sig sig-object c" id="c.ztest_rule_cb">
<span class="target" id="group__ztest__test_1ga2090c493018a95112b89c5f83b5d8162"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">ztest_rule_cb</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">ztest_unit_test</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">test</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.ztest_rule_cb" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Test rule callback function signature. </p>
<p>The function signature that can be used to register a test rule’s before/after callback. This provides access to the test and the fixture data (if provided).</p>
<dl class="field-list simple">
<dt class="field-odd">Param test</dt>
<dd class="field-odd"><p>Pointer to the unit test in context </p>
</dd>
<dt class="field-even">Param data</dt>
<dd class="field-even"><p>Pointer to the test’s fixture data (may be NULL) </p>
</dd>
</dl>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.ztest_test_fail">
<span class="target" id="group__ztest__test_1gacd6eb423f54dce8544f7c3b1618c0374"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">ztest_test_fail</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_test_fail" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Fail the currently running test. </p>
<p>This is the function called from failed assertions and the like. You probably don’t need to call it yourself. </p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.ztest_test_pass">
<span class="target" id="group__ztest__test_1ga085d30a04102ebb8c3f2206020723ee0"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">ztest_test_pass</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_test_pass" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Pass the currently running test. </p>
<p>Normally a test passes just by returning without an assertion failure. However, if the success case for your test involves a fatal fault, you can call this function from k_sys_fatal_error_handler to indicate that the test passed before aborting the thread. </p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.ztest_test_skip">
<span class="target" id="group__ztest__test_1gada3b1fcfa71db1bf7787c03ff45256d5"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">ztest_test_skip</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_test_skip" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Skip the current test. </p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.unit_test_noop">
<span class="target" id="group__ztest__test_1gaeb99bd1d29675ca8c31b519853cec422"></span><span class="k"><span class="pre">static</span></span><span class="w"> </span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">unit_test_noop</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.unit_test_noop" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Do nothing, successfully. </p>
<p>Unit test / setup function / teardown function that does nothing, successfully. Can be used as a parameter to ztest_unit_test_setup_teardown(). </p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.ztest_simple_1cpu_before">
<span class="target" id="group__ztest__test_1gac7ddc33b5a0d11e2ffa0a564019c5e3d"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">ztest_simple_1cpu_before</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_simple_1cpu_before" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>A ‘before’ function to use in test suites that just need to start 1cpu. </p>
<p>Ignores data, and calls z_test_1cpu_start()</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – The test suite’s data </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.ztest_simple_1cpu_after">
<span class="target" id="group__ztest__test_1gaa53486873430dd8fa978745d8a1d0686"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">ztest_simple_1cpu_after</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_simple_1cpu_after" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>A ‘after’ function to use in test suites that just need to stop 1cpu. </p>
<p>Ignores data, and calls z_test_1cpu_stop()</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – The test suite’s data </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-variables">Variables</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.ztest_mem_partition">
<span class="target" id="group__ztest__test_1ga3adced2fdda96833e6b1ecbf3d61d446"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../../reference/usermode/memory_domain.html#c.k_mem_partition" title="k_mem_partition"><span class="n"><span class="pre">k_mem_partition</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">ztest_mem_partition</span></span></span><a class="headerlink" href="#c.ztest_mem_partition" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.ztest_test_rule">
<span class="target" id="structztest__test__rule"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">ztest_test_rule</span></span></span><a class="headerlink" href="#c.ztest_test_rule" title="Permalink to this definition">¶</a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;ztest_test_new.h&gt;</em></div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="assertions">
<h3>Assertions<a class="headerlink" href="#assertions" title="Permalink to this headline">¶</a></h3>
<p>These macros will instantly fail the test if the related assertion fails.
When an assertion fails, it will print the current file, line and function,
alongside a reason for the failure and an optional message. If the config
option:<cite>CONFIG_ZTEST_ASSERT_VERBOSE</cite> is 0, the assertions will only print the
file and line numbers, reducing the binary size of the test.</p>
<p>Example output for a failed macro from
<code class="docutils literal notranslate"><span class="pre">zassert_equal(buf-&gt;ref,</span> <span class="pre">2,</span> <span class="pre">&quot;Invalid</span> <span class="pre">refcount&quot;)</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Assertion failed at main.c:62: test_get_single_buffer: Invalid refcount (buf-&gt;ref not equal to 2)
Aborted at unit test function
</pre></div>
</div>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__ztest__assert"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">ztest_assert</span></span></dt>
<dd><p>This module provides assertions when using Ztest. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert">
<span class="target" id="group__ztest__assert_1ga4c36fe161245ebc643088c6a14f357f7"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">cond</span></span>, <span class="n"><span class="pre">default_msg</span></span>, <span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Fail the test, if <em>cond</em> is false. </p>
<p>You probably don’t need to call this macro directly. You should instead use zassert_{condition} macros below.</p>
<p>Note that when CONFIG_MULTITHREADING=n macro returns from the function. It is then expected that in that case ztest asserts will be used only in the context of the test function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cond</strong> – Condition to check </p></li>
<li><p><strong>msg</strong> – Optional, can be NULL. Message to print if <em>cond</em> is false. </p></li>
<li><p><strong>default_msg</strong> – Message to print if <em>cond</em> is false </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_unreachable">
<span class="target" id="group__ztest__assert_1gaa61a2f8c8d530d5b149fc700993b6d03"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_unreachable</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_unreachable" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Assert that this function call won’t be reached. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msg</strong> – Optional message to print if the assertion fails </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_true">
<span class="target" id="group__ztest__assert_1ga2f30aa3d3bfe7281b86b725dec394466"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_true</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">cond</span></span>, <span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_true" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Assert that <em>cond</em> is true. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cond</strong> – Condition to check </p></li>
<li><p><strong>msg</strong> – Optional message to print if the assertion fails </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_false">
<span class="target" id="group__ztest__assert_1gacc41f998b701997e4eafb6ed7b9d537c"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_false</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">cond</span></span>, <span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_false" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Assert that <em>cond</em> is false. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cond</strong> – Condition to check </p></li>
<li><p><strong>msg</strong> – Optional message to print if the assertion fails </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_ok">
<span class="target" id="group__ztest__assert_1ga33a5902873c0ce3ac6eeda2e61cecef8"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_ok</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">cond</span></span>, <span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_ok" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Assert that <em>cond</em> is 0 (success) </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cond</strong> – Condition to check </p></li>
<li><p><strong>msg</strong> – Optional message to print if the assertion fails </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_is_null">
<span class="target" id="group__ztest__assert_1ga0380ea00fa3775f9a8a05faaf4de71b7"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_is_null</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">ptr</span></span>, <span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_is_null" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Assert that <em>ptr</em> is NULL. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ptr</strong> – Pointer to compare </p></li>
<li><p><strong>msg</strong> – Optional message to print if the assertion fails </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_not_null">
<span class="target" id="group__ztest__assert_1gad78332e6bd37812e56ccc4af601542e4"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_not_null</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">ptr</span></span>, <span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_not_null" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Assert that <em>ptr</em> is not NULL. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ptr</strong> – Pointer to compare </p></li>
<li><p><strong>msg</strong> – Optional message to print if the assertion fails </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_equal">
<span class="target" id="group__ztest__assert_1ga107b470a617e5c398353db398a3424e2"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_equal</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">a</span></span>, <span class="n"><span class="pre">b</span></span>, <span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_equal" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Assert that <em>a</em> equals <em>b</em>. </p>
<p><em>a</em> and <em>b</em> won’t be converted and will be compared directly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> – Value to compare </p></li>
<li><p><strong>b</strong> – Value to compare </p></li>
<li><p><strong>msg</strong> – Optional message to print if the assertion fails </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_not_equal">
<span class="target" id="group__ztest__assert_1ga9591c44c125ca0a073c0d80dc0d84a3b"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_not_equal</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">a</span></span>, <span class="n"><span class="pre">b</span></span>, <span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_not_equal" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Assert that <em>a</em> does not equal <em>b</em>. </p>
<p><em>a</em> and <em>b</em> won’t be converted and will be compared directly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> – Value to compare </p></li>
<li><p><strong>b</strong> – Value to compare </p></li>
<li><p><strong>msg</strong> – Optional message to print if the assertion fails </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_equal_ptr">
<span class="target" id="group__ztest__assert_1ga8787deba6ec667b7b14e12b5eb3e0d53"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_equal_ptr</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">a</span></span>, <span class="n"><span class="pre">b</span></span>, <span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_equal_ptr" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Assert that <em>a</em> equals <em>b</em>. </p>
<p><em>a</em> and <em>b</em> will be converted to <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span></code> before comparing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> – Value to compare </p></li>
<li><p><strong>b</strong> – Value to compare </p></li>
<li><p><strong>msg</strong> – Optional message to print if the assertion fails </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_within">
<span class="target" id="group__ztest__assert_1ga50ebeb6649212f47ca2092186c32fddd"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_within</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">a</span></span>, <span class="n"><span class="pre">b</span></span>, <span class="n"><span class="pre">d</span></span>, <span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_within" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Assert that <em>a</em> is within <em>b</em> with delta <em>d</em>. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> – Value to compare </p></li>
<li><p><strong>b</strong> – Value to compare </p></li>
<li><p><strong>d</strong> – Delta </p></li>
<li><p><strong>msg</strong> – Optional message to print if the assertion fails </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_mem_equal">
<span class="target" id="group__ztest__assert_1gabbfcf6345172387326d35b5d0e2bb051"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_mem_equal</span></span></span><span class="sig-paren">(</span><span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_mem_equal" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Assert that 2 memory buffers have the same contents. </p>
<p>This macro calls the final memory comparison assertion macro. Using double expansion allows providing some arguments by macros that would expand to more than one values (ANSI-C99 defines that all the macro arguments have to be expanded before macro call).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>...</strong> – Arguments, see <a class="reference internal" href="#group__ztest__assert_1gad0fb51849c8a77c88312e8b6f8333e37"><span class="std std-ref">zassert_mem_equal__</span></a> for real arguments accepted. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.zassert_mem_equal__">
<span class="target" id="group__ztest__assert_1gad0fb51849c8a77c88312e8b6f8333e37"></span><span class="sig-name descname"><span class="n"><span class="pre">zassert_mem_equal__</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">buf</span></span>, <span class="n"><span class="pre">exp</span></span>, <span class="n"><span class="pre">size</span></span>, <span class="n"><span class="pre">msg</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.zassert_mem_equal__" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Internal assert that 2 memory buffers have the same contents. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is internal macro, to be used as a second expansion. See <a class="reference internal" href="#group__ztest__assert_1gabbfcf6345172387326d35b5d0e2bb051"><span class="std std-ref">zassert_mem_equal</span></a>.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buf</strong> – Buffer to compare </p></li>
<li><p><strong>exp</strong> – Buffer with expected contents </p></li>
<li><p><strong>size</strong> – Size of buffers </p></li>
<li><p><strong>msg</strong> – Optional message to print if the assertion fails </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</dd></dl>

</div>
<div class="section" id="mocking">
<h3>Mocking<a class="headerlink" href="#mocking" title="Permalink to this headline">¶</a></h3>
<p>These functions allow abstracting callbacks and related functions and
controlling them from specific tests. You can enable the mocking framework by
setting <a class="reference internal" href="../../kconfig.html#CONFIG_ZTEST_MOCKING" title="CONFIG_ZTEST_MOCKING"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_ZTEST_MOCKING</span></code></a> to “y” in the configuration file of the
test.  The amount of concurrent return values and expected parameters is
limited by <a class="reference internal" href="../../kconfig.html#CONFIG_ZTEST_PARAMETER_COUNT" title="CONFIG_ZTEST_PARAMETER_COUNT"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_ZTEST_PARAMETER_COUNT</span></code></a>.</p>
<p>Here is an example for configuring the function <code class="docutils literal notranslate"><span class="pre">expect_two_parameters</span></code> to
expect the values <code class="docutils literal notranslate"><span class="pre">a=2</span></code> and <code class="docutils literal notranslate"><span class="pre">b=3</span></code>, and telling <code class="docutils literal notranslate"><span class="pre">returns_int</span></code> to return
<code class="docutils literal notranslate"><span class="pre">5</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ztest.h&gt;</span><span class="cp"></span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">expect_two_parameters</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">	</span><span class="n">ztest_check_expected_value</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">	</span><span class="n">ztest_check_expected_value</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 7</span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">parameter_tests</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="linenos">10</span><span class="p">{</span><span class="w"></span>
<span class="linenos">11</span><span class="w">	</span><span class="n">ztest_expect_value</span><span class="p">(</span><span class="n">expect_two_parameters</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="linenos">12</span><span class="w">	</span><span class="n">ztest_expect_value</span><span class="p">(</span><span class="n">expect_two_parameters</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
<span class="linenos">13</span><span class="w">	</span><span class="n">expect_two_parameters</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
<span class="linenos">14</span><span class="p">}</span><span class="w"></span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">returns_int</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="linenos">17</span><span class="p">{</span><span class="w"></span>
<span class="linenos">18</span><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">ztest_get_return_value</span><span class="p">();</span><span class="w"></span>
<span class="linenos">19</span><span class="p">}</span><span class="w"></span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">return_value_tests</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="linenos">22</span><span class="p">{</span><span class="w"></span>
<span class="linenos">23</span><span class="w">	</span><span class="n">ztest_returns_value</span><span class="p">(</span><span class="n">returns_int</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
<span class="linenos">24</span><span class="w">	</span><span class="n">zassert_equal</span><span class="p">(</span><span class="n">returns_int</span><span class="p">(),</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">25</span><span class="p">}</span><span class="w"></span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="kt">void</span><span class="w"> </span><span class="nf">test_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="linenos">28</span><span class="p">{</span><span class="w"></span>
<span class="linenos">29</span><span class="w">	</span><span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">mock_framework_tests</span><span class="p">,</span><span class="w"></span>
<span class="linenos">30</span><span class="w">		</span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">parameter_test</span><span class="p">),</span><span class="w"></span>
<span class="linenos">31</span><span class="w">		</span><span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">return_value_test</span><span class="p">)</span><span class="w"></span>
<span class="linenos">32</span><span class="w">	</span><span class="p">);</span><span class="w"></span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="w">	</span><span class="n">ztest_run_test_suite</span><span class="p">(</span><span class="n">mock_framework_tests</span><span class="p">);</span><span class="w"></span>
<span class="linenos">35</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__ztest__mock"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">ztest_mock</span></span></dt>
<dd><p>This module provides simple mocking functions for unit testing. These need CONFIG_ZTEST_MOCKING=y. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.ztest_expect_value">
<span class="target" id="group__ztest__mock_1ga58c2f0c0e628e73a2268a3d18b0440d6"></span><span class="sig-name descname"><span class="n"><span class="pre">ztest_expect_value</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">func</span></span>, <span class="n"><span class="pre">param</span></span>, <span class="n"><span class="pre">value</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_expect_value" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Tell function <em>func</em> to expect the value <em>value</em> for <em>param</em>. </p>
<p>When using <a class="reference internal" href="#group__ztest__mock_1gae9af6ba8e51738e938763c896f17ea8f"><span class="std std-ref">ztest_check_expected_value()</span></a>, tell that the value of <em>param</em> should be <em>value</em>. The value will internally be stored as an <code class="docutils literal notranslate"><span class="pre">uintptr_t</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – Function in question </p></li>
<li><p><strong>param</strong> – Parameter for which the value should be set </p></li>
<li><p><strong>value</strong> – Value for <em>param</em> </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ztest_check_expected_value">
<span class="target" id="group__ztest__mock_1gae9af6ba8e51738e938763c896f17ea8f"></span><span class="sig-name descname"><span class="n"><span class="pre">ztest_check_expected_value</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">param</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_check_expected_value" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>If <em>param</em> doesn’t match the value set by <a class="reference internal" href="#group__ztest__mock_1ga58c2f0c0e628e73a2268a3d18b0440d6"><span class="std std-ref">ztest_expect_value()</span></a>, fail the test. </p>
<p>This will first check that does <em>param</em> have a value to be expected, and then checks whether the value of the parameter is equal to the expected value. If either of these checks fail, the current test will fail. This must be called from the called function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>param</strong> – Parameter to check </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ztest_expect_data">
<span class="target" id="group__ztest__mock_1gac1a64d8bf9c877e8666e0c6d93b0dbab"></span><span class="sig-name descname"><span class="n"><span class="pre">ztest_expect_data</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">func</span></span>, <span class="n"><span class="pre">param</span></span>, <span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_expect_data" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Tell function <em>func</em> to expect the data <em>data</em> for <em>param</em>. </p>
<p>When using <a class="reference internal" href="#group__ztest__mock_1ga805cf99272f147beeeee5ad6ca2553f5"><span class="std std-ref">ztest_check_expected_data()</span></a>, the data pointed to by <em>param</em> should be same <em>data</em> in this function. Only data pointer is stored by this function, so it must still be valid when ztest_check_expected_data is called.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – Function in question </p></li>
<li><p><strong>param</strong> – Parameter for which the data should be set </p></li>
<li><p><strong>data</strong> – pointer for the data for parameter <em>param</em> </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ztest_check_expected_data">
<span class="target" id="group__ztest__mock_1ga805cf99272f147beeeee5ad6ca2553f5"></span><span class="sig-name descname"><span class="n"><span class="pre">ztest_check_expected_data</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">param</span></span>, <span class="n"><span class="pre">length</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_check_expected_data" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>If data pointed by <em>param</em> don’t match the data set by <a class="reference internal" href="#group__ztest__mock_1gac1a64d8bf9c877e8666e0c6d93b0dbab"><span class="std std-ref">ztest_expect_data()</span></a>, fail the test. </p>
<p>This will first check that <em>param</em> is expected to be null or non-null and then check whether the data pointed by parameter is equal to expected data. If either of these checks fail, the current test will fail. This must be called from the called function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>param</strong> – Parameter to check </p></li>
<li><p><strong>length</strong> – Length of the data to compare </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ztest_return_data">
<span class="target" id="group__ztest__mock_1gac79d097a6b274b25286f2b0e80fbd6e9"></span><span class="sig-name descname"><span class="n"><span class="pre">ztest_return_data</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">func</span></span>, <span class="n"><span class="pre">param</span></span>, <span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_return_data" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Tell function <em>func</em> to return the data <em>data</em> for <em>param</em>. </p>
<p>When using <a class="reference internal" href="#group__ztest__mock_1gac79d097a6b274b25286f2b0e80fbd6e9"><span class="std std-ref">ztest_return_data()</span></a>, the data pointed to by <em>param</em> should be same <em>data</em> in this function. Only data pointer is stored by this function, so it must still be valid when ztest_copy_return_data is called.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – Function in question </p></li>
<li><p><strong>param</strong> – Parameter for which the data should be set </p></li>
<li><p><strong>data</strong> – pointer for the data for parameter <em>param</em> </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ztest_copy_return_data">
<span class="target" id="group__ztest__mock_1ga12872a3d783d53d564ed94583bc490b0"></span><span class="sig-name descname"><span class="n"><span class="pre">ztest_copy_return_data</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">param</span></span>, <span class="n"><span class="pre">length</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_copy_return_data" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Copy the data set by ztest_return_data to the memory pointed by <em>param</em>. </p>
<p>This will first check that <em>param</em> is not null and then copy the data. This must be called from the called function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>param</strong> – Parameter to return data for </p></li>
<li><p><strong>length</strong> – Length of the data to return </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ztest_returns_value">
<span class="target" id="group__ztest__mock_1ga2ec539b4c0f3e4efb695213b4fd08c2c"></span><span class="sig-name descname"><span class="n"><span class="pre">ztest_returns_value</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">func</span></span>, <span class="n"><span class="pre">value</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_returns_value" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Tell <em>func</em> that it should return <em>value</em>. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – Function that should return <em>value</em> </p></li>
<li><p><strong>value</strong> – Value to return from <em>func</em> </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ztest_get_return_value">
<span class="target" id="group__ztest__mock_1ga31dcd5b5a3596a7404a771a2d32f3a39"></span><span class="sig-name descname"><span class="n"><span class="pre">ztest_get_return_value</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_get_return_value" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the return value for current function. </p>
<p>The return value must have been set previously with <a class="reference internal" href="#group__ztest__mock_1ga2ec539b4c0f3e4efb695213b4fd08c2c"><span class="std std-ref">ztest_returns_value()</span></a>. If no return value exists, the current test will fail.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The value the current function should return </p>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.ztest_get_return_value_ptr">
<span class="target" id="group__ztest__mock_1gaa2df2eaeba49019b7a83ac769ea95968"></span><span class="sig-name descname"><span class="n"><span class="pre">ztest_get_return_value_ptr</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#c.ztest_get_return_value_ptr" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the return value as a pointer for current function. </p>
<p>The return value must have been set previously with <a class="reference internal" href="#group__ztest__mock_1ga2ec539b4c0f3e4efb695213b4fd08c2c"><span class="std std-ref">ztest_returns_value()</span></a>. If no return value exists, the current test will fail.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The value the current function should return as a <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span></code> </p>
</dd>
</dl>
</dd></dl>

</div>
</dd></dl>

</div>
</div>
<div class="section" id="customizing-test-output">
<h2>Customizing Test Output<a class="headerlink" href="#customizing-test-output" title="Permalink to this headline">¶</a></h2>
<p>The way output is presented when running tests can be customized.
An example can be found in <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/tests/ztest/custom_output">tests/ztest/custom_output</a>.</p>
<p>Customization is enabled by setting <a class="reference internal" href="../../kconfig.html#CONFIG_ZTEST_TC_UTIL_USER_OVERRIDE" title="CONFIG_ZTEST_TC_UTIL_USER_OVERRIDE"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_ZTEST_TC_UTIL_USER_OVERRIDE</span></code></a> to “y”
and adding a file <code class="file docutils literal notranslate"><span class="pre">tc_util_user_override.h</span></code> with your overrides.</p>
<p>Add the line <code class="docutils literal notranslate"><span class="pre">zephyr_include_directories(my_folder)</span></code> to
your project’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> to let Zephyr find your header file during builds.</p>
<p>See the file <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/subsys/testsuite/include/tc_util.h">subsys/testsuite/include/tc_util.h</a> to see which macros and/or defines can be overridden.
These will be surrounded by blocks such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#ifndef SOMETHING</span>
<span class="c1">#define SOMETHING &lt;default implementation&gt;</span>
<span class="c1">#endif /* SOMETHING */</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Mar 05, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>