<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generating coverage reports &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script type="module" src="../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Trusted Firmware-M" href="../tfm/index.html" />
    <link rel="prev" title="Test Runner (Twister)" href="twister.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.99
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/3.0.0/">3.0.0</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User and Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../beyond-GSG.html">Beyond the Getting Started Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch/index.html">Architecture-related Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../docs/index.html">Documentation Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../coccinelle.html">Coccinelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code-relocation.html">Code And Data Relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crypto/index.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flash_debug/index.html">Flashing and Hardware Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debug_tools/index.html">Debugging and Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_mgmt/index.html">Device Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dts/index.html">Devicetree Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../env_vars.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../emulator/index.html">Peripheral and Hardware Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">Modules (External projects)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platformio/index.html">Using with PlatformIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../portability/index.html">OS Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../porting/index.html">Porting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../smf/index.html">State Machine Framework</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Testing</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ztest.html">Test Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="twister.html">Test Runner (Twister)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Generating coverage reports</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#test-coverage-reports-in-embedded-devices-or-qemu">Test coverage reports in embedded devices or QEMU</a></li>
<li class="toctree-l4"><a class="reference internal" href="#coverage-reports-using-the-posix-architecture">Coverage reports using the POSIX architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="#coverage-reports-using-twister">Coverage reports using Twister</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../west/index.html">West (Zephyr’s meta-tool)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimizations/index.html">Optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zephyr_cmake_package.html">Zephyr CMake Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/kconfig.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../index.html">User and Developer Guides</a> &raquo;</li>
  
     <li><a href="index.html">Testing</a> &raquo;</li>
  
  <li>Generating coverage reports</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/guides/test/coverage.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="generating-coverage-reports">
<span id="coverage"></span><h1>Generating coverage reports<a class="headerlink" href="#generating-coverage-reports" title="Permalink to this headline">¶</a></h1>
<p>With Zephyr, you can generate code coverage reports to analyze which parts of
the code are covered by a given test or application.</p>
<p>You can do this in two ways:</p>
<ul class="simple">
<li><p>In a real embedded target or QEMU, using Zephyr’s gcov integration</p></li>
<li><p>Directly in your host computer, by compiling your application targeting
the POSIX architecture</p></li>
</ul>
<div class="section" id="test-coverage-reports-in-embedded-devices-or-qemu">
<h2>Test coverage reports in embedded devices or QEMU<a class="headerlink" href="#test-coverage-reports-in-embedded-devices-or-qemu" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://gcc.gnu.org/onlinedocs/gcc/Gcov.html">GCC GCOV</a> is a test coverage program
used together with the GCC compiler to analyze and create test coverage reports
for your programs, helping you create more efficient, faster running code and
discovering untested code paths</p>
<p>In Zephyr, gcov collects coverage profiling data in RAM (and not to a file
system) while your application is running. Support for gcov collection and
reporting is limited by available RAM size and so is currently enabled only
for QEMU emulation of embedded targets.</p>
</div>
<div class="section" id="details">
<h3>Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h3>
<p>There are 2 parts to enable this feature. The first is to enable the coverage for the
device and the second to enable in the test application. As explained earlier the
code coverage with gcov is a function of RAM available. Therefore ensure that the
device has enough RAM when enabling the coverage for it. For example a small device
like frdm_k64f can run a simple test application but the more complex test
cases which consume more RAM will crash when coverage is enabled.</p>
<p>To enable the device for coverage, select <a class="reference internal" href="../../kconfig.html#CONFIG_HAS_COVERAGE_SUPPORT" title="CONFIG_HAS_COVERAGE_SUPPORT"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_HAS_COVERAGE_SUPPORT</span></code></a>
in the Kconfig.board file.</p>
<p>To report the coverage for the particular test application set <a class="reference internal" href="../../kconfig.html#CONFIG_COVERAGE" title="CONFIG_COVERAGE"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_COVERAGE</span></code></a>.</p>
</div>
<div class="section" id="steps-to-generate-code-coverage-reports">
<h3>Steps to generate code coverage reports<a class="headerlink" href="#steps-to-generate-code-coverage-reports" title="Permalink to this headline">¶</a></h3>
<p>These steps will produce an HTML coverage report for a single application.</p>
<ol class="arabic">
<li><p>Build the code with CONFIG_COVERAGE=y.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b mps2_an385 -- -DCONFIG_COVERAGE=y</span>
</pre></div>
</div>
</li>
<li><p>Capture the emulator output into a log file. You may need to terminate
the emulator with <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd>-<kbd class="kbd docutils literal notranslate">A</kbd> <kbd class="kbd docutils literal notranslate">X</kbd></kbd> for this to complete after the coverage dump
has been printed:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ninja -Cbuild run | tee log.log</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ninja -Cbuild run | tee log.log</span>
</pre></div>
</div>
</li>
<li><p>Generate the gcov <code class="docutils literal notranslate"><span class="pre">.gcda</span></code> and <code class="docutils literal notranslate"><span class="pre">.gcno</span></code> files from the log file that was
saved:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 scripts/gen_gcov_files.py -i log.log
</pre></div>
</div>
</li>
<li><p>Find the gcov binary placed in the SDK. You will need to pass the path to
the gcov binary for the appropriate architecture when you later invoke
<code class="docutils literal notranslate"><span class="pre">gcovr</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ find $ZEPHYR_SDK_INSTALL_DIR -iregex &quot;.*gcov&quot;
</pre></div>
</div>
</li>
<li><p>Create an output directory for the reports:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir -p gcov_report
</pre></div>
</div>
</li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">gcovr</span></code> to get the reports:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gcovr -r $ZEPHYR_BASE . --html -o gcov_report/coverage.html --html-details --gcov-executable &lt;gcov_path_in_SDK&gt;
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="coverage-reports-using-the-posix-architecture">
<span id="coverage-posix"></span><h2>Coverage reports using the POSIX architecture<a class="headerlink" href="#coverage-reports-using-the-posix-architecture" title="Permalink to this headline">¶</a></h2>
<p>When compiling for the POSIX architecture, you utilize your host native tooling
to build a native executable which contains your application, the Zephyr OS,
and some basic HW emulation.</p>
<p>That means you can use the same tools you would while developing any
other desktop application.</p>
<p>To build your application with <code class="docutils literal notranslate"><span class="pre">gcc</span></code>’s <a class="reference external" href="https://gcc.gnu.org/onlinedocs/gcc/Gcov.html">gcov</a>, simply set
<a class="reference internal" href="../../kconfig.html#CONFIG_COVERAGE" title="CONFIG_COVERAGE"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_COVERAGE</span></code></a> before compiling it.
When you run your application, <code class="docutils literal notranslate"><span class="pre">gcov</span></code> coverage data will be dumped into the
respective <code class="docutils literal notranslate"><span class="pre">gcda</span></code> and <code class="docutils literal notranslate"><span class="pre">gcno</span></code> files.
You may postprocess these with your preferred tools. For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b native_posix samples/hello_world -- -DCONFIG_COVERAGE=y</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./build/zephyr/zephyr.exe
<span class="gp"># </span>Press Ctrl+C to <span class="nb">exit</span>
<span class="go">lcov --capture --directory ./ --output-file lcov.info -q --rc lcov_branch_coverage=1</span>
<span class="go">genhtml lcov.info --output-directory lcov_html -q --ignore-errors source --branch-coverage --highlight --legend</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You need a recent version of lcov (at least 1.14) with support for
intermediate text format. Such packages exist in recent Linux distributions.</p>
<p>Alternatively, you can use gcovr (at least version 4.2).</p>
</div>
</div>
<div class="section" id="coverage-reports-using-twister">
<h2>Coverage reports using Twister<a class="headerlink" href="#coverage-reports-using-twister" title="Permalink to this headline">¶</a></h2>
<p>Zephyr’s <a class="reference internal" href="twister.html#twister-script"><span class="std std-ref">twister script</span></a> can automatically
generate a coverage report from the tests which were executed.
You just need to invoke it with the <code class="docutils literal notranslate"><span class="pre">--coverage</span></code> command line option.</p>
<p>For example, you may invoke:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ twister --coverage -p qemu_x86 -T tests/kernel
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ twister --coverage -p native_posix -T tests/bluetooth
</pre></div>
</div>
<p>which will produce <code class="docutils literal notranslate"><span class="pre">twister-out/coverage/index.html</span></code> with the report.</p>
<p>The process differs for unit tests, which are built with the host
toolchain and require a different board:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ twister --coverage -p unit_testing -T tests/unit
</pre></div>
</div>
<p>which produces a report in the same location as non-unit testing.</p>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Mar 05, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>