<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shields &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script type="module" src="../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="State Machine Framework" href="../smf/index.html" />
    <link rel="prev" title="Board Porting Guide" href="board_porting.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.99
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/3.0.0/">3.0.0</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User and Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../beyond-GSG.html">Beyond the Getting Started Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch/index.html">Architecture-related Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../docs/index.html">Documentation Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../coccinelle.html">Coccinelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code-relocation.html">Code And Data Relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crypto/index.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flash_debug/index.html">Flashing and Hardware Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debug_tools/index.html">Debugging and Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_mgmt/index.html">Device Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dts/index.html">Devicetree Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../env_vars.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../emulator/index.html">Peripheral and Hardware Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">Modules (External projects)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platformio/index.html">Using with PlatformIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../portability/index.html">OS Abstraction</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Porting</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="arch.html">Architecture Porting Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="board_porting.html">Board Porting Guide</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Shields</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#shield-porting-and-configuration">Shield porting and configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#board-compatibility">Board compatibility</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shield-activation">Shield activation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shield-variants">Shield variants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpio-nexus-nodes">GPIO nexus nodes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../smf/index.html">State Machine Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../west/index.html">West (Zephyr’s meta-tool)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimizations/index.html">Optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zephyr_cmake_package.html">Zephyr CMake Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/kconfig.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../index.html">User and Developer Guides</a> &raquo;</li>
  
     <li><a href="index.html">Porting</a> &raquo;</li>
  
  <li>Shields</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/guides/porting/shields.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="shields">
<span id="id1"></span><h1>Shields<a class="headerlink" href="#shields" title="Permalink to this headline">¶</a></h1>
<p>Shields, also known as “add-on” or “daughter boards”, attach to a board
to extend its features and services for easier and modularized prototyping.
In Zephyr, the shield feature provides Zephyr-formatted shield
descriptions for easier compatibility with applications.</p>
<div class="section" id="shield-porting-and-configuration">
<h2>Shield porting and configuration<a class="headerlink" href="#shield-porting-and-configuration" title="Permalink to this headline">¶</a></h2>
<p>Shield configuration files are available in the board directory
under <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main//boards/shields">/boards/shields</a>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boards/shields/&lt;shield&gt;
├── &lt;shield&gt;.overlay
├── Kconfig.shield
└── Kconfig.defconfig
</pre></div>
</div>
<p>These files provides shield configuration as follows:</p>
<ul class="simple">
<li><p><strong>&lt;shield&gt;.overlay</strong>: This file provides a shield description in devicetree
format that is merged with the board’s <a class="reference internal" href="../dts/index.html#dt-guide"><span class="std std-ref">devicetree</span></a>
before compilation.</p></li>
<li><p><strong>Kconfig.shield</strong>: This file defines shield Kconfig symbols that will be
used for default shield configuration. To ease use with applications,
the default shield configuration here should be consistent with those in
the <a class="reference internal" href="board_porting.html#default-board-configuration"><span class="std std-ref">Write your devicetree</span></a>.</p></li>
<li><p><strong>Kconfig.defconfig</strong>: This file defines the default shield configuration. It
is made to be consistent with the <a class="reference internal" href="board_porting.html#default-board-configuration"><span class="std std-ref">Write your devicetree</span></a>. Hence,
shield configuration should be done by keeping in mind that features
activation is application responsibility.</p></li>
</ul>
</div>
<div class="section" id="board-compatibility">
<h2>Board compatibility<a class="headerlink" href="#board-compatibility" title="Permalink to this headline">¶</a></h2>
<p>Hardware shield-to-board compatibility depends on the use of well-known
connectors used on popular boards (such as Arduino and 96boards).  For
software compatibility, boards must also provide a configuration matching
their supported connectors.</p>
<p>This should be done at two different level:</p>
<ul class="simple">
<li><p>Pinmux: Connector pins should be correctly configured to match shield pins</p></li>
<li><p>Devicetree: A board <a class="reference internal" href="../dts/index.html#dt-guide"><span class="std std-ref">devicetree</span></a> file,
<code class="file docutils literal notranslate"><span class="pre">BOARD.dts</span></code> should define a node alias for each connector interface.
For example, for Arduino I2C:</p></li>
</ul>
<div class="highlight-devicetree notranslate"><div class="highlight"><pre><span></span><span class="cp">#define</span><span class="cm"> </span><span class="cp">arduino_i2c i2c1</span><span class="w"></span>

<span class="nf">aliases</span><span class="cm"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">arduino</span><span class="p">,</span><span class="n">i2c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i2c1</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>Note: With support of dtc v1.4.2, above will be replaced with the recently
introduced overriding node element:</p>
<div class="highlight-devicetree notranslate"><div class="highlight"><pre><span></span><span class="nf">arduino_i2c:i2c1</span><span class="p">{};</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="board-specific-shield-configuration">
<h3>Board specific shield configuration<a class="headerlink" href="#board-specific-shield-configuration" title="Permalink to this headline">¶</a></h3>
<p>If modifications are needed to fit a shield to a particular board or board
revision, you can override a shield description for a specific board by adding
board or board revision overriding files to a shield, as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boards/shields/&lt;shield&gt;
└── boards
    ├── &lt;board&gt;_&lt;revision&gt;.overlay
    ├── &lt;board&gt;.overlay
    ├── &lt;board&gt;.defconfig
    ├── &lt;board&gt;_&lt;revision&gt;.conf
    └── &lt;board&gt;.conf
</pre></div>
</div>
</div>
</div>
<div class="section" id="shield-activation">
<h2>Shield activation<a class="headerlink" href="#shield-activation" title="Permalink to this headline">¶</a></h2>
<p>Activate support for one or more shields by adding the matching -DSHIELD arg to
CMake command</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>From the root of the zephyr repository
<span class="go">west build -b None your_app -- -DSHIELD=&quot;x_nucleo_idb05a1 x_nucleo_iks01a1&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>Alternatively, it could be set by default in a project’s CMakeLists.txt:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set(SHIELD x_nucleo_iks01a1)
</pre></div>
</div>
</div>
<div class="section" id="shield-variants">
<h2>Shield variants<a class="headerlink" href="#shield-variants" title="Permalink to this headline">¶</a></h2>
<p>Some shields may support several variants or revisions. In that case, it is
possible to provide multiple version of the shields description:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boards/shields/&lt;shield&gt;
├── &lt;shield_v1&gt;.overlay
├── &lt;shield_v1&gt;.defconfig
├── &lt;shield_v2&gt;.overlay
└── &lt;shield_v2&gt;.defconfig
</pre></div>
</div>
<p>In this case, a shield-particular revision name can be used:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>From the root of the zephyr repository
<span class="go">west build -b None your_app -- -DSHIELD=shield_v2</span>
</pre></div>
</div>
</div></blockquote>
<p>You can also provide a board-specific configuration to a specific shield
revision:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boards/shields/&lt;shield&gt;
├── &lt;shield_v1&gt;.overlay
├── &lt;shield_v1&gt;.defconfig
├── &lt;shield_v2&gt;.overlay
├── &lt;shield_v2&gt;.defconfig
└── boards
    └── &lt;shield_v2&gt;
        ├── &lt;board&gt;.overlay
        └── &lt;board&gt;.defconfig
</pre></div>
</div>
</div>
<div class="section" id="gpio-nexus-nodes">
<h2>GPIO nexus nodes<a class="headerlink" href="#gpio-nexus-nodes" title="Permalink to this headline">¶</a></h2>
<p>GPIOs accessed by the shield peripherals must be identified using the
shield GPIO abstraction, for example from the <code class="docutils literal notranslate"><span class="pre">arduino-header-r3</span></code>
compatible.  Boards that provide the header must map the header pins
to SOC-specific pins.  This is accomplished by including a <a class="reference external" href="https://github.com/devicetree-org/devicetree-specification/blob/4b1dac80eaca45b4babf5299452a951008a5d864/source/devicetree-basics.rst#nexus-nodes-and-specifier-mapping">nexus
node</a> that looks like the following into the board devicetree file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>arduino_header: connector {
        compatible = &quot;arduino-header-r3&quot;;
        #gpio-cells = &lt;2&gt;;
        gpio-map-mask = &lt;0xffffffff 0xffffffc0&gt;;
        gpio-map-pass-thru = &lt;0 0x3f&gt;;
        gpio-map = &lt;0 0 &amp;gpioa 0 0&gt;,    /* A0 */
                   &lt;1 0 &amp;gpioa 1 0&gt;,    /* A1 */
                   &lt;2 0 &amp;gpioa 4 0&gt;,    /* A2 */
                   &lt;3 0 &amp;gpiob 0 0&gt;,    /* A3 */
                   &lt;4 0 &amp;gpioc 1 0&gt;,    /* A4 */
                   &lt;5 0 &amp;gpioc 0 0&gt;,    /* A5 */
                   &lt;6 0 &amp;gpioa 3 0&gt;,    /* D0 */
                   &lt;7 0 &amp;gpioa 2 0&gt;,    /* D1 */
                   &lt;8 0 &amp;gpioa 10 0&gt;,   /* D2 */
                   &lt;9 0 &amp;gpiob 3 0&gt;,    /* D3 */
                   &lt;10 0 &amp;gpiob 5 0&gt;,   /* D4 */
                   &lt;11 0 &amp;gpiob 4 0&gt;,   /* D5 */
                   &lt;12 0 &amp;gpiob 10 0&gt;,  /* D6 */
                   &lt;13 0 &amp;gpioa 8 0&gt;,   /* D7 */
                   &lt;14 0 &amp;gpioa 9 0&gt;,   /* D8 */
                   &lt;15 0 &amp;gpioc 7 0&gt;,   /* D9 */
                   &lt;16 0 &amp;gpiob 6 0&gt;,   /* D10 */
                   &lt;17 0 &amp;gpioa 7 0&gt;,   /* D11 */
                   &lt;18 0 &amp;gpioa 6 0&gt;,   /* D12 */
                   &lt;19 0 &amp;gpioa 5 0&gt;,   /* D13 */
                   &lt;20 0 &amp;gpiob 9 0&gt;,   /* D14 */
                   &lt;21 0 &amp;gpiob 8 0&gt;;   /* D15 */
};
</pre></div>
</div>
<p>This specifies how Arduino pin references like <code class="docutils literal notranslate"><span class="pre">&lt;&amp;arduino_header</span> <span class="pre">11</span>
<span class="pre">0&gt;</span></code> are converted to SOC gpio pin references like <code class="docutils literal notranslate"><span class="pre">&lt;&amp;gpiob</span> <span class="pre">4</span> <span class="pre">0&gt;</span></code>.</p>
<p>In Zephyr GPIO specifiers generally have two parameters (indicated by
<code class="docutils literal notranslate"><span class="pre">#gpio-cells</span> <span class="pre">=</span> <span class="pre">&lt;2&gt;</span></code>): the pin number and a set of flags.  The low 6
bits of the flags correspond to features that can be configured in
devicetree.  In some cases it’s necessary to use a non-zero flag value
to tell the driver how a particular pin behaves, as with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>drdy-gpios = &lt;&amp;arduino_header 11 GPIO_ACTIVE_LOW&gt;;
</pre></div>
</div>
<p>After preprocessing this becomes <code class="docutils literal notranslate"><span class="pre">&lt;&amp;arduino_header</span> <span class="pre">11</span> <span class="pre">1&gt;</span></code>.  Normally
the presence of such a flag would cause the map lookup to fail,
because there is no map entry with a non-zero flags value.  The
<code class="docutils literal notranslate"><span class="pre">gpio-map-mask</span></code> property specifies that, for lookup, all bits of the
pin and all but the low 6 bits of the flags are used to identify the
specifier.  Then the <code class="docutils literal notranslate"><span class="pre">gpio-map-pass-thru</span></code> specifies that the low 6
bits of the flags are copied over, so the SOC GPIO reference becomes
<code class="docutils literal notranslate"><span class="pre">&lt;&amp;gpiob</span> <span class="pre">4</span> <span class="pre">1&gt;</span></code> as intended.</p>
<p>See <a class="reference external" href="https://github.com/devicetree-org/devicetree-specification/blob/4b1dac80eaca45b4babf5299452a951008a5d864/source/devicetree-basics.rst#nexus-nodes-and-specifier-mapping">nexus node</a> for more information about this capability.</p>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Mar 05, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>