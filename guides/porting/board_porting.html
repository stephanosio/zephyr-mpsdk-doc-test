<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Board Porting Guide &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script type="module" src="../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Shields" href="shields.html" />
    <link rel="prev" title="Architecture Porting Guide" href="arch.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User and Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../beyond-GSG.html">Beyond the Getting Started Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch/index.html">Architecture-related Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../docs/index.html">Documentation Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../coccinelle.html">Coccinelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code-relocation.html">Code And Data Relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crypto/index.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flash_debug/index.html">Flashing and Hardware Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debug_tools/index.html">Debugging and Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_mgmt/index.html">Device Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dts/index.html">Devicetree Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../env_vars.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../emulator/index.html">Peripheral and Hardware Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">Modules (External projects)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platformio/index.html">Using with PlatformIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../portability/index.html">OS Abstraction</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Porting</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="arch.html">Architecture Porting Guide</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Board Porting Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#boards-socs-etc">Boards, SoCs, etc.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#make-sure-your-soc-is-supported">Make sure your SoC is supported</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-your-board-directory">Create your board directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#write-your-devicetree">Write your devicetree</a></li>
<li class="toctree-l4"><a class="reference internal" href="#write-kconfig-files">Write Kconfig files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-test-and-fix">Build, test, and fix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#general-recommendations">General recommendations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flash-and-debug-support">Flash and debug support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multiple-board-revisions">Multiple board revisions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-revision-cmake-files">Custom revision.cmake files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#contributing-your-board">Contributing your board</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="shields.html">Shields</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../smf/index.html">State Machine Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../west/index.html">West (Zephyr’s meta-tool)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimizations/index.html">Optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zephyr_cmake_package.html">Zephyr CMake Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../index.html">User and Developer Guides</a> &raquo;</li>
  
     <li><a href="index.html">Porting</a> &raquo;</li>
  
  <li>Board Porting Guide</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/guides/porting/board_porting.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="board-porting-guide">
<span id="id1"></span><h1>Board Porting Guide<a class="headerlink" href="#board-porting-guide" title="Permalink to this headline">¶</a></h1>
<p>To add Zephyr support for a new <a class="reference internal" href="../../glossary.html#term-board"><span class="xref std std-term">board</span></a>, you at least need a <em>board
directory</em> with various files in it. Files in the board directory inherit
support for at least one SoC and all of its features. Therefore, Zephyr must
support your <a class="reference internal" href="../../glossary.html#term-SoC"><span class="xref std std-term">SoC</span></a> as well.</p>
<div class="section" id="boards-socs-etc">
<h2>Boards, SoCs, etc.<a class="headerlink" href="#boards-socs-etc" title="Permalink to this headline">¶</a></h2>
<p>Zephyr’s hardware support hierarchy has these layers, from most to least
specific:</p>
<ul class="simple">
<li><p>Board: a particular CPU instance and its peripherals in a concrete hardware
specification</p></li>
<li><p>SoC: the exact system on a chip the board’s CPU is part of</p></li>
<li><p>SoC series: a smaller group of tightly related SoCs</p></li>
<li><p>SoC family: a wider group of SoCs with similar characteristics</p></li>
<li><p>CPU core: a particular CPU in an architecture</p></li>
<li><p>Architecture: an instruction set architecture</p></li>
</ul>
<p>You can visualize the hierarchy like this:</p>
<div class="figure align-center" id="id5">
<a class="reference internal image-reference" href="../../_images/hierarchy.png"><img alt="Configuration Hierarchy" src="../../_images/hierarchy.png" style="width: 500px;" /></a>
<p class="caption"><span class="caption-number">Fig. 36 </span><span class="caption-text">Configuration Hierarchy</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>Here are some examples. Notice how the SoC series and family levels are
not always used.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Board</p></th>
<th class="head"><p>SoC</p></th>
<th class="head"><p>SoC series</p></th>
<th class="head"><p>SoC family</p></th>
<th class="head"><p>CPU core</p></th>
<th class="head"><p>Architecture</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="../../boards/arm/nrf52dk_nrf52832/doc/index.html#nrf52dk-nrf52832"><span class="std std-ref">nrf52dk_nrf52832</span></a></p></td>
<td><p>nRF52832</p></td>
<td><p>nRF52</p></td>
<td><p>Nordic nRF5</p></td>
<td><p>Arm Cortex-M4</p></td>
<td><p>Arm</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../boards/arm/frdm_k64f/doc/index.html#frdm-k64f"><span class="std std-ref">frdm_k64f</span></a></p></td>
<td><p>MK64F12</p></td>
<td><p>Kinetis K6x</p></td>
<td><p>NXP Kinetis</p></td>
<td><p>Arm Cortex-M4</p></td>
<td><p>Arm</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../boards/arm/stm32h747i_disco/doc/index.html#stm32h747i-disco-board"><span class="std std-ref">stm32h747i_disco</span></a></p></td>
<td><p>STM32H747XI</p></td>
<td><p>STM32H7</p></td>
<td><p>STMicro STM32</p></td>
<td><p>Arm Cortex-M7</p></td>
<td><p>Arm</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../boards/riscv/rv32m1_vega/doc/index.html#rv32m1-vega"><span class="std std-ref">rv32m1_vega_ri5cy</span></a></p></td>
<td><p>RV32M1</p></td>
<td><p>(Not used)</p></td>
<td><p>(Not used)</p></td>
<td><p>RI5CY</p></td>
<td><p>RISC-V</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="make-sure-your-soc-is-supported">
<h2>Make sure your SoC is supported<a class="headerlink" href="#make-sure-your-soc-is-supported" title="Permalink to this headline">¶</a></h2>
<p>Start by making sure your SoC is supported by Zephyr. If it is, it’s time to
<a class="reference internal" href="#create-your-board-directory"><span class="std std-ref">Create your board directory</span></a>. If you don’t know, try:</p>
<ul class="simple">
<li><p>checking <a class="reference internal" href="../../boards/index.html#boards"><span class="std std-ref">Supported Boards</span></a> for names that look relevant, and reading individual
board documentation to find out for sure.</p></li>
<li><p>asking your SoC vendor</p></li>
</ul>
<p>If you need to add SoC, CPU core, or even architecture support, this is the
wrong page, but here is some general advice.</p>
<div class="section" id="architecture">
<h3>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="arch.html#architecture-porting-guide"><span class="std std-ref">Architecture Porting Guide</span></a>.</p>
</div>
<div class="section" id="cpu-core">
<h3>CPU Core<a class="headerlink" href="#cpu-core" title="Permalink to this headline">¶</a></h3>
<p>CPU core support files go in <code class="docutils literal notranslate"><span class="pre">core</span></code> subdirectories under <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/arch">arch</a>,
e.g. <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/arch/x86/core">arch/x86/core</a>.</p>
<p>See <a class="reference internal" href="../beyond-GSG.html#gs-toolchain"><span class="std std-ref">Set Up a Toolchain</span></a> for information about toolchains (compiler, linker,
etc.) supported by Zephyr. If you need to support a new toolchain,
<a class="reference internal" href="../build/index.html#build-overview"><span class="std std-ref">Build and Configuration Systems</span></a> is a good place to start learning about the build system.
Please reach out to the community if you are looking for advice or want to
collaborate on toolchain support.</p>
</div>
<div class="section" id="soc">
<h3>SoC<a class="headerlink" href="#soc" title="Permalink to this headline">¶</a></h3>
<p>Zephyr SoC support files are in architecture-specific subdirectories of
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/soc">soc</a>. They are generally grouped by SoC family.</p>
<p>When adding a new SoC family or series for a vendor that already has SoC
support within Zephyr, please try to extract common functionality into shared
files to avoid duplication. If there is no support for your vendor yet, you can
add it in a new directory <code class="docutils literal notranslate"><span class="pre">zephyr/soc/&lt;YOUR-ARCH&gt;/&lt;YOUR-SOC&gt;</span></code>; please use
self-explanatory directory names.</p>
</div>
</div>
<div class="section" id="create-your-board-directory">
<span id="id2"></span><h2>Create your board directory<a class="headerlink" href="#create-your-board-directory" title="Permalink to this headline">¶</a></h2>
<p>Once you’ve found an existing board that uses your SoC, you can usually start
by copy/pasting its board directory and changing its contents for your
hardware.</p>
<p>You need to give your board a unique name. Run <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">boards</span></code> for a list of
names that are already taken, and pick something new. Let’s say your board is
called <code class="docutils literal notranslate"><span class="pre">plank</span></code> (please don’t actually use that name).</p>
<p>Start by creating the board directory <code class="docutils literal notranslate"><span class="pre">zephyr/boards/&lt;ARCH&gt;/plank</span></code>, where
<code class="docutils literal notranslate"><span class="pre">&lt;ARCH&gt;</span></code> is your SoC’s architecture subdirectory. (You don’t have to put your
board directory in the zephyr repository, but it’s the easiest way to get
started. See <a class="reference internal" href="../../application/index.html#custom-board-definition"><span class="std std-ref">Custom Board, Devicetree and SOC Definitions</span></a> for documentation on moving your
board directory to a separate repository once it’s working.)</p>
<p>Your board directory should look like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boards/&lt;ARCH&gt;/plank
├── board.cmake
├── CMakeLists.txt
├── doc
│   ├── plank.png
│   └── index.rst
├── Kconfig.board
├── Kconfig.defconfig
├── plank_defconfig
├── plank.dts
└── plank.yaml
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">plank</span></code> with your board’s name, of course.</p>
<p>The mandatory files are:</p>
<ol class="arabic simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">plank.dts</span></code>: a hardware description in <a class="reference internal" href="../dts/index.html#dt-guide"><span class="std std-ref">devicetree</span></a> format. This declares your SoC, connectors, and any
other hardware components such as LEDs, buttons, sensors, or communication
peripherals (USB, BLE controller, etc).</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">Kconfig.board</span></code>, <code class="file docutils literal notranslate"><span class="pre">Kconfig.defconfig</span></code>, <code class="file docutils literal notranslate"><span class="pre">plank_defconfig</span></code>:
software configuration in <a class="reference internal" href="../build/index.html#kconfig"><span class="std std-ref">Configuration System (Kconfig)</span></a> formats. This provides default
settings for software features and peripheral drivers.</p></li>
</ol>
<p>The optional files are:</p>
<ul>
<li><p><code class="file docutils literal notranslate"><span class="pre">board.cmake</span></code>: used for <a class="reference internal" href="#flash-and-debug-support"><span class="std std-ref">Flash and debug support</span></a></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>: if you need to add additional source files to
your build.</p>
<p>One common use for this file is to add a <code class="file docutils literal notranslate"><span class="pre">pinmux.c</span></code> file in your board
directory to the build, which configures pin controllers at boot time. In
that case, <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> usually looks like this:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="s">CONFIG_PINMUX</span><span class="p">)</span>
<span class="w">  </span><span class="nb">zephyr_library</span><span class="p">()</span>
<span class="w">  </span><span class="nb">zephyr_library_sources</span><span class="p">(</span><span class="s">pinmux.c</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p><code class="file docutils literal notranslate"><span class="pre">doc/index.rst</span></code>, <code class="file docutils literal notranslate"><span class="pre">doc/plank.png</span></code>: documentation for and a picture
of your board. You only need this if you’re <a class="reference internal" href="#contributing-your-board"><span class="std std-ref">Contributing your board</span></a> to
Zephyr.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">plank.yaml</span></code>: a YAML file with miscellaneous metadata used by the
<a class="reference internal" href="../test/twister.html#twister-script"><span class="std std-ref">Test Runner (Twister)</span></a>.</p></li>
</ul>
</div>
<div class="section" id="write-your-devicetree">
<span id="default-board-configuration"></span><h2>Write your devicetree<a class="headerlink" href="#write-your-devicetree" title="Permalink to this headline">¶</a></h2>
<p>The devicetree file <code class="file docutils literal notranslate"><span class="pre">boards/&lt;ARCH&gt;/plank/plank.dts</span></code> describes your board
hardware in the Devicetree Source (DTS) format (as usual, change <code class="docutils literal notranslate"><span class="pre">plank</span></code> to
your board’s name). If you’re new to devicetree, see <a class="reference internal" href="../dts/intro.html#devicetree-intro"><span class="std std-ref">Introduction to devicetree</span></a>.</p>
<p>In general, <code class="file docutils literal notranslate"><span class="pre">plank.dts</span></code> should look like this:</p>
<div class="highlight-devicetree notranslate"><div class="highlight"><pre><span></span><span class="cp">/dts-v1/</span><span class="p">;</span><span class="w"></span>
<span class="cp">#include</span><span class="cm"> </span><span class="cpf">&lt;your_soc_vendor/your_soc.dtsi&gt;</span><span class="w"></span>

<span class="nf">/</span><span class="cm"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="kr">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;A human readable name&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="kr">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;yourcompany,plank&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">     </span><span class="nf">chosen</span><span class="cm"> </span><span class="p">{</span><span class="w"></span>
<span class="w">             </span><span class="n">zephyr</span><span class="p">,</span><span class="n">console</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">your_uart_console</span><span class="p">;</span><span class="w"></span>
<span class="w">             </span><span class="n">zephyr</span><span class="p">,</span><span class="n">sram</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">your_memory_node</span><span class="p">;</span><span class="w"></span>
<span class="w">             </span><span class="cm">/* other chosen settings  for your hardware */</span><span class="w"></span>
<span class="w">     </span><span class="p">};</span><span class="w"></span>

<span class="w">     </span><span class="cm">/*</span>
<span class="cm">      * Your board-specific hardware: buttons, LEDs, sensors, etc.</span>
<span class="cm">      */</span><span class="w"></span>

<span class="w">     </span><span class="nf">leds</span><span class="cm"> </span><span class="p">{</span><span class="w"></span>
<span class="w">             </span><span class="kr">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gpio-leds&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">             </span><span class="nl">led0</span><span class="p">:</span><span class="w"> </span><span class="nf">led_0</span><span class="cm"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                     </span><span class="n">gpios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="cm">/* GPIO your LED is hooked up to */</span><span class="w"> </span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">                     </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;LED 0&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">             </span><span class="p">};</span><span class="w"></span>
<span class="w">             </span><span class="cm">/* ... other LEDs ... */</span><span class="w"></span>
<span class="w">     </span><span class="p">};</span><span class="w"></span>

<span class="w">     </span><span class="nf">buttons</span><span class="cm"> </span><span class="p">{</span><span class="w"></span>
<span class="w">             </span><span class="kr">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gpio-keys&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">             </span><span class="cm">/* ... your button definitions ... */</span><span class="w"></span>
<span class="w">     </span><span class="p">};</span><span class="w"></span>

<span class="w">     </span><span class="cm">/* These aliases are provided for compatibility with samples */</span><span class="w"></span>
<span class="w">     </span><span class="nf">aliases</span><span class="cm"> </span><span class="p">{</span><span class="w"></span>
<span class="w">             </span><span class="n">led0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">led0</span><span class="p">;</span><span class="w"> </span><span class="cm">/* now you support the blinky sample! */</span><span class="w"></span>
<span class="w">             </span><span class="cm">/* other aliases go here */</span><span class="w"></span>
<span class="w">     </span><span class="p">};</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="o">&amp;</span><span class="nf">some_peripheral_you_want_to_enable</span><span class="cm"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* like a GPIO or SPI controller */</span><span class="w"></span>
<span class="w">     </span><span class="kr">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;okay&quot;</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="o">&amp;</span><span class="nf">another_peripheral_you_want</span><span class="cm"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="kr">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;okay&quot;</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>If you’re in a hurry, simple hardware can usually be supported by copy/paste
followed by trial and error. If you want to understand details, you will need
to read the rest of the devicetree documentation and the devicetree
specification.</p>
<div class="section" id="example-frdm-k64f-and-hexiwear-k64">
<span id="dt-k6x-example"></span><h3>Example: FRDM-K64F and Hexiwear K64<a class="headerlink" href="#example-frdm-k64f-and-hexiwear-k64" title="Permalink to this headline">¶</a></h3>
<p>This section contains concrete examples related to writing your board’s
devicetree.</p>
<p>The FRDM-K64F and Hexiwear K64 board devicetrees are defined in
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/boards/arm/frdm_k64f/frdm_k64f.dts">frdm_k64fs.dts </a> and
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/boards/arm/hexiwear_k64/hexiwear_k64.dts">hexiwear_k64.dts </a>
respectively. Both boards have NXP SoCs from the same Kinetis SoC family, the
K6X.</p>
<p>Common devicetree definitions for K6X are stored in <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/dts/arm/nxp/nxp_k6x.dtsi">nxp_k6x.dtsi</a>, which is included by both board <code class="file docutils literal notranslate"><span class="pre">.dts</span></code>
files. <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/dts/arm/nxp/nxp_k6x.dtsi">nxp_k6x.dtsi</a> in turn includes
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/dts/arm/armv7-m.dtsi">armv7-m.dtsi</a>, which has common definitions
for Arm v7-M cores.</p>
<p>Since <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/dts/arm/nxp/nxp_k6x.dtsi">nxp_k6x.dtsi</a> is meant to be
generic across K6X-based boards, it leaves many devices disabled by default
using <code class="docutils literal notranslate"><span class="pre">status</span></code> properties.  For example, there is a CAN controller defined as
follows (with unimportant parts skipped):</p>
<div class="highlight-devicetree notranslate"><div class="highlight"><pre><span></span><span class="nl">can0</span><span class="p">:</span><span class="w"> </span><span class="nf">can</span><span class="o">@</span><span class="mi">40024000</span><span class="cm"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="p">...</span><span class="w"></span>
<span class="w">     </span><span class="kr">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;disabled&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="p">...</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>It is up to the board <code class="file docutils literal notranslate"><span class="pre">.dts</span></code> or application overlay files to enable these
devices as desired, by setting <code class="docutils literal notranslate"><span class="pre">status</span> <span class="pre">=</span> <span class="pre">&quot;okay&quot;</span></code>. The board <code class="file docutils literal notranslate"><span class="pre">.dts</span></code>
files are also responsible for any board-specific configuration of the device,
such as adding nodes for on-board sensors, LEDs, buttons, etc.</p>
<p>For example, FRDM-K64 (but not Hexiwear K64) <code class="file docutils literal notranslate"><span class="pre">.dts</span></code> enables the CAN
controller and sets the bus speed:</p>
<div class="highlight-devicetree notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="na">can0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="kr">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;okay&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="n">bus-speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">125000</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&amp;can0</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">};</span></code> syntax adds/overrides properties on the node with label
<code class="docutils literal notranslate"><span class="pre">can0</span></code>, i.e. the <code class="docutils literal notranslate"><span class="pre">can&#64;4002400</span></code> node defined in the <code class="file docutils literal notranslate"><span class="pre">.dtsi</span></code> file.</p>
<p>Other examples of board-specific customization is pointing properties in
<code class="docutils literal notranslate"><span class="pre">aliases</span></code> and <code class="docutils literal notranslate"><span class="pre">chosen</span></code> to the right nodes (see <a class="reference internal" href="../dts/intro.html#dt-alias-chosen"><span class="std std-ref">Aliases and chosen nodes</span></a>), and
making GPIO/pinmux assignments.</p>
</div>
</div>
<div class="section" id="write-kconfig-files">
<h2>Write Kconfig files<a class="headerlink" href="#write-kconfig-files" title="Permalink to this headline">¶</a></h2>
<p>Zephyr uses the Kconfig language to configure software features. Your board
needs to provide some Kconfig settings before you can compile a Zephyr
application for it.</p>
<p>Setting Kconfig configuration values is documented in detail in
<a class="reference internal" href="../build/kconfig/setting.html#setting-configuration-values"><span class="std std-ref">Setting Kconfig configuration values</span></a>.</p>
<p>There are three mandatory Kconfig files in the board directory for a board
named <code class="docutils literal notranslate"><span class="pre">plank</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boards/&lt;ARCH&gt;/plank
├── Kconfig.board
├── Kconfig.defconfig
└── plank_defconfig
</pre></div>
</div>
<dl>
<dt><code class="file docutils literal notranslate"><span class="pre">Kconfig.board</span></code></dt><dd><p>Included by <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/boards/Kconfig">boards/Kconfig</a> to include your board
in the list of options.</p>
<p>This should at least contain a definition for a <code class="docutils literal notranslate"><span class="pre">BOARD_PLANK</span></code> option,
which looks something like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config BOARD_PLANK
   bool &quot;Plank board&quot;
   depends on SOC_SERIES_YOUR_SOC_SERIES_HERE
   select SOC_PART_NUMBER_ABCDEFGH
</pre></div>
</div>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">Kconfig.defconfig</span></code></dt><dd><p>Board-specific default values for Kconfig options.</p>
<p>The entire file should be inside an <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">BOARD_PLANK</span></code> / <code class="docutils literal notranslate"><span class="pre">endif</span></code> pair of
lines, like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if BOARD_PLANK

# Always set CONFIG_BOARD here. This isn&#39;t meant to be customized,
# but is set as a &quot;default&quot; due to Kconfig language restrictions.
config BOARD
   default &quot;plank&quot;

# Other options you want enabled by default go next. Examples:

config FOO
   default y

if NETWORKING
config SOC_ETHERNET_DRIVER
   default y
endif # NETWORKING

endif # BOARD_PLANK
</pre></div>
</div>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">plank_defconfig</span></code></dt><dd><p>A Kconfig fragment that is merged as-is into the final build directory
<code class="file docutils literal notranslate"><span class="pre">.config</span></code> whenever an application is compiled for your board.</p>
<p>You should at least select your board’s SOC and do any mandatory settings for
your system clock, console, etc. The results are architecture-specific, but
typically look something like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_SOC_${VENDOR_XYZ3000}=y                      /* select your SoC */
CONFIG_SYS_CLOCK_HW_CYCLES_PER_SEC=120000000   /* set up your clock, etc */
CONFIG_SERIAL=y
</pre></div>
</div>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">plank_x_y_z.conf</span></code></dt><dd><p>A Kconfig fragment that is merged as-is into the final build directory
<code class="file docutils literal notranslate"><span class="pre">.config</span></code> whenever an application is compiled for your board revision
<code class="docutils literal notranslate"><span class="pre">x.y.z</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="build-test-and-fix">
<h2>Build, test, and fix<a class="headerlink" href="#build-test-and-fix" title="Permalink to this headline">¶</a></h2>
<p>Now it’s time to build and test the application(s) you want to run on your
board until you’re satisfied.</p>
<p>For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b plank samples/hello_world</span>
<span class="go">west flash</span>
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">flash</span></code> to work, see <a class="reference internal" href="#flash-and-debug-support"><span class="std std-ref">Flash and debug support</span></a> below. You can
also just flash <code class="file docutils literal notranslate"><span class="pre">build/zephyr/zephyr.elf</span></code>, <code class="file docutils literal notranslate"><span class="pre">zephyr.hex</span></code>, or
<code class="file docutils literal notranslate"><span class="pre">zephyr.bin</span></code> with any other tools you prefer.</p>
</div>
<div class="section" id="general-recommendations">
<span id="porting-general-recommendations"></span><h2>General recommendations<a class="headerlink" href="#general-recommendations" title="Permalink to this headline">¶</a></h2>
<p>For consistency and to make it easier for users to build generic applications
that are not board specific for your board, please follow these guidelines
while porting.</p>
<ul class="simple">
<li><p>Unless explicitly recommended otherwise by this section, leave peripherals
and their drivers disabled by default.</p></li>
<li><p>Configure and enable a system clock, along with a tick source.</p></li>
<li><p>Provide pin and driver configuration that matches the board’s valuable
components such as sensors, buttons or LEDs, and communication interfaces
such as USB, Ethernet connector, or Bluetooth/Wi-Fi chip.</p></li>
<li><p>If your board uses a well-known connector standard (like Arduino, Mikrobus,
Grove, or 96Boards connectors), add connector nodes to your DTS and configure
pin muxes accordingly.</p></li>
<li><p>Configure components that enable the use of these pins, such as
configuring an SPI instance to use the usual Arduino SPI pins.</p></li>
<li><p>If available, configure and enable a serial output for the console
using the <code class="docutils literal notranslate"><span class="pre">zephyr,console</span></code> chosen node in the devicetree.</p></li>
<li><p>If your board supports networking, configure a default interface.</p></li>
<li><p>Enable all GPIO ports connected to peripherals or expansion connectors.</p></li>
<li><p>If available, enable pinmux and interrupt controller drivers.</p></li>
<li><p>It is recommended to enable the MPU by default, if there is support for it
in hardware. For boards with limited memory resources it is acceptable to
disable it. When the MPU is enabled, it is recommended to also enable
hardware stack protection (CONFIG_HW_STACK_PROTECTION=y) and, thus, allow the
kernel to detect stack overflows when the system is running in privileged
mode.</p></li>
</ul>
</div>
<div class="section" id="flash-and-debug-support">
<span id="id3"></span><h2>Flash and debug support<a class="headerlink" href="#flash-and-debug-support" title="Permalink to this headline">¶</a></h2>
<p>Zephyr supports <a class="reference internal" href="../west/build-flash-debug.html#west-build-flash-debug"><span class="std std-ref">Building, Flashing and Debugging</span></a> via west extension commands.</p>
<p>To add <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">flash</span></code> and <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">debug</span></code> support for your board, you need to
create a <code class="file docutils literal notranslate"><span class="pre">board.cmake</span></code> file in your board directory. This file’s job is
to configure a “runner” for your board. (There’s nothing special you need to
do to get <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">build</span></code> support for your board.)</p>
<p>“Runners” are Zephyr-specific Python classes that wrap <a class="reference internal" href="../flash_debug/host-tools.html#flash-debug-host-tools"><span class="std std-ref">flash and debug
host tools</span></a> and integrate with west and the zephyr build
system to support <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">flash</span></code> and related commands. Each runner supports
flashing, debugging, or both. You need to configure the arguments to these
Python scripts in your <code class="file docutils literal notranslate"><span class="pre">board.cmake</span></code> to support those commands like this
example <code class="file docutils literal notranslate"><span class="pre">board.cmake</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">board_runner_args</span><span class="p">(</span><span class="s">jlink</span><span class="w"> </span><span class="s2">&quot;--device=nrf52&quot;</span><span class="w"> </span><span class="s2">&quot;--speed=4000&quot;</span><span class="p">)</span>
<span class="nb">board_runner_args</span><span class="p">(</span><span class="s">pyocd</span><span class="w"> </span><span class="s2">&quot;--target=nrf52&quot;</span><span class="w"> </span><span class="s2">&quot;--frequency=4000000&quot;</span><span class="p">)</span>

<span class="nb">include</span><span class="p">(</span><span class="o">${</span><span class="nv">ZEPHYR_BASE</span><span class="o">}</span><span class="s">/boards/common/nrfjprog.board.cmake</span><span class="p">)</span>
<span class="nb">include</span><span class="p">(</span><span class="o">${</span><span class="nv">ZEPHYR_BASE</span><span class="o">}</span><span class="s">/boards/common/jlink.board.cmake</span><span class="p">)</span>
<span class="nb">include</span><span class="p">(</span><span class="o">${</span><span class="nv">ZEPHYR_BASE</span><span class="o">}</span><span class="s">/boards/common/pyocd.board.cmake</span><span class="p">)</span>
</pre></div>
</div>
<p>This example configures the <code class="docutils literal notranslate"><span class="pre">nrfjprog</span></code>, <code class="docutils literal notranslate"><span class="pre">jlink</span></code>, and <code class="docutils literal notranslate"><span class="pre">pyocd</span></code> runners.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Runners usually have names which match the tools they wrap, so the <code class="docutils literal notranslate"><span class="pre">jlink</span></code>
runner wraps Segger’s J-Link tools, and so on. But the runner command line
options like <code class="docutils literal notranslate"><span class="pre">--speed</span></code> etc. are specific to the Python scripts.</p>
</div>
<p>For more details:</p>
<ul class="simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">flash</span> <span class="pre">--context</span></code> to see a list of available runners which support
flashing, and <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">flash</span> <span class="pre">--context</span> <span class="pre">-r</span> <span class="pre">&lt;RUNNER&gt;</span></code> to view the specific options
available for an individual runner.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">debug</span> <span class="pre">--context</span></code> and <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">debug</span> <span class="pre">--context</span> <span class="pre">&lt;RUNNER&gt;</span></code> to get
the same output for runners which support debugging.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">flash</span> <span class="pre">--help</span></code> and <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">debug</span> <span class="pre">--help</span></code> for top-level options
for flashing and debugging.</p></li>
<li><p>See <a class="reference internal" href="../west/build-flash-debug.html#west-runner"><span class="std std-ref">Flash and debug runners</span></a> for Python APIs.</p></li>
<li><p>Look for <code class="file docutils literal notranslate"><span class="pre">board.cmake</span></code> files for other boards similar to your own for
more examples.</p></li>
</ul>
<p>To see what a <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">flash</span></code> or <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">debug</span></code> command is doing exactly, run it
in verbose mode:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>west --verbose flash
west --verbose debug
</pre></div>
</div>
<p>Verbose mode prints any host tool commands the runner uses.</p>
<p>The order of the <code class="docutils literal notranslate"><span class="pre">include()</span></code> calls in your <code class="file docutils literal notranslate"><span class="pre">board.cmake</span></code> matters. The
first <code class="docutils literal notranslate"><span class="pre">include</span></code> sets the default runner if it’s not already set. For example,
including <code class="docutils literal notranslate"><span class="pre">nrfjprog.board.cmake</span></code> first means that <code class="docutils literal notranslate"><span class="pre">nrjfprog</span></code> is the default
flash runner for this board. Since <code class="docutils literal notranslate"><span class="pre">nrfjprog</span></code> does not support debugging,
<code class="docutils literal notranslate"><span class="pre">jlink</span></code> is the default debug runner.</p>
</div>
<div class="section" id="multiple-board-revisions">
<span id="porting-board-revisions"></span><h2>Multiple board revisions<a class="headerlink" href="#multiple-board-revisions" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="../../application/index.html#application-board-version"><span class="std std-ref">Building for a board revision</span></a> for basics on this feature from the user
perspective.</p>
<p>To create a new board revision for the <code class="docutils literal notranslate"><span class="pre">plank</span></code> board, create these additional
files in the board folder:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boards/&lt;ARCH&gt;/plank
├── plank_&lt;revision&gt;.conf     # optional
├── plank_&lt;revision&gt;.overlay  # optional
└── revision.cmake
</pre></div>
</div>
<p>When the user builds for board <code class="docutils literal notranslate"><span class="pre">plank&#64;&lt;revision&gt;</span></code>:</p>
<ul class="simple">
<li><p>The optional Kconfig settings specified in the file
<code class="file docutils literal notranslate"><span class="pre">plank_&lt;revision&gt;.conf</span></code> will be merged into the board’s default Kconfig
configuration.</p></li>
<li><p>The optional devicetree overlay <code class="file docutils literal notranslate"><span class="pre">plank_&lt;revision&gt;.overlay</span></code> will be added
to the common <code class="file docutils literal notranslate"><span class="pre">plank.dts</span></code> devicetree file</p></li>
<li><p>The <code class="file docutils literal notranslate"><span class="pre">revision.cmake</span></code> file controls how the Zephyr build system matches
the <code class="docutils literal notranslate"><span class="pre">&lt;board&gt;&#64;&lt;revision&gt;</span></code> string specified by the user when building an
application for the board.</p></li>
</ul>
<p>Currently, <code class="docutils literal notranslate"><span class="pre">&lt;revision&gt;</span></code> can be either a numeric <code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR.PATCH</span></code> style
revision like <code class="docutils literal notranslate"><span class="pre">1.5.0</span></code>, an integer number like <code class="docutils literal notranslate"><span class="pre">1</span></code>, or single letter like
<code class="docutils literal notranslate"><span class="pre">A</span></code>, <code class="docutils literal notranslate"><span class="pre">B</span></code>, etc. Zephyr provides a CMake board extension function,
<code class="docutils literal notranslate"><span class="pre">board_check_revision()</span></code>, to make it easy to match either style from
<code class="file docutils literal notranslate"><span class="pre">revision.cmake</span></code>.</p>
<p>Valid board revisions may be specified as arguments to the
<code class="docutils literal notranslate"><span class="pre">board_check_revision()</span></code> function, like:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">board_check_revision</span><span class="p">(</span><span class="s">FORMAT</span><span class="w"> </span><span class="s">MAJOR.MINOR.PATCH</span>
<span class="w">                     </span><span class="s">VALID_REVISIONS</span><span class="w"> </span><span class="s">0.1.0</span><span class="w"> </span><span class="s">0.3.0</span><span class="w"> </span><span class="s">...</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">VALID_REVISIONS</span></code> can be omitted if all valid revisions have specific
Kconfig fragments, such as <code class="docutils literal notranslate"><span class="pre">&lt;board&gt;_0_1_0.conf</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;board&gt;_0_3_0.conf</span></code>.
This allows you to just place Kconfig revision fragments in the board
folder and not have to keep the corresponding <code class="docutils literal notranslate"><span class="pre">VALID_REVISIONS</span></code> in sync.</p>
</div>
<p>The following sections describe how to support these styles of revision
numbers.</p>
<div class="section" id="major-minor-patch-revisions">
<h3>MAJOR.MINOR.PATCH revisions<a class="headerlink" href="#major-minor-patch-revisions" title="Permalink to this headline">¶</a></h3>
<p>Let’s say you want to add support for revisions <code class="docutils literal notranslate"><span class="pre">0.5.0</span></code>, <code class="docutils literal notranslate"><span class="pre">1.0.0</span></code>, and
<code class="docutils literal notranslate"><span class="pre">1.5.0</span></code> of the <code class="docutils literal notranslate"><span class="pre">plank</span></code> board with both Kconfig fragments and devicetree
overlays. Create <code class="file docutils literal notranslate"><span class="pre">revision.cmake</span></code> with
<code class="docutils literal notranslate"><span class="pre">board_check_revision(FORMAT</span> <span class="pre">MAJOR.MINOR.PATCH)</span></code>, and create the following
additional files in the board directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boards/&lt;ARCH&gt;/plank
├── plank_0_5_0.conf
├── plank_0_5_0.overlay
├── plank_1_0_0.conf
├── plank_1_0_0.overlay
├── plank_1_5_0.conf
├── plank_1_5_0.overlay
└── revision.cmake
</pre></div>
</div>
<p>Notice how the board files have changed periods (“.”) in the revision number to
underscores (“_”).</p>
<div class="section" id="fuzzy-revision-matching">
<h4>Fuzzy revision matching<a class="headerlink" href="#fuzzy-revision-matching" title="Permalink to this headline">¶</a></h4>
<p>To support “fuzzy” <code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR.PATCH</span></code> revision matching for the <code class="docutils literal notranslate"><span class="pre">plank</span></code>
board, use the following code in <code class="file docutils literal notranslate"><span class="pre">revision.cmake</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">board_check_revision</span><span class="p">(</span><span class="s">FORMAT</span><span class="w"> </span><span class="s">MAJOR.MINOR.PATCH</span><span class="p">)</span>
</pre></div>
</div>
<p>If the user selects a revision between those available, the closest revision
number that is not larger than the user’s choice is used. For example, if the
user builds for <code class="docutils literal notranslate"><span class="pre">plank&#64;0.7.0</span></code>, the build system will target revision
<code class="docutils literal notranslate"><span class="pre">0.5.0</span></code>.</p>
<p>The build system will print this at CMake configuration time:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">-- Board: plank, Revision: 0.7.0 (Active: 0.5.0)</span>
</pre></div>
</div>
<p>This allows you to only create revision configuration files for board revision
numbers that introduce incompatible changes.</p>
<p>Any revision less than the minimum defined will be treated as an error.</p>
<p>You may use <code class="docutils literal notranslate"><span class="pre">0.0.0</span></code> as a minimum revision to build for by creating the file
<code class="file docutils literal notranslate"><span class="pre">plank_0_0_0.conf</span></code> in the board directory. This will be used for any
revision lower than <code class="docutils literal notranslate"><span class="pre">0.5.0</span></code>, for example if the user builds for
<code class="docutils literal notranslate"><span class="pre">plank&#64;0.1.0</span></code>.</p>
</div>
<div class="section" id="exact-revision-matching">
<h4>Exact revision matching<a class="headerlink" href="#exact-revision-matching" title="Permalink to this headline">¶</a></h4>
<p>Alternatively, the <code class="docutils literal notranslate"><span class="pre">EXACT</span></code> keyword can be given to <code class="docutils literal notranslate"><span class="pre">board_check_revision()</span></code>
in <code class="file docutils literal notranslate"><span class="pre">revision.cmake</span></code> to allow exact matches only, like this:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">board_check_revision</span><span class="p">(</span><span class="s">FORMAT</span><span class="w"> </span><span class="s">MAJOR.MINOR.PATCH</span><span class="w"> </span><span class="s">EXACT</span><span class="p">)</span>
</pre></div>
</div>
<p>With this <code class="file docutils literal notranslate"><span class="pre">revision.cmake</span></code>, building for <code class="docutils literal notranslate"><span class="pre">plank&#64;0.7.0</span></code> in the above
example will result in the following error message:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Board revision `0.7.0` not found.  Please specify a valid board revision.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="letter-revision-matching">
<h3>Letter revision matching<a class="headerlink" href="#letter-revision-matching" title="Permalink to this headline">¶</a></h3>
<p>Let’s say instead that you need to support revisions <code class="docutils literal notranslate"><span class="pre">A</span></code>, <code class="docutils literal notranslate"><span class="pre">B</span></code>, and <code class="docutils literal notranslate"><span class="pre">C</span></code> of
the <code class="docutils literal notranslate"><span class="pre">plank</span></code> board. Create the following additional files in the board
directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boards/&lt;ARCH&gt;/plank
├── plank_A.conf
├── plank_A.overlay
├── plank_B.conf
├── plank_B.overlay
├── plank_C.conf
├── plank_C.overlay
└── revision.cmake
</pre></div>
</div>
<p>And add the following to <code class="file docutils literal notranslate"><span class="pre">revision.cmake</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">board_check_revision</span><span class="p">(</span><span class="s">FORMAT</span><span class="w"> </span><span class="s">LETTER</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="number-revision-matching">
<h3>Number revision matching<a class="headerlink" href="#number-revision-matching" title="Permalink to this headline">¶</a></h3>
<p>Let’s say instead that you need to support revisions <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code>, and <code class="docutils literal notranslate"><span class="pre">3</span></code> of
the <code class="docutils literal notranslate"><span class="pre">plank</span></code> board. Create the following additional files in the board
directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boards/&lt;ARCH&gt;/plank
├── plank_1.conf
├── plank_1.overlay
├── plank_2.conf
├── plank_2.overlay
├── plank_3.conf
├── plank_3.overlay
└── revision.cmake
</pre></div>
</div>
<p>And add the following to <code class="file docutils literal notranslate"><span class="pre">revision.cmake</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">board_check_revision</span><span class="p">(</span><span class="s">FORMAT</span><span class="w"> </span><span class="s">NUMBER</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="board-check-revision-details">
<h3>board_check_revision() details<a class="headerlink" href="#board-check-revision-details" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">board_check_revision</span><span class="p">(</span><span class="s">FORMAT</span><span class="w"> </span><span class="s">&lt;LETTER</span><span class="w"> </span><span class="s">|</span><span class="w"> </span><span class="s">NUMBER</span><span class="w"> </span><span class="s">|</span><span class="w"> </span><span class="s">MAJOR.MINOR.PATCH&gt;</span>
<span class="w">                     </span><span class="s">[EXACT]</span>
<span class="w">                     </span><span class="s">[DEFAULT_REVISION</span><span class="w"> </span><span class="s">&lt;revision&gt;]</span>
<span class="w">                     </span><span class="s">[HIGHEST_REVISION</span><span class="w"> </span><span class="s">&lt;revision&gt;]</span>
<span class="w">                     </span><span class="s">[VALID_REVISIONS</span><span class="w"> </span><span class="s">&lt;revision&gt;</span><span class="w"> </span><span class="s">[&lt;revision&gt;</span><span class="w"> </span><span class="s">...]]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This function supports the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FORMAT</span> <span class="pre">LETTER</span></code>: matches single letter revisions from <code class="docutils literal notranslate"><span class="pre">A</span></code> to <code class="docutils literal notranslate"><span class="pre">Z</span></code> only</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FORMAT</span> <span class="pre">NUMBER</span></code>: matches integer revisions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FORMAT</span> <span class="pre">MAJOR.MINOR.PATCH</span></code>: matches exactly three digits. The command line
allows for loose typing, that is <code class="docutils literal notranslate"><span class="pre">-DBOARD=&lt;board&gt;&#64;1</span></code> and
<code class="docutils literal notranslate"><span class="pre">-DBOARD=&lt;board&gt;&#64;1.0</span></code> will be handled as <code class="docutils literal notranslate"><span class="pre">-DBOARD=&lt;board&gt;&#64;1.0.0</span></code>.
Kconfig fragment and devicetree overlay files must use full numbering to avoid
ambiguity, so only <code class="file docutils literal notranslate"><span class="pre">&lt;board&gt;_1_0_0.conf</span></code> and
<code class="file docutils literal notranslate"><span class="pre">&lt;board&gt;_1_0_0.overlay</span></code> are allowed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXACT</span></code>: if given, the revision is required to be an exact match.
Otherwise, the closest matching revision not greater than the user’s choice
will be selected.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DEFAULT_REVISION</span> <span class="pre">&lt;revision&gt;</span></code>: if given, <code class="docutils literal notranslate"><span class="pre">&lt;revision&gt;</span></code> is the default
revision to use when user has not selected a revision number. If not given,
the build system prints an error when the user does not specify a board
revision.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HIGHEST_REVISION</span></code>: if given, specifies the highest valid revision for a
board. This can be used to ensure that a newer board cannot be used with an
older Zephyr. For example, if the current board directory supports revisions
0.x.0-0.99.99 and 1.0.0-1.99.99, and it is expected that the implementation
will not work with board revision 2.0.0, then giving <code class="docutils literal notranslate"><span class="pre">HIGHEST_REVISION</span>
<span class="pre">1.99.99</span></code> causes an error if the user builds using <code class="docutils literal notranslate"><span class="pre">&lt;board&gt;&#64;2.0.0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VALID_REVISIONS</span></code>: if given, specifies a list of revisions that are valid
for this board. If this argument is not given, then each Kconfig fragment of
the form <code class="docutils literal notranslate"><span class="pre">&lt;board&gt;_&lt;revision&gt;.conf</span></code> in the board folder will be used as a
valid revision for the board.</p></li>
</ul>
</div>
</div>
<div class="section" id="custom-revision-cmake-files">
<span id="porting-custom-board-revisions"></span><h2>Custom revision.cmake files<a class="headerlink" href="#custom-revision-cmake-files" title="Permalink to this headline">¶</a></h2>
<p>Some boards may not use board revisions supported by
<code class="docutils literal notranslate"><span class="pre">board_check_revision()</span></code>. To support revisions of any type, the file
<code class="file docutils literal notranslate"><span class="pre">revision.cmake</span></code> can implement custom revision matching without calling
<code class="docutils literal notranslate"><span class="pre">board_check_revision()</span></code>.</p>
<p>To signal to the build system that it should use a different revision than the
one specified by the user, <code class="file docutils literal notranslate"><span class="pre">revision.cmake</span></code> can set the variable
<code class="docutils literal notranslate"><span class="pre">ACTIVE_BOARD_REVISION</span></code> to the revision to use instead. The corresponding
Kconfig files and devicetree overlays must be named
<code class="file docutils literal notranslate"><span class="pre">&lt;board&gt;_&lt;ACTIVE_BOARD_REVISION&gt;.conf</span></code> and
<code class="file docutils literal notranslate"><span class="pre">&lt;board&gt;_&lt;ACTIVE_BOARD_REVISION&gt;.overlay</span></code>.</p>
<p>For example, if the user builds for <code class="docutils literal notranslate"><span class="pre">plank&#64;zero</span></code>, <code class="file docutils literal notranslate"><span class="pre">revision.cmake</span></code> can
set <code class="docutils literal notranslate"><span class="pre">ACTIVE_BOARD_REVISION</span></code> to <code class="docutils literal notranslate"><span class="pre">one</span></code> to use the files
<code class="file docutils literal notranslate"><span class="pre">plank_one.conf</span></code> and <code class="file docutils literal notranslate"><span class="pre">plank_one.overlay</span></code>.</p>
</div>
<div class="section" id="contributing-your-board">
<span id="id4"></span><h2>Contributing your board<a class="headerlink" href="#contributing-your-board" title="Permalink to this headline">¶</a></h2>
<p>If you want to contribute your board to Zephyr, first – thanks!</p>
<p>There are some extra things you’ll need to do:</p>
<ol class="arabic simple">
<li><p>Make sure you’ve followed all the <a class="reference internal" href="#porting-general-recommendations"><span class="std std-ref">General recommendations</span></a>.
They are requirements for boards included with Zephyr.</p></li>
<li><p>Add documentation for your board using the template file
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/templates/board.tmpl">doc/templates/board.tmpl</a>. See <a class="reference internal" href="../docs/index.html#zephyr-doc"><span class="std std-ref">Documentation Generation</span></a> for
information on how to build your documentation before submitting
your pull request.</p></li>
<li><p>Prepare a pull request adding your board which follows the
<a class="reference internal" href="../../contribute/index.html#contribute-guidelines"><span class="std std-ref">Contribution Guidelines</span></a>.</p></li>
</ol>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>