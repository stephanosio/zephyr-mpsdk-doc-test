<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OpenISA VEGAboard &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script type="module" src="../../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../../_static/js/ga-tracker.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../../copyright.html" />
    <link rel="next" title="Telink TLSR9518ADK80D" href="../../tlsr9518adk80d/doc/index.html" />
    <link rel="prev" title="RISCV64 Emulation (QEMU)" href="../../qemu_riscv64/doc/index.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html">
            <img src="../../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Supported Boards</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../x86/index.html">x86 Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arm/index.html">ARM Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arm64/index.html">ARM64 Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arc/index.html">ARC Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mips/index.html">MIPS Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nios2/index.html">NIOS II Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../xtensa/index.html">XTENSA Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../posix/index.html">POSIX/NATIVE Boards</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">RISCV Boards</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../adp_xc7k_ae350/doc/index.html">Andes ADP-XC7K AE350</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../beaglev_starlight_jh7100/doc/index.html">BeagleV Starlight JH7100</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../esp32c3_devkitm/doc/index.html">ESP32-C3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gd32vf103v_eval/doc/index.html">GigaDevice GD32VF103V-EVAL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hifive1/doc/index.html">SiFive HiFive1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hifive1_revb/doc/index.html">SiFive HiFive1 Rev B</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hifive_unleashed/doc/index.html">SiFive HiFive Unleashed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hifive_unmatched/doc/index.html">SiFive HiFive Unmatched</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../it8xxx2_evb/doc/index.html">ITE IT8XXX2 series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../litex_vexriscv/doc/index.html">LiteX VexRiscv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../longan_nano/doc/index.html">Sipeed Longan Nano</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../m2gl025_miv/doc/index.html">Microsemi M2GL025 Mi-V</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../neorv32/doc/index.html">NEORV32</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../qemu_riscv32/doc/index.html">RISCV32 Emulation (QEMU)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../qemu_riscv64/doc/index.html">RISCV64 Emulation (QEMU)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">OpenISA VEGAboard</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hardware">Hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#programming-and-debugging">Programming and Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l4"><a class="reference internal" href="#appendix-building-toolchain-and-openocd-from-source">Appendix: Building Toolchain and OpenOCD from Source</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tlsr9518adk80d/doc/index.html">Telink TLSR9518ADK80D</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../sparc/index.html">SPARC Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../shields/index.html">Shields</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../../index.html">Supported Boards</a> &raquo;</li>
  
     <li><a href="../../index.html">RISCV Boards</a> &raquo;</li>
  
  <li>OpenISA VEGAboard</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main//boards/riscv/rv32m1_vega/doc/index.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="openisa-vegaboard">
<span id="rv32m1-vega"></span><h1>OpenISA VEGAboard<a class="headerlink" href="#openisa-vegaboard" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The VEGAboard contains the RV32M1 SoC, featuring two RISC-V CPUs,
on-die XIP flash, and a full complement of peripherals, including a
2.4 GHz multi-protocol radio. It also has built-in sensors and
Arduino-style expansion connectors.</p>
<div class="figure align-center" id="id2">
<img alt="RV32M1-VEGA" src="../../../../_images/rv32m1_vega.png" />
<p class="caption"><span class="caption-number">Fig. 196 </span><span class="caption-text">OpenISA VEGAboard (image copyright: www.open-isa.org)</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>The two RISC-V CPUs are named RI5CY and ZERO-RISCY, and are
respectively based on the <a class="reference external" href="http://iis-projects.ee.ethz.ch/index.php/PULP">PULP platform</a> designs by the same names:
<a class="reference external" href="https://github.com/pulp-platform/riscv">RI5CY</a> and <a class="reference external" href="https://github.com/pulp-platform/zero-riscy">ZERO-RISCY</a>. RI5CY is the “main” core; it has more
flash and RAM as well as a more powerful CPU design. ZERO-RISCY is a
“secondary” core. The main ZERO-RISCY use-case is as a wireless
coprocessor for applications running on RI5CY. The two cores can
communicate via shared memory and messaging peripherals.</p>
<p>Currently, Zephyr supports RI5CY with the <code class="docutils literal notranslate"><span class="pre">rv32m1_vega_ri5cy</span></code> board
configuration name, and ZERO_RISCY with the <code class="docutils literal notranslate"><span class="pre">rv32m1_vega_zero_riscy</span></code> board
configuration name.</p>
</div>
<div class="section" id="hardware">
<h2>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h2>
<p>The VEGAboard includes the following features.</p>
<p>RV32M1 multi-core SoC:</p>
<ul class="simple">
<li><p>1 MiB flash and 192 KiB SRAM (RI5CY core)</p></li>
<li><p>256 KiB flash and 128 KiB SRAM (ZERO-RISCY core)</p></li>
<li><p>Low power modes</p></li>
<li><p>DMA support</p></li>
<li><p>Watchdog, CRC, cryptographic acceleration, ADC, DAC, comparator,
timers, PWM, RTC, I2C, UART, SPI, external memory, I2S, smart
card, USB full-speed, uSDHC, and 2.4 GHz multiprotocol radio
peripherals</p></li>
</ul>
<p>On-board sensors and peripherals:</p>
<ul class="simple">
<li><p>32 Mbit SPI flash</p></li>
<li><p>6-axis accelerometer, magnetometer, and temperature sensor (FXOS8700)</p></li>
<li><p>Ambient light sensor</p></li>
<li><p>RGB LED</p></li>
<li><p>microSD card slot</p></li>
<li><p>Antenna interface</p></li>
</ul>
<p>Additional features:</p>
<ul class="simple">
<li><p>Form-factor compatible with Arduino Uno Rev 3 expansion connector
layout (not all Arduino shields may be pin-compatible)</p></li>
<li><p>UART via USB using separate OpenSDA chip</p></li>
<li><p>RISC-V flash and debug using external JTAG dongle (not included) via
2x5 5 mil pitch connector (commonly called the “ARM 10-pin JTAG”
connector)</p></li>
</ul>
<div class="section" id="supported-features">
<h3>Supported Features<a class="headerlink" href="#supported-features" title="Permalink to this headline">¶</a></h3>
<p>Zephyr’s RI5CY configuration, <code class="docutils literal notranslate"><span class="pre">rv32m1_vega_ri5cy</span></code>, currently supports
the following hardware features:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 20%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>Controller</p></th>
<th class="head"><p>Driver/Component</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EVENT</p></td>
<td><p>on-chip</p></td>
<td><p>event unit interrupt controller</p></td>
</tr>
<tr class="row-odd"><td><p>INTMUX</p></td>
<td><p>on-chip</p></td>
<td><p>level 2 interrupt controller</p></td>
</tr>
<tr class="row-even"><td><p>LPTMR</p></td>
<td><p>on-chip</p></td>
<td><p>lptmr-based system timer</p></td>
</tr>
<tr class="row-odd"><td><p>PINMUX</p></td>
<td><p>on-chip</p></td>
<td><p>pinmux</p></td>
</tr>
<tr class="row-even"><td><p>GPIO</p></td>
<td><p>on-chip</p></td>
<td><p>gpio</p></td>
</tr>
<tr class="row-odd"><td><p>UART</p></td>
<td><p>on-chip</p></td>
<td><p>serial</p></td>
</tr>
<tr class="row-even"><td><p>I2C(M)</p></td>
<td><p>on-chip</p></td>
<td><p>i2c</p></td>
</tr>
<tr class="row-odd"><td><p>SPI</p></td>
<td><p>on-chip</p></td>
<td><p>spi</p></td>
</tr>
<tr class="row-even"><td><p>TPM</p></td>
<td><p>on-chip</p></td>
<td><p>pwm</p></td>
</tr>
<tr class="row-odd"><td><p>SENSOR</p></td>
<td><p>off-chip</p></td>
<td><p>fxos8700 polling;
fxos8700 trigger;</p></td>
</tr>
</tbody>
</table>
<p>Zephyr’s ZERO-RISCY configuration, <code class="docutils literal notranslate"><span class="pre">rv32m1_vega_zero_riscy</span></code>, currently
supports the following hardware features:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 20%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>Controller</p></th>
<th class="head"><p>Driver/Component</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EVENT</p></td>
<td><p>on-chip</p></td>
<td><p>event unit interrupt controller</p></td>
</tr>
<tr class="row-odd"><td><p>INTMUX</p></td>
<td><p>on-chip</p></td>
<td><p>level 2 interrupt controller</p></td>
</tr>
<tr class="row-even"><td><p>LPTMR</p></td>
<td><p>on-chip</p></td>
<td><p>lptmr-based system timer</p></td>
</tr>
<tr class="row-odd"><td><p>PINMUX</p></td>
<td><p>on-chip</p></td>
<td><p>pinmux</p></td>
</tr>
<tr class="row-even"><td><p>GPIO</p></td>
<td><p>on-chip</p></td>
<td><p>gpio</p></td>
</tr>
<tr class="row-odd"><td><p>UART</p></td>
<td><p>on-chip</p></td>
<td><p>serial</p></td>
</tr>
<tr class="row-even"><td><p>I2C(M)</p></td>
<td><p>on-chip</p></td>
<td><p>i2c</p></td>
</tr>
<tr class="row-odd"><td><p>TPM</p></td>
<td><p>on-chip</p></td>
<td><p>pwm</p></td>
</tr>
<tr class="row-even"><td><p>SENSOR</p></td>
<td><p>off-chip</p></td>
<td><p>fxos8700 polling;
fxos8700 trigger;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ble-software-link-layer-experimental-support">
<h3>BLE Software Link Layer experimental support<a class="headerlink" href="#ble-software-link-layer-experimental-support" title="Permalink to this headline">¶</a></h3>
<p>This is an experimental feature supported on the Zephyr’s RI5CY
configuration, <code class="docutils literal notranslate"><span class="pre">rv32m1_vega_ri5cy</span></code>. It  uses the Software Link Layer
framework by Nordic Semi to enable the the on-SoC radio and transceiver for
implementing a software defined BLE controller. By using both the controller
and the host stack available in Zephyr, the following BLE samples can be used
with this board:</p>
<ul class="simple">
<li><p>beacon</p></li>
<li><p>central</p></li>
<li><p>central_hr</p></li>
<li><p>eddystone</p></li>
<li><p>hci_uart</p></li>
<li><p>ibeacon</p></li>
<li><p>peripheral_csc (Cycling Speed Cadence)</p></li>
<li><p>peripheral_dis (Device Information Service)</p></li>
<li><p>peripheral_esp (Environmental Sensing Service)</p></li>
<li><p>peripheral_hr (Heart Rate)</p></li>
<li><p>peripheral_ht (Health Thermometer)</p></li>
<li><p>peripheral</p></li>
<li><p>scan_adv</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>BLE Software Link Layer limitations:</p>
<ul class="simple">
<li><p>no 512/256 Kbps PHY</p></li>
<li><p>no TX power adjustment</p></li>
</ul>
</div>
</div>
<div class="section" id="connections-and-ios">
<h3>Connections and IOs<a class="headerlink" href="#connections-and-ios" title="Permalink to this headline">¶</a></h3>
<p>RV32M1 SoC pins are brought out to Arduino-style expansion connectors.
These are 2 pins wide each, adding an additional row of expansion pins
per header compared to the standard Arduino layout.</p>
<p>They are described in the tables in the following subsections. Since
pins are usually grouped by logical function in rows on these headers,
the odd- and even-numbered pins are listed in separate tables.  The
“Port/bit” columns refer to the SoC PORT and GPIO peripheral
naming scheme, e.g. “E/13” means PORTE/GPIOE pin 13.</p>
<p>See the schematic and chip reference manual for details.
(Documentation is available from the <a class="reference external" href="https://github.com/open-isa-org/open-isa.org/releases">OpenISA GitHub releases</a> page.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pins with peripheral functionality may also be muxed as GPIOs.</p>
</div>
<p><strong>Top right expansion header (J1)</strong></p>
<p>Odd/bottom pins:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 29%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>Port/bit</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>E/13</p></td>
<td><p>I2S_TX_BCLK</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>E/14</p></td>
<td><p>I2S_TX_FS</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>E/15</p></td>
<td><p>I2S_TXD</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>E/19</p></td>
<td><p>I2S_MCLK</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>E/16</p></td>
<td><p>I2S_RX_BCLK</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>E/21</p></td>
<td><p>SOF_OUT</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>E/17</p></td>
<td><p>I2S_RX_FS</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>E/18</p></td>
<td><p>I2S_RXD</p></td>
</tr>
</tbody>
</table>
<p>Even/top pins:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 29%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>Port/bit</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2</p></td>
<td><p>A/25</p></td>
<td><p>UART1_RX</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>A/26</p></td>
<td><p>UART1_TX</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>A/27</p></td>
<td><p>GPIO</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>B/13</p></td>
<td><p>PWM</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>B/14</p></td>
<td><p>GPIO</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>A/30</p></td>
<td><p>PWM</p></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p>A/31</p></td>
<td><p>PWM/CMP</p></td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><p>B/1</p></td>
<td><p>GPIO</p></td>
</tr>
</tbody>
</table>
<p><strong>Top left expansion header (J2)</strong></p>
<p>Odd/bottom pins:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 29%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>Port/bit</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>D/5</p></td>
<td><p>FLEXIO_D25</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>D/4</p></td>
<td><p>FLEXIO_D24</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>D/3</p></td>
<td><p>FLEXIO_D23</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>D/2</p></td>
<td><p>FLEXIO_D22</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>D/1</p></td>
<td><p>FLEXIO_D21</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>D/0</p></td>
<td><p>FLEXIO_D20</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>C/30</p></td>
<td><p>FLEXIO_D19</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>C/29</p></td>
<td><p>FLEXIO_D18</p></td>
</tr>
<tr class="row-even"><td><p>17</p></td>
<td><p>C/28</p></td>
<td><p>FLEXIO_D17</p></td>
</tr>
<tr class="row-odd"><td><p>19</p></td>
<td><p>B/29</p></td>
<td><p>FLEXIO_D16</p></td>
</tr>
</tbody>
</table>
<p>Even/top pins:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 29%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>Port/bit</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2</p></td>
<td><p>B/2</p></td>
<td><p>GPIO</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>B/3</p></td>
<td><p>PWM</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>B/6</p></td>
<td><p>SPI0_PCS2</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>B/5</p></td>
<td><p>SPI0_SOUT</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>B/7</p></td>
<td><p>SPI0_SIN</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>B/4</p></td>
<td><p>SPI0_SCK</p></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>GND</p></td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>AREF</p></td>
</tr>
<tr class="row-even"><td><p>18</p></td>
<td><p>C/9</p></td>
<td><p>I2C0_SDA</p></td>
</tr>
<tr class="row-odd"><td><p>20</p></td>
<td><p>C/10</p></td>
<td><p>I2C0_SCL</p></td>
</tr>
</tbody>
</table>
<p><strong>Bottom left expansion header (J3)</strong></p>
<p>Note that the headers at the bottom of the board have odd-numbered
pins on the top, unlike the headers at the top of the board.</p>
<p>Odd/top pins:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 26%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>Port/bit</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>A/21</p></td>
<td><p>ARDUINO_EMVSIM_PD</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>A/20</p></td>
<td><p>ARDUINO_EMVSIM_IO</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>A/19</p></td>
<td><p>ARDUINO_EMVSIM_VCCEN</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>A/18</p></td>
<td><p>ARDUINO_EMVSIM_RST</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>A/17</p></td>
<td><p>ARDUINO_EMVSIM_CLK</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>B/17</p></td>
<td><p>FLEXIO_D7</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>B/16</p></td>
<td><p>FLEXIO_D6</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>B/15</p></td>
<td><p>FLEXIO_D5</p></td>
</tr>
</tbody>
</table>
<p>Even/bottom pins: note that these are mostly power-related.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 29%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>Port/bit</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>SDA_GPIO0</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>BRD_IO_PER</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>RST_SDA</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>BRD_IO_PER</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>P5V_INPUT</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>GND</p></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>GND</p></td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>P5-9V VIN</p></td>
</tr>
</tbody>
</table>
<p><strong>Bottom right expansion header (J4)</strong></p>
<p>Note that the headers at the bottom of the board have odd-numbered
pins on the top, unlike the headers at the top of the board.</p>
<p>Odd/top pins:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 6%" />
<col style="width: 16%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>Port/bit</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>TAMPER2</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>TAMPER1/RTC_CLKOUT</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>TAMPER0/RTC_WAKEUP_b</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>E/2</p></td>
<td><p>ADC0_SE19</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>E/5</p></td>
<td><p>LPCMP1_IN2/LPCMP1_OUT</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>DAC0_OUT/ADC0_SE16/LPCMP0_IN3/LPCMP1_IN3</p></td>
</tr>
</tbody>
</table>
<p>Even/bottom pins:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 15%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pin</p></th>
<th class="head"><p>Port/bit</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2</p></td>
<td><p>C/11</p></td>
<td><p>ADC0_SE6</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>C/12</p></td>
<td><p>ADC0_SE7</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>B/9</p></td>
<td><p>ADC0_SE3</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>E/4</p></td>
<td><p>ADC0_SE21</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>E/10</p></td>
<td><p>ADC0_SE19 (and E/10, I2C3_SDA via 0 Ohm DNP)</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>E/11</p></td>
<td><p>ADC0_SE20 (and E/11, I2C3_SCL via 0 Ohm DNP)</p></td>
</tr>
</tbody>
</table>
<div class="section" id="additional-pins">
<h4>Additional Pins<a class="headerlink" href="#additional-pins" title="Permalink to this headline">¶</a></h4>
<p>For an up-to-date description of additional pins (such as buttons,
LEDs, etc.) supported by Zephyr, see the board DTS files in the Zephyr
source code, i.e.
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/boards/riscv/rv32m1_vega/rv32m1_vega_ri5cy.dts">boards/riscv/rv32m1_vega/rv32m1_vega_ri5cy.dts</a> for RI5CY and
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/boards/riscv/rv32m1_vega/rv32m1_vega_zero_riscy.dts">boards/riscv/rv32m1_vega/rv32m1_vega_zero_riscy.dts</a> for
ZERO-RISCY.</p>
<p>See the schematic in the documentation available from the <a class="reference external" href="https://github.com/open-isa-org/open-isa.org/releases">OpenISA
GitHub releases</a> page for additional details.</p>
</div>
</div>
<div class="section" id="system-clocks">
<h3>System Clocks<a class="headerlink" href="#system-clocks" title="Permalink to this headline">¶</a></h3>
<p>The RI5CY and ZERO-RISCY cores are configured to use the slow internal
reference clock (SIRC) as the clock source for an LPTMR peripheral to manage
the system timer, and the fast internal reference clock (FIRC) to generate a
48MHz core clock.</p>
</div>
<div class="section" id="serial-port">
<h3>Serial Port<a class="headerlink" href="#serial-port" title="Permalink to this headline">¶</a></h3>
<p>The USB connector at the top left of the board (near the RESET button) is
connected to an OpenSDA chip which provides a serial USB device. This is
connected to the LPUART0 peripheral which the RI5CY and ZERO-RISCY cores use by
default for console and logging.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The OpenSDA chip cannot be used to flash or debug the RISC-V cores.</p>
<p>See the next section for flash and debug instructions for the
RISC-V cores using an external JTAG dongle.</p>
</div>
</div>
</div>
<div class="section" id="programming-and-debugging">
<h2>Programming and Debugging<a class="headerlink" href="#programming-and-debugging" title="Permalink to this headline">¶</a></h2>
<div class="admonition important" id="rv32m1-programming-hw">
<p class="admonition-title">Important</p>
<p>To use this board, you will need:</p>
<ul class="simple">
<li><p>a <a class="reference external" href="https://www.segger.com/products/debug-probes/j-link/">SEGGER J-Link</a> debug probe to debug the RISC-V cores</p></li>
<li><p>a J-Link <a class="reference external" href="https://www.segger.com/products/debug-probes/j-link/accessories/adapters/9-pin-cortex-m-adapter/">9-Pin Cortex-M Adapter</a> board and ribbon cable</p></li>
<li><p>the SEGGER <a class="reference external" href="https://www.segger.com/downloads/jlink/#J-LinkSoftwareAndDocumentationPack">J-Link Software and Documentation Pack</a> software
installed</p></li>
</ul>
<p>A JTAG dongle is not included with the board itself.</p>
</div>
<p>Follow these steps to:</p>
<ol class="arabic simple">
<li><p>Get a toolchain and OpenOCD</p></li>
<li><p>Set up the board for booting RI5CY</p></li>
<li><p>Compile a Zephyr application for the RI5CY core</p></li>
<li><p>Flash the application to your board</p></li>
<li><p>Debug the board using GDB</p></li>
</ol>
<div class="section" id="get-the-toolchain-and-openocd">
<span id="rv32m1-toolchain-openocd"></span><h3>Get the Toolchain and OpenOCD<a class="headerlink" href="#get-the-toolchain-and-openocd" title="Permalink to this headline">¶</a></h3>
<p>Before programming and debugging, you first need to get a GNU
toolchain and an OpenOCD build. There are vendor-specific versions of
each for the RV32M1 SoC<a class="footnote-reference brackets" href="#toolchain-openocd" id="id1">1</a>.</p>
<div class="section" id="option-1-recommended-prebuilt-toolchain-and-openocd">
<h4>Option 1 (Recommended): Prebuilt Toolchain and OpenOCD<a class="headerlink" href="#option-1-recommended-prebuilt-toolchain-and-openocd" title="Permalink to this headline">¶</a></h4>
<p>The following prebuilt toolchains and OpenOCD archives are available
on the <a class="reference external" href="https://github.com/open-isa-org/open-isa.org/releases">OpenISA GitHub releases</a> page:</p>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">Toolchain_Linux.tar.gz</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">Toolchain_Mac.tar.gz</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">Toolchain_Windows.zip</span></code></p></li>
</ul>
<p>Download and extract the archive for your system, then extract the
toolchain and OpenOCD archives inside.</p>
<p>Linux:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>tar xvzf Toolchain_Linux.tar.gz
tar xvzf openocd.tar.gz
tar xvzf riscv32-unknown-elf-gcc.tar.gz
mv openocd ~/rv32m1-openocd
mv riscv32-unknown-elf-gcc ~
</pre></div>
</div>
<p>macOS (unfortunately, the OpenISA 1.0.0 release’s Mac
<code class="file docutils literal notranslate"><span class="pre">riscv32-unknown-elf-gcc.tar.gz</span></code> file doesn’t expand into a
<code class="file docutils literal notranslate"><span class="pre">riscv32-unknown-elf-gcc</span></code> directory, so it has to be created):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>tar xvzf Toolchain_Mac.tar.gz
tar xvzf openocd.tar.gz
mkdir riscv32-unknown-elf-gcc
mv riscv32-unknown-elf-gcc.tar.gz riscv32-unknown-elf-gcc
<span class="nb">cd</span> riscv32-unknown-elf-gcc/
tar xvzf riscv32-unknown-elf-gcc.tar.gz
<span class="nb">cd</span> ..
mv openocd ~/rv32m1-openocd
mv riscv32-unknown-elf-gcc ~
</pre></div>
</div>
<p>Windows:</p>
<ol class="arabic simple">
<li><p>Extract <code class="file docutils literal notranslate"><span class="pre">Toolchain_Windows.zip</span></code> in the file manager</p></li>
<li><p>Extract the <code class="file docutils literal notranslate"><span class="pre">openocd.zip</span></code> and <code class="file docutils literal notranslate"><span class="pre">riscv32-unknown-elf-gcc.zip</span></code> files
in the resulting <code class="file docutils literal notranslate"><span class="pre">Toolchain_Windows</span></code> folder</p></li>
<li><p>Move the extracted <code class="file docutils literal notranslate"><span class="pre">openocd</span></code> folder to <code class="file docutils literal notranslate"><span class="pre">C:\rv32m1-openocd</span></code></p></li>
<li><p>Move the extracted <code class="file docutils literal notranslate"><span class="pre">riscv32-unknown-elf-gcc</span></code> folder to
<code class="file docutils literal notranslate"><span class="pre">C:\riscv32-unknown-elf-gcc</span></code></p></li>
</ol>
<p>For simplicity, this guide assumes:</p>
<ul class="simple">
<li><p>You put the extracted toolchain at <code class="file docutils literal notranslate"><span class="pre">~/riscv32-unknown-elf-gcc</span></code>
on macOS or Linux, and <code class="file docutils literal notranslate"><span class="pre">C:\riscv32-unknown-elf-gcc</span></code> on
Windows.</p></li>
<li><p>You put the extracted OpenOCD binary at <code class="file docutils literal notranslate"><span class="pre">~/rv32m1-openocd</span></code> on
macOS or Linux, and the OpenOCD folder into <code class="file docutils literal notranslate"><span class="pre">C:\rv32m1-openocd</span></code>
on Windows.</p></li>
</ul>
<p>You can put them elsewhere, but be aware:</p>
<ul class="simple">
<li><p>If you put the toolchain somewhere else, you will need to change
the <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">CROSS_COMPILE</span></code> value described below accordingly.</p></li>
<li><p>If you put OpenOCD somewhere else, you will need to change the
OpenOCD path in the flashing and debugging instructions below.</p></li>
<li><p>Don’t use installation directories with spaces anywhere in the path;
this won’t work with Zephyr’s build system.</p></li>
</ul>
</div>
<div class="section" id="option-2-building-toolchain-and-openocd-from-source">
<h4>Option 2: Building Toolchain and OpenOCD From Source<a class="headerlink" href="#option-2-building-toolchain-and-openocd-from-source" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference internal" href="#rv32m1-vega-toolchain-build"><span class="std std-ref">Appendix: Building Toolchain and OpenOCD from Source</span></a>.</p>
</div>
</div>
<div class="section" id="jtag-setup">
<span id="rv32m1-vega-jtag"></span><h3>JTAG Setup<a class="headerlink" href="#jtag-setup" title="Permalink to this headline">¶</a></h3>
<p>This section describes how to connect to your board via the J-Link
debugger and adapter board. See the <a class="reference internal" href="#rv32m1-programming-hw"><span class="std std-ref">above information</span></a> for details on required hardware.</p>
<ol class="arabic">
<li><p>Connect the J-Link debugger through the adapter board to the
VEGAboard as shown in the figure.</p>
<div class="figure align-center" id="id3">
<img alt="RV32M1-VEGA" src="../../../../_images/rv32m1_vega_jtag.jpg" />
<p class="caption"><span class="caption-number">Fig. 197 </span><span class="caption-text">VEGAboard connected properly to J-Link debugger.
VEGAboard connector J55 should be used. Pin 1 is on the bottom left.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</li>
<li><p>Power the VEGAboard via USB. The OpenSDA connector at the top left
is recommended for UART access.</p></li>
<li><p>Make sure your J-Link is connected to your computer via USB.</p></li>
</ol>
</div>
<div class="section" id="one-time-board-setup-for-booting-ri5cy-or-zero-riscy">
<h3>One-Time Board Setup For Booting RI5CY or ZERO-RISCY<a class="headerlink" href="#one-time-board-setup-for-booting-ri5cy-or-zero-riscy" title="Permalink to this headline">¶</a></h3>
<p>Next, you’ll need to make sure your board boots the RI5CY or ZERO-RISCY core.
<strong>You only need to do this once.</strong></p>
<p>The RV32M1 SoC on the VEGAboard has multiple cores, any of which can
be selected as the boot core. Before flashing and debugging, you’ll
first make sure you’re booting the right core.</p>
<p><strong>Linux and macOS</strong>:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Linux users: to run these commands as a normal user, you will need
to install the <a class="reference external" href="https://github.com/open-isa-rv32m1/rv32m1-openocd/blob/master/contrib/60-openocd.rules">60-openocd.rules</a> udev rules file (usually by
placing it in <code class="file docutils literal notranslate"><span class="pre">/etc/udev/rules.d</span></code>, then unplugging and
plugging the J-Link in again via USB).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These Zephyr-specific instructions differ slightly from the
equivalent SDK ones. The Zephyr OpenOCD configuration file does not
run <code class="docutils literal notranslate"><span class="pre">init</span></code>, so you have to do it yourself as explained below.</p>
</div>
<ol class="arabic">
<li><p>In one terminal, use OpenOCD to connect to the board:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>~/rv32m1-openocd -f boards/riscv/rv32m1_vega/support/openocd_rv32m1_vega_ri5cy.cfg
</pre></div>
</div>
<p>The output should look like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ~/rv32m1-openocd -f boards/riscv/rv32m1_vega/support/openocd_rv32m1_vega_ri5cy.cfg
Open On-Chip Debugger 0.10.0+dev-00431-ge1ec3c7d (2018-10-31-07:29)
[...]
Info : Listening on port 3333 for gdb connections
Info : Listening on port 6666 for tcl connections
Info : Listening on port 4444 for telnet connections
</pre></div>
</div>
</li>
<li><p>In another terminal, connect to OpenOCD’s telnet server and execute
the <code class="docutils literal notranslate"><span class="pre">init</span></code> and <code class="docutils literal notranslate"><span class="pre">ri5cy_boot</span></code> commands <strong>with the reset button on
the board (at top left) pressed down</strong>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ telnet localhost <span class="m">4444</span>
Trying <span class="m">127</span>.0.0.1...
Connected to localhost.
Escape character is <span class="s1">&#39;^]&#39;</span>.
Open On-Chip Debugger
&gt; init
&gt; ri5cy_boot
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>To boot the ZERO-RISCY core instead, replace <code class="docutils literal notranslate"><span class="pre">ri5cy_boot</span></code> above with
<code class="docutils literal notranslate"><span class="pre">zero_boot</span></code>.</p>
<p>The reset button is at top left, as shown in the following figure.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../_images/ri5cy_boot.jpg"><img alt="Reset button is pressed" src="../../../../_images/ri5cy_boot.jpg" style="width: 4in;" /></a>
</div>
<p>Now quit the telnet session in this terminal and exit OpenOCD in the
other terminal.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Unplug your J-Link and VEGAboard, and plug them back in.</p></li>
</ol>
<p><strong>Windows</strong>:</p>
<p>In one cmd.exe prompt in the Zephyr directory:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>C:<span class="se">\r</span>v32m1-openocd<span class="se">\b</span>in<span class="se">\o</span>penocd.exe rv32m1-openocd -f boards<span class="se">\r</span>iscv32<span class="se">\r</span>v32m1_vega<span class="se">\s</span>upport<span class="se">\o</span>penocd_rv32m1_vega_ri5cy.cfg
</pre></div>
</div>
<p>In a telnet program of your choice:</p>
<ol class="arabic simple">
<li><p>Connect to localhost port 4444 using telnet.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">init</span></code> and <code class="docutils literal notranslate"><span class="pre">ri5cy_boot</span></code> as shown above, with RESET held down.</p></li>
<li><p>Quit the OpenOCD and telnet sessions.</p></li>
<li><p>Unplug your J-Link and VEGAboard, and plug them back in.</p></li>
</ol>
<blockquote>
<div><p>To boot the ZERO-RISCY core instead, replace <code class="docutils literal notranslate"><span class="pre">ri5cy_boot</span></code> above with
<code class="docutils literal notranslate"><span class="pre">zero_boot</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="compiling-a-program">
<h3>Compiling a Program<a class="headerlink" href="#compiling-a-program" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>These instructions assume you’ve set up a development system,
cloned the Zephyr repository, and installed Python dependencies as
described in the <a class="reference internal" href="../../../../getting_started/index.html#getting-started"><span class="std std-ref">Getting Started Guide</span></a>.</p>
<p>You should also have already downloaded and installed the toolchain
and OpenOCD as described above in <a class="reference internal" href="#rv32m1-toolchain-openocd"><span class="std std-ref">Get the Toolchain and OpenOCD</span></a>.</p>
</div>
<p>The first step is to set up environment variables to point at your
toolchain and OpenOCD:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Linux or macOS</span>
<span class="nb">export</span> <span class="nv">ZEPHYR_TOOLCHAIN_VARIANT</span><span class="o">=</span>cross-compile
<span class="nb">export</span> <span class="nv">CROSS_COMPILE</span><span class="o">=</span>~/riscv32-unknown-elf-gcc/bin/riscv32-unknown-elf-

<span class="c1"># Windows</span>
<span class="nb">set</span> <span class="nv">ZEPHYR_TOOLCHAIN_VARIANT</span><span class="o">=</span>cross-compile
<span class="nb">set</span> <span class="nv">CROSS_COMPILE</span><span class="o">=</span>C:<span class="se">\r</span>iscv32-unknown-elf-gcc<span class="se">\b</span>in<span class="se">\r</span>iscv32-unknown-elf-
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above only sets these variables for your current shell session.
You need to make sure this happens every time you use this board.</p>
</div>
<p>Now let’s compile the <a class="reference internal" href="../../../../samples/hello_world/README.html#hello-world"><span class="std std-ref">Hello World</span></a> application. (You can try
others as well; see <a class="reference internal" href="../../../../samples/index.html#samples-and-demos"><span class="std std-ref">Samples and Demos</span></a> for more.)</p>
<p>Due to a toolchain <a class="reference external" href="https://github.com/pulp-platform/pulpino/issues/240">linker issue</a>, you need to add an option setting
<code class="docutils literal notranslate"><span class="pre">CMAKE_REQUIRED_FLAGS</span></code> when running CMake to generate a build system
(see <a class="reference internal" href="../../../../application/index.html#application"><span class="std std-ref">Application Development</span></a> for information about Zephyr’s build system).</p>
<p>Linux and macOS (run this in a terminal from the Zephyr directory):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up environment and create build directory:</span>
<span class="nb">source</span> zephyr-env.sh
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>From the root of the zephyr repository
<span class="gp"># </span>On Linux/macOS
<span class="go">cd samples/hello_world</span>
<span class="go">mkdir build &amp;&amp; cd build</span>

<span class="gp"># </span>On Windows
<span class="go">cd samples\hello_world</span>
<span class="go">mkdir build &amp; cd build</span>

<span class="gp"># </span>Use cmake to configure a Ninja-based buildsystem:
<span class="go">cmake -GNinja -DBOARD=rv32m1_vega_ri5cy -DCMAKE_REQUIRED_FLAGS=-Wl,-dT=/dev/null ..</span>

<span class="gp"># </span>Now run ninja on the generated build system:
<span class="go">ninja</span>
</pre></div>
</div>
<p>Windows (run this in a <code class="docutils literal notranslate"><span class="pre">cmd</span></code> prompt, from the Zephyr directory):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up environment and create build directory</span>
zephyr-env.cmd
<span class="nb">cd</span> samples<span class="se">\h</span>ello_world
mkdir build <span class="p">&amp;</span> <span class="nb">cd</span> build

<span class="c1"># Use CMake to generate a Ninja-based build system:</span>
<span class="nb">type</span> NUL &gt; empty.ld
cmake -GNinja -DBOARD<span class="o">=</span>rv32m1_vega_ri5cy -DCMAKE_REQUIRED_FLAGS<span class="o">=</span>-Wl,-dT<span class="o">=</span>%cd%<span class="se">\e</span>mpty.ld ..

<span class="c1"># Build the sample</span>
ninja
</pre></div>
</div>
</div>
<div class="section" id="flashing">
<h3>Flashing<a class="headerlink" href="#flashing" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure you’ve done the <a class="reference internal" href="#rv32m1-vega-jtag"><span class="std std-ref">JTAG setup</span></a>, and
that the VEGAboard’s top left USB connector is connected to your
computer too (for UART access).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Linux users: to run these commands as a normal user, you will need
to install the <a class="reference external" href="https://github.com/open-isa-rv32m1/rv32m1-openocd/blob/master/contrib/60-openocd.rules">60-openocd.rules</a> udev rules file (usually by
placing it in <code class="file docutils literal notranslate"><span class="pre">/etc/udev/rules.d</span></code>, then unplugging and
plugging the J-Link in again via USB).</p>
</div>
<p>Make sure you’ve followed the above instructions to set up your board
and build a program first.</p>
<p>Since you need to use a special OpenOCD, the easiest way to flash is
by using <a class="reference internal" href="../../../../guides/west/build-flash-debug.html#west-build-flash-debug"><span class="std std-ref">west flash</span></a> instead of <code class="docutils literal notranslate"><span class="pre">ninja</span>
<span class="pre">flash</span></code> like you might see with other Zephyr documentation.</p>
<p>Run these commands from the build directory where you ran <code class="docutils literal notranslate"><span class="pre">ninja</span></code> in
the above section.</p>
<p>Linux and macOS:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t use &quot;~/rv32m1-openocd&quot;. It won&#39;t work.</span>
west flash --openocd<span class="o">=</span><span class="nv">$HOME</span>/rv32m1-openocd
</pre></div>
</div>
<p>Windows:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>west flash --openocd<span class="o">=</span>C:<span class="se">\r</span>v32m1-openocd<span class="se">\b</span>in<span class="se">\o</span>penocd.exe
</pre></div>
</div>
<p>If you have problems:</p>
<ul class="simple">
<li><p>Make sure you don’t have another <code class="docutils literal notranslate"><span class="pre">openocd</span></code> process running in the
background.</p></li>
<li><p>Unplug the boards and plug them back in.</p></li>
<li><p>On Linux, make sure udev rules are installed, as described above.</p></li>
</ul>
<p>As an alternative, for manual steps to run OpenOCD and GDB to flash,
see the <a class="reference external" href="https://github.com/open-isa-rv32m1/rv32m1_sdk_riscv/blob/master/readme.md">SDK README</a>.</p>
</div>
<div class="section" id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure you’ve done the <a class="reference internal" href="#rv32m1-vega-jtag"><span class="std std-ref">JTAG setup</span></a>, and
that the VEGAboard’s top left USB connector is connected to your
computer too (for UART access).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Linux users: to run these commands as a normal user, you will need
to install the <a class="reference external" href="https://github.com/open-isa-rv32m1/rv32m1-openocd/blob/master/contrib/60-openocd.rules">60-openocd.rules</a> udev rules file (usually by
placing it in <code class="file docutils literal notranslate"><span class="pre">/etc/udev/rules.d</span></code>, then unplugging and
plugging the J-Link in again via USB).</p>
</div>
<p>Make sure you’ve followed the above instructions to set up your board
and build a program first.</p>
<p>To debug with gdb:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Linux, macOS</span>
west debug --openocd<span class="o">=</span><span class="nv">$HOME</span>/rv32m1-openocd

<span class="c1"># Windows</span>
west debug --openocd<span class="o">=</span>C:<span class="se">\r</span>v32m1-openocd<span class="se">\b</span>in<span class="se">\o</span>penocd.exe
</pre></div>
</div>
<p>Then, from the <code class="docutils literal notranslate"><span class="pre">(gdb)</span></code> prompt, follow these steps to halt the core,
load the binary (<code class="file docutils literal notranslate"><span class="pre">zephyr.elf</span></code>), and re-sync with the OpenOCD
server:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>gdb<span class="o">)</span> monitor init
<span class="o">(</span>gdb<span class="o">)</span> monitor reset halt
<span class="o">(</span>gdb<span class="o">)</span> load
<span class="o">(</span>gdb<span class="o">)</span> monitor gdb_sync
<span class="o">(</span>gdb<span class="o">)</span> stepi
</pre></div>
</div>
<p>You can then set breakpoints and debug using normal GDB commands.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GDB can get out of sync with the target if you execute commands
that reset it. To reset RI5CY and get GDB back in sync with it
without reloading the binary:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>gdb<span class="o">)</span> monitor reset halt
<span class="o">(</span>gdb<span class="o">)</span> monitor gdb_sync
<span class="o">(</span>gdb<span class="o">)</span> stepi
</pre></div>
</div>
</div>
<p>If you have problems:</p>
<ul class="simple">
<li><p>Make sure you don’t have another <code class="docutils literal notranslate"><span class="pre">openocd</span></code> process running in the
background.</p></li>
<li><p>Unplug the boards and plug them back in.</p></li>
<li><p>On Linux, make sure udev rules are installed, as described above.</p></li>
</ul>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>OpenISA developer portal: <a class="reference external" href="http://open-isa.org">http://open-isa.org</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-isa-org/open-isa.org/releases">OpenISA GitHub releases</a>: includes toolchain and OpenOCD
prebuilts, as well as documentation, such as the SoC datasheet and
reference manual, board schematic and user guides, etc.</p></li>
<li><p>Base toolchain: <a class="reference external" href="https://github.com/pulp-platform/pulp-riscv-gnu-toolchain">pulp-riscv-gnu-toolchain</a>; extra toolchain patches:
<a class="reference external" href="https://github.com/open-isa-rv32m1/rv32m1_gnu_toolchain_patch">rv32m1_gnu_toolchain_patch</a> (only needed if building from source).</p></li>
<li><p>OpenOCD repository: <a class="reference external" href="https://github.com/open-isa-rv32m1/rv32m1-openocd">rv32m1-openocd</a> (only needed if building from
source).</p></li>
<li><p>Vendor SDK: <a class="reference external" href="https://github.com/open-isa-rv32m1/rv32m1_sdk_riscv">rv32m1_sdk_riscv</a>. Contains HALs, non-Zephyr sample
applications, and information on using the board with Eclipse which
may be interesting when combined with the Eclipse Debugging
information in the <a class="reference internal" href="../../../../application/index.html#application"><span class="std std-ref">Application Development</span></a>.</p></li>
</ul>
</div>
<div class="section" id="appendix-building-toolchain-and-openocd-from-source">
<span id="rv32m1-vega-toolchain-build"></span><h2>Appendix: Building Toolchain and OpenOCD from Source<a class="headerlink" href="#appendix-building-toolchain-and-openocd-from-source" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Toolchain and OpenOCD build instructions are provided for Linux and
macOS only.</p>
<p>Instructions for building OpenOCD have only been verified on Linux.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Don’t use installation directories with spaces anywhere in
the path; this won’t work with Zephyr’s build system.</p>
</div>
<p>Ubuntu 18.04 users need to install these additional dependencies:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo apt-get install autoconf automake autotools-dev curl libmpc-dev <span class="se">\</span>
                     libmpfr-dev libgmp-dev gawk build-essential bison <span class="se">\</span>
                     flex texinfo gperf libtool patchutils bc zlib1g-dev <span class="se">\</span>
                     libusb-1.0-0-dev libudev1 libudev-dev g++
</pre></div>
</div>
<p>Users of other Linux distributions need to install the above packages
with their system package manager.</p>
<p>macOS users need to install dependencies with Homebrew:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>brew install gawk gnu-sed gmp mpfr libmpc isl zlib
</pre></div>
</div>
<p>The build toolchain is based on the <a class="reference external" href="https://github.com/pulp-platform/pulp-riscv-gnu-toolchain">pulp-riscv-gnu-toolchain</a>, with
some additional patches hosted in a separate repository,
<a class="reference external" href="https://github.com/open-isa-rv32m1/rv32m1_gnu_toolchain_patch">rv32m1_gnu_toolchain_patch</a>. To build the toolchain, follow the
instructions in the <code class="docutils literal notranslate"><span class="pre">rv32m1_gnu_toolchain_patch</span></code> repository’s
<a class="reference external" href="https://github.com/open-isa-rv32m1/rv32m1_gnu_toolchain_patch/blob/master/readme.md">readme.md</a> file to apply the patches, then run:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./configure --prefix<span class="o">=</span>&lt;toolchain-installation-dir&gt; --with-arch<span class="o">=</span>rv32imc --with-cmodel<span class="o">=</span>medlow --enable-multilib
make
</pre></div>
</div>
<p>If you set <code class="docutils literal notranslate"><span class="pre">&lt;toolchain-installation-dir&gt;</span></code> to
<code class="file docutils literal notranslate"><span class="pre">~/riscv32-unknown-elf-gcc</span></code>, you can use the above instructions
for setting <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">CROSS_COMPILE</span></code> when building Zephyr
applications. If you set it to something else, you will need to update
your <span class="target" id="index-2"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">CROSS_COMPILE</span></code> setting accordingly.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Strangely, there is no separate <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> step for the
toolchain. That is, the <code class="docutils literal notranslate"><span class="pre">make</span></code> invocation both builds and
installs the toolchain. This means <code class="docutils literal notranslate"><span class="pre">make</span></code> has to be run as root
if you want to set <code class="docutils literal notranslate"><span class="pre">--prefix</span></code> to a system directory such as
<code class="file docutils literal notranslate"><span class="pre">/usr/local</span></code> or <code class="file docutils literal notranslate"><span class="pre">/opt</span></code> on Linux.</p>
</div>
<p>To build OpenOCD, clone the <a class="reference external" href="https://github.com/open-isa-rv32m1/rv32m1-openocd">rv32m1-openocd</a> repository, then run
these from the repository top level:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./bootstrap
./configure --prefix<span class="o">=</span>&lt;openocd-installation-dir&gt;
make
make install
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">&lt;openocd-installation-dir&gt;</span></code> is <code class="file docutils literal notranslate"><span class="pre">~/rv32m1-openocd</span></code>, you
should set your OpenOCD path to <code class="file docutils literal notranslate"><span class="pre">~/rv32m1-openocd/bin/openocd</span></code>
in the above flash and debug instructions.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="toolchain-openocd"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>For Linux users, the RISC-V toolchain in the <a class="reference internal" href="../../../../getting_started/installation_linux.html#zephyr-sdk"><span class="std std-ref">Zephyr SDK</span></a> may work, but it hasn’t been thoroughly tested with this
SoC, and will not allow use of any available RISC-V ISA extensions.</p>
<p>Support for the RV32M1 SoC is not currently available in the OpenOCD
upstream repository or the OpenOCD build in the Zephyr SDK.</p>
</dd>
</dl>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>