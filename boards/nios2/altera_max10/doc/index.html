<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Altera MAX10 &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script type="module" src="../../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../../_static/js/ga-tracker.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../../copyright.html" />
    <link rel="next" title="Altera Nios-II Emulation (QEMU)" href="../../qemu_nios2/doc/index.html" />
    <link rel="prev" title="NIOS II Boards" href="../../index.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html">
            <img src="../../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.99
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/3.0.0/">3.0.0</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Supported Boards</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../x86/index.html">x86 Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arm/index.html">ARM Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arm64/index.html">ARM64 Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arc/index.html">ARC Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mips/index.html">MIPS Boards</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">NIOS II Boards</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Altera MAX10</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hardware">Hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#programming-and-debugging">Programming and Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../qemu_nios2/doc/index.html">Altera Nios-II Emulation (QEMU)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../xtensa/index.html">XTENSA Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../posix/index.html">POSIX/NATIVE Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../riscv/index.html">RISCV Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sparc/index.html">SPARC Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../shields/index.html">Shields</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/kconfig.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../../index.html">Supported Boards</a> &raquo;</li>
  
     <li><a href="../../index.html">NIOS II Boards</a> &raquo;</li>
  
  <li>Altera MAX10</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main//boards/nios2/altera_max10/doc/index.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="altera-max10">
<span id="id1"></span><h1>Altera MAX10<a class="headerlink" href="#altera-max10" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The Zephyr kernel is supported on the Altera MAX10 Rev C development kit, using
the Nios II Gen 2 soft CPU.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../../../../_images/altera_max10.jpg"><img alt="Altera's MAX* 10" src="../../../../_images/altera_max10.jpg" style="width: 442px;" /></a>
<p class="caption"><span class="caption-number">Fig. 185 </span><span class="caption-text">Altera’s MAX* 10  (Credit: Altera)</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="hardware">
<h2>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dip-switch-settings">
<h3>DIP Switch settings<a class="headerlink" href="#dip-switch-settings" title="Permalink to this headline">¶</a></h3>
<p>There are two sets of switches on the back of the board. Of particular
importance is SW2:</p>
<ul class="simple">
<li><p>Switch 2 (CONFIG_SEL) should be in the OFF (up) position so that the first
boot image is CFM0</p></li>
<li><p>Switch 3 (VTAP_BYPASS) needs to be in the ON (down) position or the flashing
scripts won’t work</p></li>
<li><p>Switch 4 (HSMC_BYPASSN) should be OFF (up)</p></li>
</ul>
<a class="reference internal image-reference" href="../../../../_images/Altera_MAX10_switches.jpg"><img alt="Altera's MAX* 10 Switches" class="align-center" src="../../../../_images/Altera_MAX10_switches.jpg" style="width: 442px;" /></a>
<p>Other switches are user switches, their position is application-specific.</p>
</div>
<div class="section" id="necessary-software">
<h3>Necessary Software<a class="headerlink" href="#necessary-software" title="Permalink to this headline">¶</a></h3>
<p>You will need the Altera Quartus SDK in order to work with this device. The
<a class="reference external" href="http://dl.altera.com/?edition=lite">Altera Lite Distribution</a> of Quartus may be obtained without
charge.</p>
<p>For your convenience using the SDK tools (such as <code class="docutils literal notranslate"><span class="pre">nios2-configure-sof</span></code>),
you should put the binaries provided by the SDK
in your path. Below is an example, adjust ALTERA_BASE to where you installed the
SDK:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export ALTERA_BASE=/opt/altera_lite/16.0</span>
<span class="go">export PATH=$PATH:$ALTERA_BASE/quartus/bin:$ALTERA_BASE/nios2eds/bin</span>
</pre></div>
</div>
<p>You may need to adjust your udev rules so that you can talk to the USB Blaster
II peripheral, which is the built-in JTAG interface for this device.</p>
<p>The following works for Fedora 23:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>For Altera USB-Blaster permissions.
<span class="go">SUBSYSTEM==&quot;usb&quot;,\</span>
<span class="go">ENV{DEVTYPE}==&quot;usb_device&quot;,\</span>
<span class="go">ATTR{idVendor}==&quot;09fb&quot;,\</span>
<span class="go">ATTR{idProduct}==&quot;6010&quot;,\</span>
<span class="go">MODE=&quot;0666&quot;,\</span>
<span class="go">NAME=&quot;bus/usb/$env{BUSNUM}/$env{DEVNUM}&quot;,\</span>
<span class="go">RUN+=&quot;/bin/chmod 0666 %c&quot;</span>
<span class="go">SUBSYSTEM==&quot;usb&quot;,\</span>
<span class="go">ENV{DEVTYPE}==&quot;usb_device&quot;,\</span>
<span class="go">ATTR{idVendor}==&quot;09fb&quot;,\</span>
<span class="go">ATTR{idProduct}==&quot;6810&quot;,\</span>
<span class="go">MODE=&quot;0666&quot;,\</span>
<span class="go">NAME=&quot;bus/usb/$env{BUSNUM}/$env{DEVNUM}&quot;,\</span>
<span class="go">RUN+=&quot;/bin/chmod 0666 %c&quot;</span>
</pre></div>
</div>
<p>You can test connectivity with the SDK jtagconfig tool, you should see something
like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>jtagconfig
<span class="go">1) USB-BlasterII [1-1.2]</span>
<span class="go">  031050DD   10M50DA(.|ES)/10M50DC</span>
<span class="go">  020D10DD   VTAP10</span>
</pre></div>
</div>
</div>
<div class="section" id="reference-cpu">
<h3>Reference CPU<a class="headerlink" href="#reference-cpu" title="Permalink to this headline">¶</a></h3>
<p>A reference CPU design of a Nios II/f core is included in the Zephyr tree
in the <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/soc/nios2/nios2f-zephyr/cpu">soc/nios2/nios2f-zephyr/cpu</a> directory.</p>
<p>Flash this CPU using the <code class="docutils literal notranslate"><span class="pre">nios2-configure-sof</span></code> SDK tool with the FPGA
configuration file
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/soc/nios2/nios2f-zephyr/cpu/ghrd_10m50da.sof">soc/nios2/nios2f-zephyr/cpu/ghrd_10m50da.sof</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>nios2-configure-sof ghrd_10m50da.sof
</pre></div>
</div>
<p>This CPU is a Nios II/F core with a 16550 UART, JTAG UART, and the Avalon Timer.
For any Nios II SOC definition, you can find out more details about the CPU
configuration by inspecting system.h in the SOC’s include directory.</p>
</div>
<div class="section" id="console-output">
<h3>Console Output<a class="headerlink" href="#console-output" title="Permalink to this headline">¶</a></h3>
<div class="section" id="uart">
<h4>16550 UART<a class="headerlink" href="#uart" title="Permalink to this headline">¶</a></h4>
<p>By default, the kernel is configured to send console output to the 16550 UART.
You can monitor this on your workstation by connecting to the top right mini USB
port on the board (it will show up in /dev as a ttyUSB node), and then running
minicom with flow control disabled, 115200-8N1 settings.</p>
</div>
<div class="section" id="jtag-uart">
<h4>JTAG UART<a class="headerlink" href="#jtag-uart" title="Permalink to this headline">¶</a></h4>
<p>You can also have it send its console output to the JTAG UART.
Enable <code class="docutils literal notranslate"><span class="pre">jtag_uart</span></code> node in <code class="file docutils literal notranslate"><span class="pre">altera_max10.dts</span></code> or overlay file:</p>
<div class="highlight-devicetree notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="na">jtag_uart</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kr">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;okay&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">current-speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">115200</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>To view these messages on your local workstation, run the terminal application
in the SDK:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>nios2-terminal
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="programming-and-debugging">
<h2>Programming and Debugging<a class="headerlink" href="#programming-and-debugging" title="Permalink to this headline">¶</a></h2>
<div class="section" id="flashing">
<h3>Flashing<a class="headerlink" href="#flashing" title="Permalink to this headline">¶</a></h3>
<div class="section" id="flashing-kernel-into-ufm">
<h4>Flashing Kernel into UFM<a class="headerlink" href="#flashing-kernel-into-ufm" title="Permalink to this headline">¶</a></h4>
<p>The usual <code class="docutils literal notranslate"><span class="pre">flash</span></code> target will work with the <code class="docutils literal notranslate"><span class="pre">altera_max10</span></code> board
configuration. Here is an example for the <a class="reference internal" href="../../../../samples/hello_world/README.html#hello-world"><span class="std std-ref">Hello World</span></a>
application.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>From the root of the zephyr repository
<span class="go">west build -b altera_max10 samples/hello_world</span>
<span class="go">west flash</span>
</pre></div>
</div>
<p>Refer to <a class="reference internal" href="../../../../application/index.html#build-an-application"><span class="std std-ref">Building an Application</span></a> and <a class="reference internal" href="../../../../application/index.html#application-run"><span class="std std-ref">Run an Application</span></a> for
more details.</p>
<p>This provisions the Zephyr kernel and the CPU configuration onto the board,
using the scripts/support/quartus-flash.py script. After it completes the kernel
will immediately boot.</p>
</div>
<div class="section" id="flashing-kernel-directly-into-ram-over-jtag">
<h4>Flashing Kernel directly into RAM over JTAG<a class="headerlink" href="#flashing-kernel-directly-into-ram-over-jtag" title="Permalink to this headline">¶</a></h4>
<p>The SDK included the nios2-download tool which will let you flash a kernel
directly into RAM and then boot it from the __start symbol.</p>
<p>In order for this to work, your entire kernel must be located in RAM. Make sure
the following config options are disabled:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CONFIG_XIP=n</span>
<span class="go">CONFIG_INCLUDE_RESET_VECTOR=n</span>
</pre></div>
</div>
<p>Then, after building your kernel, push it into device’s RAM by running
this from the build directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>nios2-download --go zephyr/zephyr.elf
</pre></div>
</div>
<p>If you have a console session running (either minicom or nios2-terminal) you
should see the application’s output. There are additional arguments you can pass
to nios2-download so that it spawns a GDB server that you can connect to,
although it’s typically simpler to just use nios2-gdb-server as described below.</p>
</div>
</div>
<div class="section" id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<p>The Altera SDK includes a GDB server which can be used to debug a MAX10 board.
You can either debug a running image that was flashed onto the device in User
Flash Memory (UFM), or load an image over the JTAG using GDB.</p>
<div class="section" id="debugging-with-ufm-flashed-image">
<h4>Debugging With UFM Flashed Image<a class="headerlink" href="#debugging-with-ufm-flashed-image" title="Permalink to this headline">¶</a></h4>
<p>You can debug an application in the usual way.  Here is an example.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>From the root of the zephyr repository
<span class="go">west build -b altera_max10 samples/hello_world</span>
<span class="go">west debug</span>
</pre></div>
</div>
<p>You will see output similar to the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Nios II GDB server running on port 3335</span>
<span class="go">Ignoring --stop option because --tcpport also specified</span>
<span class="go">GNU gdb (GDB) 7.11.0.20160511-git</span>
<span class="go">Copyright (C) 2016 Free Software Foundation, Inc.</span>
<span class="go">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span>
<span class="go">This is free software: you are free to change and redistribute it.</span>
<span class="go">There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;</span>
<span class="go">and &quot;show warranty&quot; for details.</span>
<span class="go">This GDB was configured as &quot;--host=x86_64-pokysdk-linux --target=nios2-zephyr-elf&quot;.</span>
<span class="go">Type &quot;show configuration&quot; for configuration details.</span>
<span class="go">For bug reporting instructions, please see:</span>
<span class="go">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span>
<span class="go">Find the GDB manual and other documentation resources online at:</span>
<span class="go">&lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span>
<span class="go">For help, type &quot;help&quot;.</span>
<span class="go">Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...</span>
<span class="go">Reading symbols from /projects/zephyr/samples/hello_world/build/zephyr/zephyr.elf...done.</span>
<span class="go">Remote debugging using :3335</span>
<span class="go">Using cable &quot;USB-BlasterII [3-1.3]&quot;, device 1, instance 0x00</span>
<span class="go">Resetting and pausing target processor: OK</span>
<span class="go">Listening on port 3335 for connection from GDB: accepted</span>
<span class="go">isr_tables_syms () at /projects/zephyr/arch/common/isr_tables.c:63</span>
<span class="go">63      GEN_ABSOLUTE_SYM(__ISR_LIST_SIZEOF, sizeof(struct _isr_list));</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">b _PrepC</span>
<span class="go">Breakpoint 1 at 0xdf0: file /projects/zephyr/arch/nios2/core/prep_c.c, line 36.</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">b z_cstart</span>
<span class="go">Breakpoint 2 at 0x1254: file /projects/zephyr/kernel/init.c, line 348.</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">c</span>
<span class="go">Continuing.</span>

<span class="go">Breakpoint 2, _Cstart () at /projects/zephyr/kernel/init.c:348</span>
<span class="go">348     {</span>
<span class="gp gp-VirtualEnv">(gdb)</span>
</pre></div>
</div>
<p>To start debugging manually:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nios2-gdb-server --tcpport 1234 --stop --reset-target</span>
</pre></div>
</div>
<p>And then connect with GDB from the build directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nios2-poky-elf-gdb  zephyr/zephyr.elf -ex &quot;target remote :1234&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="debugging-with-jtag-flashed-image">
<h4>Debugging With JTAG Flashed Image<a class="headerlink" href="#debugging-with-jtag-flashed-image" title="Permalink to this headline">¶</a></h4>
<p>In order for this to work, execute-in-place must be disabled, since the GDB
‘load’ command can only put text and data in RAM. Ensure this is in your
configuration:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CONFIG_XIP=n</span>
</pre></div>
</div>
<p>It is OK for this procedure to leave the reset vector enabled, unlike
nios2-download (which errors out if it finds sections outside of SRAM) it will
be ignored.</p>
<p>In a terminal, launch the nios2 GDB server. It doesn’t matter what kernel (if
any) is on the device, but you should have at least flashed a CPU using
nios2-configure-sof. You can leave this process running.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>nios2-gdb-server --tcpport <span class="m">1234</span> --tcppersist --init-cache --reset-target
</pre></div>
</div>
<p>Build your Zephyr kernel, and load it into a GDB built for Nios II (included in
the Zephyr SDK) from the build directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>nios2-poky-elf-gdb zephyr/zephyr.elf
</pre></div>
</div>
<p>Then connect to the GDB server:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">target remote :1234</span>
</pre></div>
</div>
<p>And then load the kernel image over the wire. The CPU will not start from the
reset vector, instead it will boot from the __start symbol:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">load</span>
<span class="go">Loading section reset, size 0xc lma 0x0</span>
<span class="go">Loading section exceptions, size 0x1b0 lma 0x400020</span>
<span class="go">Loading section text, size 0x8df0 lma 0x4001d0</span>
<span class="go">Loading section devconfig, size 0x30 lma 0x408fc0</span>
<span class="go">Loading section rodata, size 0x3f4 lma 0x408ff0</span>
<span class="go">Loading section datas, size 0x888 lma 0x4093e4</span>
<span class="go">Loading section initlevel, size 0x30 lma 0x409c6c</span>
<span class="go">Loading section _k_task_list, size 0x58 lma 0x409c9c</span>
<span class="go">Loading section _k_task_ptr, size 0x8 lma 0x409cf4</span>
<span class="go">Loading section _k_event_list, size 0x10 lma 0x409cfc</span>
<span class="go">Start address 0x408f54, load size 40184</span>
<span class="go">Transfer rate: 417 KB/sec, 368 bytes/write.</span>
<span class="go">After this is done you may set breakpoints and continue execution. If you ever want to reset the CPU, issue the &#39;load&#39; command again.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.altera.com/en_US/pdfs/literature/hb/nios2/n2cpu-nii5v1gen2.pdf">CPU Documentation</a></p></li>
<li><p><a class="reference external" href="https://www.altera.com/en_US/pdfs/literature/an/an730.pdf">Nios II Processor Booting Methods in MAX 10 FPGA Devices</a></p></li>
<li><p><a class="reference external" href="https://www.altera.com/content/dam/altera-www/global/en_US/pdfs/literature/ug/ug_embedded_ip.pdf">Embedded Peripherals IP User Guide</a></p></li>
<li><p><a class="reference external" href="https://www.altera.com/content/dam/altera-www/global/en_US/pdfs/literature/hb/max-10/ug_m10_config.pdf">MAX 10 FPGA Configuration User Guide</a></p></li>
<li><p><a class="reference external" href="https://www.altera.com/content/dam/altera-www/global/en_US/pdfs/literature/ug/ug-max10m50-fpga-dev-kit.pdf">MAX 10 FPGA Development Kit User Guide</a></p></li>
<li><p><a class="reference external" href="https://www.altera.com/content/dam/altera-www/global/en_US/pdfs/literature/hb/nios2/edh_ed51004.pdf">Nios II Command-Line Tools</a></p></li>
<li><p><a class="reference external" href="https://www.altera.com/content/dam/altera-www/global/en_US/pdfs/literature/manual/tclscriptrefmnl.pdf">Quartus II Scripting Reference Manual</a></p></li>
</ul>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Mar 05, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>