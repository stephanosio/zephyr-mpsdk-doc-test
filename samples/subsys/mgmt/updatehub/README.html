<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UpdateHub embedded Firmware Over-The-Air (FOTA) sample &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script type="module" src="../../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../../_static/js/ga-tracker.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../../copyright.html" />
    <link rel="next" title="Modbus Samples" href="../../modbus/modbus.html" />
    <link rel="prev" title="Open Supervised Device Protocol (OSDP)" href="../osdp/README.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html">
            <img src="../../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.99
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/3.0.0/">3.0.0</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../security/index.html">Security</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Samples and Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../classic.html">Classic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basic/basic.html">Basic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../userspace/index.html">Userspace Samples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../subsys.html">Various Subsystems Samples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../canbus/canbus.html">Controller Area Network (CAN) Bus Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../console/console.html">Console Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cpp/cpp.html">C++ Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../debug/index.html">Debug Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../display/display.html">Display Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fs/fs.html">FS Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ipc/ipc.html">IPC Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../logging/logging.html">Logging Sample</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../mgmt.html">Management Samples</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../hawkbit/README.html">Hawkbit Direct Device Integration API sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mcumgr/smp_svr/README.html">SMP Server Sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="../osdp/README.html">Open Supervised Device Protocol (OSDP)</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">UpdateHub embedded Firmware Over-The-Air (FOTA) sample</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../modbus/modbus.html">Modbus Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../nvs/README.html">NVS: Non-Volatile Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../portability/portability.html">Portability Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../settings/README.html">Settings sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../shell/shell.html">Shell System Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../task_wdt/README.html">Task Watchdog Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usb/usb.html">USB device support samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../video/video.html">Video Samples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../net/net.html">Networking Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../bluetooth/bluetooth.html">Bluetooth samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensor/sensor.html">Sensor Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arch/index.html">Architecture Dependent Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../boards/boards.html">Board-specific samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../drivers/drivers.html">Driver Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../application_development/application_development.html">Application development samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../shields/shields.html">Shields Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../posix/posix.html">POSIX Subsystem Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kernel/index.html">Various Kernel and Scheduler Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tfm_integration/tfm_integration.html">TF-M Integration Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tfm_integration/tfm_integration.html#trusted-firmware-m-tf-m">Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/index.html">External Module Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../compression/compression.html">Compression Samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/kconfig.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../../index.html">Samples and Demos</a> &raquo;</li>
  
     <li><a href="../../subsys.html">Various Subsystems Samples</a> &raquo;</li>
  
     <li><a href="../mgmt.html">Management Samples</a> &raquo;</li>
  
  <li>UpdateHub embedded Firmware Over-The-Air (FOTA) sample</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main//samples/subsys/mgmt/updatehub/README.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="updatehub-embedded-firmware-over-the-air-fota-sample">
<span id="updatehub-fota-sample"></span><h1>UpdateHub embedded Firmware Over-The-Air (FOTA) sample<a class="headerlink" href="#updatehub-embedded-firmware-over-the-air-fota-sample" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>UpdateHub is an enterprise-grade solution which makes it simple to remotely
update all your embedded devices.  It handles all aspects related to sending
Firmware Over-the-Air (FOTA) updates with maximum security and efficiency,
while you focus on adding value to your product.  It is possible to read more
about at <a class="reference external" href="https://docs.updatehub.io/">docs.updatehub.io</a>.</p>
<p>This sample shows how to use UpdateHub in both a polling and manual update
mode.</p>
<p>Polling mode runs automatically on a predefined period, probing the server
for updates and installing them without requiring user intervention.</p>
<p>Manual mode requires the user to call the server probe and then, if there is
an available update, also requires the user to decide if it is appropriate to
update now or later.</p>
<p>You can access the sample source code at
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/subsys/mgmt/updatehub/src/main.c">samples/subsys/mgmt/updatehub/src/main.c</a>.</p>
</div>
<div class="section" id="caveats">
<h2>Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The Zephyr port of <code class="docutils literal notranslate"><span class="pre">UpdateHub</span></code> was initialy developed to run on a
<a class="reference internal" href="../../../../boards/arm/frdm_k64f/doc/index.html#frdm-k64f"><span class="std std-ref">Freedom-K64F</span></a> kit using the ethernet connectivity.  The
application should build and run for other platforms with same connectivity.</p></li>
<li><p>The sample provides overlay files to enable other tecnologies like WIFI,
modem, BLE IPSP, 802.15.4 or OpenThread.  These technologies depends on
hardware resources and the correspondent overlay was designed to be generic
instead full optimized.</p></li>
<li><p>It is important understand that some wireless technologies may require a
gateway or some sort of border router.  It is out of scope provide such
configuration in details.</p></li>
<li><p>The MCUboot bootloader is required for <code class="docutils literal notranslate"><span class="pre">UpdateHub</span></code> function properly.
Before chose a platform to test, make sure that SoC and board have support
to it.  UpdateHub currently uses two slots to perform the upgrade.  More
information about Device Firmware Upgrade subsystem and MCUboot can be found
in <a class="reference internal" href="../../../../guides/device_mgmt/dfu.html#mcuboot"><span class="std std-ref">MCUboot</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UpdateHub</span></code> acts like a service on Zephyr. It is heavily dependent on
Zephyr sub-systems and it uses CoAP over UDP.</p></li>
</ul>
</div>
<div class="section" id="building-and-running">
<h2>Building and Running<a class="headerlink" href="#building-and-running" title="Permalink to this headline">¶</a></h2>
<p>The below steps describe how to build and run the <code class="docutils literal notranslate"><span class="pre">UpdateHub</span></code> sample in
Zephyr.  Open a terminal <code class="docutils literal notranslate"><span class="pre">terminal</span> <span class="pre">1</span></code> and navigate to your Zephyr project
directory.  This allows contruct and run everything from a common place.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ls</span>
<span class="go">bootloader  modules  tools  zephyr</span>
</pre></div>
</div>
<div class="section" id="step-1-build-flash-mcuboot">
<h3>Step 1: Build/Flash MCUboot<a class="headerlink" href="#step-1-build-flash-mcuboot" title="Permalink to this headline">¶</a></h3>
<p>The MCUboot can be build following the instructions in the <a class="reference internal" href="../../../../guides/device_mgmt/dfu.html#mcuboot"><span class="std std-ref">MCUboot</span></a>
documentation page.  Flash the resulting image file using west on
<code class="docutils literal notranslate"><span class="pre">terminal</span> <span class="pre">1</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>From the root of the zephyr repository
<span class="go">west build -b frdm_k64f -d build/mcuboot-frdm_k64f bootloader/mcuboot/boot/zephyr</span>
<span class="go">west flash -d build/mcuboot-frdm_k64f</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-start-the-updatehub-server">
<h3>Step 2: Start the UpdateHub Server<a class="headerlink" href="#step-2-start-the-updatehub-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="step-2-1-updatehub-ce-community-edition">
<h4>Step 2.1: UpdateHub-CE (Community Edition)<a class="headerlink" href="#step-2-1-updatehub-ce-community-edition" title="Permalink to this headline">¶</a></h4>
<p>The Zephyr sample application is configured by default to use the UpdateHub-CE
server edition.  This version implies you need run your own server.  The
UpdateHub-CE is distributed as a docker container and can be on your local
network or even instaled on a service provider like Digital Ocean, Vultr etc.
To start using the UpdateHub-CE simple execute the docker command with the
following parameters on another terminal <code class="docutils literal notranslate"><span class="pre">terminal</span> <span class="pre">2</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker run -it -p 8080:8080 -p 5683:5683/udp --rm</span>
<span class="go">  updatehub/updatehub-ce:latest</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-2-updatehub-cloud">
<h4>Step 2.2: UpdateHub Cloud<a class="headerlink" href="#step-2-2-updatehub-cloud" title="Permalink to this headline">¶</a></h4>
<p>The UpdateHub Cloud is an enterprise-grade solution.  It provides almost same
resources than UpdateHub-CE with the DTLS as main diferential.  For more
details on how to use the UpdateHub Cloud please refer to the documentation on
<a class="reference external" href="https://updatehub.io">updatehub.io</a>.  The UpdateHub Cloud has the option to use CoAPS/DTLS or not.
If you want to use the CoAPS/DTLS, simply add the <code class="docutils literal notranslate"><span class="pre">overlay-dtls.conf</span></code> when
building the sample.  You can use the provided certificate for test this
example or create your own.  The below procedure instruct how create a new
certificate using openssl on a Linux machine on terminal <code class="docutils literal notranslate"><span class="pre">terminal</span> <span class="pre">2</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">openssl genrsa -out privkey.pem 512</span>
<span class="go">openssl req -new -x509 -key privkey.pem -out servercert.pem</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">servercert</span></code> and <code class="docutils literal notranslate"><span class="pre">privkey</span></code> files must be embedded in the application
by <code class="docutils literal notranslate"><span class="pre">certificates.h</span></code> file.  The following procedure can be used to generated
the required <code class="docutils literal notranslate"><span class="pre">der</span></code> files:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">openssl x509 -in servercert.pem -outform DER -out servercert.der</span>
<span class="go">openssl pkcs8 -topk8 -inform PEM -outform DER -nocrypt -in privkey.pem</span>
<span class="go">  -out privkey.der</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">der</span></code> files should be placed on the sample source at certificates
directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using UpdateHub Cloud server it is necessary update your own
<code class="docutils literal notranslate"><span class="pre">overlay-prj.conf</span></code> with option <a class="reference internal" href="../../../../kconfig.html#CONFIG_UPDATEHUB_CE" title="CONFIG_UPDATEHUB_CE"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_UPDATEHUB_CE</span></code></a> equal <code class="docutils literal notranslate"><span class="pre">n</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="step-3-configure-updatehub-sample">
<h3>Step 3: Configure UpdateHub Sample<a class="headerlink" href="#step-3-configure-updatehub-sample" title="Permalink to this headline">¶</a></h3>
<p>The updatehub have several Kconfig options that are necessary configure to
make it work or tune communication.</p>
<p>Set <a class="reference internal" href="../../../../kconfig.html#CONFIG_UPDATEHUB_CE" title="CONFIG_UPDATEHUB_CE"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_UPDATEHUB_CE</span></code></a> select between UpdateHub edition.  The <code class="docutils literal notranslate"><span class="pre">y</span></code>
value will select UpdateHub-CE otherwise <code class="docutils literal notranslate"><span class="pre">n</span></code> selects UpdateHub Cloud.</p>
<p>Set <a class="reference internal" href="../../../../kconfig.html#CONFIG_UPDATEHUB_SERVER" title="CONFIG_UPDATEHUB_SERVER"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_UPDATEHUB_SERVER</span></code></a> with your local IP address that runs the
UpdateHub-CE server edition.  If your are using a service provider a DNS name
is a valid option too.  This option is only valid when using UpdateHub-CE.</p>
<p>Set <a class="reference internal" href="../../../../kconfig.html#CONFIG_UPDATEHUB_POLL_INTERVAL" title="CONFIG_UPDATEHUB_POLL_INTERVAL"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_UPDATEHUB_POLL_INTERVAL</span></code></a> with the polling period of your
preference, remembering that the limit is between 0 and 43200 minutes
(30 days).  The default value is 1440 minutes (24h).</p>
<p>Set <a class="reference internal" href="../../../../kconfig.html#CONFIG_UPDATEHUB_PRODUCT_UID" title="CONFIG_UPDATEHUB_PRODUCT_UID"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_UPDATEHUB_PRODUCT_UID</span></code></a> with your product ID.  When using
UpdateHub-CE the valid is available at <code class="docutils literal notranslate"><span class="pre">overlay-prj.conf.example</span></code> file.</p>
</div>
<div class="section" id="step-4-build-updatehub-app">
<h3>Step 4: Build UpdateHub App<a class="headerlink" href="#step-4-build-updatehub-app" title="Permalink to this headline">¶</a></h3>
<p>In order to correctly build UpdateHub the overlay files must be use correctly.
More information about overlay files in <a class="reference internal" href="../../../../application/index.html#important-build-vars"><span class="std std-ref">Important Build System Variables</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is out of scope at this moment provide support for experimental
features.  However, the configuration and use is similar to the start
point indicated on the experimental network interface.</p>
</div>
<div class="section" id="step-4-1-build-for-ethernet">
<h4>Step 4.1: Build for Ethernet<a class="headerlink" href="#step-4-1-build-for-ethernet" title="Permalink to this headline">¶</a></h4>
<p>The ethernet depends only from base configuration.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b [ frdm_k64f | nucleo_f767zi ] -d build/app zephyr/samples/subsys/mgmt/updatehub -- -DOVERLAY_CONFIG=overlay-prj.conf</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-2-build-for-wifi">
<h4>Step 4.2: Build for WiFi<a class="headerlink" href="#step-4-2-build-for-wifi" title="Permalink to this headline">¶</a></h4>
<p>For WiFi, it needs add <code class="docutils literal notranslate"><span class="pre">overlay-wifi.conf</span></code>.  Here a shield provides WiFi
connectivity using, for instance, arduino headers.  See <a class="reference internal" href="../../../../boards/shields/esp_8266/doc/index.html#module-esp-8266"><span class="std std-ref">ESP-8266 Modules</span></a>
for details.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b [ frdm_k64f | nrf52840dk_nrf52840 | nucleo_f767zi ] -d build/app zephyr/samples/subsys/mgmt/updatehub -- -DSHIELD=esp_8266_arduino -DOVERLAY_CONFIG=&quot;overlay-wifi.conf;overlay-prj.conf&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The board disco_l475_iot1 is not supported.  The es-WIFI driver currently
doesn’t support UDP.</p>
</div>
</div>
<div class="section" id="step-4-3-build-for-modem">
<h4>Step 4.3: Build for Modem<a class="headerlink" href="#step-4-3-build-for-modem" title="Permalink to this headline">¶</a></h4>
<p>Modem needs add <code class="docutils literal notranslate"><span class="pre">overlay-modem.conf</span></code>.  Now, a DTC overlay file is used to
configure the glue between the modem and an arduino headers.  The modem config
uses PPP over GSM modem, see <a class="reference internal" href="../../../net/gsm_modem/README.html#gsm-modem-sample"><span class="std std-ref">Generic GSM Modem Sample</span></a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b [ frdm_k64f | nrf52840dk_nrf52840 | nucleo_f767zi ] -d build/app zephyr/samples/subsys/mgmt/updatehub -- -DOVERLAY_CONFIG=&quot;overlay-modem.conf;overlay-prj.conf&quot; \</span>
<span class="go">-DDTC_OVERLAY_FILE=arduino.overlay</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-4-build-for-ieee-802-15-4-experimental">
<h4>Step 4.4: Build for IEEE 802.15.4 [experimental]<a class="headerlink" href="#step-4-4-build-for-ieee-802-15-4-experimental" title="Permalink to this headline">¶</a></h4>
<p>For IEEE 802.15.4 needs add <code class="docutils literal notranslate"><span class="pre">overlay-802154.conf</span></code>.  This requires two nodes:
one will be the host and the second one will be the device under test.  The
validation needs a Linux kernel &gt;= 4.9 with all 6loWPAN support.  The start
point is try reproduce the Zephyr <a class="reference internal" href="../../../net/wpanusb/README.html#wpanusb-sample"><span class="std std-ref">wpanusb sample</span></a>. It is out of scope
at this moment provide support since it is experimental.  The gateway was
tested with both native linux driver and <code class="docutils literal notranslate"><span class="pre">atusb</span></code> and with <code class="docutils literal notranslate"><span class="pre">wpanusb</span></code> sample.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf52840dk_nrf52840 -d build/app zephyr/samples/subsys/mgmt/updatehub -- -DOVERLAY_CONFIG=&quot;overlay-802154.conf;overlay-prj.conf&quot;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b [ frdm_k64f | nucleo_f767zi ] -d build/app zephyr/samples/subsys/mgmt/updatehub -- -DSHIELD=atmel_rf2xx_arduino -DOVERLAY_CONFIG=&quot;overlay-802154.conf;overlay-prj.conf&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-5-build-for-ble-ipsp-experimental">
<h4>Step 4.5: Build for BLE IPSP [experimental]<a class="headerlink" href="#step-4-5-build-for-ble-ipsp-experimental" title="Permalink to this headline">¶</a></h4>
<p>The BLE IPSP needs <code class="docutils literal notranslate"><span class="pre">overlay-ipsp.conf</span></code>.  This may requires two nodes:
one will be the host and the second one will be the device under test.  The
validation needs a Linux kernel &gt;= 4.9 with all 6loWPAN support.  In this
particular case the Bluetooth 6LoWPAN module is needed. The start point is try
reproduce the Zephyr <a class="reference internal" href="../../../bluetooth/ipsp/README.html#bluetooth-ipsp-sample"><span class="std std-ref">Bluetooth: IPSP Sample</span></a>. It is out of scope
at this moment provide support since it is experimental.  The gateway was
tested with native linux driver and an USB dongle.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf52840dk_nrf52840 -d build/app zephyr/samples/subsys/mgmt/updatehub -- -DOVERLAY_CONFIG=&quot;overlay-ipsp.conf;overlay-prj.conf&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-6-build-for-openthread-network-experimental">
<h4>Step 4.6: Build for OpenThread Network [experimental]<a class="headerlink" href="#step-4-6-build-for-openthread-network-experimental" title="Permalink to this headline">¶</a></h4>
<p>The OpenThread requries the <code class="docutils literal notranslate"><span class="pre">overlay-ot.conf</span></code>.  It requires two nodes:
one will be the host NCP and the second one will be the device under test.  The
validation needs a Linux kernel &gt;= 4.9 with optional NAT-64 support.  The
start point is try reproduce the <a class="reference external" href="https://openthread.io/guides/border-router">OpenThread Router</a>. It is
out of scope at this moment provide support since it is experimental.  The
gateway was tested using two boards with OpenThread 1.1.1 on NCP mode.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf52840dk_nrf52840 -d build/app zephyr/samples/subsys/mgmt/updatehub -- -DOVERLAY_CONFIG=&quot;overlay-ot.conf;overlay-prj.conf&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-5-sign-the-app-image">
<h3>Step 5: Sign the app image<a class="headerlink" href="#step-5-sign-the-app-image" title="Permalink to this headline">¶</a></h3>
<p>The app image is the application itself that will be on the board.  This app
will connect to UpdateHub server and check for new images.  The image will be
loaded on the board with version 1.0.0.  It is important check what file
format you SoC tools uses.  In general, Zephyr can create images with binary
(<code class="docutils literal notranslate"><span class="pre">.bin</span></code>) image format or Intel’s (<code class="docutils literal notranslate"><span class="pre">.hex</span></code>) image format.</p>
<p>The Zephyr provide the <code class="docutils literal notranslate"><span class="pre">west</span></code> tool that simplify the signing process.  Just
call west with proper parameter values:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west sign -t imgtool -d build/app -- --version 1.0.0 --pad</span>
<span class="go">  --key bootloader/mcuboot/root-rsa-2048.pem</span>

<span class="go">=== image configuration:</span>
<span class="go">partition offset: 131072 (0x20000)</span>
<span class="go">partition size: 393216 (0x60000)</span>
<span class="go">rom start offset: 512 (0x200)</span>
<span class="go">=== signing binaries</span>
<span class="go">unsigned bin: &lt;zephyrdir&gt;/build/app/zephyr/zephyr.bin</span>
<span class="go">signed bin:   &lt;zephyrdir&gt;/build/app/zephyr/zephyr.signed.bin</span>
</pre></div>
</div>
</div>
<div class="section" id="step-6-flash-the-app-image">
<h3>Step 6: Flash the app image<a class="headerlink" href="#step-6-flash-the-app-image" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west flash -d build/app --bin-file build/app/zephyr/zephyr.signed.bin</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Command variation to flash a <code class="docutils literal notranslate"><span class="pre">hex</span></code> file:
<code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">flash</span> <span class="pre">-d</span> <span class="pre">build/app</span> <span class="pre">--hex-file</span> <span class="pre">build/app/zephyr/zephyr.signed.hex</span></code></p>
</div>
<p>At this point you can access a third terminal <code class="docutils literal notranslate"><span class="pre">terminal</span> <span class="pre">3</span></code> to check if image
is running.  Open the <code class="docutils literal notranslate"><span class="pre">terminal</span> <span class="pre">3</span></code> and press reset on your board:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">minicom -D /dev/ttyACM0</span>
</pre></div>
</div>
</div>
<div class="section" id="step-7-signing-the-binary-test-image">
<h3>Step 7: Signing the binary test image<a class="headerlink" href="#step-7-signing-the-binary-test-image" title="Permalink to this headline">¶</a></h3>
<p>The test image needs different parameters to add the signature.  Pay attention
to make sure you are creating the right signed image.  The test image will be
created with version 2.0.0 in this tutorial:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west sign --no-hex --bin -B build/zephyr-2.0.0.bin -t imgtool -d build/app --</span>
<span class="go">  --version 2.0.0 --key bootloader/mcuboot/root-rsa-2048.pem</span>

<span class="go">=== image configuration:</span>
<span class="go">partition offset: 131072 (0x20000)</span>
<span class="go">partition size: 393216 (0x60000)</span>
<span class="go">rom start offset: 512 (0x200)</span>
<span class="go">=== signing binaries</span>
<span class="go">unsigned bin: &lt;zephyrdir&gt;/build/app/zephyr/zephyr.bin</span>
<span class="go">signed bin:   build/zephyr-2.0.0.bin</span>
</pre></div>
</div>
</div>
<div class="section" id="step-8-create-a-package-with-updatehub-utilities-uhu">
<h3>Step 8: Create a package with UpdateHub Utilities (uhu)<a class="headerlink" href="#step-8-create-a-package-with-updatehub-utilities-uhu" title="Permalink to this headline">¶</a></h3>
<p>First, install UpdateHub Utilities (<code class="docutils literal notranslate"><span class="pre">uhu</span></code>) on your system, using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pip3 install --user uhu</span>
</pre></div>
</div>
<p>After installing uhu you will need to set the <code class="docutils literal notranslate"><span class="pre">product-uid</span></code>.  The value for
UpdateHub-CE can be found at <code class="docutils literal notranslate"><span class="pre">overlay-prj.conf.example</span></code> file.  For UpdateHub
Cloud, you need copy the value from the web interface.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uhu product use &quot;e4d37cfe6ec48a2d069cc0bbb8b078677e9a0d8df3a027c4d8ea131130c4265f&quot;</span>
</pre></div>
</div>
<p>Then, add the package and its mode (<code class="docutils literal notranslate"><span class="pre">zephyr</span></code>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uhu package add build/zephyr-2.0.0.bin -m zephyr</span>
</pre></div>
</div>
<p>Then inform what <code class="docutils literal notranslate"><span class="pre">version</span></code> this image is:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uhu package version 2.0.0</span>
</pre></div>
</div>
<p>And finally you can build the package by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uhu package archive --output build/zephyr-2.0.0.pkg</span>
</pre></div>
</div>
<p>The remaining steps are dedicated to UpdateHub-CE.  If you are using UpdateHub
Cloud you can find the proper procedure at <a class="reference external" href="https://docs.updatehub.io/">docs.updatehub.io</a>.</p>
</div>
<div class="section" id="step-9-add-the-package-to-server">
<h3>Step 9: Add the package to server<a class="headerlink" href="#step-9-add-the-package-to-server" title="Permalink to this headline">¶</a></h3>
<p>Now, add the package to the updatehub server.  Open your browser to the server
URL, <code class="docutils literal notranslate"><span class="pre">&lt;your-ip-address&gt;:8080</span></code>, and logging into the server using <code class="docutils literal notranslate"><span class="pre">admin</span></code>
as the login and password by default.  After logging in, click on the package
menu, then <code class="docutils literal notranslate"><span class="pre">UPLOAD</span> <span class="pre">PACKAGE</span></code>, and select the package built in step 8.</p>
</div>
<div class="section" id="step-10-register-device-on-server">
<h3>Step 10: Register device on server<a class="headerlink" href="#step-10-register-device-on-server" title="Permalink to this headline">¶</a></h3>
<p>If you chose <code class="docutils literal notranslate"><span class="pre">Manual</span></code>, register your device at updatehub server by using the
terminal session where you are debugging the board <code class="docutils literal notranslate"><span class="pre">terminal</span> <span class="pre">3</span></code>. Type the
following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">updatehub run</span>
</pre></div>
</div>
<p>If everything is alright, it will print on the screen <code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">update</span> <span class="pre">available</span></code>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">Polling</span></code> mode, the system will automatically register your device after
<a class="reference internal" href="../../../../kconfig.html#CONFIG_UPDATEHUB_POLL_INTERVAL" title="CONFIG_UPDATEHUB_POLL_INTERVAL"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_UPDATEHUB_POLL_INTERVAL</span></code></a> minutes.  The <code class="docutils literal notranslate"><span class="pre">updatehub</span> <span class="pre">run</span></code> can
be used to speed-up.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The message <code class="docutils literal notranslate"><span class="pre">Could</span> <span class="pre">not</span> <span class="pre">receive</span> <span class="pre">data</span></code> means that the application was not
able to reached the updatehub server for some reason.  The most common
cases are server down, missing network routes and forget to change the
content of <code class="docutils literal notranslate"><span class="pre">overlay-prj.conf</span></code> file.</p>
</div>
</div>
<div class="section" id="step-11-create-a-rollout">
<h3>Step 11: Create a rollout<a class="headerlink" href="#step-11-create-a-rollout" title="Permalink to this headline">¶</a></h3>
<p>In the browser where the UpdateHub-CE is open, click on <code class="docutils literal notranslate"><span class="pre">menu</span> <span class="pre">Rollout</span></code>
and then <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">ROLLOUT</span></code>.  Select the version of the package that you added
in step 9.  With that, the update is published, and the server is ready to
accept update requests.</p>
</div>
<div class="section" id="step-12-run-the-update">
<h3>Step 12: Run the update<a class="headerlink" href="#step-12-run-the-update" title="Permalink to this headline">¶</a></h3>
<p>Back in the terminal session that you used for debugging the board, type the
following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">updatehub run</span>
</pre></div>
</div>
<p>And then wait.  The board will probe the server, check if there are any new
updates, and then download the update package you’ve just created. If
everything goes fine the message <code class="docutils literal notranslate"><span class="pre">Image</span> <span class="pre">flashed</span> <span class="pre">successfully,</span> <span class="pre">you</span> <span class="pre">can</span> <span class="pre">reboot</span>
<span class="pre">now</span></code> will be printed on the terminal.  If you are using the <code class="docutils literal notranslate"><span class="pre">Polling</span></code> mode
the board will reboot automatically and Step 13 can be skipped.</p>
</div>
<div class="section" id="step-13-reboot-the-system">
<h3>Step 13: Reboot the system<a class="headerlink" href="#step-13-reboot-the-system" title="Permalink to this headline">¶</a></h3>
<p>In the terminal you used for debugging the board, type the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kernel reboot cold</span>
</pre></div>
</div>
<p>Your board will reboot and then start with the new image.  After rebooting,
the board will automatically ping the server again and the message <code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">update</span>
<span class="pre">available</span></code> will be printed on the terminal.  You can check the newer version
using the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">uart:~$ </span>updatehub info
<span class="go">Unique device id: acbdef0123456789</span>
<span class="go">Firmware Version: 2.0.0</span>
<span class="go">Product uid: e4d37cfe6ec48a2d069cc0bbb8b078677e9a0d8df3a027c4d8ea131130c4265f</span>
<span class="go">UpdateHub Server: &lt;server ip/dns&gt;</span>
<span class="gp">uart:~$</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hardware">
<h2>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h2>
<p>The below list of hardware have been used by UpdateHub team.</p>
<table class="colwidths-given docutils align-default" style="width: 800px">
<colgroup>
<col style="width: 5%" />
<col style="width: 45%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ID</p></th>
<th class="head"><p>Network Interface</p></th>
<th class="head"><p>Shield / Device</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Ethernet</p></td>
<td><p>Native</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>WIFI</p></td>
<td><p><a class="reference internal" href="../../../../boards/shields/esp_8266/doc/index.html#module-esp-8266"><span class="std std-ref">ESP-8266</span></a></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>MODEM (PPP)</p></td>
<td><p>SIMCOM 808</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>IEEE 802.15.4 (6loWPAN)</p></td>
<td><p>Native,
<a class="reference internal" href="../../../../boards/shields/atmel_rf2xx/doc/index.html#atmel-at86rf2xx-transceivers"><span class="std std-ref">RF2XX</span></a></p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>BLE IPSP (6loWPAN)</p></td>
<td><p>Native</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>OpenThread Network</p></td>
<td><p>Native</p></td>
</tr>
</tbody>
</table>
<table class="colwidths-given docutils align-default" style="width: 800px">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Board</p></th>
<th class="head"><p>Network Interface</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="../../../../boards/arm/frdm_k64f/doc/index.html#frdm-k64f"><span class="std std-ref">NXP FRDM-K64F</span></a></p></td>
<td><p>1, 2, 3, 4</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../../../boards/arm/nrf52840dk_nrf52840/doc/index.html#nrf52840dk-nrf52840"><span class="std std-ref">nRF52840 DK</span></a></p></td>
<td><p>2, 3, 4, 5, 6</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../../../boards/arm/nucleo_f767zi/doc/index.html#nucleo-f767zi-board"><span class="std std-ref">ST Nucleo F767ZI</span></a></p></td>
<td><p>1, 2, 3, 4</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Mar 05, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>