<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SMP Server Sample &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script type="module" src="../../../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../../../_static/js/ga-tracker.js"></script>
        <script src="../../../../../_static/tabs.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../../../copyright.html" />
    <link rel="next" title="Open Supervised Device Protocol (OSDP)" href="../../osdp/README.html" />
    <link rel="prev" title="Hawkbit Direct Device Integration API sample" href="../../hawkbit/README.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../index.html">
            <img src="../../../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.99
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/3.0.0/">3.0.0</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../security/index.html">Security</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Samples and Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../classic.html">Classic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../basic/basic.html">Basic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../userspace/index.html">Userspace Samples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../subsys.html">Various Subsystems Samples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../canbus/canbus.html">Controller Area Network (CAN) Bus Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../console/console.html">Console Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cpp/cpp.html">C++ Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../debug/index.html">Debug Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../display/display.html">Display Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../fs/fs.html">FS Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ipc/ipc.html">IPC Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../logging/logging.html">Logging Sample</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../mgmt.html">Management Samples</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../hawkbit/README.html">Hawkbit Direct Device Integration API sample</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">SMP Server Sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../osdp/README.html">Open Supervised Device Protocol (OSDP)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../updatehub/README.html">UpdateHub embedded Firmware Over-The-Air (FOTA) sample</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modbus/modbus.html">Modbus Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nvs/README.html">NVS: Non-Volatile Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../portability/portability.html">Portability Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../settings/README.html">Settings sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../shell/shell.html">Shell System Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../task_wdt/README.html">Task Watchdog Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../usb/usb.html">USB device support samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../video/video.html">Video Samples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../net/net.html">Networking Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../bluetooth/bluetooth.html">Bluetooth samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sensor/sensor.html">Sensor Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../arch/index.html">Architecture Dependent Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../boards/boards.html">Board-specific samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../drivers/drivers.html">Driver Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../application_development/application_development.html">Application development samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../shields/shields.html">Shields Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../posix/posix.html">POSIX Subsystem Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../kernel/index.html">Various Kernel and Scheduler Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tfm_integration/tfm_integration.html">TF-M Integration Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tfm_integration/tfm_integration.html#trusted-firmware-m-tf-m">Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../modules/index.html">External Module Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../compression/compression.html">Compression Samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/kconfig.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../../../index.html">Samples and Demos</a> &raquo;</li>
  
     <li><a href="../../../subsys.html">Various Subsystems Samples</a> &raquo;</li>
  
     <li><a href="../../mgmt.html">Management Samples</a> &raquo;</li>
  
  <li>SMP Server Sample</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main//samples/subsys/mgmt/mcumgr/smp_svr/README.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="smp-server-sample">
<span id="smp-svr-sample"></span><h1>SMP Server Sample<a class="headerlink" href="#smp-server-sample" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This sample application implements a Simple Management Protocol (SMP) server.
SMP is a basic transfer encoding for use with the MCUmgr management protocol.
For more information about MCUmgr and SMP, please see <a class="reference internal" href="../../../../../guides/device_mgmt/index.html#device-mgmt"><span class="std std-ref">Device Management</span></a>.</p>
<p>This sample application supports the following mcumgr transports by default:</p>
<blockquote>
<div><ul class="simple">
<li><p>Shell</p></li>
<li><p>Bluetooth</p></li>
<li><p>UDP</p></li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">smp_svr</span></code> enables support for the following command groups:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fs_mgmt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_mgmt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">os_mgmt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stat_mgmt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shell_mgmt</span></code></p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="caveats">
<h2>Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The MCUboot bootloader is required for <code class="docutils literal notranslate"><span class="pre">img_mgmt</span></code> to function
properly. More information about the Device Firmware Upgrade subsystem and
MCUboot can be found in <a class="reference internal" href="../../../../../guides/device_mgmt/dfu.html#mcuboot"><span class="std std-ref">MCUboot</span></a>.</p></li>
<li><p>The <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code> command-line tool only works with Bluetooth Low Energy (BLE)
on Linux and macOS. On Windows there is no support for Device Firmware
Upgrade over BLE yet.</p></li>
</ul>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installing-the-mcumgr-cli">
<h3>Installing the mcumgr cli<a class="headerlink" href="#installing-the-mcumgr-cli" title="Permalink to this headline">¶</a></h3>
<p>To interact remotely with the management subsystem on a device, we need to have the
<code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code> installed. Follow the instructions in the <a class="reference internal" href="../../../../../guides/device_mgmt/mcumgr.html#mcumgr-cli"><span class="std std-ref">Command-line Tool</span></a> section
of the Management subsystem documentation.</p>
</div>
<div class="section" id="building-a-ble-controller">
<h3>Building a BLE Controller<a class="headerlink" href="#building-a-ble-controller" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is only relevant for Linux users</p>
</div>
<p>If you want to try out Device Firmware Upgrade (DFU) over the air using
Bluetooth Low Energy (BLE) and do not have a built-in or pluggable BLE radio,
you can build one and use it following the instructions in
<a class="reference internal" href="../../../../bluetooth/hci_uart/README.html#bluetooth-hci-uart-bluez"><span class="std std-ref">Using the controller with BlueZ</span></a>.</p>
</div>
</div>
<div class="section" id="building-and-flashing-mcuboot">
<h2>Building and flashing MCUboot<a class="headerlink" href="#building-and-flashing-mcuboot" title="Permalink to this headline">¶</a></h2>
<p>The below steps describe how to build and run the MCUboot bootloader.
Detailed instructions can be found in the <a class="reference internal" href="../../../../../guides/device_mgmt/dfu.html#mcuboot"><span class="std std-ref">MCUboot</span></a> documentation page.</p>
<p>The Zephyr port of MCUboot is essentially a normal Zephyr application, which means that
we can build and flash it like normal using <code class="docutils literal notranslate"><span class="pre">west</span></code>, like so:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b &lt;board&gt; -d build_mcuboot bootloader/mcuboot/boot/zephyr</span>
<span class="go">west flash -d build_mcuboot</span>
</pre></div>
</div>
<p>Substitute &lt;board&gt; for one of the boards supported by the sample, see
<code class="file docutils literal notranslate"><span class="pre">sample.yaml</span></code>.</p>
</div>
<div class="section" id="building-the-sample-application">
<span id="smp-svr-sample-build"></span><h2>Building the sample application<a class="headerlink" href="#building-the-sample-application" title="Permalink to this headline">¶</a></h2>
<p>The below steps describe how to build and run the <code class="docutils literal notranslate"><span class="pre">smp_svr</span></code> sample in
Zephyr. The <code class="docutils literal notranslate"><span class="pre">smp_svr</span></code> sample comes in different flavours.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-Qmx1ZXRvb3Ro" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-Qmx1ZXRvb3Ro" name="Qmx1ZXRvb3Ro" role="tab" tabindex="0">Bluetooth</button><button aria-controls="panel-0-U2VyaWFs" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-U2VyaWFs" name="U2VyaWFs" role="tab" tabindex="-1">Serial</button><button aria-controls="panel-0-VVNCIENEQ19BQ00=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-VVNCIENEQ19BQ00=" name="VVNCIENEQ19BQ00=" role="tab" tabindex="-1">USB CDC_ACM</button><button aria-controls="panel-0-U2hlbGw=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="-1">Shell</button><button aria-controls="panel-0-VURQ" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-VURQ" name="VURQ" role="tab" tabindex="-1">UDP</button></div><div aria-labelledby="tab-0-Qmx1ZXRvb3Ro" class="sphinx-tabs-panel group-tab" id="panel-0-Qmx1ZXRvb3Ro" name="Qmx1ZXRvb3Ro" role="tabpanel" tabindex="0"><p>The sample application comes in two bluetooth flavours: a normal one and a tiny one
for resource constrained bluetooth devices.</p>
<p>To build the normal bluetooth sample:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build \</span>
<span class="go">   -b nrf52dk_nrf52832 \</span>
<span class="go">   samples/subsys/mgmt/mcumgr/smp_svr \</span>
<span class="go">   -- \</span>
<span class="go">   -DOVERLAY_CONFIG=overlay-bt.conf</span>
</pre></div>
</div>
<p>And to build the tiny bluetooth sample:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build \</span>
<span class="go">   -b nrf51dk_nrf51422 \</span>
<span class="go">   samples/subsys/mgmt/mcumgr/smp_svr \</span>
<span class="go">   -- \</span>
<span class="go">   -DOVERLAY_CONFIG=overlay-bt-tiny.conf</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-U2VyaWFs" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-U2VyaWFs" name="U2VyaWFs" role="tabpanel" tabindex="0"><p>To build the serial sample with file-system and shell management support:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build \</span>
<span class="go">   -b frdm_k64f \</span>
<span class="go">   samples/subsys/mgmt/mcumgr/smp_svr \</span>
<span class="go">   -- \</span>
<span class="go">   -DOVERLAY_CONFIG=&#39;overlay-serial.conf;overlay-fs.conf;overlay-shell-mgmt.conf&#39;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-VVNCIENEQ19BQ00=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-VVNCIENEQ19BQ00=" name="VVNCIENEQ19BQ00=" role="tabpanel" tabindex="0"><p>To build the serial sample with USB CDC_ACM backend:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build \</span>
<span class="go">   -b nrf52840dk_nrf52840 \</span>
<span class="go">   samples/subsys/mgmt/mcumgr/smp_svr \</span>
<span class="go">   -- \</span>
<span class="go">   -DOVERLAY_CONFIG=overlay-cdc.conf</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-U2hlbGw=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><p>To build the shell sample:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build \</span>
<span class="go">   -b frdm_k64f \</span>
<span class="go">   samples/subsys/mgmt/mcumgr/smp_svr \</span>
<span class="go">   -- \</span>
<span class="go">   -DOVERLAY_CONFIG=&#39;overlay-shell.conf&#39;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-VURQ" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-VURQ" name="VURQ" role="tabpanel" tabindex="0"><p>The UDP transport for SMP supports both IPv4 and IPv6.
In the sample, both IPv4 and IPv6 are enabled, but they can be
enabled and disabled separately.</p>
<p>To build the UDP sample:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build \</span>
<span class="go">   -b frdm_k64f \</span>
<span class="go">   samples/subsys/mgmt/mcumgr/smp_svr \</span>
<span class="go">   -- \</span>
<span class="go">   -DOVERLAY_CONFIG=overlay-udp.conf</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="signing-the-sample-image">
<span id="smp-svr-sample-sign"></span><h2>Signing the sample image<a class="headerlink" href="#signing-the-sample-image" title="Permalink to this headline">¶</a></h2>
<p>A key feature of MCUboot is that images must be signed before they can be successfully
uploaded and run on a target. To sign images, the MCUboot tool <code class="file docutils literal notranslate"><span class="pre">imgtool</span></code> can be used.</p>
<p>To sign the sample image we built in a previous step:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west sign -t imgtool -- --key bootloader/mcuboot/root-rsa-2048.pem</span>
</pre></div>
</div>
<p>The above command creates an image file called <code class="file docutils literal notranslate"><span class="pre">zephyr.signed.bin</span></code> in the
build directory.</p>
<p>For more information on image signing and <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">sign</span></code>, see the <a class="reference internal" href="../../../../../guides/west/sign.html#west-sign"><span class="std std-ref">Signing Binaries</span></a>
documentation.</p>
</div>
<div class="section" id="flashing-the-sample-image">
<h2>Flashing the sample image<a class="headerlink" href="#flashing-the-sample-image" title="Permalink to this headline">¶</a></h2>
<p>Upload the <code class="file docutils literal notranslate"><span class="pre">zephyr.signed.bin</span></code> file from the previous to image slot-0 of your
board.  See <a class="reference internal" href="../../../../../reference/storage/flash_map/flash_map.html#flash-map-api"><span class="std std-ref">Flash map</span></a> for details on flash partitioning.</p>
<p>To upload the initial image file to an empty slot-0, we simply use <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">flash</span></code>
like normal. <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">flash</span></code> will automatically detect slot-0 address and confirm
the image.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west flash --bin-file build/zephyr/zephyr.signed.bin</span>
</pre></div>
</div>
<p>We need to explicity specify the <em>signed</em> image file, otherwise the non-signed version
will be used and the image wont be runnable.</p>
<div class="section" id="sample-image-hello-world">
<h3>Sample image: hello world!<a class="headerlink" href="#sample-image-hello-world" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">smp_svr</span></code> app is ready to run.  Just reset your board and test the app
with the <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code> command-line tool’s <code class="docutils literal notranslate"><span class="pre">echo</span></code> functionality, which will
send a string to the remote target device and have it echo it back:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-Qmx1ZXRvb3Ro" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-Qmx1ZXRvb3Ro" name="Qmx1ZXRvb3Ro" role="tab" tabindex="0">Bluetooth</button><button aria-controls="panel-1-U2hlbGw=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="-1">Shell</button><button aria-controls="panel-1-VURQ" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-VURQ" name="VURQ" role="tab" tabindex="-1">UDP</button></div><div aria-labelledby="tab-1-Qmx1ZXRvb3Ro" class="sphinx-tabs-panel group-tab" id="panel-1-Qmx1ZXRvb3Ro" name="Qmx1ZXRvb3Ro" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo mcumgr --conntype ble --connstring ctlr_name=hci0,peer_name=&#39;Zephyr&#39; echo hello</span>
<span class="go">hello</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-U2hlbGw=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mcumgr --conntype serial --connstring &quot;/dev/ttyACM0,baud=115200&quot; echo hello</span>
<span class="go">hello</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-VURQ" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-VURQ" name="VURQ" role="tabpanel" tabindex="0"><p>Using IPv4:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mcumgr --conntype udp --connstring=[192.168.1.1]:1337 echo hello</span>
<span class="go">hello</span>
</pre></div>
</div>
<p>And using IPv6</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mcumgr --conntype udp --connstring=[2001:db8::1]:1337 echo hello</span>
<span class="go">hello</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code> command-line tool requires a connection string in order
to identify the remote target device. In the BT sample we use a BLE-based
connection string, and you might need to modify it depending on the
BLE controller you are using.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the following sections, examples will use <code class="docutils literal notranslate"><span class="pre">&lt;connection</span> <span class="pre">string&gt;</span></code> to represent
the <code class="docutils literal notranslate"><span class="pre">--conntype</span> <span class="pre">&lt;type&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">--connstring=&lt;string&gt;</span></code> <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code> parameters.</p>
</div>
</div>
</div>
<div class="section" id="device-firmware-upgrade-dfu">
<h2>Device Firmware Upgrade (DFU)<a class="headerlink" href="#device-firmware-upgrade-dfu" title="Permalink to this headline">¶</a></h2>
<p>Now that the SMP server is running on your board and you are able to communicate
with it using <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code>, you might want to test what is commonly called
“OTA DFU”, or Over-The-Air Device Firmware Upgrade. This works for both BT and UDP.</p>
<p>The general sequence of a DFU process is as follows:</p>
<ul class="simple">
<li><p>Build an MCUboot enabled application, see <a class="reference internal" href="#smp-svr-sample-build"><span class="std std-ref">Building the sample application</span></a></p></li>
<li><p>Sign the application image, see <a class="reference internal" href="#smp-svr-sample-sign"><span class="std std-ref">Signing the sample image</span></a></p></li>
<li><p>Upload the signed image using <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code></p></li>
<li><p>Listing the images on the device using <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code></p></li>
<li><p>Mark the uploaded image for testing using <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code></p></li>
<li><p>Reset the device remotely using <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code></p></li>
<li><p>Confirm the uploaded image using <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code> (optional)</p></li>
</ul>
<div class="section" id="direct-image-upload-and-image-mapping-to-mcuboot-slot">
<h3>Direct image upload and Image mapping to MCUboot slot<a class="headerlink" href="#direct-image-upload-and-image-mapping-to-mcuboot-slot" title="Permalink to this headline">¶</a></h3>
<p>Currently the mcumgr supports, for direct upload, 4 target images, of which first two are mapped
into MCUboot primary (slot-0) and secondary (slot-1) respectively.</p>
<p>The mcumgr <code class="docutils literal notranslate"><span class="pre">image</span> <span class="pre">upload</span></code> command may be provided optional <code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">-n</span> <span class="pre">&lt;image&gt;</span></code> parameter that will
select target image for upload; when parameter is no provided, 0 is assumed, which means “default
behaviour”, and it performs upload to the “image-1”, the MCUboot secondary slot.</p>
<p>For clarity, here is DTS label to slot to <code class="docutils literal notranslate"><span class="pre">&lt;image&gt;</span></code> translation table:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 26%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>DTS label</p></th>
<th class="head"><p>Slot</p></th>
<th class="head"><p>-n &lt;image&gt;</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>“image-0”</p></td>
<td><p>slot-0</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>“image-1”</p></td>
<td><p>slot-1</p></td>
<td><p>0, 1</p></td>
</tr>
<tr class="row-even"><td><p>“image-2”</p></td>
<td></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>“image-3”</p></td>
<td></td>
<td><p>3</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-e</span></code> option actually means “no erase”, and is provided to the mcumgr
to prevent it from sending erase command to target, before updating image.
The options is always needed when <code class="docutils literal notranslate"><span class="pre">-n</span></code> is used for image selection,
as the erase command is hardcoded to erase slot-1 (“image-1”),
regardless of which slot is uploaded at the time.</p>
</div>
</div>
<div class="section" id="upload-the-signed-image">
<h3>Upload the signed image<a class="headerlink" href="#upload-the-signed-image" title="Permalink to this headline">¶</a></h3>
<p>To upload the signed image, use the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo mcumgr &lt;connection string&gt; image upload build/zephyr/zephyr.signed.bin</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At the beginning of the upload process, the target might start erasing
the image slot, taking several dozen seconds for some targets.  This might
cause an NMP timeout in the management protocol tool. Use the
<code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">&lt;timeout-in-seconds</span></code> option to increase the response timeout for the
<code class="docutils literal notranslate"><span class="pre">mcumgr</span></code> command line tool if this occurs.</p>
</div>
</div>
<div class="section" id="list-the-images">
<h3>List the images<a class="headerlink" href="#list-the-images" title="Permalink to this headline">¶</a></h3>
<p>We can now obtain a list of images (slot-0 and slot-1) present in the remote
target device by issuing the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo mcumgr &lt;connection string&gt; image list</span>
</pre></div>
</div>
<p>This should print the status and hash values of each of the images present.</p>
</div>
<div class="section" id="test-the-image">
<h3>Test the image<a class="headerlink" href="#test-the-image" title="Permalink to this headline">¶</a></h3>
<p>In order to instruct MCUboot to swap the images we need to test the image first,
making sure it boots:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo mcumgr &lt;connection string&gt; image test &lt;hash of slot-1 image&gt;</span>
</pre></div>
</div>
<p>Now MCUBoot will swap the image on the next reset.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is not yet any way of getting the image hash without actually uploading the
image and getting the hash by using the <code class="docutils literal notranslate"><span class="pre">image</span> <span class="pre">list</span></code> command of <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code>.</p>
</div>
</div>
<div class="section" id="reset-remotely">
<h3>Reset remotely<a class="headerlink" href="#reset-remotely" title="Permalink to this headline">¶</a></h3>
<p>We can reset the device remotely to observe (use the console output) how
MCUboot swaps the images:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo mcumgr &lt;connection string&gt; reset</span>
</pre></div>
</div>
<p>Upon reset MCUboot will swap slot-0 and slot-1.</p>
</div>
<div class="section" id="confirm-new-image">
<h3>Confirm new image<a class="headerlink" href="#confirm-new-image" title="Permalink to this headline">¶</a></h3>
<p>The new image is now loaded into slot-0, but it will be swapped back into slot-1
on the next reset unless the image is confirmed. To confirm the new image:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo mcumgr &lt;connection string&gt; image confirm</span>
</pre></div>
</div>
<p>Note that if you try to send the very same image that is already flashed in
slot-0 then the procedure will not complete successfully since the hash values
for both slots will be identical.</p>
</div>
</div>
<div class="section" id="download-file-from-file-system">
<h2>Download file from File System<a class="headerlink" href="#download-file-from-file-system" title="Permalink to this headline">¶</a></h2>
<p>SMP server supports downloading files from File System on device via
<code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code>. This is useful with FS log backend, when files are stored in
non-volatile memory. Build and flash both MCUboot and smp_svr applications and
then use <code class="file docutils literal notranslate"><span class="pre">mcumgr</span></code> with <code class="file docutils literal notranslate"><span class="pre">download</span></code> command, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mcumgr --conntype serial --connstring=&#39;dev=/dev/ttyACM0,baud=115200&#39; \</span>
<span class="go">fs download /lfs/log.0000 ~/log.txt</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Mar 05, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>