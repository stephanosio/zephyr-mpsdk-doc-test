<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>USB Mass Storage Sample Application &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script type="module" src="../../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../../_static/js/ga-tracker.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../../copyright.html" />
    <link rel="next" title="Testusb application sample" href="../testusb/README.html" />
    <link rel="prev" title="USB HID Sample Application" href="../hid/README.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html">
            <img src="../../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../security/index.html">Security</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Samples and Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../classic.html">Classic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basic/basic.html">Basic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../userspace/index.html">Userspace Samples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../subsys.html">Various Subsystems Samples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../canbus/canbus.html">Controller Area Network (CAN) Bus Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../console/console.html">Console Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cpp/cpp.html">C++ Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../debug/index.html">Debug Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../display/display.html">Display Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fs/fs.html">FS Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ipc/ipc.html">IPC Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../logging/logging.html">Logging Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mgmt/mgmt.html">Management Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../modbus/modbus.html">Modbus Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../nvs/README.html">NVS: Non-Volatile Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../portability/portability.html">Portability Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../settings/README.html">Settings sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../shell/shell.html">Shell System Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../task_wdt/README.html">Task Watchdog Sample</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../usb.html">USB device support samples</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../audio/headphones_microphone/README.html">USB Audio Sample Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="../audio/headset/README.html">USB Audio Sample Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cdc_acm/README.html">USB CDC ACM Sample Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cdc_acm_composite/README.html">USB CDC ACM Sample Composite Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="../console/README.html">Console over CDC ACM UART Sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dfu/README.html">USB DFU Sample Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="../hid-cdc/README.html">USB HID CDC ACM Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="../hid-mouse/README.html">USB HID mouse Sample Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="../hid/README.html">USB HID Sample Application</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">USB Mass Storage Sample Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="../testusb/README.html">Testusb application sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="../webusb/README.html">WebUSB sample application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../video/video.html">Video Samples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../net/net.html">Networking Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../bluetooth/bluetooth.html">Bluetooth samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensor/sensor.html">Sensor Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arch/index.html">Architecture Dependent Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../boards/boards.html">Board-specific samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../drivers/drivers.html">Driver Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../application_development/application_development.html">Application development samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../shields/shields.html">Shields Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../posix/posix.html">POSIX Subsystem Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kernel/index.html">Various Kernel and Scheduler Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tfm_integration/tfm_integration.html">TF-M Integration Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tfm_integration/tfm_integration.html#trusted-firmware-m-tf-m">Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/index.html">External Module Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../compression/compression.html">Compression Samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../../index.html">Samples and Demos</a> &raquo;</li>
  
     <li><a href="../../subsys.html">Various Subsystems Samples</a> &raquo;</li>
  
     <li><a href="../usb.html">USB device support samples</a> &raquo;</li>
  
  <li>USB Mass Storage Sample Application</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main//samples/subsys/usb/mass/README.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="usb-mass-storage-sample-application">
<span id="usb-mass"></span><h1>USB Mass Storage Sample Application<a class="headerlink" href="#usb-mass-storage-sample-application" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This sample app demonstrates use of a USB Mass Storage driver by the Zephyr
project. This very simple driver enumerates a board with either RAM or FLASH
into an USB disk.  This sample can be found under
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/subsys/usb/mass">samples/subsys/usb/mass</a> in the Zephyr project tree.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>This project requires a USB device driver, and either 32KiB (96KiB optional)
of RAM or a FLASH device.</p>
</div>
<div class="section" id="building-and-running">
<h2>Building and Running<a class="headerlink" href="#building-and-running" title="Permalink to this headline">¶</a></h2>
<p>This sample can be built for multiple boards, customized through overlays found
in <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/subsys/usb/mass/boards">samples/subsys/usb/mass/boards</a> in the Zephyr project tree.
The selection between a RAM-based or a FLASH-based disk and file system
can be chosen passing Kconfig configuration via the -D command-line switch.</p>
<div class="section" id="ram-disk-example-without-any-file-system">
<h3>RAM-disk Example without any file system<a class="headerlink" href="#ram-disk-example-without-any-file-system" title="Permalink to this headline">¶</a></h3>
<p>The default configurations selects RAM-based disk without any file system.
This example only needs additional 32KiB RAM for the RAM-disk and is intended
for testing USB mass storage class implementation.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b reel_board samples/subsys/usb/mass</span>
</pre></div>
</div>
</div>
<div class="section" id="fat-fs-example">
<h3>FAT FS Example<a class="headerlink" href="#fat-fs-example" title="Permalink to this headline">¶</a></h3>
<p>If more than 96KiB are available, FAT files system can be used
with a RAM-disk. Alternatively it is possible with the FLASH-based disk.
In this example we will build the sample with a RAM-based disk:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b reel_board samples/subsys/usb/mass -- -DCONFIG_APP_MSC_STORAGE_RAM=y</span>
</pre></div>
</div>
<p>In this example we will build the sample with a FLASH-based disk and FAT
file system for Adafruit Feather nRF52840 Express.  This board configures
to use the external 16 MiBi QSPI flash chip with a 2 MiBy FAT partition.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b adafruit_feather_nrf52840 samples/subsys/usb/mass -- -DCONFIG_APP_MSC_STORAGE_FLASH_FATFS=y</span>
</pre></div>
</div>
<p>After you have built and flashed the sample app image to your board, plug the
board into a host device, for example, a PC running Linux.
The board will be detected as shown by the Linux journalctl command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>journalctl -k -n <span class="m">17</span>
<span class="go">usb 2-2.4: new full-speed USB device number 29 using xhci_hcd</span>
<span class="go">usb 2-2.4: New USB device found, idVendor=2fe3, idProduct=0008, bcdDevice= 2.03</span>
<span class="go">usb 2-2.4: New USB device strings: Mfr=1, Product=2, SerialNumber=3</span>
<span class="go">usb 2-2.4: Product: Zephyr MSC sample</span>
<span class="go">usb 2-2.4: Manufacturer: ZEPHYR</span>
<span class="go">usb 2-2.4: SerialNumber: 86FE679A598AC47A</span>
<span class="go">usb-storage 2-2.4:1.0: USB Mass Storage device detected</span>
<span class="go">scsi host3: usb-storage 2-2.4:1.0</span>
<span class="go">scsi 3:0:0:0: Direct-Access     ZEPHYR   ZEPHYR USB DISK  0.01 PQ: 0 ANSI: 0 CCS</span>
<span class="go">sd 3:0:0:0: Attached scsi generic sg4 type 0</span>
<span class="go">sd 3:0:0:0: [sdb] 256 512-byte logical blocks: (131 kB/128 KiB)</span>
<span class="go">sd 3:0:0:0: [sdb] Write Protect is off</span>
<span class="go">sd 3:0:0:0: [sdb] Mode Sense: 03 00 00 00</span>
<span class="go">sd 3:0:0:0: [sdb] No Caching mode page found</span>
<span class="go">sd 3:0:0:0: [sdb] Assuming drive cache: write through</span>
<span class="go"> sdb:</span>
<span class="go">sd 3:0:0:0: [sdb] Attached SCSI removable disk</span>
</pre></div>
</div>
<p>The output to the console will look something like this
(file system contents will be different):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>*** Booting Zephyr OS build zephyr-v2.3.0-1991-g4c8d1496eafb  ***
Area 4 at 0x0 on GD25Q16 for 2097152 bytes
Mount /NAND:: 0
/NAND:: bsize = 512 ; frsize = 1024 ; blocks = 2028 ; bfree = 1901
/NAND: opendir: 0
  F 0 SAMPLE.TXT
End of files
[00:00:00.077,423] &lt;inf&gt; main: The device is put in USB mass storage mode.
</pre></div>
</div>
<p>On most operating systems the drive will be automatically mounted.</p>
</div>
<div class="section" id="sd-card-example">
<h3>SD Card Example<a class="headerlink" href="#sd-card-example" title="Permalink to this headline">¶</a></h3>
<p>This example requires SD card support, see <a class="reference internal" href="../../../../reference/storage/disk/access.html#disk-access-api"><span class="std std-ref">Disk Access</span></a>, and
a SD card formatted with FAT filesystem.</p>
<p>If a board with SD card controller is available, the example can be built as
follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b mimxrt1050_evk samples/subsys/usb/mass -- -DCONFIG_APP_MSC_STORAGE_SDCARD=y</span>
</pre></div>
</div>
<p>In case the board has no support for SD card controller, but the card can
be connected to SPI using e.g. a shield, example can be built as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf52840dk_nrf52840 samples/subsys/usb/mass -- -DSHIELD=waveshare_epaper_gdeh0154a07 -DCONFIG_APP_MSC_STORAGE_SDCARD=y</span>
</pre></div>
</div>
<p>Depending on the size of the media it can take time until the file system has
initialized the card and it is available via USB. It should also be noted that
the transfer speed over SPI is very slow.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>*** Booting Zephyr OS build v2.5.0-rc3-73-gd85067f0a759  ***
Mount /SD:: 0
[00:00:00.281,585] &lt;inf&gt; sdhc_spi: Found a ~3751 MiB SDHC card.
[00:00:00.282,867] &lt;inf&gt; sdhc_spi: Manufacturer ID=27 OEM=&#39;SM&#39; Name=&#39;00000&#39; Revision=0x10 Serial=0x16fdd47b
[00:00:00.308,654] &lt;inf&gt; sdhc_spi: Found a ~3751 MiB SDHC card.
[00:00:00.309,906] &lt;inf&gt; sdhc_spi: Manufacturer ID=27 OEM=&#39;SM&#39; Name=&#39;00000&#39; Revision=0x10 Serial=0x16fdd47b
/SD:: bsize = 512 ; frsize = 32768 ; blocks = 119776 ; bfree = 119773
/SD: opendir: 0
  D 0 42
  F 1111 TEST.TXT
End of files
[00:00:18.588,043] &lt;inf&gt; main: The device is put in USB mass storage mode.
</pre></div>
</div>
</div>
<div class="section" id="littlefs-example">
<h3>LittleFS Example<a class="headerlink" href="#littlefs-example" title="Permalink to this headline">¶</a></h3>
<p>This board configures to use the external 64 MiBi QSPI flash chip with a
128 KiBy <a class="reference external" href="https://github.com/ARMmbed/littlefs">littlefs</a> partition compatible with the one produced by the
<a class="reference internal" href="../../fs/littlefs/README.html#littlefs-sample"><span class="std std-ref">littlefs File System Sample Application</span></a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf52840dk_nrf52840 samples/subsys/usb/mass -- -DCONFIG_APP_MSC_STORAGE_FLASH_LITTLEFS=y</span>
</pre></div>
</div>
<p>After you have built and flashed the sample app image to your board,
connect the board’s two USB connectors (debug and nRF USB) to a host
running a littlefs-FUSE-capable operating system.  The output to the
console will look something like this (file system contents will be
different):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>*** Booting Zephyr OS build zephyr-v2.2.0-1966-g7815942d5fc5  ***
Area 4 at 0x0 on MX25R64 for 65536 bytes
[00:00:00.005,310] &lt;inf&gt; main: The device is put in USB mass storage mode.

[00:00:00.009,002] &lt;inf&gt; littlefs: LittleFS version 2.2, disk version 2.0
[00:00:00.009,063] &lt;inf&gt; littlefs: FS at MX25R64:0x0 is 16 0x1000-byte blocks with 512 cye
[00:00:00.009,063] &lt;inf&gt; littlefs: sizes: rd 16 ; pr 16 ; ca 64 ; la 32
[00:00:00.011,718] &lt;inf&gt; littlefs: /lfs mounted
Mount /lfs: 0
/lfs: bsize = 16 ; frsize = 4096 ; blocks = 16 ; bfree = 13
/lfs opendir: 0
  F 8 hi
  F 128 linux
  F 5 newfile
End of files
</pre></div>
</div>
<p>For information on mounting littlefs file system on Linux or FreeBSD
systems refer to the “littlefs Usage” section below.</p>
</div>
<div class="section" id="littlefs-usage">
<h3>littlefs Usage<a class="headerlink" href="#littlefs-usage" title="Permalink to this headline">¶</a></h3>
<p>While a FAT-based file system can be mounted by many systems automatically,
mounting the littlefs file system on a Linux or FreeBSD system can be
accomplished using the <a class="reference external" href="https://github.com/ARMmbed/littlefs-fuse">littlefs-FUSE</a> utility.</p>
<p>First determine the local device name from the system log, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Apr 25 08:10:25 tirzah kernel: [570310.921039] scsi 17:0:0:0: Direct-Access     ZEPHYR   ZEPHYR USB DISK  0.01 PQ: 0 ANSI: 0 CCS
Apr 25 08:10:25 tirzah kernel: [570310.921550] sd 17:0:0:0: Attached scsi generic sg4 type 0
Apr 25 08:10:25 tirzah kernel: [570310.922277] sd 17:0:0:0: [sdd] 256 512-byte logical blocks: (131 kB/128 KiB)
Apr 25 08:10:25 tirzah kernel: [570310.922696] sd 17:0:0:0: [sdd] Write Protect is off
</pre></div>
</div>
<p>This shows that the block device associated with the USB drive is
<code class="docutils literal notranslate"><span class="pre">/dev/sdd</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tirzah<span class="o">[</span><span class="m">447</span><span class="o">]</span>$ ll /dev/sdd
brw-rw---- <span class="m">1</span> root disk <span class="m">8</span>, <span class="m">48</span> Apr <span class="m">25</span> <span class="m">08</span>:10 /dev/sdd
</pre></div>
</div>
<p>This can be mounted as a file system with the following commands:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo chmod a+rw /dev/sdd   <span class="c1"># required to allow user access</span>
mkdir /tmp/lfs
lfs <span class="se">\</span>
       --read_size<span class="o">=</span><span class="m">16</span> <span class="se">\</span>
       --prog_size<span class="o">=</span><span class="m">16</span> <span class="se">\</span>
       --block_size<span class="o">=</span><span class="m">4096</span> <span class="se">\</span>
       --block_count<span class="o">=</span><span class="m">32</span> <span class="se">\</span>
       --cache_size<span class="o">=</span><span class="m">64</span> <span class="se">\</span>
       --lookahead_size<span class="o">=</span><span class="m">32</span> <span class="se">\</span>
       /dev/sdd /tmp/lfs
</pre></div>
</div>
<p>which produces output like this (disk contents will vary):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tirzah[467]$ ls -l /tmp/lfs
total 0
-rwxrwxrwx 0 root root   8 Dec 31  1969 hi
-rwxrwxrwx 0 root root 128 Dec 31  1969 linux
-rwxrwxrwx 0 root root   5 Dec 31  1969 newfile
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">lfs</span></code> is a mount command and you should take care to unmount the
device before removing the USB drive:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>umount /tmp/lfs
</pre></div>
</div>
<div class="section" id="littlefs-parameter-selection">
<h4>littlefs parameter selection<a class="headerlink" href="#littlefs-parameter-selection" title="Permalink to this headline">¶</a></h4>
<p>Be aware that the parameters passed to <strong class="command">lfs</strong> in the example
above <strong>must</strong> exactly match the corresponding parameters used to
initialize the file system.  The required parameters can be observed
from the Zephyr mount log messages:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[00:00:00.009,002] &lt;inf&gt; littlefs: LittleFS version 2.2, disk version 2.0
[00:00:00.009,063] &lt;inf&gt; littlefs: FS at MX25R64:0x0 is 16 0x1000-byte blocks with 512 cye
[00:00:00.009,063] &lt;inf&gt; littlefs: sizes: rd 16 ; pr 16 ; ca 64 ; la 32
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--read_size</span></code> corresponds to the <code class="docutils literal notranslate"><span class="pre">rd</span></code> size and is 16;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--prog_size</span></code> corresponds to the <code class="docutils literal notranslate"><span class="pre">pr</span></code> size and is 16;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--block_size</span></code> comes from <code class="docutils literal notranslate"><span class="pre">0x1000-byte</span> <span class="pre">blocks</span></code> and is 4096 (0x1000);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--block_count</span></code> comes from <code class="docutils literal notranslate"><span class="pre">16</span> <span class="pre">0x1000-byte</span> <span class="pre">blocks</span></code> and is 16;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--cache_size</span></code> comes from the <code class="docutils literal notranslate"><span class="pre">ca</span></code> size and is 64;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--lookahead_size</span></code> comes from the <code class="docutils literal notranslate"><span class="pre">la</span></code> size and is 32</p></li>
</ul>
<p>If any of the parameters are inconsistent between the Zephyr and Linux
specification the file system will not mount correctly.</p>
</div>
</div>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>