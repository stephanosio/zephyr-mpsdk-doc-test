<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TF-M PSA crypto &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script type="module" src="../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="PSA Protected Storage" href="../psa_protected_storage/README.html" />
    <link rel="prev" title="TF-M Integration Samples" href="../tfm_integration.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.99
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/3.0.0/">3.0.0</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Samples and Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../classic.html">Classic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html">Basic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../userspace/index.html">Userspace Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsys/subsys.html">Various Subsystems Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../net/net.html">Networking Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth/bluetooth.html">Bluetooth samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sensor/sensor.html">Sensor Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../arch/index.html">Architecture Dependent Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../boards/boards.html">Board-specific samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../drivers/drivers.html">Driver Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../application_development/application_development.html">Application development samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shields/shields.html">Shields Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../posix/posix.html">POSIX Subsystem Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kernel/index.html">Various Kernel and Scheduler Samples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tfm_integration.html">TF-M Integration Samples</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">TF-M PSA crypto</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#key-files">Key Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-and-running">Building and Running</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../psa_protected_storage/README.html">PSA Protected Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tfm_ipc/README.html">TF-M IPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tfm_psa_test/README.html">TF-M Platform Security Architecture Test Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tfm_regression_test/README.html">TF-M Regression Test Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tfm_secure_partition/README.html">TF-M Secure Partition Sample</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tfm_integration.html#trusted-firmware-m-tf-m">Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/index.html">External Module Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../compression/compression.html">Compression Samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/kconfig.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../index.html">Samples and Demos</a> &raquo;</li>
  
     <li><a href="../tfm_integration.html">TF-M Integration Samples</a> &raquo;</li>
  
  <li>TF-M PSA crypto</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main//samples/tfm_integration/psa_crypto/README.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="tf-m-psa-crypto">
<span id="tfm-psa-crypto"></span><h1>TF-M PSA crypto<a class="headerlink" href="#tf-m-psa-crypto" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This TF-M integration example demonstrates how to use the PSA crypto API in
Zephyr for cryptography and device certificate signing request. In addition,
this example also demonstrates certain TF-M features that are covered as part
of the RTOS vendor requirements for a <a class="reference external" href="https://www.psacertified.org/security-certification/psa-certified-level-1/">PSA Certified Level 1</a> product, such
as secure storage for config data, initial attestation for device
verification.</p>
<p>Trusted Firmware (TF-M) Platform Security Architecture (PSA) APIs
are used for the secure processing environment, with Zephyr running in the
non-secure processing environment.</p>
<p>It uses <strong>IPC Mode</strong> for communication, where an IPC mechanism is inserted to
handle secure TF-M API calls and responses.</p>
<p>The sample prints test info to the console either as a single-thread or
multi-thread application.</p>
</div>
<div class="section" id="key-files">
<h2>Key Files<a class="headerlink" href="#key-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="psa-crypto-c">
<h3><code class="docutils literal notranslate"><span class="pre">psa_crypto.c</span></code><a class="headerlink" href="#psa-crypto-c" title="Permalink to this headline">¶</a></h3>
<p>Demonstrates hash, sign/verify workflow:</p>
<ul class="simple">
<li><p>Generate/import a persistent key: secp256r1 (usage: ecdsa-with-SHA256)</p></li>
<li><p>Display the public key based on the private key data above</p></li>
<li><p>Calculate the SHA256 hash of a payload</p></li>
<li><p>Sign the hash with the persistent key</p></li>
<li><p>Verify the signature using the public key</p></li>
<li><p>Destroy the key</p></li>
</ul>
<p>Also demonstrates device certificate signing request (CSR) workflow:</p>
<ul class="simple">
<li><p>Generate/import a persistent key: secp256r1 (usage: ecdsa-with-SHA256)</p></li>
<li><p>Set subject name in device CSR</p></li>
<li><p>Generate device CSR in PEM format</p></li>
<li><p>Encode device CSR as JSON</p></li>
</ul>
<p>Importing/generating the persistent key is based on config option
<code class="docutils literal notranslate"><span class="pre">PSA_IMPORT_KEY</span></code>. When <code class="docutils literal notranslate"><span class="pre">PSA_IMPORT_KEY</span></code> is enabled,
the key data can be static if <code class="docutils literal notranslate"><span class="pre">PRIVATE_KEY_STATIC</span></code> is set or key data
is generated using <code class="docutils literal notranslate"><span class="pre">psa_generate_random</span></code> if <code class="docutils literal notranslate"><span class="pre">PRIVATE_KEY_RANDOM</span></code>
is set.</p>
</div>
<div class="section" id="psa-attestation-c">
<h3><code class="docutils literal notranslate"><span class="pre">psa_attestation.c</span></code><a class="headerlink" href="#psa-attestation-c" title="Permalink to this headline">¶</a></h3>
<p>Demonstrates how to request an initial attestation token (IAT) from the TF-M
secure processing environment (SPE).</p>
</div>
</div>
<div class="section" id="building-and-running">
<h2>Building and Running<a class="headerlink" href="#building-and-running" title="Permalink to this headline">¶</a></h2>
<p>This project outputs startup status and info to the console. It can be built and
executed on an ARM Cortex M33 target board or QEMU.</p>
<p>This sample will only build on a Linux or macOS development system
(not Windows), and has been tested on the following setups:</p>
<ul class="simple">
<li><p>macOS Mojave using QEMU 4.2.0 with gcc-arm-none-eabi-7-2018-q2-update</p></li>
<li><p>macOS Mojave with gcc-arm-none-eabi-7-2018-q2-update</p></li>
<li><p>Ubuntu 18.04 using Zephyr SDK 0.11.2</p></li>
</ul>
<div class="section" id="tf-m-bl2-logs">
<h3>TF-M BL2 logs<a class="headerlink" href="#tf-m-bl2-logs" title="Permalink to this headline">¶</a></h3>
<dl>
<dt>Add the following to <code class="docutils literal notranslate"><span class="pre">prj.conf</span></code> to see the logs from TF-M BL2:</dt><dd><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CONFIG_TFM_BL2</span><span class="o">=</span>y
<span class="nv">CONFIG_TFM_CMAKE_BUILD_TYPE_DEBUG</span><span class="o">=</span>y
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="on-mps2-an521">
<h3>On MPS2+ AN521:<a class="headerlink" href="#on-mps2-an521" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Build Zephyr with a non-secure configuration
(<code class="docutils literal notranslate"><span class="pre">-DBOARD=mps2_an521_ns</span></code>).</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">west</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;ZEPHYR_ROOT&gt;
west build -p -b mps2_an521_ns samples/tfm_integration/psa_crypto
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">ninja</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;ZEPHYR_ROOT&gt;/samples/tfm_integration/psa_crypto/
rm -rf build
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake -GNinja -DBOARD<span class="o">=</span>mps2_an521_ns ..
ninja
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;ZEPHYR_ROOT&gt;/samples/tfm_integration/psa_crypto/
rm -rf build
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake -DBOARD<span class="o">=</span>mps2_an521_ns ..
make
</pre></div>
</div>
</li>
<li><p>Copy application binary files (mcuboot.bin and tfm_sign.bin) to
<code class="docutils literal notranslate"><span class="pre">&lt;MPS2</span> <span class="pre">device</span> <span class="pre">name&gt;/SOFTWARE/</span></code>.</p></li>
<li><p>Edit (e.g., with vim) the <code class="docutils literal notranslate"><span class="pre">&lt;MPS2</span> <span class="pre">device</span> <span class="pre">name&gt;/MB/HBI0263C/AN521/images.txt</span></code>
file, and update it as shown below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>TITLE: Versatile Express Images Configuration File

<span class="o">[</span>IMAGES<span class="o">]</span>
TOTALIMAGES: <span class="m">2</span> <span class="p">;</span>Number of Images <span class="o">(</span>Max: <span class="m">32</span><span class="o">)</span>

IMAGE0ADDRESS: 0x10000000
IMAGE0FILE: <span class="se">\S</span>OFTWARE<span class="se">\m</span>cuboot.bin  <span class="p">;</span> BL2 bootloader

IMAGE1ADDRESS: 0x10080000
IMAGE1FILE: <span class="se">\S</span>OFTWARE<span class="se">\t</span>fm_sign.bin <span class="p">;</span> TF-M with application binary blob
</pre></div>
</div>
</li>
<li><p>Save the file, exit the editor, and reset the MPS2+ board.</p></li>
</ol>
</div>
<div class="section" id="on-qemu">
<h3>On QEMU:<a class="headerlink" href="#on-qemu" title="Permalink to this headline">¶</a></h3>
<p>Build Zephyr with a non-secure configuration (<code class="docutils literal notranslate"><span class="pre">-DBOARD=mps2_an521_ns</span></code>)
and run it in qemu via the <code class="docutils literal notranslate"><span class="pre">run</span></code> command.</p>
<blockquote>
<div><p>Using <code class="docutils literal notranslate"><span class="pre">west</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;ZEPHYR_ROOT&gt;
west build -p -b mps2_an521_ns samples/tfm_integration/psa_crypto -t run
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">ninja</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;ZEPHYR_ROOT&gt;/samples/tfm_integration/psa_crypto/
rm -rf build
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake -GNinja -DBOARD<span class="o">=</span>mps2_an521_ns ..
ninja run
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;ZEPHYR_ROOT&gt;/samples/tfm_integration/psa_crypto/
rm -rf build
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake -DBOARD<span class="o">=</span>mps2_an521_ns ..
make run
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="on-lpcxpresso55s69">
<h3>On LPCxpresso55S69:<a class="headerlink" href="#on-lpcxpresso55s69" title="Permalink to this headline">¶</a></h3>
<p>Build Zephyr with a non-secure configuration:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ west build -p -b lpcxpresso55s69_ns samples/tfm_integration/psa_crypto/ --
</pre></div>
</div>
</div></blockquote>
<p>Make sure your board is set up with <a class="reference internal" href="../../../guides/flash_debug/probes.html#lpclink2-jlink-onboard-debug-probe"><span class="std std-ref">LPC-Link2 J-Link Onboard Debug Probe</span></a>,
since this isn’t the debug interface boards ship with from the factory;</p>
<p>Next we need to manually flash the resulting image (<code class="docutils literal notranslate"><span class="pre">tfm_merged.bin</span></code>) with a
J-Link as follows:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">JLinkExe -device lpc55s69 -if swd -speed 2000 -autoconnect 1</span>
<span class="go">J-Link&gt;r</span>
<span class="go">J-Link&gt;erase</span>
<span class="go">J-Link&gt;loadfile build/tfm_merged.bin</span>
</pre></div>
</div>
</div></blockquote>
<p>Resetting the board and erasing it will unlock the board, this is useful in case
it’s in an unknown state and can’t be flashed.</p>
<p>We need to reset the board manually after flashing the image to run this code.</p>
</div>
<div class="section" id="on-nrf5340-and-nrf9160">
<h3>On nRF5340 and nRF9160:<a class="headerlink" href="#on-nrf5340-and-nrf9160" title="Permalink to this headline">¶</a></h3>
<p>Build Zephyr with a non-secure configuration
(<code class="docutils literal notranslate"><span class="pre">-DBOARD=nrf5340dk_nrf5340_cpuapp_ns</span></code> or <code class="docutils literal notranslate"><span class="pre">-DBOARD=nrf9160dk_nrf9160_ns</span></code>).</p>
<blockquote>
<div><p>Example, for nRF9160, using <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">ninja</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;ZEPHYR_ROOT&gt;/samples/tfm_integration/psa_crypto/
rm -rf build
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake -GNinja -DBOARD<span class="o">=</span>nrf9160dk_nrf9160_ns ..
</pre></div>
</div>
</div></blockquote>
<p>If building with BL2 (MCUboot bootloader) enabled, manually flash
the MCUboot bootloader image binary (<code class="docutils literal notranslate"><span class="pre">bl2.hex</span></code>).</p>
<blockquote>
<div><p>Example, using <code class="docutils literal notranslate"><span class="pre">nrfjprog</span></code> on nRF9160:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nrfjprg -f NRF91 --program tfm/bin/bl2.hex --sectorerase
</pre></div>
</div>
</div></blockquote>
<p>Finally, flash the concatenated TF-M + Zephyr binary.</p>
<blockquote>
<div><p>Example, for nRF9160, using <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">ninja</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ninja flash
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="on-bl5340">
<h3>On BL5340:<a class="headerlink" href="#on-bl5340" title="Permalink to this headline">¶</a></h3>
<p>Build Zephyr with a non-secure configuration
(<code class="docutils literal notranslate"><span class="pre">-DBOARD=bl5340_dvk_cpuapp_ns</span></code>).</p>
<blockquote>
<div><p>Example using <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">ninja</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;ZEPHYR_ROOT&gt;/samples/tfm_integration/psa_crypto/
rm -rf build
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake -GNinja -DBOARD<span class="o">=</span>bl5340_dvk_cpuapp_ns ..
</pre></div>
</div>
</div></blockquote>
<p>Flash the concatenated TF-M + Zephyr binary.</p>
<blockquote>
<div><p>Example using <code class="docutils literal notranslate"><span class="pre">west</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>west flash --hex-file tfm_merged.hex
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="sample-output">
<h3>Sample Output<a class="headerlink" href="#sample-output" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[Sec Thread] Secure image initializing!</span>
<span class="go">Booting TFM v1.4.1</span>
<span class="go">[Crypto] Dummy Entropy NV Seed is not suitable for production!</span>
<span class="go">*** Booting Zephyr OS build v2.7.99-1102-gf503ba9f1ab3  ***</span>
<span class="go">[00:00:00.014,000] &lt;inf&gt; app: app_cfg: Creating new config file with UID 0x1055CFDA7A</span>
<span class="go">[00:00:01.215,000] &lt;inf&gt; app: att: System IAT size is: 545 bytes.</span>
<span class="go">[00:00:01.215,000] &lt;inf&gt; app: att: Requesting IAT with 64 byte challenge.</span>
<span class="go">[00:00:01.836,000] &lt;inf&gt; app: att: IAT data received: 545 bytes.</span>

<span class="go">         0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F</span>
<span class="go">00000000 D2 84 43 A1 01 26 A0 59 01 D5 AA 3A 00 01 24 FF ..C..&amp;.Y...:..$.</span>
<span class="go">00000010 58 40 00 11 22 33 44 55 66 77 88 99 AA BB CC DD X@..&quot;3DUfw......</span>
<span class="go">00000020 EE FF 00 11 22 33 44 55 66 77 88 99 AA BB CC DD ....&quot;3DUfw......</span>
<span class="go">00000030 EE FF 00 11 22 33 44 55 66 77 88 99 AA BB CC DD ....&quot;3DUfw......</span>
<span class="go">00000040 EE FF 00 11 22 33 44 55 66 77 88 99 AA BB CC DD ....&quot;3DUfw......</span>
<span class="go">00000050 EE FF 3A 00 01 24 FB 58 20 A0 A1 A2 A3 A4 A5 A6 ..:..$.X .......</span>
<span class="go">00000060 A7 A8 A9 AA AB AC AD AE AF B0 B1 B2 B3 B4 B5 B6 ................</span>
<span class="go">00000070 B7 B8 B9 BA BB BC BD BE BF 3A 00 01 25 00 58 21 .........:..%.X!</span>
<span class="go">00000080 01 FA 58 75 5F 65 86 27 CE 54 60 F2 9B 75 29 67 ..Xu_e.&#39;.T`..u)g</span>
<span class="go">00000090 13 24 8C AE 7A D9 E2 98 4B 90 28 0E FC BC B5 02 .$..z...K.(.....</span>
<span class="go">000000A0 48 3A 00 01 24 FA 58 20 AA AA AA AA AA AA AA AA H:..$.X ........</span>
<span class="go">000000B0 BB BB BB BB BB BB BB BB CC CC CC CC CC CC CC CC ................</span>
<span class="go">000000C0 DD DD DD DD DD DD DD DD 3A 00 01 24 F8 20 3A 00 ........:..$. :.</span>
<span class="go">000000D0 01 24 F9 19 30 00 3A 00 01 24 FD 82 A5 01 63 53 .$..0.:..$....cS</span>
<span class="go">000000E0 50 45 04 65 30 2E 30 2E 30 05 58 20 BF E6 D8 6F PE.e0.0.0.X ...o</span>
<span class="go">000000F0 88 26 F4 FF 97 FB 96 C4 E6 FB C4 99 3E 46 19 FC .&amp;..........&gt;F..</span>
<span class="go">00000100 56 5D A2 6A DF 34 C3 29 48 9A DC 38 06 66 53 48 V].j.4.)H..8.fSH</span>
<span class="go">00000110 41 32 35 36 02 58 20 6D E1 0F 82 E0 CF FC 84 5A A256.X m.......Z</span>
<span class="go">00000120 24 25 2B EB 70 D7 2C 6B FC 92 CD BE 5B 65 9E C7 $%+.p.,k....[e..</span>
<span class="go">00000130 34 1E 1C D2 80 5D A3 A5 01 64 4E 53 50 45 04 65 4....]...dNSPE.e</span>
<span class="go">00000140 30 2E 30 2E 30 05 58 20 B3 60 CA F5 C9 8C 6B 94 0.0.0.X .`....k.</span>
<span class="go">00000150 2A 48 82 FA 9D 48 23 EF B1 66 A9 EF 6A 6E 4A A3 *H...H#..f..jnJ.</span>
<span class="go">00000160 7C 19 19 ED 1F CC C0 49 06 66 53 48 41 32 35 36 |......I.fSHA256</span>
<span class="go">00000170 02 58 20 01 4C F2 64 0D 49 F8 23 69 57 FE F3 73 .X .L.d.I.#iW..s</span>
<span class="go">00000180 97 7E 73 C2 2C 4F D2 95 25 D8 BE 29 32 14 23 5D .~s.,O..%..)2.#]</span>
<span class="go">00000190 A9 22 AD 3A 00 01 25 01 77 77 77 77 2E 74 72 75 .&quot;.:..%.wwww.tru</span>
<span class="go">000001A0 73 74 65 64 66 69 72 6D 77 61 72 65 2E 6F 72 67 stedfirmware.org</span>
<span class="go">000001B0 3A 00 01 24 F7 71 50 53 41 5F 49 4F 54 5F 50 52 :..$.qPSA_IOT_PR</span>
<span class="go">000001C0 4F 46 49 4C 45 5F 31 3A 00 01 24 FC 72 30 36 30 OFILE_1:..$.r060</span>
<span class="go">000001D0 34 35 36 35 32 37 32 38 32 39 31 30 30 31 30 58 456527282910010X</span>
<span class="go">000001E0 40 59 23 3E 80 5E E0 9F FA E3 F4 14 62 D3 15 A5 @Y#&gt;.^......b...</span>
<span class="go">000001F0 B0 95 B5 E5 CB 79 92 F8 F1 A0 FE 14 0C 6C 84 2A .....y.......l.*</span>
<span class="go">00000200 41 97 BC 6F C6 7D 9C A5 21 BB 4C 2C D1 2C F3 66 A..o.}..!.L,.,.f</span>
<span class="go">00000210 4E D4 85 D2 57 15 72 11 E8 9E 06 4F C4 46 D0 58 N...W.r....O.F.X</span>
<span class="go">00000220 26                                              &amp;</span>

<span class="gp">[00:00:01.905,000] &lt;inf&gt; app: Persisting SECP256R1 key as #</span><span class="m">1</span>
<span class="gp">[00:00:02.458,000] &lt;inf&gt; app: Retrieving public key for key #</span><span class="m">1</span>

<span class="go">         0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F</span>
<span class="go">00000000 04 07 93 39 CD 42 53 7B 18 8C 8A F1 05 7F 49 D1 ...9.BS{......I.</span>
<span class="go">00000010 6B 30 D5 39 0D 1A 6E 95 BA 0C CD FE DB 59 A3 03 k0.9..n......Y..</span>
<span class="go">00000020 02 61 B4 CF 13 CC 70 15 67 30 83 FE A0 D4 2A 19 .a....p.g0....*.</span>
<span class="go">00000030 72 82 3E 3F 90 00 91 C6 5E 43 DC E9 B4 C4 0E F3 r.&gt;?....^C......</span>
<span class="go">00000040 79                                              y</span>

<span class="go">[00:00:03.020,000] &lt;inf&gt; app: Calculating SHA-256 hash of value</span>

<span class="go">         0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F</span>
<span class="go">00000000 50 6C 65 61 73 65 20 68 61 73 68 20 61 6E 64 20 Please hash and</span>
<span class="go">00000010 73 69 67 6E 20 74 68 69 73 20 6D 65 73 73 61 67 sign this messag</span>
<span class="go">00000020 65 2E                                           e.</span>


<span class="go">         0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F</span>
<span class="go">00000000 9D 08 E3 E6 DB 1C 12 39 C0 9B 9A 83 84 83 72 7A .......9......rz</span>
<span class="go">00000010 EA 96 9E 1D 13 72 1E 4D 35 75 CC D4 C8 01 41 9C .....r.M5u....A.</span>

<span class="go">[00:00:03.032,000] &lt;inf&gt; app: Signing SHA-256 hash</span>

<span class="go">         0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F</span>
<span class="go">00000000 EE F1 FE A6 A8 41 5F CC A6 3A 73 A7 C1 33 B4 78 .....A_..:s..3.x</span>
<span class="go">00000010 BF B7 38 78 2A 91 C8 82 32 F8 73 85 56 08 D2 A0 ..8x*...2.s.V...</span>
<span class="go">00000020 A6 22 2C 64 7A C7 E4 0A FB 99 D1 8B 67 37 F7 13 .&quot;,dz.......g7..</span>
<span class="go">00000030 E6 6C 54 7B 29 1D 3B A2 D8 E3 C4 79 17 BA 34 A8 .lT{).;....y..4.</span>

<span class="go">[00:00:03.658,000] &lt;inf&gt; app: Verifying signature for SHA-256 hash</span>
<span class="go">[00:00:06.339,000] &lt;inf&gt; app: Signature verified.</span>
<span class="gp">[00:00:06.349,000] &lt;inf&gt; app: Destroyed persistent key #</span><span class="m">1</span>
<span class="go">[00:00:06.354,000] &lt;inf&gt; app: Generating 256 bytes of random data.</span>

<span class="go">         0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F</span>
<span class="go">00000000 24 5C B3 EB 88 D2 80 76 23 B3 07 CA 16 92 8F 3D $\.....v#......=</span>
<span class="go">00000010 27 AC C2 42 59 15 5E 3C EB 11 20 3C 14 A6 EB 60 &#39;..BY.^&lt;.. &lt;...`</span>
<span class="go">00000020 C0 92 12 97 4D D7 62 BC A0 0A 34 A7 CE A8 78 18 ....M.b...4...x.</span>
<span class="go">00000030 1B 30 6E 3C DA 80 F2 55 F7 FA 10 8B F5 78 CE 92 .0n&lt;...U.....x..</span>
<span class="go">00000040 92 FF F2 A3 22 4D 2D F6 62 39 6D A5 DD E1 E1 C4 ....&quot;M-.b9m.....</span>
<span class="go">00000050 67 67 30 19 98 D7 E4 AD A2 6A 27 1C A4 C2 A2 C6 gg0......j&#39;.....</span>
<span class="go">00000060 8A B5 98 26 D3 1A 84 75 55 52 4F E1 6D 4B 84 99 ...&amp;...uURO.mK..</span>
<span class="go">00000070 0F C2 5E 88 D5 8B E6 AA 2F 61 DC 63 79 5B 69 3F ..^...../a.cy[i?</span>
<span class="go">00000080 19 79 5A 78 49 29 22 92 9D F5 F3 FD 16 60 E2 72 .yZxI)&quot;......`.r</span>
<span class="go">00000090 EA F8 8E 32 7D 81 A0 21 0C 82 4A A8 4C EE 9C 0E ...2}..!..J.L...</span>
<span class="go">000000A0 D7 BF 50 60 6C 65 8A 7C A6 CD C5 98 8B 15 EA F0 ..P`le.|........</span>
<span class="go">000000B0 26 D0 15 F4 EB DE A0 FD 88 2F 72 8B ED 07 44 5C &amp;......../r...D\</span>
<span class="go">000000C0 91 46 17 8C 26 46 F2 7C BF 6B 45 63 B6 71 E7 51 .F..&amp;F.|.kEc.q.Q</span>
<span class="go">000000D0 E4 34 A2 5A 01 F4 6E FF A2 67 82 7B F3 36 34 54 .4.Z..n..g.{.64T</span>
<span class="go">000000E0 80 ED 7E 9D 0A 21 09 9C 9C 55 A9 14 AF A2 66 65 ..~..!...U....fe</span>
<span class="go">000000F0 DE 8D BE C2 8B 31 B8 ED 06 AE A9 0B 7E 62 75 87 .....1......~bu.</span>

<span class="go">[00:00:06.385,000] &lt;inf&gt; app: Initialising PSA crypto</span>
<span class="go">[00:00:06.386,000] &lt;inf&gt; app: PSA crypto init completed</span>
<span class="gp">[00:00:06.387,000] &lt;inf&gt; app: Persisting SECP256R1 key as #</span><span class="m">1</span>
<span class="gp">[00:00:06.938,000] &lt;inf&gt; app: Retrieving public key for key #</span><span class="m">1</span>

<span class="go">         0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F</span>
<span class="go">00000000 04 34 B7 2F D5 EC 41 71 B1 04 D9 BE 1C E7 DD F7 .4./..Aq........</span>
<span class="go">00000010 C4 C0 B1 E9 64 CB 45 1F E3 4A 95 52 A8 75 B2 8C ....d.E..J.R.u..</span>
<span class="go">00000020 4D F1 CB 4F C2 26 2C 90 C9 05 B2 E4 4C 2A E9 9D M..O.&amp;,.....L*..</span>
<span class="go">00000030 11 DF 35 1B 0E 86 D5 9C A1 1F FC FA ED 21 9A B5 ..5..........!..</span>
<span class="go">00000040 28                                              (</span>

<span class="go">[00:00:07.495,000] &lt;inf&gt; app: Adding subject name to CSR</span>
<span class="go">[00:00:07.496,000] &lt;inf&gt; app: Adding subject name to CSR completed</span>
<span class="go">[00:00:07.497,000] &lt;inf&gt; app: Adding EC key to PK container</span>
<span class="go">[00:00:07.499,000] &lt;inf&gt; app: Adding EC key to PK container completed</span>
<span class="go">[00:00:07.500,000] &lt;inf&gt; app: Create device Certificate Signing Request</span>
<span class="go">[00:00:08.692,000] &lt;inf&gt; app: Create device Certificate Signing Request completed</span>
<span class="go">[00:00:08.693,000] &lt;inf&gt; app: Certificate Signing Request:</span>

<span class="go">-----BEGIN CERTIFICATE REQUEST-----</span>
<span class="go">MIHrMIGQAgEAMC4xDzANBgNVBAoMBkxpbmFybzEbMBkGA1UEAwwSRGV2aWNlIENl</span>
<span class="go">cnRpZmljYXRlMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAENLcv1exBcbEE2b4c</span>
<span class="go">5933xMCx6WTLRR/jSpVSqHWyjE3xy0/CJiyQyQWy5Ewq6Z0R3zUbDobVnKEf/Prt</span>
<span class="go">IZq1KKAAMAwGCCqGSM49BAMCBQADSAAwRQIgaAlTPmrIaRO7myM2Qr+LNk9sagdO</span>
<span class="go">jPGUqbz4oUWhUsICIQCuHADW6F2l4czv78BO5Nf+FHZEpjbI1+fA2aLzglOaiA==</span>
<span class="go">-----END CERTIFICATE REQUEST-----</span>

<span class="go">[00:00:08.696,000] &lt;inf&gt; app: Encoding CSR as json</span>
<span class="go">[00:00:08.699,000] &lt;inf&gt; app: Encoding CSR as json completed</span>
<span class="go">[00:00:08.700,000] &lt;inf&gt; app: Certificate Signing Request in JSON:</span>

<span class="go">{&quot;CSR&quot;:&quot;-----BEGIN CERTIFICATE REQUEST-----\nMIHrMIGQAgEAMC4xDzANBgNVBAoMBkxpbmFybzEbMBkGA1UEAwwSRGV2aWNlIENl\ncnRpZmljYXRlMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAENLcv1exBcbEE2b4c\n5933xMCx6WTLRR/jSpVSqHWyjE3xy0/CJiyQyQWy5Ewq6Z0R3zUbDobVnKEf/Prt\nIZq1KKAAMAwGCCqGSM49BAMCBQADSAAwRQIgaAlTPmrIaRO7myM2Qr+LNk9sagdO\njPGUqbz4oUWhUsICIQCuHADW6F2l4czv78BO5Nf+FHZEpjbI1+fA2aLzglOaiA==\n-----END CERTIFICATE REQUEST-----\n&quot;}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Mar 05, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>