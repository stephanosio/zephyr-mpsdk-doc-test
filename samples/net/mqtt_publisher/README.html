<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MQTT Publisher &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script type="module" src="../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="OpenThread Co-Processor" href="../openthread/coprocessor/README.html" />
    <link rel="prev" title="mDNS Responder Application" href="../mdns_responder/README.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.99
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/3.0.0/">3.0.0</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Samples and Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../classic.html">Classic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html">Basic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../userspace/index.html">Userspace Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsys/subsys.html">Various Subsystems Samples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../net.html">Networking Samples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../capture/README.html">Network Packet Capture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../civetweb/http_server/README.html">Civetweb sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../civetweb/websocket_server/README.html">Civetweb WebSocket Server sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cloud/google_iot_mqtt/README.html">Google IOT MQTT Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cloud/mqtt_azure/README.html">MQTT Azure Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cloud/tagoio_http_post/README.html">TagoIO IoT Cloud HTTP Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dhcpv4_client/README.html">Sample DHCPv4 client application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dns_resolve/README.html">DNS Resolve Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsa/README.html">DSA Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eth_native_posix/README.html">Native Posix Ethernet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gptp/README.html">gPTP Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gsm_modem/README.html">Generic GSM Modem Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ipv4_autoconf/README.html">IPv4 autoconf client application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lldp/README.html">LLDP Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lwm2m_client/README.html">LwM2M client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mdns_responder/README.html">mDNS Responder Application</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">MQTT Publisher</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-and-running">Build and Running</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../openthread/coprocessor/README.html">OpenThread Co-Processor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../promiscuous_mode/README.html">Promiscuous Mode Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/big_http_download/README.html">Socket Big HTTP Download Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/can/README.html">Socket CAN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/coap_client/README.html">CoAP client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/coap_server/README.html">CoAP Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/dumb_http_server/README.html">Socket Dumb HTTP Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/dumb_http_server_mt/README.html">Socket Multithreaded Dumb HTTP Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/echo/README.html">Socket Echo Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/echo_async/README.html">Asynchronous Socket Echo Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/echo_async_select/README.html">Asynchronous Socket Echo Server Using select()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/echo_client/README.html">Socket Echo Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/echo_server/README.html">Socket Echo Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/http_client/README.html">Socket HTTP Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/http_get/README.html">Socket HTTP GET Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/net_mgmt/README.html">Network Management Socket</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/packet/README.html">Packet socket sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/sntp_client/README.html">SNTP client sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/socketpair/README.html">Socketpair Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/tcp/README.html">TCP Sample for TTCN-3 based Sanity Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/txtime/README.html">SO_TXTIME sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/websocket_client/README.html">Socket Websocket Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats/README.html">Network Statistics Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../syslog_net/README.html">Syslog net Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../telnet/README.html">Sample TELNET console application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../virtual/README.html">Virtual Network Interface Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlan/README.html">Virtual LAN Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wifi/README.html">Wi-Fi sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wpan_serial/README.html">802.15.4 “serial-radio” sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wpanusb/README.html">wpanusb sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../zperf/README.html">zperf: Network Traffic Generator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth/bluetooth.html">Bluetooth samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sensor/sensor.html">Sensor Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../arch/index.html">Architecture Dependent Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../boards/boards.html">Board-specific samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../drivers/drivers.html">Driver Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../application_development/application_development.html">Application development samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shields/shields.html">Shields Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../posix/posix.html">POSIX Subsystem Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kernel/index.html">Various Kernel and Scheduler Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm_integration/tfm_integration.html">TF-M Integration Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm_integration/tfm_integration.html#trusted-firmware-m-tf-m">Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/index.html">External Module Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../compression/compression.html">Compression Samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/kconfig.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../index.html">Samples and Demos</a> &raquo;</li>
  
     <li><a href="../net.html">Networking Samples</a> &raquo;</li>
  
  <li>MQTT Publisher</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main//samples/net/mqtt_publisher/README.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="mqtt-publisher">
<span id="mqtt-publisher-sample"></span><h1>MQTT Publisher<a class="headerlink" href="#mqtt-publisher" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://mqtt.org/">MQTT</a> (MQ Telemetry Transport) is a lightweight
publish/subscribe messaging protocol optimized for small sensors and
mobile devices.</p>
<p>The Zephyr MQTT Publisher sample application is a MQTT v3.1.1
client that sends MQTT PUBLISH messages to a MQTT broker.
See the <a class="reference external" href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html">MQTT V3.1.1 spec</a> for more information.</p>
<p>The source code of this sample application can be found at:
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/net/mqtt_publisher">samples/net/mqtt_publisher</a>.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Linux machine</p></li>
<li><p>Freedom Board (FRDM-K64F)</p></li>
<li><p>Mosquitto server: any version that supports MQTT v3.1.1. This sample
was tested with mosquitto 1.3.4.</p></li>
<li><p>Mosquitto subscriber</p></li>
<li><p>LAN for testing purposes (Ethernet)</p></li>
</ul>
</div>
<div class="section" id="build-and-running">
<h2>Build and Running<a class="headerlink" href="#build-and-running" title="Permalink to this headline">¶</a></h2>
<p>Currently, this sample application only supports static IP addresses.
Open the <code class="file docutils literal notranslate"><span class="pre">src/config.h</span></code> file and set the IP addresses according
to the LAN environment.
Alternatively, set the IP addresses in the <code class="file docutils literal notranslate"><span class="pre">prj.conf</span></code> file.</p>
<p>The file <code class="file docutils literal notranslate"><span class="pre">src/config.h</span></code> also contains some variables that may be changed:</p>
<p>MQTT broker TCP port:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SERVER_PORT             1883</span>
</pre></div>
</div>
<p>Application sleep time:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define APP_SLEEP_MSECS         500</span>
</pre></div>
</div>
<p>Max number of connection tries:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define APP_CONNECT_TRIES       10</span>
</pre></div>
</div>
<p>MQTT Client Identifier:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define MQTT_CLIENTID           &quot;zephyr_publisher&quot;</span>
</pre></div>
</div>
<p>This sample application supports the IBM Bluemix Watson topic format that can
be enabled by changing the default value of APP_BLUEMIX_TOPIC from 0 to 1:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define APP_BLUEMIX_TOPIC       1</span>
</pre></div>
</div>
<p>The Bluemix topic may include some parameters like device type, device
identifier, event type and message format. This application uses the
following macros to specify those values:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define BLUEMIX_DEVTYPE         &quot;sensor&quot;</span>
<span class="cp">#define BLUEMIX_DEVID           &quot;carbon&quot;</span>
<span class="cp">#define BLUEMIX_EVENT           &quot;status&quot;</span>
<span class="cp">#define BLUEMIX_FORMAT          &quot;json&quot;</span>
</pre></div>
</div>
<p>Max number of MQTT PUBLISH iterations is defined in Kconfig:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_NET_SAMPLE_APP_MAX_ITERATIONS</span><span class="w">    </span><span class="mi">5</span><span class="w"></span>
</pre></div>
</div>
<p>On your Linux host computer, open a terminal window, locate the source code
of this sample application (i.e., <a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/net/mqtt_publisher">samples/net/mqtt_publisher</a>) and type:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b frdm_k64f samples/net/mqtt_publisher</span>
<span class="go">west flash</span>
</pre></div>
</div>
<p>Open another terminal window and type:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo mosquitto -v -p <span class="m">1883</span>
</pre></div>
</div>
<p>Open another terminal window and type:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mosquitto_sub -t sensors
</pre></div>
</div>
<div class="section" id="connecting-securely-using-tls">
<h3>Connecting securely using TLS<a class="headerlink" href="#connecting-securely-using-tls" title="Permalink to this headline">¶</a></h3>
<p>While it is possible to set up a local secure MQTT server and update the
sample to connect to it, it does require some work on the user’s part to
create the certificates and to set them up with the server.</p>
<p>Alternatively, a <a class="reference external" href="https://test.mosquitto.org/">publicly available Mosquitto MQTT server/broker</a> is available to quickly and easily
try this sample with TLS enabled, by following these steps:</p>
<ul class="simple">
<li><p>Download the server’s CA certificate file in DER format from
<a class="reference external" href="https://test.mosquitto.org">https://test.mosquitto.org</a></p></li>
<li><p>In <code class="file docutils literal notranslate"><span class="pre">src/test_certs.h</span></code>, set <code class="docutils literal notranslate"><span class="pre">ca_certificate[]</span></code> using the certificate
contents (or set it to its filename if the socket offloading feature is
enabled on your platform and <a class="reference internal" href="../../../kconfig.html#CONFIG_TLS_CREDENTIAL_FILENAMES" title="CONFIG_TLS_CREDENTIAL_FILENAMES"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_TLS_CREDENTIAL_FILENAMES</span></code></a> is
set to <code class="docutils literal notranslate"><span class="pre">y</span></code>).</p></li>
<li><p>In <code class="file docutils literal notranslate"><span class="pre">src/config.h</span></code>, set SERVER_ADDR to the IP address to connect to,
i.e., the IP address of test.mosquitto.org <code class="docutils literal notranslate"><span class="pre">&quot;37.187.106.16&quot;</span></code></p></li>
<li><p>In <code class="file docutils literal notranslate"><span class="pre">src/main.c</span></code>, set TLS_SNI_HOSTNAME to <code class="docutils literal notranslate"><span class="pre">&quot;test.mosquitto.org&quot;</span></code>
to match the Common Name (CN) in the downloaded certificate.</p></li>
<li><p>Build the sample by specifying <code class="docutils literal notranslate"><span class="pre">-DOVERLAY_CONFIG=overlay-tls.conf</span></code>
when running <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">build</span></code> or <code class="docutils literal notranslate"><span class="pre">cmake</span></code> (or refer to the TLS offloading
section below if your platform uses the offloading feature).</p></li>
<li><p>Flash the binary onto the device to run the sample:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ninja flash
</pre></div>
</div>
</div>
<div class="section" id="tls-offloading">
<h3>TLS offloading<a class="headerlink" href="#tls-offloading" title="Permalink to this headline">¶</a></h3>
<p>For boards that support this feature, TLS offloading is used by
specifying <code class="docutils literal notranslate"><span class="pre">-DOVERLAY_CONFIG=overlay-tls-offload.conf</span></code> when running <code class="docutils literal notranslate"><span class="pre">west</span>
<span class="pre">build</span></code> or <code class="docutils literal notranslate"><span class="pre">cmake</span></code>.</p>
<p>Using this overlay enables TLS without bringing in mbedtls.</p>
</div>
<div class="section" id="socks5-proxy-support">
<h3>SOCKS5 proxy support<a class="headerlink" href="#socks5-proxy-support" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to connect to the MQTT broker through a SOCKS5 proxy.
To enable it, use <code class="docutils literal notranslate"><span class="pre">-DOVERLAY_CONFIG=overlay-socks5.conf</span></code> when running <code class="docutils literal notranslate"><span class="pre">west</span>
<span class="pre">build</span></code> or  <code class="docutils literal notranslate"><span class="pre">cmake</span></code>.</p>
<p>By default, to make the testing easier, the proxy is expected to run on the
same host as the MQTT broker.</p>
<p>To start a proxy server, <code class="docutils literal notranslate"><span class="pre">ssh</span></code> can be used.
Use the following command to run it on your host with the default port:</p>
<p>To connect to a proxy server that is not running under the same IP as the MQTT
broker or uses a different port number, modify the following values:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SOCKS5_PROXY_ADDR    SERVER_ADDR</span>
<span class="cp">#define SOCKS5_PROXY_PORT    1080</span>
</pre></div>
</div>
</div>
<div class="section" id="running-on-cc3220sf-launchxl">
<h3>Running on cc3220sf_launchxl<a class="headerlink" href="#running-on-cc3220sf-launchxl" title="Permalink to this headline">¶</a></h3>
<p>Offloading on cc3220sf_launchxl also provides DHCP services, so the sample
uses dynamic IP addresses on this board.</p>
<p>By default, the sample is set up to connect to the broker at the address
specified by SERVER_ADDR in config.h. If the broker is secured using TLS, users
should enable TLS offloading, upload the server’s certificate
authority file in DER format to the device filesystem using TI Uniflash,
and name it “ca_cert.der”.</p>
<p>In addition, TLS_SNI_HOSTNAME in main.c should be defined to match the
Common Name (CN) in the certificate file in order for the TLS domain
name verification to succeed.</p>
<p>See the note on Provisioning and Fast Connect in <a class="reference internal" href="../../../boards/arm/cc3220sf_launchxl/doc/index.html#cc3220sf-launchxl"><span class="std std-ref">CC3220SF LaunchXL</span></a>.</p>
<p>The Secure Socket Offload section has information on programming the
certificate to flash.</p>
<p>Proceed to test as above.</p>
</div>
<div class="section" id="sample-output">
<h3>Sample output<a class="headerlink" href="#sample-output" title="Permalink to this headline">¶</a></h3>
<p>This is the output from the FRDM UART console, with:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_NET_SAMPLE_APP_MAX_ITERATIONS</span><span class="w">     </span><span class="mi">5</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[dev/eth_mcux] [INF] eth_0_init: Enabled 100M full-duplex mode.</span>
<span class="go">[dev/eth_mcux] [DBG] eth_0_init: MAC 00:04:9f:3e:1a:0a</span>
<span class="go">[publisher:233] network_setup: 0 &lt;OK&gt;</span>
<span class="go">[publisher:258] mqtt_init: 0 &lt;OK&gt;</span>
<span class="go">[connect_cb:81] user_data: CONNECTED</span>
<span class="go">[try_to_connect:212] mqtt_tx_connect: 0 &lt;OK&gt;</span>
<span class="go">[publisher:276] try_to_connect: 0 &lt;OK&gt;</span>
<span class="go">[publisher:285] mqtt_tx_pingreq: 0 &lt;OK&gt;</span>
<span class="go">[publisher:290] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBACK&gt; packet id: 1888, user_data: PUBLISH</span>
<span class="go">[publisher:295] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBREC&gt; packet id: 16356, user_data: PUBLISH</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBCOMP&gt; packet id: 16356, user_data: PUBLISH</span>
<span class="go">[publisher:300] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publisher:285] mqtt_tx_pingreq: 0 &lt;OK&gt;</span>
<span class="go">[publisher:290] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBACK&gt; packet id: 45861, user_data: PUBLISH</span>
<span class="go">[publisher:295] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBREC&gt; packet id: 53870, user_data: PUBLISH</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBCOMP&gt; packet id: 53870, user_data: PUBLISH</span>
<span class="go">[publisher:300] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publisher:285] mqtt_tx_pingreq: 0 &lt;OK&gt;</span>
<span class="go">[publisher:290] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBACK&gt; packet id: 60144, user_data: PUBLISH</span>
<span class="go">[publisher:295] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBREC&gt; packet id: 6561, user_data: PUBLISH</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBCOMP&gt; packet id: 6561, user_data: PUBLISH</span>
<span class="go">[publisher:300] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publisher:285] mqtt_tx_pingreq: 0 &lt;OK&gt;</span>
<span class="go">[publisher:290] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBACK&gt; packet id: 38355, user_data: PUBLISH</span>
<span class="go">[publisher:295] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBREC&gt; packet id: 60656, user_data: PUBLISH</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBCOMP&gt; packet id: 60656, user_data: PUBLISH</span>
<span class="go">[publisher:300] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publisher:285] mqtt_tx_pingreq: 0 &lt;OK&gt;</span>
<span class="go">[publisher:290] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBACK&gt; packet id: 28420, user_data: PUBLISH</span>
<span class="go">[publisher:295] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBREC&gt; packet id: 49829, user_data: PUBLISH</span>
<span class="go">[publish_cb:149] &lt;MQTT_PUBCOMP&gt; packet id: 49829, user_data: PUBLISH</span>
<span class="go">[publisher:300] mqtt_tx_publish: 0 &lt;OK&gt;</span>
<span class="go">[disconnect_cb:101] user_data: DISCONNECTED</span>
<span class="go">[publisher:304] mqtt_tx_disconnect: 0 &lt;OK&gt;</span>

<span class="go">Bye!</span>
</pre></div>
</div>
<p>The line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[try_to_connect:220] mqtt_connect: -5 &lt;ERROR&gt;</span>
</pre></div>
</div>
<p>means that an error was detected and a new connect message will be sent.</p>
<p>The MQTT API is asynchronous, so messages are displayed as the callbacks are
executed.</p>
<p>This is the information that the subscriber will receive:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mosquitto_sub -t sensors
<span class="go">DOORS:OPEN_QoS0</span>
<span class="go">DOORS:OPEN_QoS1</span>
<span class="go">DOORS:OPEN_QoS2</span>
<span class="go">DOORS:OPEN_QoS0</span>
<span class="go">DOORS:OPEN_QoS1</span>
<span class="go">DOORS:OPEN_QoS2</span>
<span class="go">DOORS:OPEN_QoS0</span>
<span class="go">DOORS:OPEN_QoS1</span>
<span class="go">DOORS:OPEN_QoS2</span>
<span class="go">DOORS:OPEN_QoS0</span>
<span class="go">DOORS:OPEN_QoS1</span>
<span class="go">DOORS:OPEN_QoS2</span>
<span class="go">DOORS:OPEN_QoS0</span>
<span class="go">DOORS:OPEN_QoS1</span>
<span class="go">DOORS:OPEN_QoS2</span>
</pre></div>
</div>
<p>This is the output from the MQTT broker:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo mosquitto -v
<span class="go">1485663791: mosquitto version 1.3.4 (build date 2014-08-17 00:14:52-0300) starting</span>
<span class="go">1485663791: Using default config.</span>
<span class="go">1485663791: Opening ipv4 listen socket on port 1883.</span>
<span class="go">1485663791: Opening ipv6 listen socket on port 1883.</span>
<span class="go">1485663797: New connection from 192.168.1.101 on port 1883.</span>
<span class="go">1485663797: New client connected from 192.168.1.101 as zephyr_publisher (c1, k0).</span>
<span class="go">1485663797: Sending CONNACK to zephyr_publisher (0)</span>
<span class="go">1485663798: Received PINGREQ from zephyr_publisher</span>
<span class="go">1485663798: Sending PINGRESP to zephyr_publisher</span>
<span class="go">1485663798: Received PUBLISH from zephyr_publisher (d0, q0, r0, m0, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663799: Received PUBLISH from zephyr_publisher (d0, q1, r0, m1888, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663799: Sending PUBACK to zephyr_publisher (Mid: 1888)</span>
<span class="go">1485663799: Received PUBLISH from zephyr_publisher (d0, q2, r0, m16356, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663799: Sending PUBREC to zephyr_publisher (Mid: 16356)</span>
<span class="go">1485663799: Received PUBREL from zephyr_publisher (Mid: 16356)</span>
<span class="go">1485663799: Sending PUBCOMP to zephyr_publisher (Mid: 16356)</span>
<span class="go">1485663800: Received PINGREQ from zephyr_publisher</span>
<span class="go">1485663800: Sending PINGRESP to zephyr_publisher</span>
<span class="go">1485663800: Received PUBLISH from zephyr_publisher (d0, q0, r0, m0, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663801: Received PUBLISH from zephyr_publisher (d0, q1, r0, m45861, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663801: Sending PUBACK to zephyr_publisher (Mid: 45861)</span>
<span class="go">1485663801: Received PUBLISH from zephyr_publisher (d0, q2, r0, m53870, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663801: Sending PUBREC to zephyr_publisher (Mid: 53870)</span>
<span class="go">1485663801: Received PUBREL from zephyr_publisher (Mid: 53870)</span>
<span class="go">1485663801: Sending PUBCOMP to zephyr_publisher (Mid: 53870)</span>
<span class="go">1485663802: Received PINGREQ from zephyr_publisher</span>
<span class="go">1485663802: Sending PINGRESP to zephyr_publisher</span>
<span class="go">1485663802: Received PUBLISH from zephyr_publisher (d0, q0, r0, m0, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663803: Received PUBLISH from zephyr_publisher (d0, q1, r0, m60144, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663803: Sending PUBACK to zephyr_publisher (Mid: 60144)</span>
<span class="go">1485663803: Received PUBLISH from zephyr_publisher (d0, q2, r0, m6561, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663803: Sending PUBREC to zephyr_publisher (Mid: 6561)</span>
<span class="go">1485663803: Received PUBREL from zephyr_publisher (Mid: 6561)</span>
<span class="go">1485663803: Sending PUBCOMP to zephyr_publisher (Mid: 6561)</span>
<span class="go">1485663804: Received PINGREQ from zephyr_publisher</span>
<span class="go">1485663804: Sending PINGRESP to zephyr_publisher</span>
<span class="go">1485663804: Received PUBLISH from zephyr_publisher (d0, q0, r0, m0, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663805: Received PUBLISH from zephyr_publisher (d0, q1, r0, m38355, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663805: Sending PUBACK to zephyr_publisher (Mid: 38355)</span>
<span class="go">1485663805: Received PUBLISH from zephyr_publisher (d0, q2, r0, m60656, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663805: Sending PUBREC to zephyr_publisher (Mid: 60656)</span>
<span class="go">1485663805: Received PUBREL from zephyr_publisher (Mid: 60656)</span>
<span class="go">1485663805: Sending PUBCOMP to zephyr_publisher (Mid: 60656)</span>
<span class="go">1485663806: Received PINGREQ from zephyr_publisher</span>
<span class="go">1485663806: Sending PINGRESP to zephyr_publisher</span>
<span class="go">1485663806: Received PUBLISH from zephyr_publisher (d0, q0, r0, m0, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663807: Received PUBLISH from zephyr_publisher (d0, q1, r0, m28420, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663807: Sending PUBACK to zephyr_publisher (Mid: 28420)</span>
<span class="go">1485663807: Received PUBLISH from zephyr_publisher (d0, q2, r0, m49829, &#39;sensors&#39;, ... (15 bytes))</span>
<span class="go">1485663807: Sending PUBREC to zephyr_publisher (Mid: 49829)</span>
<span class="go">1485663807: Received PUBREL from zephyr_publisher (Mid: 49829)</span>
<span class="go">1485663807: Sending PUBCOMP to zephyr_publisher (Mid: 49829)</span>
<span class="go">1485663808: Received DISCONNECT from zephyr_publisher</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Mar 05, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>