<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gPTP Sample Application &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script type="module" src="../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="Generic GSM Modem Sample" href="../gsm_modem/README.html" />
    <link rel="prev" title="Native Posix Ethernet" href="../eth_native_posix/README.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Samples and Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../classic.html">Classic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html">Basic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../userspace/index.html">Userspace Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsys/subsys.html">Various Subsystems Samples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../net.html">Networking Samples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../capture/README.html">Network Packet Capture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../civetweb/http_server/README.html">Civetweb sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../civetweb/websocket_server/README.html">Civetweb WebSocket Server sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cloud/google_iot_mqtt/README.html">Google IOT MQTT Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cloud/mqtt_azure/README.html">MQTT Azure Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cloud/tagoio_http_post/README.html">TagoIO IoT Cloud HTTP Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dhcpv4_client/README.html">Sample DHCPv4 client application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dns_resolve/README.html">DNS Resolve Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dsa/README.html">DSA Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eth_native_posix/README.html">Native Posix Ethernet</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">gPTP Sample Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-and-running">Building and Running</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../gsm_modem/README.html">Generic GSM Modem Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ipv4_autoconf/README.html">IPv4 autoconf client application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lldp/README.html">LLDP Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lwm2m_client/README.html">LwM2M client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mdns_responder/README.html">mDNS Responder Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mqtt_publisher/README.html">MQTT Publisher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openthread/coprocessor/README.html">OpenThread Co-Processor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../promiscuous_mode/README.html">Promiscuous Mode Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/big_http_download/README.html">Socket Big HTTP Download Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/can/README.html">Socket CAN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/coap_client/README.html">CoAP client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/coap_server/README.html">CoAP Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/dumb_http_server/README.html">Socket Dumb HTTP Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/dumb_http_server_mt/README.html">Socket Multithreaded Dumb HTTP Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/echo/README.html">Socket Echo Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/echo_async/README.html">Asynchronous Socket Echo Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/echo_async_select/README.html">Asynchronous Socket Echo Server Using select()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/echo_client/README.html">Socket Echo Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/echo_server/README.html">Socket Echo Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/http_client/README.html">Socket HTTP Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/http_get/README.html">Socket HTTP GET Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/net_mgmt/README.html">Network Management Socket</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/packet/README.html">Packet socket sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/sntp_client/README.html">SNTP client sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/socketpair/README.html">Socketpair Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/tcp/README.html">TCP Sample for TTCN-3 based Sanity Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/txtime/README.html">SO_TXTIME sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sockets/websocket_client/README.html">Socket Websocket Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats/README.html">Network Statistics Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../syslog_net/README.html">Syslog net Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../telnet/README.html">Sample TELNET console application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../virtual/README.html">Virtual Network Interface Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlan/README.html">Virtual LAN Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wifi/README.html">Wi-Fi sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wpan_serial/README.html">802.15.4 “serial-radio” sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wpanusb/README.html">wpanusb sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../zperf/README.html">zperf: Network Traffic Generator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth/bluetooth.html">Bluetooth samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sensor/sensor.html">Sensor Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../arch/index.html">Architecture Dependent Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../boards/boards.html">Board-specific samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../drivers/drivers.html">Driver Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../application_development/application_development.html">Application development samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shields/shields.html">Shields Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../posix/posix.html">POSIX Subsystem Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kernel/index.html">Various Kernel and Scheduler Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm_integration/tfm_integration.html">TF-M Integration Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm_integration/tfm_integration.html#trusted-firmware-m-tf-m">Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/index.html">External Module Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../compression/compression.html">Compression Samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../index.html">Samples and Demos</a> &raquo;</li>
  
     <li><a href="../net.html">Networking Samples</a> &raquo;</li>
  
  <li>gPTP Sample Application</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main//samples/net/gptp/README.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="gptp-sample-application">
<span id="gptp-sample"></span><h1>gPTP Sample Application<a class="headerlink" href="#gptp-sample-application" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The gPTP sample application for Zephyr will enable gPTP support, registers
gPTP phase discontinuity callback, enable traffic class support (TX multi
queues) and setup VLANs (if enabled). The net-shell is also enabled so that
user can monitor gPTP functionality.</p>
<p>The source code for this sample application can be found at:
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/net/gptp">samples/net/gptp</a>.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>For generic host connectivity, that can be used for debugging purposes, see
<a class="reference internal" href="../../../guides/networking/native_posix_setup.html#networking-with-native-posix"><span class="std std-ref">Networking with native_posix board</span></a> for details.</p>
</div>
<div class="section" id="building-and-running">
<h2>Building and Running<a class="headerlink" href="#building-and-running" title="Permalink to this headline">¶</a></h2>
<p>A good way to run this sample is to run this gPTP application inside
native_posix board as described in <a class="reference internal" href="../../../guides/networking/native_posix_setup.html#networking-with-native-posix"><span class="std std-ref">Networking with native_posix board</span></a> or with
embedded device like NXP FRDM-K64F, Nucleo-H743-ZI, Nucleo-H745ZI-Q,
Nucleo-F767ZI or Atmel SAM-E70 Xplained. Note that gPTP is only supported for
boards that have an Ethernet port and which has support for collecting
timestamps for sent and received Ethernet frames.</p>
<p>Follow these steps to build the gPTP sample application:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b &lt;board to use&gt; samples/net/gptp</span>
</pre></div>
</div>
<p>The net-shell command “<strong>net gptp</strong>” will print out general gPTP information.
For port 1, the command “<strong>net gptp 1</strong>” will print detailed information about
port 1 statistics etc. Note that executing the shell command could affect
the timing of the sent or received gPTP packets and the grandmaster might
mark the device as non AS capable and disable it.</p>
<div class="section" id="setting-up-linux-host">
<h3>Setting up Linux Host<a class="headerlink" href="#setting-up-linux-host" title="Permalink to this headline">¶</a></h3>
<p>If you need VLAN support in your network, then the
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/net/vlan/vlan-setup-linux.sh">samples/net/vlan/vlan-setup-linux.sh</a> provides a script that can be
executed on the Linux host. It creates two VLANs on the Linux host and creates
routes to Zephyr. If you are using native_posix board, then
the <code class="docutils literal notranslate"><span class="pre">net-setup.sh</span></code> will create VLAN setup automatically with this command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./net-setup.sh -c zeth-vlan.conf</span>
</pre></div>
</div>
<p>The OpenAVNU repository at <a class="reference external" href="https://github.com/AVnu">https://github.com/AVnu</a> contains gPTP
daemon that can be run in Linux host and which can act as a grandmaster for
the IEEE 801.1AS network. Note that OpenAVNU will not work with
native_posix board as that board only supports software timestamping and
OpenAVNU only supports hardware timestamping. See instructions at the end
of this chapter how to run linuxptp daemon with native_posix board.</p>
<p>Get OpenAvnu/gPTP project sources</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone git@github.com:AVnu/gptp.git</span>
</pre></div>
</div>
<p>After downloading the source code, compile it like this in Linux:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir build</span>
<span class="go">cd build</span>
<span class="go">cmake ..</span>
<span class="go">make</span>
<span class="go">cp ../gptp_cfg.ini .</span>
</pre></div>
</div>
<p>Edit the <code class="file docutils literal notranslate"><span class="pre">gptp_cfg.ini</span></code> file and set the neighborPropDelayThresh to 10000
as the default value 800 is too low if you run the gPTP in FRDM-K64F.</p>
<p>Then execute the daemon with correct network interface and the configuration
file.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo ./gptp enp0s25 -F gptp_cfg.ini</span>
</pre></div>
</div>
<p>Note that here the example network interface <strong>enp0s25</strong> is the name of the
network interface that is connected to your Zephyr device.</p>
<p>If everything is configured correctly, you should see following kind of
messages from gptp:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">INFO     : GPTP [13:01:14:837] gPTP starting</span>
<span class="go">INFO     : GPTP [13:01:14:838] priority1 = 248</span>
<span class="go">INFO     : GPTP [13:01:14:838] announceReceiptTimeout: 3</span>
<span class="go">INFO     : GPTP [13:01:14:838] syncReceiptTimeout: 3</span>
<span class="go">INFO     : GPTP [13:01:14:838] LINKSPEED_100MB - PHY delay</span>
<span class="go">                    TX: 1044 | RX: 2133</span>
<span class="go">INFO     : GPTP [13:01:14:838] LINKSPEED_1G - PHY delay</span>
<span class="go">                    TX: 184 | RX: 382</span>
<span class="go">INFO     : GPTP [13:01:14:838] neighborPropDelayThresh: 10000</span>
<span class="go">INFO     : GPTP [13:01:14:838] syncReceiptThreshold: 8</span>
<span class="go">ERROR    : GPTP [13:01:14:838] Using clock device: /dev/ptp0</span>
<span class="go">STATUS   : GPTP [13:01:14:838] Starting PDelay</span>
<span class="go">STATUS   : GPTP [13:01:14:838] Link Speed: 1000000 kb/sec</span>
<span class="go">STATUS   : GPTP [13:01:14:871] AsCapable: Enabled</span>
<span class="go">STATUS   : GPTP [13:01:16:497] New Grandmaster &quot;3C:97:0E:FF:FE:23:F2:32&quot; (previous &quot;00:00:00:00:00:00:00:00&quot;)</span>
<span class="go">STATUS   : GPTP [13:01:16:497] Switching to Master</span>
</pre></div>
</div>
<p>If Zephyr syncs properly with gptp daemon, then this is printed:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">STATUS   : GPTP [13:01:25:965] AsCapable: Enabled</span>
</pre></div>
</div>
<p>By default gPTP in Zephyr will not print any gPTP debug messages to console.
One can enable debug prints by setting
<a class="reference internal" href="../../../reference/kconfig/dummy-syms.html#std-kconfig-CONFIG_NET_GPTP_LOG_LEVEL_DBG"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_NET_GPTP_LOG_LEVEL_DBG</span></code></a> in the config file.</p>
<p>For native_posix board, use <code class="docutils literal notranslate"><span class="pre">linuxptp</span></code> project as that supports
software timestamping.</p>
<p>Get linuxptp project sources</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone git://git.code.sf.net/p/linuxptp/code</span>
</pre></div>
</div>
<p>Compile the <code class="docutils literal notranslate"><span class="pre">ptp4l</span></code> daemon and start it like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo ./ptp4l -2 -f gPTP-zephyr.cfg -i zeth -m -q -l 6 -S</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">default.cfg</span></code> as a base, copy it to <code class="docutils literal notranslate"><span class="pre">gPTP-zephyr.cfg</span></code>, and modify
it according to your needs.</p>
</div>
<div class="section" id="multiport-setup">
<h3>Multiport Setup<a class="headerlink" href="#multiport-setup" title="Permalink to this headline">¶</a></h3>
<p>If you set <a class="reference internal" href="../../../reference/kconfig/dummy-syms.html#std-kconfig-CONFIG_NET_GPTP_NUM_PORTS"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_NET_GPTP_NUM_PORTS</span></code></a> larger than 1, then gPTP sample
will create multiple TSN ports. This configuration is currently only supported
in native_posix board.</p>
<p>You need to enable the ports in the net-tools. If the number of ports is set
to 2, then give following commands to create the network interfaces in host
side:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo ./net-setup.sh -c zeth0-gptp.conf -i zeth0 start</span>
<span class="go">sudo ./net-setup.sh -c zeth1-gptp.conf -i zeth1 start</span>
</pre></div>
</div>
<p>After that you can start ptp4l daemon for both interfaces. Please use two
terminals when starting ptp4l daemon. Note that you must use ptp4l as OpenAVNU
does not work with software clock available in native_posix.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd &lt;ptp4l directory&gt;</span>
<span class="go">sudo ./ptp4l -2 -f gPTP-zephyr.cfg -m -q -l 6 -S -i zeth0</span>
<span class="go">sudo ./ptp4l -2 -f gPTP-zephyr.cfg -m -q -l 6 -S -i zeth1</span>
</pre></div>
</div>
<p>Compile Zephyr application.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b native_posix samples/net/gptp</span>
</pre></div>
</div>
<p>When the Zephyr image is build, you can start it like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">build/zephyr/zephyr.exe -attach_uart</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>