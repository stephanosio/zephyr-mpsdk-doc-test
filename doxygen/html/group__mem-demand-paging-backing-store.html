<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zephyr API Documentation: Backing Store APIs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-zephyr.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-zephyr.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Zephyr API Documentation
   &#160;<span id="projectnumber">3.0.99</span>
   </div>
   <div id="projectbrief">A Scalable Open Source RTOS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__mem-demand-paging-backing-store.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Backing Store APIs</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaadedcda81ca04a2044332a8f6787967a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mem-demand-paging-backing-store.html#gaadedcda81ca04a2044332a8f6787967a">k_mem_paging_backing_store_location_get</a> (struct z_page_frame *pf, <a class="el" href="stdint_8h.html#a4788399d1d0b37ccf098a7da82254808">uintptr_t</a> *location, <a class="el" href="stdbool_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> page_fault)</td></tr>
<tr class="separator:gaadedcda81ca04a2044332a8f6787967a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6ad421ad5671d9df3d96e03361f672e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mem-demand-paging-backing-store.html#ga6ad421ad5671d9df3d96e03361f672e8">k_mem_paging_backing_store_location_free</a> (<a class="el" href="stdint_8h.html#a4788399d1d0b37ccf098a7da82254808">uintptr_t</a> location)</td></tr>
<tr class="separator:ga6ad421ad5671d9df3d96e03361f672e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga51f663e0a8c31367082e78097359af6d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mem-demand-paging-backing-store.html#ga51f663e0a8c31367082e78097359af6d">k_mem_paging_backing_store_page_out</a> (<a class="el" href="stdint_8h.html#a4788399d1d0b37ccf098a7da82254808">uintptr_t</a> location)</td></tr>
<tr class="separator:ga51f663e0a8c31367082e78097359af6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9becb4908cc7840ece93a2360692962d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mem-demand-paging-backing-store.html#ga9becb4908cc7840ece93a2360692962d">k_mem_paging_backing_store_page_in</a> (<a class="el" href="stdint_8h.html#a4788399d1d0b37ccf098a7da82254808">uintptr_t</a> location)</td></tr>
<tr class="separator:ga9becb4908cc7840ece93a2360692962d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0902bc03fecfe8c7b51eb1f3efe587b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mem-demand-paging-backing-store.html#ga0902bc03fecfe8c7b51eb1f3efe587b7">k_mem_paging_backing_store_page_finalize</a> (struct z_page_frame *pf, <a class="el" href="stdint_8h.html#a4788399d1d0b37ccf098a7da82254808">uintptr_t</a> location)</td></tr>
<tr class="separator:ga0902bc03fecfe8c7b51eb1f3efe587b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7ff441f23619b2678bfb72559d5bd592"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mem-demand-paging-backing-store.html#ga7ff441f23619b2678bfb72559d5bd592">k_mem_paging_backing_store_init</a> (void)</td></tr>
<tr class="separator:ga7ff441f23619b2678bfb72559d5bd592"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Backing store APIs </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga7ff441f23619b2678bfb72559d5bd592" name="ga7ff441f23619b2678bfb72559d5bd592"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7ff441f23619b2678bfb72559d5bd592">&#9670;&nbsp;</a></span>k_mem_paging_backing_store_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void k_mem_paging_backing_store_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="mem__manage_8h.html">include/sys/mem_manage.h</a>&gt;</code></p>
<p >Backing store initialization function.</p>
<p >The implementation may expect to receive page in/out calls as soon as this returns, but not before that. Called at POST_KERNEL.</p>
<p >This function is expected to do two things:</p><ul>
<li>Initialize any internal data structures and accounting for the backing store.</li>
<li>If the backing store already contains all or some loaded kernel data pages at boot time, Z_PAGE_FRAME_BACKED should be appropriately set for their associated page frames, and any internal accounting set up appropriately. </li>
</ul>

</div>
</div>
<a id="ga6ad421ad5671d9df3d96e03361f672e8" name="ga6ad421ad5671d9df3d96e03361f672e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6ad421ad5671d9df3d96e03361f672e8">&#9670;&nbsp;</a></span>k_mem_paging_backing_store_location_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void k_mem_paging_backing_store_location_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#a4788399d1d0b37ccf098a7da82254808">uintptr_t</a>&#160;</td>
          <td class="paramname"><em>location</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="mem__manage_8h.html">include/sys/mem_manage.h</a>&gt;</code></p>
<p >Free a backing store location</p>
<p >Any stored data may be discarded, and the location token associated with this address may be re-used for some other data page.</p>
<p >This function is invoked with interrupts locked.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">location</td><td>Location token to free </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gaadedcda81ca04a2044332a8f6787967a" name="gaadedcda81ca04a2044332a8f6787967a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaadedcda81ca04a2044332a8f6787967a">&#9670;&nbsp;</a></span>k_mem_paging_backing_store_location_get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int k_mem_paging_backing_store_location_get </td>
          <td>(</td>
          <td class="paramtype">struct z_page_frame *&#160;</td>
          <td class="paramname"><em>pf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#a4788399d1d0b37ccf098a7da82254808">uintptr_t</a> *&#160;</td>
          <td class="paramname"><em>location</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdbool_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td>
          <td class="paramname"><em>page_fault</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="mem__manage_8h.html">include/sys/mem_manage.h</a>&gt;</code></p>
<p >Reserve or fetch a storage location for a data page loaded into a page frame</p>
<p >The returned location token must be unique to the mapped virtual address. This location will be used in the backing store to page out data page contents for later retrieval. The location value must be page-aligned.</p>
<p >This function may be called multiple times on the same data page. If its page frame has its Z_PAGE_FRAME_BACKED bit set, it is expected to return the previous backing store location for the data page containing a cached clean copy. This clean copy may be updated on page-out, or used to discard clean pages without needing to write out their contents.</p>
<p >If the backing store is full, some other backing store location which caches a loaded data page may be selected, in which case its associated page frame will have the Z_PAGE_FRAME_BACKED bit cleared (as it is no longer cached).</p>
<p >pf-&gt;addr will indicate the virtual address the page is currently mapped to. Large, sparse backing stores which can contain the entire address space may simply generate location tokens purely as a function of pf-&gt;addr with no other management necessary.</p>
<p >This function distinguishes whether it was called on behalf of a page fault. A free backing store location must always be reserved in order for page faults to succeed. If the page_fault parameter is not set, this function should return -ENOMEM even if one location is available.</p>
<p >This function is invoked with interrupts locked.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">pf</td><td>Virtual address to obtain a storage location </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">location</td><td>storage location token </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">page_fault</td><td>Whether this request was for a page fault </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 Success </dd>
<dd>
-ENOMEM Backing store is full </dd></dl>

</div>
</div>
<a id="ga0902bc03fecfe8c7b51eb1f3efe587b7" name="ga0902bc03fecfe8c7b51eb1f3efe587b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0902bc03fecfe8c7b51eb1f3efe587b7">&#9670;&nbsp;</a></span>k_mem_paging_backing_store_page_finalize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void k_mem_paging_backing_store_page_finalize </td>
          <td>(</td>
          <td class="paramtype">struct z_page_frame *&#160;</td>
          <td class="paramname"><em>pf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#a4788399d1d0b37ccf098a7da82254808">uintptr_t</a>&#160;</td>
          <td class="paramname"><em>location</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="mem__manage_8h.html">include/sys/mem_manage.h</a>&gt;</code></p>
<p >Update internal accounting after a page-in</p>
<p >This is invoked after <a class="el" href="group__mem-demand-paging-backing-store.html#ga9becb4908cc7840ece93a2360692962d">k_mem_paging_backing_store_page_in()</a> and interrupts have been* re-locked, making it safe to access the z_page_frame data. The location value will be the same passed to <a class="el" href="group__mem-demand-paging-backing-store.html#ga9becb4908cc7840ece93a2360692962d">k_mem_paging_backing_store_page_in()</a>.</p>
<p >The primary use-case for this is to update custom fields for the backing store in the page frame, to reflect where the data should be evicted to if it is paged out again. This may be a no-op in some implementations.</p>
<p >If the backing store caches paged-in data pages, this is the appropriate time to set the Z_PAGE_FRAME_BACKED bit. The kernel only skips paging out clean data pages if they are noted as clean in the page tables and the Z_PAGE_FRAME_BACKED bit is set in their associated page frame.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pf</td><td>Page frame that was loaded in </td></tr>
    <tr><td class="paramname">location</td><td>Location of where the loaded data page was retrieved </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga9becb4908cc7840ece93a2360692962d" name="ga9becb4908cc7840ece93a2360692962d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9becb4908cc7840ece93a2360692962d">&#9670;&nbsp;</a></span>k_mem_paging_backing_store_page_in()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void k_mem_paging_backing_store_page_in </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#a4788399d1d0b37ccf098a7da82254808">uintptr_t</a>&#160;</td>
          <td class="paramname"><em>location</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="mem__manage_8h.html">include/sys/mem_manage.h</a>&gt;</code></p>
<p >Copy a data page from the provided location to Z_SCRATCH_PAGE.</p>
<p >Immediately before this is called, Z_SCRATCH_PAGE will be mapped read-write to the intended destination page frame for the calling context.</p>
<p >Calls to this and <a class="el" href="group__mem-demand-paging-backing-store.html#ga51f663e0a8c31367082e78097359af6d">k_mem_paging_backing_store_page_out()</a> will always be serialized, but interrupts may be enabled.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">location</td><td>Location token for the data page </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga51f663e0a8c31367082e78097359af6d" name="ga51f663e0a8c31367082e78097359af6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga51f663e0a8c31367082e78097359af6d">&#9670;&nbsp;</a></span>k_mem_paging_backing_store_page_out()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void k_mem_paging_backing_store_page_out </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#a4788399d1d0b37ccf098a7da82254808">uintptr_t</a>&#160;</td>
          <td class="paramname"><em>location</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="mem__manage_8h.html">include/sys/mem_manage.h</a>&gt;</code></p>
<p >Copy a data page from Z_SCRATCH_PAGE to the specified location</p>
<p >Immediately before this is called, Z_SCRATCH_PAGE will be mapped read-write to the intended source page frame for the calling context.</p>
<p >Calls to this and <a class="el" href="group__mem-demand-paging-backing-store.html#ga9becb4908cc7840ece93a2360692962d">k_mem_paging_backing_store_page_in()</a> will always be serialized, but interrupts may be enabled.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">location</td><td>Location token for the data page, for later retrieval </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Mar 5 2022 05:00:46 for Zephyr API Documentation by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
<script type="text/javascript">
  $(function() {
    toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
    toggleButton.title = "Toggle Light/Dark Mode"
    $(document).ready(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
    // every resize will remove the button, which is why it has to be added again:
    $(window).resize(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
  })
</script>
</body>
</html>
