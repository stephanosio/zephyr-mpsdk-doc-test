<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Demand Paging &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script type="module" src="../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Shared Multi Heap" href="shared_multi_heap.html" />
    <link rel="prev" title="Memory Management" href="index.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application/index.html">Application Development</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api/index.html">API Status and Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../audio/index.html">Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/notify.html">Asynchronous Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../canbus/index.html">Controller Area Network (CAN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crypto/index.html">Crypto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devicetree/index.html">Devicetree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../drivers/index.html">Device Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../display/index.html">Display Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edac/index.html">Error Detection And Correction (EDAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file_system/index.html">File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iterable_sections/index.html">Iterable Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/formatted_output.html">Formatted Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel/index.html">Kernel Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libc/index.html">C standard library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.html">Logging</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Memory Management</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Demand Paging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#terminology">Terminology</a></li>
<li class="toctree-l4"><a class="reference internal" href="#paging-statistics">Paging Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eviction-algorithm">Eviction Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backing-store">Backing Store</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-reference">API Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="shared_multi_heap.html">Shared Multi Heap</a></li>
<li class="toctree-l3"><a class="reference internal" href="sys_mem_blocks.html">Memory Blocks Allocator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../misc/index.html">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_structures/index.html">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modbus/index.html">Modbus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/index.html">Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../random/index.html">Random Number Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resource_management/index.html">Resource Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/index.html">Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.html">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../task_wdt/index.html">Task Watchdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/timeutil.html">Time Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usb/index.html">USB device support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usermode/index.html">User Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../util/index.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../settings/index.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timing_functions/index.html">Executing Time Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../virtualization/index.html">Virtualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../index.html">API Reference</a> &raquo;</li>
  
     <li><a href="index.html">Memory Management</a> &raquo;</li>
  
  <li>Demand Paging</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/reference/memory_management/demand_paging.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="demand-paging">
<span id="memory-management-api-demand-paging"></span><h1>Demand Paging<a class="headerlink" href="#demand-paging" title="Permalink to this headline">¶</a></h1>
<p>Demand paging provides a mechanism where data is only brought into physical
memory as required by current execution context. The physical memory is
conceptually divided in page-sized page frames as regions to hold data.</p>
<ul class="simple">
<li><p>When the processor tries to access data and the data page exists in
one of the page frames, the execution continues without any interruptions.</p></li>
<li><p>When the processor tries to access the data page that does not exist
in any page frames, a page fault occurs. The paging code then brings in
the corresponding data page from backing store into physical memory if
there is a free page frame. If there is no more free page frames,
the eviction algorithm is invoked to select a data page to be paged out,
thus freeing up a page frame for new data to be paged in. If this data
page has been modified after it is first paged in, the data will be
written back into the backing store. If no modifications is done or
after written back into backing store, the data page is now considered
paged out and the corresponding page frame is now free. The paging code
then invokes the backing store to page in the data page corresponding to
the location of the requested data. The backing store copies that data
page into the free page frame. Now the data page is in physical memory
and execution can continue.</p></li>
</ul>
<p>There are functions where paging in and out can be invoked manually
using <a class="reference internal" href="#c.k_mem_page_in" title="k_mem_page_in"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_page_in()</span></code></a> and <a class="reference internal" href="#c.k_mem_page_out" title="k_mem_page_out"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_page_out()</span></code></a>.
<a class="reference internal" href="#c.k_mem_page_in" title="k_mem_page_in"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_page_in()</span></code></a> can be used to page in data pages
in anticipation that they are required in the near future. This is used to
minimize number of page faults as these data pages are already in physical
memory, and thus minimizing latency. <a class="reference internal" href="#c.k_mem_page_out" title="k_mem_page_out"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_page_out()</span></code></a> can be
used to page out data pages where they are not going to be accessed for
a considerable amount of time. This frees up page frames so that the next
page in can be executed faster as the paging code does not need to invoke
the eviction algorithm.</p>
<div class="section" id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>Data Page</dt><dd><p>A data page is a page-sized region of data. It may exist in a page frame,
or be paged out to some backing store. Its location can always be looked
up in the CPU’s page tables (or equivalent) by virtual address.
The data type will always be <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span></code> or in some cases <code class="docutils literal notranslate"><span class="pre">uint8_t</span> <span class="pre">*</span></code>
when doing pointer arithmetic.</p>
</dd>
<dt>Page Frame</dt><dd><p>A page frame is a page-sized physical memory region in RAM. It is a
container where a data page may be placed. It is always referred to by
physical address. Zephyr has a convention of using <code class="docutils literal notranslate"><span class="pre">uintptr_t</span></code> for physical
addresses. For every page frame, a <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">z_page_frame</span></code> is instantiated to
store metadata. Flags for each page frame:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Z_PAGE_FRAME_PINNED</span></code> indicates a page frame is pinned in memory
and should never be paged out.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Z_PAGE_FRAME_RESERVED</span></code> indicates a physical page reserved by hardware
and should not be used at all.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Z_PAGE_FRAME_MAPPED</span></code> is set when a physical page is mapped to
virtual memory address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Z_PAGE_FRAME_BUSY</span></code> indicates a page frame is currently involved in
a page-in/out operation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Z_PAGE_FRAME_BACKED</span></code> indicates a page frame has a clean copy
in the backing store.</p></li>
</ul>
</dd>
<dt>Z_SCRATCH_PAGE</dt><dd><p>The virtual address of a special page provided to the backing store to:
* Copy a data page from <code class="docutils literal notranslate"><span class="pre">Z_SCRATCH_PAGE</span></code> to the specified location; or,
* Copy a data page from the provided location to <code class="docutils literal notranslate"><span class="pre">Z_SCRATCH_PAGE</span></code>.
This is used as an intermediate page for page in/out operations. This
scratch needs to be mapped read/write for backing store code to access.
However the data page itself may only be mapped as read-only in virtual
address space. If this page is provided as-is to backing store,
the data page must be re-mapped as read/write which has security
implications as the data page is no longer read-only to other parts of
the application.</p>
</dd>
</dl>
</div>
<div class="section" id="paging-statistics">
<h2>Paging Statistics<a class="headerlink" href="#paging-statistics" title="Permalink to this headline">¶</a></h2>
<p>Paging statistics can be obtained via various function calls when
<a class="reference internal" href="../kconfig/dummy-syms.html#std-kconfig-CONFIG_DEMAND_PAGING_TIMING_HISTOGRAM_NUM_BINS"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_DEMAND_PAGING_TIMING_HISTOGRAM_NUM_BINS</span></code></a> is enabled:</p>
<ul class="simple">
<li><p>Overall statistics via <a class="reference internal" href="#c.k_mem_paging_stats_get" title="k_mem_paging_stats_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_stats_get()</span></code></a></p></li>
<li><p>Per-thread statistics via <a class="reference internal" href="#c.k_mem_paging_thread_stats_get" title="k_mem_paging_thread_stats_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_thread_stats_get()</span></code></a>
if <a class="reference internal" href="../kconfig/dummy-syms.html#std-kconfig-CONFIG_DEMAND_PAGING_THREAD_STATS"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_DEMAND_PAGING_THREAD_STATS</span></code></a> is enabled</p></li>
<li><p>Execution time histogram can be obtained when
<a class="reference internal" href="../kconfig/dummy-syms.html#std-kconfig-CONFIG_DEMAND_PAGING_TIMING_HISTOGRAM"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_DEMAND_PAGING_TIMING_HISTOGRAM</span></code></a> is enabled, and
<a class="reference internal" href="../kconfig/dummy-syms.html#std-kconfig-CONFIG_DEMAND_PAGING_TIMING_HISTOGRAM_NUM_BINS"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_DEMAND_PAGING_TIMING_HISTOGRAM_NUM_BINS</span></code></a> is defined.
Note that the timing is highly dependent on the architecture,
SoC or board. It is highly recommended that
<code class="docutils literal notranslate"><span class="pre">k_mem_paging_eviction_histogram_bounds[]</span></code> and
<code class="docutils literal notranslate"><span class="pre">k_mem_paging_backing_store_histogram_bounds[]</span></code>
be defined for a particular application.</p>
<ul>
<li><p>Execution time histogram of eviction algorithm via
<a class="reference internal" href="#c.k_mem_paging_histogram_eviction_get" title="k_mem_paging_histogram_eviction_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_histogram_eviction_get()</span></code></a></p></li>
<li><p>Execution time histogram of backing store doing page-in via
<a class="reference internal" href="#c.k_mem_paging_histogram_backing_store_page_in_get" title="k_mem_paging_histogram_backing_store_page_in_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_histogram_backing_store_page_in_get()</span></code></a></p></li>
<li><p>Execution time histogram of backing store doing page-out via
<a class="reference internal" href="#c.k_mem_paging_histogram_backing_store_page_out_get" title="k_mem_paging_histogram_backing_store_page_out_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_histogram_backing_store_page_out_get()</span></code></a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="eviction-algorithm">
<h2>Eviction Algorithm<a class="headerlink" href="#eviction-algorithm" title="Permalink to this headline">¶</a></h2>
<p>The eviction algorithm is used to determine which data page and its
corresponding page frame can be paged out to free up a page frame
for the next page in operation. There are two functions which are
called from the kernel paging code:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.k_mem_paging_eviction_init" title="k_mem_paging_eviction_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_eviction_init()</span></code></a> is called to initialize
the eviction algorithm. This is called at <code class="docutils literal notranslate"><span class="pre">POST_KERNEL</span></code>.</p></li>
<li><p><a class="reference internal" href="#c.k_mem_paging_eviction_select" title="k_mem_paging_eviction_select"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_eviction_select()</span></code></a> is called to select
a data page to evict. A function argument <code class="docutils literal notranslate"><span class="pre">dirty</span></code> is written to
signal the caller whether the selected data page has been modified
since it is first paged in. If the <code class="docutils literal notranslate"><span class="pre">dirty</span></code> bit is returned
as set, the paging code signals to the backing store to write
the data page back into storage (thus updating its content).
The function returns a pointer to the page frame corresponding to
the selected data page.</p></li>
</ul>
<p>Currently, a NRU (Not-Recently-Used) eviction algorithm has been
implemented as a sample. This is a very simple algorithm which
ranks each data page on whether they have been accessed and modified.
The selection is based on this ranking.</p>
<p>To implement a new eviction algorithm, the two functions mentioned
above must be implemented.</p>
</div>
<div class="section" id="backing-store">
<h2>Backing Store<a class="headerlink" href="#backing-store" title="Permalink to this headline">¶</a></h2>
<p>Backing store is responsible for paging in/out data page between
their corresponding page frames and storage. These are the functions
which must be implemented:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.k_mem_paging_backing_store_init" title="k_mem_paging_backing_store_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_backing_store_init()</span></code></a> is called to
initialized the backing store at <code class="docutils literal notranslate"><span class="pre">POST_KERNEL</span></code>.</p></li>
<li><p><a class="reference internal" href="#c.k_mem_paging_backing_store_location_get" title="k_mem_paging_backing_store_location_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_backing_store_location_get()</span></code></a> is called to
reserve a backing store location so a data page can be paged out.
This <code class="docutils literal notranslate"><span class="pre">location</span></code> token is passed to
<a class="reference internal" href="#c.k_mem_paging_backing_store_page_out" title="k_mem_paging_backing_store_page_out"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_backing_store_page_out()</span></code></a> to perform actual
page out operation.</p></li>
<li><p><a class="reference internal" href="#c.k_mem_paging_backing_store_location_free" title="k_mem_paging_backing_store_location_free"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_backing_store_location_free()</span></code></a> is called to
free a backing store location (the <code class="docutils literal notranslate"><span class="pre">location</span></code> token) which can
then be used for subsequent page out operation.</p></li>
<li><p><a class="reference internal" href="#c.k_mem_paging_backing_store_page_in" title="k_mem_paging_backing_store_page_in"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_backing_store_page_in()</span></code></a> copies a data page
from the backing store location associated with the provided
<code class="docutils literal notranslate"><span class="pre">location</span></code> token to the page pointed by <code class="docutils literal notranslate"><span class="pre">Z_SCRATCH_PAGE</span></code>.</p></li>
<li><p><a class="reference internal" href="#c.k_mem_paging_backing_store_page_out" title="k_mem_paging_backing_store_page_out"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_backing_store_page_out()</span></code></a> copies a data page
from <code class="docutils literal notranslate"><span class="pre">Z_SCRATCH_PAGE</span></code> to the backing store location associated
with the provided <code class="docutils literal notranslate"><span class="pre">location</span></code> token.</p></li>
<li><p><a class="reference internal" href="#c.k_mem_paging_backing_store_page_finalize" title="k_mem_paging_backing_store_page_finalize"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_backing_store_page_finalize()</span></code></a> is invoked after
<a class="reference internal" href="#c.k_mem_paging_backing_store_page_in" title="k_mem_paging_backing_store_page_in"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_backing_store_page_in()</span></code></a> so that the page frame
struct may be updated for internal accounting. This can be
a no-op.</p></li>
</ul>
<p>To implement a new backing store, the functions mentioned above
must be implemented.
<a class="reference internal" href="#c.k_mem_paging_backing_store_page_finalize" title="k_mem_paging_backing_store_page_finalize"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mem_paging_backing_store_page_finalize()</span></code></a> can be an empty
function if so desired.</p>
</div>
<div class="section" id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__mem-demand-paging"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">mem-demand-paging</span></span></dt>
<dd><div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_page_out">
<span class="target" id="group__mem-demand-paging_1ga0b18037209b4d8b5964bd9a1d760f703"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_page_out</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">addr</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_page_out" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Evict a page-aligned virtual memory region to the backing store</p>
<p>Useful if it is known that a memory region will not be used for some time. All the data pages within the specified region will be evicted to the backing store if they weren’t already, with their associated page frames marked as available for mappings or page-ins.</p>
<p>None of the associated page frames mapped to the provided region should be pinned.</p>
<p>Note that there are no guarantees how long these pages will be evicted, they could take page faults immediately.</p>
<p>If CONFIG_DEMAND_PAGING_ALLOW_IRQ is enabled, this function may not be called by ISRs as the backing store may be in-use.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>addr</strong> – Base page-aligned virtual address </p></li>
<li><p><strong>size</strong> – Page-aligned data region size </p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Success </p></li>
<li><p><strong>-ENOMEM</strong> – Insufficient space in backing store to satisfy request. The region may be partially paged out. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_page_in">
<span class="target" id="group__mem-demand-paging_1gab36c36a4e230677d2090514f7a34b408"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_page_in</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">addr</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_page_in" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Load a virtual data region into memory</p>
<p>After the function completes, all the page frames associated with this function will be paged in. However, they are not guaranteed to stay there. This is useful if the region is known to be used soon.</p>
<p>If CONFIG_DEMAND_PAGING_ALLOW_IRQ is enabled, this function may not be called by ISRs as the backing store may be in-use.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>addr</strong> – Base page-aligned virtual address </p></li>
<li><p><strong>size</strong> – Page-aligned data region size </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_pin">
<span class="target" id="group__mem-demand-paging_1ga5f2d422edde7d366e81a870ce057589f"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_pin</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">addr</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_pin" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Pin an aligned virtual data region, paging in as necessary</p>
<p>After the function completes, all the page frames associated with this region will be resident in memory and pinned such that they stay that way. This is a stronger version of z_mem_page_in().</p>
<p>If CONFIG_DEMAND_PAGING_ALLOW_IRQ is enabled, this function may not be called by ISRs as the backing store may be in-use.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>addr</strong> – Base page-aligned virtual address </p></li>
<li><p><strong>size</strong> – Page-aligned data region size </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_unpin">
<span class="target" id="group__mem-demand-paging_1ga3278aae5e24733c722b7d83c4b17dab3"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_unpin</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">addr</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_unpin" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Un-pin an aligned virtual data region</p>
<p>After the function completes, all the page frames associated with this region will be no longer marked as pinned. This does not evict the region, follow this with z_mem_page_out() if you need that.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>addr</strong> – Base page-aligned virtual address </p></li>
<li><p><strong>size</strong> – Page-aligned data region size </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_stats_get">
<span class="target" id="group__mem-demand-paging_1ga52ad88e0c0eed2aa27331bfd4707b7ec"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_stats_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">k_mem_paging_stats_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">stats</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_stats_get" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the paging statistics since system startup</p>
<p>This populates the paging statistics struct being passed in as argument.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stats</strong> – <strong>[inout]</strong> Paging statistics struct to be filled. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_thread_stats_get">
<span class="target" id="group__mem-demand-paging_1gafad6b39cb2faf3bb416cd4d3faaa8d8c"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_thread_stats_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../kernel/threads/index.html#c.k_thread" title="k_thread"><span class="n"><span class="pre">k_thread</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">thread</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">k_mem_paging_stats_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">stats</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_thread_stats_get" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the paging statistics since system startup for a thread</p>
<p>This populates the paging statistics struct being passed in as argument for a particular thread.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>thread</strong> – <strong>[in]</strong> Thread </p></li>
<li><p><strong>stats</strong> – <strong>[inout]</strong> Paging statistics struct to be filled. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_histogram_eviction_get">
<span class="target" id="group__mem-demand-paging_1gaec64d019d819b00c7bc3804aac269199"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_histogram_eviction_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">k_mem_paging_histogram_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">hist</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_histogram_eviction_get" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the eviction timing histogram</p>
<p>This populates the timing histogram struct being passed in as argument.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hist</strong> – <strong>[inout]</strong> Timing histogram struct to be filled. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_histogram_backing_store_page_in_get">
<span class="target" id="group__mem-demand-paging_1ga1da0a643e8f85f98e29288e441a37dfa"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_histogram_backing_store_page_in_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">k_mem_paging_histogram_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">hist</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_histogram_backing_store_page_in_get" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the backing store page-in timing histogram</p>
<p>This populates the timing histogram struct being passed in as argument.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hist</strong> – <strong>[inout]</strong> Timing histogram struct to be filled. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_histogram_backing_store_page_out_get">
<span class="target" id="group__mem-demand-paging_1gae4f80d14f88a46ddb9aeb7afba861864"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_histogram_backing_store_page_out_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">k_mem_paging_histogram_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">hist</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_histogram_backing_store_page_out_get" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the backing store page-out timing histogram</p>
<p>This populates the timing histogram struct being passed in as argument.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hist</strong> – <strong>[inout]</strong> Timing histogram struct to be filled. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</dd></dl>

<div class="section" id="eviction-algorithm-apis">
<h3>Eviction Algorithm APIs<a class="headerlink" href="#eviction-algorithm-apis" title="Permalink to this headline">¶</a></h3>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__mem-demand-paging-eviction"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">mem-demand-paging-eviction</span></span></dt>
<dd><p>Eviction algorithm APIs </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_eviction_select">
<span class="target" id="group__mem-demand-paging-eviction_1ga12641d53942529c7d7364c08473a6eca"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">z_page_frame</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_eviction_select</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dirty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_eviction_select" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Select a page frame for eviction</p>
<p>The kernel will invoke this to choose a page frame to evict if there are no free page frames.</p>
<p>This function will never be called before the initial <a class="reference internal" href="#group__mem-demand-paging-eviction_1ga68dcfc0e5374de2c8ad7b9fe4e65c4f4"><span class="std std-ref">k_mem_paging_eviction_init()</span></a>.</p>
<p>This function is invoked with interrupts locked.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dirty</strong> – <strong>[out]</strong> Whether the page to evict is dirty </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The page frame to evict </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_eviction_init">
<span class="target" id="group__mem-demand-paging-eviction_1ga68dcfc0e5374de2c8ad7b9fe4e65c4f4"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_eviction_init</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_eviction_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Initialization function</p>
<p>Called at POST_KERNEL to perform any necessary initialization tasks for the eviction algorithm. <a class="reference internal" href="#group__mem-demand-paging-eviction_1ga12641d53942529c7d7364c08473a6eca"><span class="std std-ref">k_mem_paging_eviction_select()</span></a> is guaranteed to never be called until this has returned, and this will only be called once. </p>
</dd></dl>

</div>
</dd></dl>

</div>
<div class="section" id="backing-store-apis">
<h3>Backing Store APIs<a class="headerlink" href="#backing-store-apis" title="Permalink to this headline">¶</a></h3>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__mem-demand-paging-backing-store"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">mem-demand-paging-backing-store</span></span></dt>
<dd><p>Backing store APIs </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_backing_store_location_get">
<span class="target" id="group__mem-demand-paging-backing-store_1gaadedcda81ca04a2044332a8f6787967a"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_backing_store_location_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">z_page_frame</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pf</span></span>, <span class="n"><span class="pre">uintptr_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">location</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">page_fault</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_backing_store_location_get" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Reserve or fetch a storage location for a data page loaded into a page frame</p>
<p>The returned location token must be unique to the mapped virtual address. This location will be used in the backing store to page out data page contents for later retrieval. The location value must be page-aligned.</p>
<p>This function may be called multiple times on the same data page. If its page frame has its Z_PAGE_FRAME_BACKED bit set, it is expected to return the previous backing store location for the data page containing a cached clean copy. This clean copy may be updated on page-out, or used to discard clean pages without needing to write out their contents.</p>
<p>If the backing store is full, some other backing store location which caches a loaded data page may be selected, in which case its associated page frame will have the Z_PAGE_FRAME_BACKED bit cleared (as it is no longer cached).</p>
<p>pf-&gt;addr will indicate the virtual address the page is currently mapped to. Large, sparse backing stores which can contain the entire address space may simply generate location tokens purely as a function of pf-&gt;addr with no other management necessary.</p>
<p>This function distinguishes whether it was called on behalf of a page fault. A free backing store location must always be reserved in order for page faults to succeed. If the page_fault parameter is not set, this function should return -ENOMEM even if one location is available.</p>
<p>This function is invoked with interrupts locked.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pf</strong> – Virtual address to obtain a storage location </p></li>
<li><p><strong>location</strong> – <strong>[out]</strong> storage location token </p></li>
<li><p><strong>page_fault</strong> – Whether this request was for a page fault </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>0 Success </p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>-ENOMEM Backing store is full </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_backing_store_location_free">
<span class="target" id="group__mem-demand-paging-backing-store_1ga6ad421ad5671d9df3d96e03361f672e8"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_backing_store_location_free</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uintptr_t</span></span><span class="w"> </span><span class="n"><span class="pre">location</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_backing_store_location_free" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Free a backing store location</p>
<p>Any stored data may be discarded, and the location token associated with this address may be re-used for some other data page.</p>
<p>This function is invoked with interrupts locked.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>location</strong> – Location token to free </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_backing_store_page_out">
<span class="target" id="group__mem-demand-paging-backing-store_1ga51f663e0a8c31367082e78097359af6d"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_backing_store_page_out</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uintptr_t</span></span><span class="w"> </span><span class="n"><span class="pre">location</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_backing_store_page_out" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Copy a data page from Z_SCRATCH_PAGE to the specified location</p>
<p>Immediately before this is called, Z_SCRATCH_PAGE will be mapped read-write to the intended source page frame for the calling context.</p>
<p>Calls to this and <a class="reference internal" href="#group__mem-demand-paging-backing-store_1ga9becb4908cc7840ece93a2360692962d"><span class="std std-ref">k_mem_paging_backing_store_page_in()</span></a> will always be serialized, but interrupts may be enabled.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>location</strong> – Location token for the data page, for later retrieval </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_backing_store_page_in">
<span class="target" id="group__mem-demand-paging-backing-store_1ga9becb4908cc7840ece93a2360692962d"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_backing_store_page_in</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uintptr_t</span></span><span class="w"> </span><span class="n"><span class="pre">location</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_backing_store_page_in" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Copy a data page from the provided location to Z_SCRATCH_PAGE.</p>
<p>Immediately before this is called, Z_SCRATCH_PAGE will be mapped read-write to the intended destination page frame for the calling context.</p>
<p>Calls to this and <a class="reference internal" href="#group__mem-demand-paging-backing-store_1ga51f663e0a8c31367082e78097359af6d"><span class="std std-ref">k_mem_paging_backing_store_page_out()</span></a> will always be serialized, but interrupts may be enabled.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>location</strong> – Location token for the data page </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_backing_store_page_finalize">
<span class="target" id="group__mem-demand-paging-backing-store_1ga0902bc03fecfe8c7b51eb1f3efe587b7"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_backing_store_page_finalize</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">z_page_frame</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pf</span></span>, <span class="n"><span class="pre">uintptr_t</span></span><span class="w"> </span><span class="n"><span class="pre">location</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_backing_store_page_finalize" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Update internal accounting after a page-in</p>
<p>This is invoked after <a class="reference internal" href="#group__mem-demand-paging-backing-store_1ga9becb4908cc7840ece93a2360692962d"><span class="std std-ref">k_mem_paging_backing_store_page_in()</span></a> and interrupts have been* re-locked, making it safe to access the z_page_frame data. The location value will be the same passed to <a class="reference internal" href="#group__mem-demand-paging-backing-store_1ga9becb4908cc7840ece93a2360692962d"><span class="std std-ref">k_mem_paging_backing_store_page_in()</span></a>.</p>
<p>The primary use-case for this is to update custom fields for the backing store in the page frame, to reflect where the data should be evicted to if it is paged out again. This may be a no-op in some implementations.</p>
<p>If the backing store caches paged-in data pages, this is the appropriate time to set the Z_PAGE_FRAME_BACKED bit. The kernel only skips paging out clean data pages if they are noted as clean in the page tables and the Z_PAGE_FRAME_BACKED bit is set in their associated page frame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pf</strong> – Page frame that was loaded in </p></li>
<li><p><strong>location</strong> – Location of where the loaded data page was retrieved </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mem_paging_backing_store_init">
<span class="target" id="group__mem-demand-paging-backing-store_1ga7ff441f23619b2678bfb72559d5bd592"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mem_paging_backing_store_init</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mem_paging_backing_store_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Backing store initialization function.</p>
<p>The implementation may expect to receive page in/out calls as soon as this returns, but not before that. Called at POST_KERNEL.</p>
<p>This function is expected to do two things:<ul class="simple">
<li><p>Initialize any internal data structures and accounting for the backing store.</p></li>
<li><p>If the backing store already contains all or some loaded kernel data pages at boot time, Z_PAGE_FRAME_BACKED should be appropriately set for their associated page frames, and any internal accounting set up appropriately. </p></li>
</ul>
</p>
</dd></dl>

</div>
</dd></dl>

</div>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>