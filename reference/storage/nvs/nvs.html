<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Non-Volatile Storage (NVS) &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script type="module" src="../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="Disk Access" href="../disk/access.html" />
    <link rel="prev" title="Storage" href="../index.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html">API Status and Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../audio/index.html">Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/notify.html">Asynchronous Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../canbus/index.html">Controller Area Network (CAN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto/index.html">Crypto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../devicetree/index.html">Devicetree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../drivers/index.html">Device Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../display/index.html">Display Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edac/index.html">Error Detection And Correction (EDAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../file_system/index.html">File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iterable_sections/index.html">Iterable Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/formatted_output.html">Formatted Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kernel/index.html">Kernel Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../libc/index.html">C standard library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/index.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../memory_management/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/index.html">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data_structures/index.html">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modbus/index.html">Modbus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../peripherals/index.html">Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../random/index.html">Random Number Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../resource_management/index.html">Resource Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shell/index.html">Shell</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Storage</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Non-Volatile Storage (NVS)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#flash-wear">Flash wear</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flash-write-block-size-migration">Flash write block size migration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sample">Sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-reference">API Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../disk/access.html">Disk Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="../flash_map/flash_map.html">Flash map</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fcb/fcb.html">Flash Circular Buffer (FCB)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stream/stream_flash.html">Stream Flash</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../task_wdt/index.html">Task Watchdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/timeutil.html">Time Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usb/index.html">USB device support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usermode/index.html">User Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../util/index.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../settings/index.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timing_functions/index.html">Executing Time Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../virtualization/index.html">Virtualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../index.html">API Reference</a> &raquo;</li>
  
     <li><a href="../index.html">Storage</a> &raquo;</li>
  
  <li>Non-Volatile Storage (NVS)</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/reference/storage/nvs/nvs.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="non-volatile-storage-nvs">
<span id="nvs-api"></span><h1>Non-Volatile Storage (NVS)<a class="headerlink" href="#non-volatile-storage-nvs" title="Permalink to this headline">¶</a></h1>
<p>Elements, represented as id-data pairs, are stored in flash using a
FIFO-managed circular buffer. The flash area is divided into sectors. Elements
are appended to a sector until storage space in the sector is exhausted. Then a
new sector in the flash area is prepared for use (erased). Before erasing the
sector it is checked that identifier - data pairs exist in the sectors in use,
if not the id-data pair is copied.</p>
<p>The id is a 16-bit unsigned number. NVS ensures that for each used id there is
at least one id-data pair stored in flash at all time.</p>
<p>NVS allows storage of binary blobs, strings, integers, longs, and any
combination of these.</p>
<p>Each element is stored in flash as metadata (8 byte) and data. The metadata is
written in a table starting from the end of a nvs sector, the data is
written one after the other from the start of the sector. The metadata consists
of: id, data offset in sector, data length, part (unused) and a crc.</p>
<p>A write of data to nvs always starts with writing the data, followed by a write
of the metadata. Data that is written in flash without metadata is ignored
during initialization.</p>
<p>During initialization NVS will verify the data stored in flash, if it
encounters an error it will ignore any data with missing/incorrect metadata.</p>
<p>NVS checks the id-data pair before writing data to flash. If the id-data pair
is unchanged no write to flash is performed.</p>
<p>To protect the flash area against frequent erases it is important that there is
sufficient free space. NVS has a protection mechanism to avoid getting in a
endless loop of flash page erases when there is limited free space. When such
a loop is detected NVS returns that there is no more space available.</p>
<p>For NVS the file system is declared as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">nvs_fs</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="p">.</span><span class="n">sector_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NVS_SECTOR_SIZE</span><span class="p">,</span><span class="w"></span>
<span class="p">.</span><span class="n">sector_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NVS_SECTOR_COUNT</span><span class="p">,</span><span class="w"></span>
<span class="p">.</span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NVS_STORAGE_OFFSET</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NVS_SECTOR_SIZE</span></code> is the sector size, it has to be a multiple of
the flash erase page size and a power of 2.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NVS_SECTOR_COUNT</span></code> is the number of sectors, it is at least 2, one
sector is always kept empty to allow copying of existing data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NVS_STORAGE_OFFSET</span></code> is the offset of the storage area in flash.</p></li>
</ul>
<div class="section" id="flash-wear">
<h2>Flash wear<a class="headerlink" href="#flash-wear" title="Permalink to this headline">¶</a></h2>
<p>When writing data to flash a study of the flash wear is important. Flash has a
limited life which is determined by the number of times flash can be erased.
Flash is erased one page at a time and the pagesize is determined by the
hardware. As an example a nRF51822 device has a pagesize of 1024 bytes and each
page can be erased about 20,000 times.</p>
<div class="section" id="calculating-expected-device-lifetime">
<h3>Calculating expected device lifetime<a class="headerlink" href="#calculating-expected-device-lifetime" title="Permalink to this headline">¶</a></h3>
<p>Suppose we use a 4 bytes state variable that is changed every minute and
needs to be restored after reboot. NVS has been defined with a sector_size
equal to the pagesize (1024 bytes) and 2 sectors have been defined.</p>
<p>Each write of the state variable requires 12 bytes of flash storage: 8 bytes
for the metadata and 4 bytes for the data. When storing the data the
first sector will be full after 1024/12 = 85.33 minutes. After another 85.33
minutes, the second sector is full.  When this happens, because we’re using
only two sectors, the first sector will be used for storage and will be erased
after 171 minutes of system time.  With the expected device life of 20,000
writes, with two sectors writing every 171 minutes, the device should last
about 171 * 20,000 minutes, or about 6.5 years.</p>
<p>More generally then, with</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NS</span></code> as the number of storage requests per minute,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DS</span></code> as the data size in bytes,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SECTOR_SIZE</span></code> in bytes, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PAGE_ERASES</span></code> as the number of times the page can be erased,</p></li>
</ul>
<p>the expected device life (in minutes) can be calculated as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SECTOR_COUNT</span> <span class="o">*</span> <span class="n">SECTOR_SIZE</span> <span class="o">*</span> <span class="n">PAGE_ERASES</span> <span class="o">/</span> <span class="p">(</span><span class="n">NS</span> <span class="o">*</span> <span class="p">(</span><span class="n">DS</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span> <span class="n">minutes</span>
</pre></div>
</div>
<p>From this formula it is also clear what to do in case the expected life is too
short: increase <code class="docutils literal notranslate"><span class="pre">SECTOR_COUNT</span></code> or <code class="docutils literal notranslate"><span class="pre">SECTOR_SIZE</span></code>.</p>
</div>
</div>
<div class="section" id="flash-write-block-size-migration">
<h2>Flash write block size migration<a class="headerlink" href="#flash-write-block-size-migration" title="Permalink to this headline">¶</a></h2>
<p>It is possible that during a DFU process, the flash driver used by the NVS
changes the supported minimal write block size.
The NVS in-flash image will stay compatible unless the
physical ATE size changes.
Especially, migration between 1,2,4,8-bytes write block sizes is allowed.</p>
</div>
<div class="section" id="sample">
<h2>Sample<a class="headerlink" href="#sample" title="Permalink to this headline">¶</a></h2>
<p>A sample of how NVS can be used is supplied in <code class="docutils literal notranslate"><span class="pre">samples/subsys/nvs</span></code>.</p>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>MPU fault while using NVS, or <code class="docutils literal notranslate"><span class="pre">-ETIMEDOUT</span></code> error returned</dt><dd><p>NVS can use the internal flash of the SoC.  While the MPU is enabled,
the flash driver requires MPU RWX access to flash memory, configured
using <a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_MPU_ALLOW_FLASH_WRITE"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_MPU_ALLOW_FLASH_WRITE</span></code></a>.  If this option is
disabled, the NVS application will get an MPU fault if it references
the internal SoC flash and it’s the only thread running.  In a
multi-threaded application, another thread might intercept the fault
and the NVS API will return an <code class="docutils literal notranslate"><span class="pre">-ETIMEDOUT</span></code> error.</p>
</dd>
</dl>
</div>
<div class="section" id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<p>The NVS subsystem APIs are provided by <code class="docutils literal notranslate"><span class="pre">nvs.h</span></code>:</p>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__nvs__data__structures"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">nvs_data_structures</span></span></dt>
<dd><p>Non-volatile Storage Data Structures. </p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.nvs_fs">
<span class="target" id="structnvs__fs"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nvs_fs</span></span></span><a class="headerlink" href="#c.nvs_fs" title="Permalink to this definition">¶</a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;nvs.h&gt;</em></div>
<p>Non-volatile Storage File system structure. </p>
<dl class="field-list simple">
<dt class="field-odd">Param offset</dt>
<dd class="field-odd"><p>File system offset in flash </p>
</dd>
<dt class="field-even">Param ate_wra</dt>
<dd class="field-even"><p>Allocation table entry write address. Addresses are stored as uint32_t: high 2 bytes correspond to the sector, low 2 bytes are the offset in the sector </p>
</dd>
<dt class="field-odd">Param data_wra</dt>
<dd class="field-odd"><p>Data write address </p>
</dd>
<dt class="field-even">Param sector_size</dt>
<dd class="field-even"><p>File system is split into sectors, each sector must be multiple of pagesize </p>
</dd>
<dt class="field-odd">Param sector_count</dt>
<dd class="field-odd"><p>Number of sectors in the file systems </p>
</dd>
<dt class="field-even">Param ready</dt>
<dd class="field-even"><p>Flag indicating if the filesystem is initialized </p>
</dd>
<dt class="field-odd">Param nvs_lock</dt>
<dd class="field-odd"><p>Mutex </p>
</dd>
<dt class="field-even">Param flash_device</dt>
<dd class="field-even"><p>Flash Device runtime structure </p>
</dd>
<dt class="field-odd">Param flash_parameters</dt>
<dd class="field-odd"><p>Flash memory parameters structure </p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__nvs__high__level__api"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">nvs_high_level_api</span></span></dt>
<dd><p>Non-volatile Storage APIs. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.nvs_init">
<span class="target" id="group__nvs__high__level__api_1ga1867563e4a7932f25f3c961114d746d5"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nvs_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.nvs_fs" title="nvs_fs"><span class="n"><span class="pre">nvs_fs</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fs</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dev_name</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nvs_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>nvs_init </p>
<p>Initializes a NVS file system in flash.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fs</strong> – Pointer to file system </p></li>
<li><p><strong>dev_name</strong> – Pointer to flash device name </p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Success </p></li>
<li><p><strong>-ERRNO</strong> – errno code if error </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nvs_clear">
<span class="target" id="group__nvs__high__level__api_1ga42ee9fd0d98f89dcabc5888f8b4600f0"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nvs_clear</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.nvs_fs" title="nvs_fs"><span class="n"><span class="pre">nvs_fs</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fs</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nvs_clear" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>nvs_clear </p>
<p>Clears the NVS file system from flash. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fs</strong> – Pointer to file system </p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Success </p></li>
<li><p><strong>-ERRNO</strong> – errno code if error </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nvs_write">
<span class="target" id="group__nvs__high__level__api_1ga34d40e9f63ba514d7915b72c4fef0b82"></span><span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nvs_write</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.nvs_fs" title="nvs_fs"><span class="n"><span class="pre">nvs_fs</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fs</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">id</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nvs_write" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>nvs_write </p>
<p>Write an entry to the file system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fs</strong> – Pointer to file system </p></li>
<li><p><strong>id</strong> – Id of the entry to be written </p></li>
<li><p><strong>data</strong> – Pointer to the data to be written </p></li>
<li><p><strong>len</strong> – Number of bytes to be written</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Number of bytes written. On success, it will be equal to the number of bytes requested to be written. When a rewrite of the same data already stored is attempted, nothing is written to flash, thus 0 is returned. On error, returns negative value of errno.h defined error codes. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nvs_delete">
<span class="target" id="group__nvs__high__level__api_1ga5fd4175a4976e6d3ee8621ed95e0ee9e"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nvs_delete</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.nvs_fs" title="nvs_fs"><span class="n"><span class="pre">nvs_fs</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fs</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nvs_delete" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>nvs_delete </p>
<p>Delete an entry from the file system</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fs</strong> – Pointer to file system </p></li>
<li><p><strong>id</strong> – Id of the entry to be deleted </p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Success </p></li>
<li><p><strong>-ERRNO</strong> – errno code if error </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nvs_read">
<span class="target" id="group__nvs__high__level__api_1ga341fd2ad029709cbb6eafde1ae88603f"></span><span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nvs_read</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.nvs_fs" title="nvs_fs"><span class="n"><span class="pre">nvs_fs</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fs</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">id</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nvs_read" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>nvs_read </p>
<p>Read an entry from the file system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fs</strong> – Pointer to file system </p></li>
<li><p><strong>id</strong> – Id of the entry to be read </p></li>
<li><p><strong>data</strong> – Pointer to data buffer </p></li>
<li><p><strong>len</strong> – Number of bytes to be read</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Number of bytes read. On success, it will be equal to the number of bytes requested to be read. When the return value is larger than the number of bytes requested to read this indicates not all bytes were read, and more data is available. On error, returns negative value of errno.h defined error codes. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nvs_read_hist">
<span class="target" id="group__nvs__high__level__api_1ga8e525038e353045ad6cd90607e887b0d"></span><span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nvs_read_hist</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.nvs_fs" title="nvs_fs"><span class="n"><span class="pre">nvs_fs</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fs</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">id</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">cnt</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nvs_read_hist" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>nvs_read_hist </p>
<p>Read a history entry from the file system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fs</strong> – Pointer to file system </p></li>
<li><p><strong>id</strong> – Id of the entry to be read </p></li>
<li><p><strong>data</strong> – Pointer to data buffer </p></li>
<li><p><strong>len</strong> – Number of bytes to be read </p></li>
<li><p><strong>cnt</strong> – History counter: 0: latest entry, 1: one before latest …</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Number of bytes read. On success, it will be equal to the number of bytes requested to be read. When the return value is larger than the number of bytes requested to read this indicates not all bytes were read, and more data is available. On error, returns negative value of errno.h defined error codes. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.nvs_calc_free_space">
<span class="target" id="group__nvs__high__level__api_1ga37e5a55f0b9209c7c0c95db9e1e84715"></span><span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nvs_calc_free_space</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.nvs_fs" title="nvs_fs"><span class="n"><span class="pre">nvs_fs</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fs</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.nvs_calc_free_space" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>nvs_calc_free_space </p>
<p>Calculate the available free space in the file system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fs</strong> – Pointer to file system</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Number of bytes free. On success, it will be equal to the number of bytes that can still be written to the file system. Calculating the free space is a time consuming operation, especially on spi flash. On error, returns negative value of errno.h defined error codes. </p>
</dd>
</dl>
</dd></dl>

</div>
</dd></dl>

</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>