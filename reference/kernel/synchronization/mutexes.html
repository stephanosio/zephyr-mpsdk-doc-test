<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mutexes &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script type="module" src="../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="Condition Variables" href="condvar.html" />
    <link rel="prev" title="Semaphores" href="semaphores.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html">API Status and Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../audio/index.html">Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/notify.html">Asynchronous Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../canbus/index.html">Controller Area Network (CAN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto/index.html">Crypto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../devicetree/index.html">Devicetree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../drivers/index.html">Device Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../display/index.html">Display Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edac/index.html">Error Detection And Correction (EDAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../file_system/index.html">File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iterable_sections/index.html">Iterable Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/formatted_output.html">Formatted Output</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Kernel Services</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#scheduling-interrupts-and-synchronization">Scheduling, Interrupts, and Synchronization</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../threads/index.html">Threads</a></li>
<li class="toctree-l4"><a class="reference internal" href="../scheduling/index.html">Scheduling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../threads/system_threads.html">System Threads</a></li>
<li class="toctree-l4"><a class="reference internal" href="../threads/workqueue.html">Workqueue Threads</a></li>
<li class="toctree-l4"><a class="reference internal" href="../threads/nothread.html">Zephyr Without Threads</a></li>
<li class="toctree-l4"><a class="reference internal" href="../other/interrupts.html">Interrupts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../other/polling.html">Polling API</a></li>
<li class="toctree-l4"><a class="reference internal" href="semaphores.html">Semaphores</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Mutexes</a></li>
<li class="toctree-l4"><a class="reference internal" href="condvar.html">Condition Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="events.html">Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="../smp/smp.html">Symmetric Multiprocessing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#data-passing">Data Passing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#memory-management">Memory Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#timing">Timing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#other">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../libc/index.html">C standard library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/index.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../memory_management/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/index.html">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data_structures/index.html">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modbus/index.html">Modbus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../peripherals/index.html">Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../random/index.html">Random Number Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../resource_management/index.html">Resource Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shell/index.html">Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/index.html">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../task_wdt/index.html">Task Watchdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/timeutil.html">Time Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usb/index.html">USB device support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usermode/index.html">User Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../util/index.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../settings/index.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timing_functions/index.html">Executing Time Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../virtualization/index.html">Virtualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../index.html">API Reference</a> &raquo;</li>
  
     <li><a href="../index.html">Kernel Services</a> &raquo;</li>
  
  <li>Mutexes</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/reference/kernel/synchronization/mutexes.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="mutexes">
<span id="mutexes-v2"></span><h1>Mutexes<a class="headerlink" href="#mutexes" title="Permalink to this headline">¶</a></h1>
<p>A <em class="dfn">mutex</em> is a kernel object that implements a traditional
reentrant mutex. A mutex allows multiple threads to safely share
an associated hardware or software resource by ensuring mutually exclusive
access to the resource.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#concepts" id="id1">Concepts</a></p>
<ul>
<li><p><a class="reference internal" href="#reentrant-locking" id="id2">Reentrant Locking</a></p></li>
<li><p><a class="reference internal" href="#priority-inheritance" id="id3">Priority Inheritance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#implementation" id="id4">Implementation</a></p>
<ul>
<li><p><a class="reference internal" href="#defining-a-mutex" id="id5">Defining a Mutex</a></p></li>
<li><p><a class="reference internal" href="#locking-a-mutex" id="id6">Locking a Mutex</a></p></li>
<li><p><a class="reference internal" href="#unlocking-a-mutex" id="id7">Unlocking a Mutex</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#suggested-uses" id="id8">Suggested Uses</a></p></li>
<li><p><a class="reference internal" href="#configuration-options" id="id9">Configuration Options</a></p></li>
<li><p><a class="reference internal" href="#api-reference" id="id10">API Reference</a></p></li>
<li><p><a class="reference internal" href="#futex-api-reference" id="id11">Futex API Reference</a></p></li>
<li><p><a class="reference internal" href="#user-mode-mutex-api-reference" id="id12">User Mode Mutex API Reference</a></p></li>
</ul>
</div>
<div class="section" id="concepts">
<h2><a class="toc-backref" href="#id1">Concepts</a><a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h2>
<p>Any number of mutexes can be defined (limited only by available RAM). Each mutex
is referenced by its memory address.</p>
<p>A mutex has the following key properties:</p>
<ul class="simple">
<li><p>A <strong>lock count</strong> that indicates the number of times the mutex has be locked
by the thread that has locked it. A count of zero indicates that the mutex
is unlocked.</p></li>
<li><p>An <strong>owning thread</strong> that identifies the thread that has locked the mutex,
when it is locked.</p></li>
</ul>
<p>A mutex must be initialized before it can be used. This sets its lock count
to zero.</p>
<p>A thread that needs to use a shared resource must first gain exclusive rights
to access it by <strong>locking</strong> the associated mutex. If the mutex is already locked
by another thread, the requesting thread may choose to wait for the mutex
to be unlocked.</p>
<p>After locking a mutex, the thread may safely use the associated resource
for as long as needed; however, it is considered good practice to hold the lock
for as short a time as possible to avoid negatively impacting other threads
that want to use the resource. When the thread no longer needs the resource
it must <strong>unlock</strong> the mutex to allow other threads to use the resource.</p>
<p>Any number of threads may wait on a locked mutex simultaneously.
When the mutex becomes unlocked it is then locked by the highest-priority
thread that has waited the longest.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mutex objects are <em>not</em> designed for use by ISRs.</p>
</div>
<div class="section" id="reentrant-locking">
<h3><a class="toc-backref" href="#id2">Reentrant Locking</a><a class="headerlink" href="#reentrant-locking" title="Permalink to this headline">¶</a></h3>
<p>A thread is permitted to lock a mutex it has already locked.
This allows the thread to access the associated resource at a point
in its execution when the mutex may or may not already be locked.</p>
<p>A mutex that is repeatedly locked by a thread must be unlocked an equal number
of times before the mutex becomes fully unlocked so it can be claimed
by another thread.</p>
</div>
<div class="section" id="priority-inheritance">
<h3><a class="toc-backref" href="#id3">Priority Inheritance</a><a class="headerlink" href="#priority-inheritance" title="Permalink to this headline">¶</a></h3>
<p>The thread that has locked a mutex is eligible for <em class="dfn">priority inheritance</em>.
This means the kernel will <em>temporarily</em> elevate the thread’s priority
if a higher priority thread begins waiting on the mutex. This allows the owning
thread to complete its work and release the mutex more rapidly by executing
at the same priority as the waiting thread. Once the mutex has been unlocked,
the unlocking thread resets its priority to the level it had before locking
that mutex.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_PRIORITY_CEILING"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_PRIORITY_CEILING</span></code></a> configuration option limits
how high the kernel can raise a thread’s priority due to priority
inheritance. The default value of 0 permits unlimited elevation.</p>
</div>
<p>When two or more threads wait on a mutex held by a lower priority thread, the
kernel adjusts the owning thread’s priority each time a thread begins waiting
(or gives up waiting). When the mutex is eventually unlocked, the unlocking
thread’s priority correctly reverts to its original non-elevated priority.</p>
<p>The kernel does <em>not</em> fully support priority inheritance when a thread holds
two or more mutexes simultaneously. This situation can result in the thread’s
priority not reverting to its original non-elevated priority when all mutexes
have been released. It is recommended that a thread lock only a single mutex
at a time when multiple mutexes are shared between threads of different
priorities.</p>
</div>
</div>
<div class="section" id="implementation">
<h2><a class="toc-backref" href="#id4">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="defining-a-mutex">
<h3><a class="toc-backref" href="#id5">Defining a Mutex</a><a class="headerlink" href="#defining-a-mutex" title="Permalink to this headline">¶</a></h3>
<p>A mutex is defined using a variable of type <a class="reference internal" href="#c.k_mutex" title="k_mutex"><code class="xref c c-struct docutils literal notranslate"><span class="pre">k_mutex</span></code></a>.
It must then be initialized by calling <a class="reference internal" href="#c.k_mutex_init" title="k_mutex_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mutex_init()</span></code></a>.</p>
<p>The following code defines and initializes a mutex.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">k_mutex</span><span class="w"> </span><span class="n">my_mutex</span><span class="p">;</span><span class="w"></span>

<span class="n">k_mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_mutex</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Alternatively, a mutex can be defined and initialized at compile time
by calling <a class="reference internal" href="#c.K_MUTEX_DEFINE" title="K_MUTEX_DEFINE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">K_MUTEX_DEFINE</span></code></a>.</p>
<p>The following code has the same effect as the code segment above.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">K_MUTEX_DEFINE</span><span class="p">(</span><span class="n">my_mutex</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="locking-a-mutex">
<h3><a class="toc-backref" href="#id6">Locking a Mutex</a><a class="headerlink" href="#locking-a-mutex" title="Permalink to this headline">¶</a></h3>
<p>A mutex is locked by calling <a class="reference internal" href="#c.k_mutex_lock" title="k_mutex_lock"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mutex_lock()</span></code></a>.</p>
<p>The following code builds on the example above, and waits indefinitely
for the mutex to become available if it is already locked by another thread.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">k_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_mutex</span><span class="p">,</span><span class="w"> </span><span class="n">K_FOREVER</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The following code waits up to 100 milliseconds for the mutex to become
available, and gives a warning if the mutex does not become available.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_mutex</span><span class="p">,</span><span class="w"> </span><span class="n">K_MSEC</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* mutex successfully locked */</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Cannot lock XYZ display</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="unlocking-a-mutex">
<h3><a class="toc-backref" href="#id7">Unlocking a Mutex</a><a class="headerlink" href="#unlocking-a-mutex" title="Permalink to this headline">¶</a></h3>
<p>A mutex is unlocked by calling <a class="reference internal" href="#c.k_mutex_unlock" title="k_mutex_unlock"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_mutex_unlock()</span></code></a>.</p>
<p>The following code builds on the example above,
and unlocks the mutex that was previously locked by the thread.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">k_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_mutex</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="suggested-uses">
<h2><a class="toc-backref" href="#id8">Suggested Uses</a><a class="headerlink" href="#suggested-uses" title="Permalink to this headline">¶</a></h2>
<p>Use a mutex to provide exclusive access to a resource, such as a physical
device.</p>
</div>
<div class="section" id="configuration-options">
<h2><a class="toc-backref" href="#id9">Configuration Options</a><a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h2>
<p>Related configuration options:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_PRIORITY_CEILING"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_PRIORITY_CEILING</span></code></a></p></li>
</ul>
</div>
<div class="section" id="api-reference">
<h2><a class="toc-backref" href="#id10">API Reference</a><a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__mutex__apis"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">mutex_apis</span></span></dt>
<dd><div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.K_MUTEX_DEFINE">
<span class="target" id="group__mutex__apis_1gab6f3d98fabbdc0918bbc9934d61d63f3"></span><span class="sig-name descname"><span class="n"><span class="pre">K_MUTEX_DEFINE</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">name</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.K_MUTEX_DEFINE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Statically define and initialize a mutex. </p>
<p>The mutex can be accessed outside the module where it is defined using:</p>
<p><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="n">struct</span> <span class="n">k_mutex</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">;</span> 
</pre></div>
</div>
</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – Name of the mutex. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.k_mutex_init">
<span class="target" id="group__mutex__apis_1ga56b64952fb8b78b00268a21c28b41480"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mutex_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_mutex" title="k_mutex"><span class="n"><span class="pre">k_mutex</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">mutex</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mutex_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Initialize a mutex. </p>
<p>This routine initializes a mutex object, prior to its first use.</p>
<p>Upon completion, the mutex is available and does not have an owner.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mutex</strong> – Address of the mutex.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><p><strong>0</strong> – Mutex object created </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mutex_lock">
<span class="target" id="group__mutex__apis_1ga850549358645249c285669baa49c33b0"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mutex_lock</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_mutex" title="k_mutex"><span class="n"><span class="pre">k_mutex</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">mutex</span></span>, <a class="reference internal" href="../timing/clocks.html#c.k_timeout_t" title="k_timeout_t"><span class="n"><span class="pre">k_timeout_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">timeout</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mutex_lock" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Lock a mutex. </p>
<p>This routine locks <em>mutex</em>. If the mutex is locked by another thread, the calling thread waits until the mutex becomes available or until a timeout occurs.</p>
<p>A thread is permitted to lock a mutex it has already locked. The operation completes immediately and the lock count is increased by 1.</p>
<p>Mutexes may not be locked in ISRs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mutex</strong> – Address of the mutex. </p></li>
<li><p><strong>timeout</strong> – Waiting period to lock the mutex, or one of the special values K_NO_WAIT and K_FOREVER.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Mutex locked. </p></li>
<li><p><strong>-EBUSY</strong> – Returned without waiting. </p></li>
<li><p><strong>-EAGAIN</strong> – Waiting period timed out. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_mutex_unlock">
<span class="target" id="group__mutex__apis_1ga360f4c0e7258b0d7030cdb1f452b2c31"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mutex_unlock</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_mutex" title="k_mutex"><span class="n"><span class="pre">k_mutex</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">mutex</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_mutex_unlock" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Unlock a mutex. </p>
<p>This routine unlocks <em>mutex</em>. The mutex must already be locked by the calling thread.</p>
<p>The mutex cannot be claimed by another thread until it has been unlocked by the calling thread as many times as it was previously locked by that thread.</p>
<p>Mutexes may not be unlocked in ISRs, as mutexes must only be manipulated in thread context due to ownership and priority inheritance semantics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mutex</strong> – Address of the mutex.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Mutex unlocked. </p></li>
<li><p><strong>-EPERM</strong> – The current thread does not own the mutex </p></li>
<li><p><strong>-EINVAL</strong> – The mutex is not locked </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.k_mutex">
<span class="target" id="structk__mutex"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_mutex</span></span></span><a class="headerlink" href="#c.k_mutex" title="Permalink to this definition">¶</a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;kernel.h&gt;</em></div>
<p>Mutex Structure </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.k_mutex.wait_q">
<span class="target" id="structk__mutex_1a4add234295bceff22551ee74f3aed802"></span><span class="n"><span class="pre">_wait_q_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">wait_q</span></span></span><a class="headerlink" href="#c.k_mutex.wait_q" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Mutex wait queue </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_mutex.owner">
<span class="target" id="structk__mutex_1af910bb07dc99e50078de26fccca468e4"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../threads/index.html#c.k_thread" title="k_thread"><span class="n"><span class="pre">k_thread</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">owner</span></span></span><a class="headerlink" href="#c.k_mutex.owner" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Mutex owner </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_mutex.lock_count">
<span class="target" id="structk__mutex_1a0db401fc8e03e1f984b8fd15af974718"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">lock_count</span></span></span><a class="headerlink" href="#c.k_mutex.lock_count" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Current lock count </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_mutex.owner_orig_prio">
<span class="target" id="structk__mutex_1ab0d16fac9f8af960a501ffd93ec08c80"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">owner_orig_prio</span></span></span><a class="headerlink" href="#c.k_mutex.owner_orig_prio" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Original thread priority </p>
</dd></dl>

</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="futex-api-reference">
<h2><a class="toc-backref" href="#id11">Futex API Reference</a><a class="headerlink" href="#futex-api-reference" title="Permalink to this headline">¶</a></h2>
<p>k_futex is a lightweight mutual exclusion primitive designed to minimize
kernel involvement. Uncontended operation relies only on atomic access
to shared memory. k_futex are tracked as kernel objects and can live in
user memory so that any access bypasses the kernel object permission
management mechanism.</p>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__futex__apis"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">futex_apis</span></span></dt>
<dd><div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.k_futex_wait">
<span class="target" id="group__futex__apis_1ga596bfa265f88567ad9e80fd38cd433d3"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_futex_wait</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">k_futex</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">futex</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">expected</span></span>, <a class="reference internal" href="../timing/clocks.html#c.k_timeout_t" title="k_timeout_t"><span class="n"><span class="pre">k_timeout_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">timeout</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_futex_wait" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Pend the current thread on a futex. </p>
<p>Tests that the supplied futex contains the expected value, and if so, goes to sleep until some other thread calls <a class="reference internal" href="#group__futex__apis_1ga62de1aeb7c5c273aed20d0e05336d7a0"><span class="std std-ref">k_futex_wake()</span></a> on it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>futex</strong> – Address of the futex. </p></li>
<li><p><strong>expected</strong> – Expected value of the futex, if it is different the caller will not wait on it. </p></li>
<li><p><strong>timeout</strong> – Non-negative waiting period on the futex, or one of the special values K_NO_WAIT or K_FOREVER. </p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>-EACCES</strong> – Caller does not have read access to futex address. </p></li>
<li><p><strong>-EAGAIN</strong> – If the futex value did not match the expected parameter. </p></li>
<li><p><strong>-EINVAL</strong> – Futex parameter address not recognized by the kernel. </p></li>
<li><p><strong>-ETIMEDOUT</strong> – Thread woke up due to timeout and not a futex wakeup. </p></li>
<li><p><strong>0</strong> – if the caller went to sleep and was woken up. The caller should check the futex’s value on wakeup to determine if it needs to block again. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_futex_wake">
<span class="target" id="group__futex__apis_1ga62de1aeb7c5c273aed20d0e05336d7a0"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_futex_wake</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">k_futex</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">futex</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">wake_all</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_futex_wake" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Wake one/all threads pending on a futex. </p>
<p>Wake up the highest priority thread pending on the supplied futex, or wakeup all the threads pending on the supplied futex, and the behavior depends on wake_all.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>futex</strong> – Futex to wake up pending threads. </p></li>
<li><p><strong>wake_all</strong> – If true, wake up all pending threads; If false, wakeup the highest priority thread. </p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>-EACCES</strong> – Caller does not have access to the futex address. </p></li>
<li><p><strong>-EINVAL</strong> – Futex parameter address not recognized by the kernel. </p></li>
<li><p><strong>Number</strong> – of threads that were woken up. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</dd></dl>

</div>
<div class="section" id="user-mode-mutex-api-reference">
<h2><a class="toc-backref" href="#id12">User Mode Mutex API Reference</a><a class="headerlink" href="#user-mode-mutex-api-reference" title="Permalink to this headline">¶</a></h2>
<p>sys_mutex behaves almost exactly like k_mutex, with the added advantage
that a sys_mutex instance can reside in user memory. When user mode isn’t
enabled, sys_mutex behaves like k_mutex.</p>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__user__mutex__apis"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">user_mutex_apis</span></span></dt>
<dd><div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.SYS_MUTEX_DEFINE">
<span class="target" id="group__user__mutex__apis_1ga486bd6a11d0b0d312cdf8a6a8f66c1a3"></span><span class="sig-name descname"><span class="n"><span class="pre">SYS_MUTEX_DEFINE</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">name</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.SYS_MUTEX_DEFINE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Statically define and initialize a sys_mutex. </p>
<p>The mutex can be accessed outside the module where it is defined using:</p>
<p><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="n">struct</span> <span class="n">sys_mutex</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">;</span> 
</pre></div>
</div>
</p>
<p>Route this to memory domains using K_APP_DMEM().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – Name of the mutex. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.sys_mutex_init">
<span class="target" id="group__user__mutex__apis_1ga5456b75934cb26abc974a45ae82d717b"></span><span class="k"><span class="pre">static</span></span><span class="w"> </span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">sys_mutex_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">sys_mutex</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">mutex</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.sys_mutex_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Initialize a mutex. </p>
<p>This routine initializes a mutex object, prior to its first use.</p>
<p>Upon completion, the mutex is available and does not have an owner.</p>
<p>This routine is only necessary to call when userspace is disabled and the mutex was not created with <a class="reference internal" href="#group__user__mutex__apis_1ga486bd6a11d0b0d312cdf8a6a8f66c1a3"><span class="std std-ref">SYS_MUTEX_DEFINE()</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mutex</strong> – Address of the mutex. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.sys_mutex_lock">
<span class="target" id="group__user__mutex__apis_1ga6887005f8223d4f36de5ae5c02ba4b17"></span><span class="k"><span class="pre">static</span></span><span class="w"> </span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">sys_mutex_lock</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">sys_mutex</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">mutex</span></span>, <a class="reference internal" href="../timing/clocks.html#c.k_timeout_t" title="k_timeout_t"><span class="n"><span class="pre">k_timeout_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">timeout</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.sys_mutex_lock" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Lock a mutex. </p>
<p>This routine locks <em>mutex</em>. If the mutex is locked by another thread, the calling thread waits until the mutex becomes available or until a timeout occurs.</p>
<p>A thread is permitted to lock a mutex it has already locked. The operation completes immediately and the lock count is increased by 1.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mutex</strong> – Address of the mutex, which may reside in user memory </p></li>
<li><p><strong>timeout</strong> – Waiting period to lock the mutex, or one of the special values K_NO_WAIT and K_FOREVER.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Mutex locked. </p></li>
<li><p><strong>-EBUSY</strong> – Returned without waiting. </p></li>
<li><p><strong>-EAGAIN</strong> – Waiting period timed out. </p></li>
<li><p><strong>-EACCES</strong> – Caller has no access to provided mutex address </p></li>
<li><p><strong>-EINVAL</strong> – Provided mutex not recognized by the kernel </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.sys_mutex_unlock">
<span class="target" id="group__user__mutex__apis_1ga7d4babcd161600dab5f1842c58be2a1f"></span><span class="k"><span class="pre">static</span></span><span class="w"> </span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">sys_mutex_unlock</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">sys_mutex</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">mutex</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.sys_mutex_unlock" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Unlock a mutex. </p>
<p>This routine unlocks <em>mutex</em>. The mutex must already be locked by the calling thread.</p>
<p>The mutex cannot be claimed by another thread until it has been unlocked by the calling thread as many times as it was previously locked by that thread.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mutex</strong> – Address of the mutex, which may reside in user memory </p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Mutex unlocked </p></li>
<li><p><strong>-EACCES</strong> – Caller has no access to provided mutex address </p></li>
<li><p><strong>-EINVAL</strong> – Provided mutex not recognized by the kernel or mutex wasn’t locked </p></li>
<li><p><strong>-EPERM</strong> – Caller does not own the mutex </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</dd></dl>

</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>