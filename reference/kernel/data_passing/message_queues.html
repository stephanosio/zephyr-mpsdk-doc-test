<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Message Queues &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script type="module" src="../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="Mailboxes" href="mailboxes.html" />
    <link rel="prev" title="Stacks" href="stacks.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html">API Status and Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../audio/index.html">Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/notify.html">Asynchronous Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../canbus/index.html">Controller Area Network (CAN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto/index.html">Crypto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../devicetree/index.html">Devicetree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../drivers/index.html">Device Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../display/index.html">Display Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edac/index.html">Error Detection And Correction (EDAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../file_system/index.html">File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iterable_sections/index.html">Iterable Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/formatted_output.html">Formatted Output</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Kernel Services</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../index.html#scheduling-interrupts-and-synchronization">Scheduling, Interrupts, and Synchronization</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#data-passing">Data Passing</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="queues.html">Queues</a></li>
<li class="toctree-l4"><a class="reference internal" href="fifos.html">FIFOs</a></li>
<li class="toctree-l4"><a class="reference internal" href="lifos.html">LIFOs</a></li>
<li class="toctree-l4"><a class="reference internal" href="stacks.html">Stacks</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Message Queues</a></li>
<li class="toctree-l4"><a class="reference internal" href="mailboxes.html">Mailboxes</a></li>
<li class="toctree-l4"><a class="reference internal" href="pipes.html">Pipes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#memory-management">Memory Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#timing">Timing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#other">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../libc/index.html">C standard library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/index.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../memory_management/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/index.html">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data_structures/index.html">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modbus/index.html">Modbus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../peripherals/index.html">Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../random/index.html">Random Number Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../resource_management/index.html">Resource Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shell/index.html">Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/index.html">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../task_wdt/index.html">Task Watchdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/timeutil.html">Time Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usb/index.html">USB device support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usermode/index.html">User Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../util/index.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../settings/index.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timing_functions/index.html">Executing Time Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../virtualization/index.html">Virtualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../index.html">API Reference</a> &raquo;</li>
  
     <li><a href="../index.html">Kernel Services</a> &raquo;</li>
  
  <li>Message Queues</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/reference/kernel/data_passing/message_queues.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="message-queues">
<span id="message-queues-v2"></span><h1>Message Queues<a class="headerlink" href="#message-queues" title="Permalink to this headline">¶</a></h1>
<p>A <em class="dfn">message queue</em> is a kernel object that implements a simple
message queue, allowing threads and ISRs to asynchronously send and receive
fixed-size data items.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#concepts" id="id1">Concepts</a></p></li>
<li><p><a class="reference internal" href="#implementation" id="id2">Implementation</a></p>
<ul>
<li><p><a class="reference internal" href="#defining-a-message-queue" id="id3">Defining a Message Queue</a></p></li>
<li><p><a class="reference internal" href="#writing-to-a-message-queue" id="id4">Writing to a Message Queue</a></p></li>
<li><p><a class="reference internal" href="#reading-from-a-message-queue" id="id5">Reading from a Message Queue</a></p></li>
<li><p><a class="reference internal" href="#peeking-into-a-message-queue" id="id6">Peeking into a Message Queue</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#suggested-uses" id="id7">Suggested Uses</a></p></li>
<li><p><a class="reference internal" href="#configuration-options" id="id8">Configuration Options</a></p></li>
<li><p><a class="reference internal" href="#api-reference" id="id9">API Reference</a></p></li>
</ul>
</div>
<div class="section" id="concepts">
<h2><a class="toc-backref" href="#id1">Concepts</a><a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h2>
<p>Any number of message queues can be defined (limited only by available RAM).
Each message queue is referenced by its memory address.</p>
<p>A message queue has the following key properties:</p>
<ul class="simple">
<li><p>A <strong>ring buffer</strong> of data items that have been sent but not yet received.</p></li>
<li><p>A <strong>data item size</strong>, measured in bytes.</p></li>
<li><p>A <strong>maximum quantity</strong> of data items that can be queued in the ring buffer.</p></li>
</ul>
<p>The message queue’s ring buffer must be aligned to an N-byte boundary, where
N is a power of 2 (i.e. 1, 2, 4, 8, …). To ensure that the messages stored in
the ring buffer are similarly aligned to this boundary, the data item size
must also be a multiple of N.</p>
<p>A message queue must be initialized before it can be used.
This sets its ring buffer to empty.</p>
<p>A data item can be <strong>sent</strong> to a message queue by a thread or an ISR.
The data item pointed at by the sending thread is copied to a waiting thread,
if one exists; otherwise the item is copied to the message queue’s ring buffer,
if space is available. In either case, the size of the data area being sent
<em>must</em> equal the message queue’s data item size.</p>
<p>If a thread attempts to send a data item when the ring buffer is full,
the sending thread may choose to wait for space to become available.
Any number of sending threads may wait simultaneously when the ring buffer
is full; when space becomes available
it is given to the highest priority sending thread that has waited the longest.</p>
<p>A data item can be <strong>received</strong> from a message queue by a thread.
The data item is copied to the area specified by the receiving thread;
the size of the receiving area <em>must</em> equal the message queue’s data item size.</p>
<p>If a thread attempts to receive a data item when the ring buffer is empty,
the receiving thread may choose to wait for a data item to be sent.
Any number of receiving threads may wait simultaneously when the ring buffer
is empty; when a data item becomes available it is given to
the highest priority receiving thread that has waited the longest.</p>
<p>A thread can also <strong>peek</strong> at the message on the head of a message queue without
removing it from the queue.
The data item is copied to the area specified by the receiving thread;
the size of the receiving area <em>must</em> equal the message queue’s data item size.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The kernel does allow an ISR to receive an item from a message queue,
however the ISR must not attempt to wait if the message queue is empty.</p>
</div>
</div>
<div class="section" id="implementation">
<h2><a class="toc-backref" href="#id2">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="defining-a-message-queue">
<h3><a class="toc-backref" href="#id3">Defining a Message Queue</a><a class="headerlink" href="#defining-a-message-queue" title="Permalink to this headline">¶</a></h3>
<p>A message queue is defined using a variable of type <a class="reference internal" href="#c.k_msgq" title="k_msgq"><code class="xref c c-struct docutils literal notranslate"><span class="pre">k_msgq</span></code></a>.
It must then be initialized by calling <a class="reference internal" href="#c.k_msgq_init" title="k_msgq_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_msgq_init()</span></code></a>.</p>
<p>The following code defines and initializes an empty message queue
that is capable of holding 10 items, each of which is 12 bytes long.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">data_item_type</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">field1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">field2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">field3</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="kt">char</span><span class="w"> </span><span class="nf">__aligned</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="n">my_msgq_buffer</span><span class="p">[</span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">data_item_type</span><span class="p">)];</span><span class="w"></span>
<span class="k">struct</span><span class="w"> </span><span class="nc">k_msgq</span><span class="w"> </span><span class="n">my_msgq</span><span class="p">;</span><span class="w"></span>

<span class="n">k_msgq_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_msgq</span><span class="p">,</span><span class="w"> </span><span class="n">my_msgq_buffer</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">data_item_type</span><span class="p">),</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Alternatively, a message queue can be defined and initialized at compile time
by calling <a class="reference internal" href="#c.K_MSGQ_DEFINE" title="K_MSGQ_DEFINE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">K_MSGQ_DEFINE</span></code></a>.</p>
<p>The following code has the same effect as the code segment above. Observe
that the macro defines both the message queue and its buffer.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">K_MSGQ_DEFINE</span><span class="p">(</span><span class="n">my_msgq</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">data_item_type</span><span class="p">),</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The following code demonstrates an alignment implementation for the
structure defined in the previous example code. <code class="docutils literal notranslate"><span class="pre">aligned</span></code> means each
<code class="xref c c-struct docutils literal notranslate"><span class="pre">data_item_type</span></code> will begin on the specified byte boundary.
<code class="docutils literal notranslate"><span class="pre">aligned(4)</span></code> means that the structure is aligned to an address that
is divisible by 4.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">field1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">field2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">field3</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span><span class="w"> </span><span class="n">data_item_type</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="writing-to-a-message-queue">
<h3><a class="toc-backref" href="#id4">Writing to a Message Queue</a><a class="headerlink" href="#writing-to-a-message-queue" title="Permalink to this headline">¶</a></h3>
<p>A data item is added to a message queue by calling <a class="reference internal" href="#c.k_msgq_put" title="k_msgq_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_msgq_put()</span></code></a>.</p>
<p>The following code builds on the example above, and uses the message queue
to pass data items from a producing thread to one or more consuming threads.
If the message queue fills up because the consumers can’t keep up, the
producing thread throws away all existing data so the newer data can be saved.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">producer_thread</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">data_item_type</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cm">/* create data item to send (e.g. measurement, timestamp, ...) */</span><span class="w"></span>
<span class="w">        </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"></span>

<span class="w">        </span><span class="cm">/* send data to consumers */</span><span class="w"></span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">k_msgq_put</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_msgq</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">K_NO_WAIT</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="cm">/* message queue is full: purge old data &amp; try again */</span><span class="w"></span>
<span class="w">            </span><span class="n">k_msgq_purge</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_msgq</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="cm">/* data item was successfully added to message queue */</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="reading-from-a-message-queue">
<h3><a class="toc-backref" href="#id5">Reading from a Message Queue</a><a class="headerlink" href="#reading-from-a-message-queue" title="Permalink to this headline">¶</a></h3>
<p>A data item is taken from a message queue by calling <a class="reference internal" href="#c.k_msgq_get" title="k_msgq_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_msgq_get()</span></code></a>.</p>
<p>The following code builds on the example above, and uses the message queue
to process data items generated by one or more producing threads. Note that
the return value of <a class="reference internal" href="#c.k_msgq_get" title="k_msgq_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_msgq_get()</span></code></a> should be tested as <code class="docutils literal notranslate"><span class="pre">-ENOMSG</span></code>
can be returned due to <a class="reference internal" href="#c.k_msgq_purge" title="k_msgq_purge"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_msgq_purge()</span></code></a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">consumer_thread</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">data_item_type</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cm">/* get a data item */</span><span class="w"></span>
<span class="w">        </span><span class="n">k_msgq_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_msgq</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">K_FOREVER</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="cm">/* process data item */</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="peeking-into-a-message-queue">
<h3><a class="toc-backref" href="#id6">Peeking into a Message Queue</a><a class="headerlink" href="#peeking-into-a-message-queue" title="Permalink to this headline">¶</a></h3>
<p>A data item is read from a message queue by calling <a class="reference internal" href="#c.k_msgq_peek" title="k_msgq_peek"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_msgq_peek()</span></code></a>.</p>
<p>The following code peeks into the message queue to read the data item at the
head of the queue that is generated by one or more producing threads.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">consumer_thread</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">data_item_type</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cm">/* read a data item by peeking into the queue */</span><span class="w"></span>
<span class="w">        </span><span class="n">k_msgq_peek</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_msgq</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="cm">/* process data item */</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="suggested-uses">
<h2><a class="toc-backref" href="#id7">Suggested Uses</a><a class="headerlink" href="#suggested-uses" title="Permalink to this headline">¶</a></h2>
<p>Use a message queue to transfer small data items between threads
in an asynchronous manner.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A message queue can be used to transfer large data items, if desired.
However, this can increase interrupt latency as interrupts are locked
while a data item is written or read. The time to write or read a data item
increases linearly with its size since the item is copied in its entirety
to or from the buffer in memory. For this reason, it is usually preferable
to transfer large data items by exchanging a pointer to the data item,
rather than the data item itself.</p>
<p>A synchronous transfer can be achieved by using the kernel’s mailbox
object type.</p>
</div>
</div>
<div class="section" id="configuration-options">
<h2><a class="toc-backref" href="#id8">Configuration Options</a><a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h2>
<p>Related configuration options:</p>
<ul class="simple">
<li><p>None.</p></li>
</ul>
</div>
<div class="section" id="api-reference">
<h2><a class="toc-backref" href="#id9">API Reference</a><a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__msgq__apis"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">msgq_apis</span></span></dt>
<dd><div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-defines">Defines</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.K_MSGQ_FLAG_ALLOC">
<span class="target" id="group__msgq__apis_1ga4bb73f46fd0818f7f7a90860b792f7ce"></span><span class="sig-name descname"><span class="n"><span class="pre">K_MSGQ_FLAG_ALLOC</span></span></span><a class="headerlink" href="#c.K_MSGQ_FLAG_ALLOC" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.K_MSGQ_DEFINE">
<span class="target" id="group__msgq__apis_1ga95ef93002766901511d09c8cd8f8293b"></span><span class="sig-name descname"><span class="n"><span class="pre">K_MSGQ_DEFINE</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">q_name</span></span>, <span class="n"><span class="pre">q_msg_size</span></span>, <span class="n"><span class="pre">q_max_msgs</span></span>, <span class="n"><span class="pre">q_align</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.K_MSGQ_DEFINE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Statically define and initialize a message queue. </p>
<p>The message queue’s ring buffer contains space for <em>q_max_msgs</em> messages, each of which is <em>q_msg_size</em> bytes long. The buffer is aligned to a <em>q_align</em> -byte boundary, which must be a power of 2. To ensure that each message is similarly aligned to this boundary, <em>q_msg_size</em> must also be a multiple of <em>q_align</em>.</p>
<p>The message queue can be accessed outside the module where it is defined using:</p>
<p><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="n">struct</span> <span class="n">k_msgq</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">;</span> 
</pre></div>
</div>
</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q_name</strong> – Name of the message queue. </p></li>
<li><p><strong>q_msg_size</strong> – Message size (in bytes). </p></li>
<li><p><strong>q_max_msgs</strong> – Maximum number of messages that can be queued. </p></li>
<li><p><strong>q_align</strong> – Alignment of the message queue’s ring buffer. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.k_msgq_init">
<span class="target" id="group__msgq__apis_1ga54a5cdcaea2236c383ace433fedc0d39"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_msgq" title="k_msgq"><span class="n"><span class="pre">k_msgq</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msgq</span></span>, <span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buffer</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">msg_size</span></span>, <span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">max_msgs</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_msgq_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Initialize a message queue. </p>
<p>This routine initializes a message queue object, prior to its first use.</p>
<p>The message queue’s ring buffer must contain space for <em>max_msgs</em> messages, each of which is <em>msg_size</em> bytes long. The buffer must be aligned to an N-byte boundary, where N is a power of 2 (i.e. 1, 2, 4, …). To ensure that each message is similarly aligned to this boundary, <em>q_msg_size</em> must also be a multiple of N.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msgq</strong> – Address of the message queue. </p></li>
<li><p><strong>buffer</strong> – Pointer to ring buffer that holds queued messages. </p></li>
<li><p><strong>msg_size</strong> – Message size (in bytes). </p></li>
<li><p><strong>max_msgs</strong> – Maximum number of messages that can be queued. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_msgq_alloc_init">
<span class="target" id="group__msgq__apis_1gabe7305b8f442ebdc147dbbc6e8cf92fc"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq_alloc_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_msgq" title="k_msgq"><span class="n"><span class="pre">k_msgq</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msgq</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">msg_size</span></span>, <span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">max_msgs</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_msgq_alloc_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Initialize a message queue. </p>
<p>This routine initializes a message queue object, prior to its first use, allocating its internal ring buffer from the calling thread’s resource pool.</p>
<p>Memory allocated for the ring buffer can be released by calling <a class="reference internal" href="#group__msgq__apis_1gafda4399aa9b8f1e44bdf752e00ea787b"><span class="std std-ref">k_msgq_cleanup()</span></a>, or if userspace is enabled and the msgq object loses all of its references.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msgq</strong> – Address of the message queue. </p></li>
<li><p><strong>msg_size</strong> – Message size (in bytes). </p></li>
<li><p><strong>max_msgs</strong> – Maximum number of messages that can be queued.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>0 on success, -ENOMEM if there was insufficient memory in the thread’s resource pool, or -EINVAL if the size parameters cause an integer overflow. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_msgq_cleanup">
<span class="target" id="group__msgq__apis_1gafda4399aa9b8f1e44bdf752e00ea787b"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq_cleanup</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_msgq" title="k_msgq"><span class="n"><span class="pre">k_msgq</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msgq</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_msgq_cleanup" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Release allocated buffer for a queue. </p>
<p>Releases memory allocated for the ring buffer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msgq</strong> – message queue to cleanup</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – on success </p></li>
<li><p><strong>-EBUSY</strong> – Queue not empty </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_msgq_put">
<span class="target" id="group__msgq__apis_1ga54e96aaaea5462a1f963b7fd5ca82bfe"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq_put</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_msgq" title="k_msgq"><span class="n"><span class="pre">k_msgq</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msgq</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <a class="reference internal" href="../timing/clocks.html#c.k_timeout_t" title="k_timeout_t"><span class="n"><span class="pre">k_timeout_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">timeout</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_msgq_put" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Send a message to a message queue. </p>
<p>This routine sends a message to message queue <em>q</em>.</p>
<p><dl class="simple">
<dt><strong>Function properties (list may not be complete)</strong></dt><dd><p><span> <a class="reference internal" href="../../api/terminology.html#api-term-isr-ok"><span class="std std-ref">isr-ok</span></a></span> </p>
</dd>
</dl>
</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The message content is copied from <em>data</em> into <em>msgq</em> and the <em>data</em> pointer is not retained, so the message content will not be modified by this function.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msgq</strong> – Address of the message queue. </p></li>
<li><p><strong>data</strong> – Pointer to the message. </p></li>
<li><p><strong>timeout</strong> – Non-negative waiting period to add the message, or one of the special values K_NO_WAIT and K_FOREVER.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Message sent. </p></li>
<li><p><strong>-ENOMSG</strong> – Returned without waiting or queue purged. </p></li>
<li><p><strong>-EAGAIN</strong> – Waiting period timed out. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_msgq_get">
<span class="target" id="group__msgq__apis_1gae67f2ced2df1f9c290ae15dab9097cb7"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_msgq" title="k_msgq"><span class="n"><span class="pre">k_msgq</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msgq</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <a class="reference internal" href="../timing/clocks.html#c.k_timeout_t" title="k_timeout_t"><span class="n"><span class="pre">k_timeout_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">timeout</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_msgq_get" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Receive a message from a message queue. </p>
<p>This routine receives a message from message queue <em>q</em><p>in a “first in,</p>
<p>first out” manner.</p>
</p>
<p><dl class="simple">
<dt><strong>Function properties (list may not be complete)</strong></dt><dd><p><span> <a class="reference internal" href="../../api/terminology.html#api-term-isr-ok"><span class="std std-ref">isr-ok</span></a></span> </p>
</dd>
</dl>
</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>timeout</em> must be set to K_NO_WAIT if called from ISR.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msgq</strong> – Address of the message queue. </p></li>
<li><p><strong>data</strong> – Address of area to hold the received message. </p></li>
<li><p><strong>timeout</strong> – Waiting period to receive the message, or one of the special values K_NO_WAIT and K_FOREVER.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Message received. </p></li>
<li><p><strong>-ENOMSG</strong> – Returned without waiting. </p></li>
<li><p><strong>-EAGAIN</strong> – Waiting period timed out. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_msgq_peek">
<span class="target" id="group__msgq__apis_1ga14f543472f2f63cfde0bdfa87b95c915"></span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq_peek</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_msgq" title="k_msgq"><span class="n"><span class="pre">k_msgq</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msgq</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_msgq_peek" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Peek/read a message from a message queue. </p>
<p>This routine reads a message from message queue <em>q</em><p>in a “first in,</p>
<p>first out” manner and leaves the message in the queue.</p>
</p>
<p><dl class="simple">
<dt><strong>Function properties (list may not be complete)</strong></dt><dd><p><span> <a class="reference internal" href="../../api/terminology.html#api-term-isr-ok"><span class="std std-ref">isr-ok</span></a></span> </p>
</dd>
</dl>
</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msgq</strong> – Address of the message queue. </p></li>
<li><p><strong>data</strong> – Address of area to hold the message read from the queue.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>0</strong> – Message read. </p></li>
<li><p><strong>-ENOMSG</strong> – Returned when the queue has no message. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_msgq_purge">
<span class="target" id="group__msgq__apis_1gaa18875887773195ae44b7fe0972ee760"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq_purge</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_msgq" title="k_msgq"><span class="n"><span class="pre">k_msgq</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msgq</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_msgq_purge" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Purge a message queue. </p>
<p>This routine discards all unreceived messages in a message queue’s ring buffer. Any threads that are blocked waiting to send a message to the message queue are unblocked and see an -ENOMSG error code.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msgq</strong> – Address of the message queue. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_msgq_num_free_get">
<span class="target" id="group__msgq__apis_1ga7d154beb4f9c6227eddbef26d406ca24"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq_num_free_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_msgq" title="k_msgq"><span class="n"><span class="pre">k_msgq</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msgq</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_msgq_num_free_get" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the amount of free space in a message queue. </p>
<p>This routine returns the number of unused entries in a message queue’s ring buffer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msgq</strong> – Address of the message queue.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Number of unused ring buffer entries. </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_msgq_get_attrs">
<span class="target" id="group__msgq__apis_1ga8f9d3eef67cbc9c0717a84190bbf7f41"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq_get_attrs</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_msgq" title="k_msgq"><span class="n"><span class="pre">k_msgq</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msgq</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_msgq_attrs" title="k_msgq_attrs"><span class="n"><span class="pre">k_msgq_attrs</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">attrs</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_msgq_get_attrs" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get basic attributes of a message queue. </p>
<p>This routine fetches basic attributes of message queue into attr argument.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msgq</strong> – Address of the message queue. </p></li>
<li><p><strong>attrs</strong> – pointer to message queue attribute structure. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_msgq_num_used_get">
<span class="target" id="group__msgq__apis_1ga458793a89f1d9f762bda3422918a9faa"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq_num_used_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.k_msgq" title="k_msgq"><span class="n"><span class="pre">k_msgq</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msgq</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_msgq_num_used_get" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the number of messages in a message queue. </p>
<p>This routine returns the number of messages in a message queue’s ring buffer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msgq</strong> – Address of the message queue.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Number of messages. </p>
</dd>
</dl>
</dd></dl>

</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.k_msgq">
<span class="target" id="structk__msgq"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq</span></span></span><a class="headerlink" href="#c.k_msgq" title="Permalink to this definition">¶</a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;kernel.h&gt;</em></div>
<p>Message Queue Structure. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq.wait_q">
<span class="target" id="structk__msgq_1ae3b3d53d60b789d69c65494cfd090076"></span><span class="n"><span class="pre">_wait_q_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">wait_q</span></span></span><a class="headerlink" href="#c.k_msgq.wait_q" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Message queue wait queue </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq.lock">
<span class="target" id="structk__msgq_1aa2e00a7292502f0de88cff28c5e375f0"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../smp/smp.html#c.k_spinlock" title="k_spinlock"><span class="n"><span class="pre">k_spinlock</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">lock</span></span></span><a class="headerlink" href="#c.k_msgq.lock" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Lock </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq.msg_size">
<span class="target" id="structk__msgq_1a512fe468da96540639a0d71f1707f79d"></span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">msg_size</span></span></span><a class="headerlink" href="#c.k_msgq.msg_size" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Message size </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq.max_msgs">
<span class="target" id="structk__msgq_1aebd3b6e91e97b2d4369feea1a3f7b7a0"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">max_msgs</span></span></span><a class="headerlink" href="#c.k_msgq.max_msgs" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Maximal number of messages </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq.buffer_start">
<span class="target" id="structk__msgq_1aca77f1cf833d3aa27ae65004b446bdd2"></span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">buffer_start</span></span></span><a class="headerlink" href="#c.k_msgq.buffer_start" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Start of message buffer </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq.buffer_end">
<span class="target" id="structk__msgq_1a9d47fd25d7a70e8518d45dd48c51f0e0"></span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">buffer_end</span></span></span><a class="headerlink" href="#c.k_msgq.buffer_end" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>End of message buffer </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq.read_ptr">
<span class="target" id="structk__msgq_1a594e8a4a638521f42f24f85fe0742d64"></span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">read_ptr</span></span></span><a class="headerlink" href="#c.k_msgq.read_ptr" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Read pointer </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq.write_ptr">
<span class="target" id="structk__msgq_1aacf9b7b9f6e26e402f3752fc56834f23"></span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">write_ptr</span></span></span><a class="headerlink" href="#c.k_msgq.write_ptr" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Write pointer </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq.used_msgs">
<span class="target" id="structk__msgq_1a5c0cc83eaaf44d7fd7de8fffc7b2f857"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">used_msgs</span></span></span><a class="headerlink" href="#c.k_msgq.used_msgs" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Number of used messages </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq.flags">
<span class="target" id="structk__msgq_1ae03025420908f8342ce12a1395c7657b"></span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">flags</span></span></span><a class="headerlink" href="#c.k_msgq.flags" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Message queue </p>
</dd></dl>

</div>
</dd></dl>

<dl class="c struct">
<dt class="sig sig-object c" id="c.k_msgq_attrs">
<span class="target" id="structk__msgq__attrs"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_msgq_attrs</span></span></span><a class="headerlink" href="#c.k_msgq_attrs" title="Permalink to this definition">¶</a><br /></dt>
<dd><div class="docutils container">
<em>#include &lt;kernel.h&gt;</em></div>
<p>Message Queue Attributes. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq_attrs.msg_size">
<span class="target" id="structk__msgq__attrs_1a7d1d72946bdd517c07da37493a89e30e"></span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">msg_size</span></span></span><a class="headerlink" href="#c.k_msgq_attrs.msg_size" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Message Size </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq_attrs.max_msgs">
<span class="target" id="structk__msgq__attrs_1ad0f5894ba0da840b91eb85015252e649"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">max_msgs</span></span></span><a class="headerlink" href="#c.k_msgq_attrs.max_msgs" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Maximal number of messages </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.k_msgq_attrs.used_msgs">
<span class="target" id="structk__msgq__attrs_1a00f936870442fa455117cbdd7821fac5"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">used_msgs</span></span></span><a class="headerlink" href="#c.k_msgq_attrs.used_msgs" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Used messages </p>
</dd></dl>

</div>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>