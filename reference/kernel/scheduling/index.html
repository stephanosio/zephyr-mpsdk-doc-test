<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scheduling &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script type="module" src="../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="System Threads" href="../threads/system_threads.html" />
    <link rel="prev" title="Threads" href="../threads/index.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html">API Status and Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../audio/index.html">Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/notify.html">Asynchronous Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../canbus/index.html">Controller Area Network (CAN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto/index.html">Crypto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../devicetree/index.html">Devicetree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../drivers/index.html">Device Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../display/index.html">Display Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edac/index.html">Error Detection And Correction (EDAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../file_system/index.html">File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iterable_sections/index.html">Iterable Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/formatted_output.html">Formatted Output</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Kernel Services</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#scheduling-interrupts-and-synchronization">Scheduling, Interrupts, and Synchronization</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../threads/index.html">Threads</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Scheduling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../threads/system_threads.html">System Threads</a></li>
<li class="toctree-l4"><a class="reference internal" href="../threads/workqueue.html">Workqueue Threads</a></li>
<li class="toctree-l4"><a class="reference internal" href="../threads/nothread.html">Zephyr Without Threads</a></li>
<li class="toctree-l4"><a class="reference internal" href="../other/interrupts.html">Interrupts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../other/polling.html">Polling API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../synchronization/semaphores.html">Semaphores</a></li>
<li class="toctree-l4"><a class="reference internal" href="../synchronization/mutexes.html">Mutexes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../synchronization/condvar.html">Condition Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../synchronization/events.html">Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="../smp/smp.html">Symmetric Multiprocessing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#data-passing">Data Passing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#memory-management">Memory Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#timing">Timing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#other">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../libc/index.html">C standard library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/index.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../memory_management/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/index.html">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data_structures/index.html">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modbus/index.html">Modbus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../peripherals/index.html">Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../random/index.html">Random Number Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../resource_management/index.html">Resource Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shell/index.html">Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/index.html">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../task_wdt/index.html">Task Watchdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/timeutil.html">Time Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usb/index.html">USB device support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usermode/index.html">User Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../util/index.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../settings/index.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timing_functions/index.html">Executing Time Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../virtualization/index.html">Virtualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../index.html">API Reference</a> &raquo;</li>
  
     <li><a href="../index.html">Kernel Services</a> &raquo;</li>
  
  <li>Scheduling</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/reference/kernel/scheduling/index.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="scheduling">
<span id="scheduling-v2"></span><h1>Scheduling<a class="headerlink" href="#scheduling" title="Permalink to this headline">¶</a></h1>
<p>The kernel’s priority-based scheduler allows an application’s threads
to share the CPU.</p>
<div class="section" id="concepts">
<h2>Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h2>
<p>The scheduler determines which thread is allowed to execute
at any point in time; this thread is known as the <strong>current thread</strong>.</p>
<p>There are various points in time when the scheduler is given an
opportunity to change the identity of the current thread.  These points
are called <strong>reschedule points</strong>. Some potential reschedule points are:</p>
<ul class="simple">
<li><p>transition of a thread from running state to a suspended or waiting
state, for example by <a class="reference internal" href="../synchronization/semaphores.html#c.k_sem_take" title="k_sem_take"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_sem_take()</span></code></a> or <a class="reference internal" href="../threads/index.html#c.k_sleep" title="k_sleep"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_sleep()</span></code></a>.</p></li>
<li><p>transition of a thread to the <a class="reference internal" href="../threads/index.html#thread-states"><span class="std std-ref">ready state</span></a>, for
example by <a class="reference internal" href="../synchronization/semaphores.html#c.k_sem_give" title="k_sem_give"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_sem_give()</span></code></a> or <a class="reference internal" href="../threads/index.html#c.k_thread_start" title="k_thread_start"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_thread_start()</span></code></a></p></li>
<li><p>return to thread context after processing an interrupt</p></li>
<li><p>when a running thread invokes <a class="reference internal" href="../threads/index.html#c.k_yield" title="k_yield"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_yield()</span></code></a></p></li>
</ul>
<p>A thread <strong>sleeps</strong> when it voluntarily initiates an operation that
transitions itself to a suspended or waiting state.</p>
<p>Whenever the scheduler changes the identity of the current thread,
or when execution of the current thread is replaced by an ISR,
the kernel first saves the current thread’s CPU register values.
These register values get restored when the thread later resumes execution.</p>
<div class="section" id="scheduling-algorithm">
<h3>Scheduling Algorithm<a class="headerlink" href="#scheduling-algorithm" title="Permalink to this headline">¶</a></h3>
<p>The kernel’s scheduler selects the highest priority ready thread
to be the current thread. When multiple ready threads of the same priority
exist, the scheduler chooses the one that has been waiting longest.</p>
<p>A thread’s relative priority is primarily determined by its static priority.
However, when both earliest-deadline-first scheduling is enabled
(<a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_SCHED_DEADLINE"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_SCHED_DEADLINE</span></code></a>) and a choice of threads have equal
static priority, then the thread with the earlier deadline is considered
to have the higher priority. Thus, when earliest-deadline-first scheduling is
enabled, two threads are only considered to have the same priority when both
their static priorities and deadlines are equal. The routine
<a class="reference internal" href="../threads/index.html#c.k_thread_deadline_set" title="k_thread_deadline_set"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_thread_deadline_set()</span></code></a> is used to set a thread’s deadline.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Execution of ISRs takes precedence over thread execution,
so the execution of the current thread may be replaced by an ISR
at any time unless interrupts have been masked. This applies to both
cooperative threads and preemptive threads.</p>
</div>
<p>The kernel can be built with one of several choices for the ready queue
implementation, offering different choices between code size, constant factor
runtime overhead and performance scaling when many threads are added.</p>
<ul>
<li><p>Simple linked-list ready queue (<a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_SCHED_DUMB"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_SCHED_DUMB</span></code></a>)</p>
<p>The scheduler ready queue will be implemented as a simple unordered list, with
very fast constant time performance for single threads and very low code size.
This implementation should be selected on systems with constrained code size
that will never see more than a small number (3, maybe) of runnable threads in
the queue at any given time.  On most platforms (that are not otherwise using
the red/black tree) this results in a savings of ~2k of code size.</p>
</li>
<li><p>Red/black tree ready queue (<a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_SCHED_SCALABLE"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_SCHED_SCALABLE</span></code></a>)</p>
<p>The scheduler ready queue will be implemented as a red/black tree.  This has
rather slower constant-time insertion and removal overhead, and on most
platforms (that are not otherwise using the red/black tree somewhere) requires
an extra ~2kb of code. The resulting behavior will scale cleanly and
quickly into the many thousands of threads.</p>
<p>Use this for applications needing many concurrent runnable threads (&gt; 20 or
so).  Most applications won’t need this ready queue implementation.</p>
</li>
<li><p>Traditional multi-queue ready queue (<a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_SCHED_MULTIQ"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_SCHED_MULTIQ</span></code></a>)</p>
<p>When selected, the scheduler ready queue will be implemented as the
classic/textbook array of lists, one per priority (max 32 priorities).</p>
<p>This corresponds to the scheduler algorithm used in Zephyr versions prior to
1.12.</p>
<p>It incurs only a tiny code size overhead vs. the “dumb” scheduler and runs in
O(1) time in almost all circumstances with very low constant factor.  But it
requires a fairly large RAM budget to store those list heads, and the limited
features make it incompatible with features like deadline scheduling that
need to sort threads more finely, and SMP affinity which need to traverse the
list of threads.</p>
<p>Typical applications with small numbers of runnable threads probably want the
DUMB scheduler.</p>
</li>
</ul>
<p>The wait_q abstraction used in IPC primitives to pend threads for later wakeup
shares the same backend data structure choices as the scheduler, and can use
the same options.</p>
<ul>
<li><p>Scalable wait_q implementation (<a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_WAITQ_SCALABLE"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_WAITQ_SCALABLE</span></code></a>)</p>
<p>When selected, the wait_q will be implemented with a balanced tree.  Choose
this if you expect to have many threads waiting on individual primitives.
There is a ~2kb code size increase over <a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_WAITQ_DUMB"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_WAITQ_DUMB</span></code></a> (which may
be shared with <a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_SCHED_SCALABLE"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_SCHED_SCALABLE</span></code></a>) if the red/black tree is not
used elsewhere in the application, and pend/unpend operations on “small”
queues will be somewhat slower (though this is not generally a performance
path).</p>
</li>
<li><p>Simple linked-list wait_q (<a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_WAITQ_DUMB"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_WAITQ_DUMB</span></code></a>)</p>
<p>When selected, the wait_q will be implemented with a doubly-linked list.
Choose this if you expect to have only a few threads blocked on any single
IPC primitive.</p>
</li>
</ul>
</div>
<div class="section" id="cooperative-time-slicing">
<h3>Cooperative Time Slicing<a class="headerlink" href="#cooperative-time-slicing" title="Permalink to this headline">¶</a></h3>
<p>Once a cooperative thread becomes the current thread, it remains
the current thread until it performs an action that makes it unready.
Consequently, if a cooperative thread performs lengthy computations,
it may cause an unacceptable delay in the scheduling of other threads,
including those of higher priority and equal priority.</p>
<blockquote>
<div><img alt="../../../_images/cooperative.svg" class="align-center" src="../../../_images/cooperative.svg" /></div></blockquote>
<p>To overcome such problems, a cooperative thread can voluntarily relinquish
the CPU from time to time to permit other threads to execute.
A thread can relinquish the CPU in two ways:</p>
<ul class="simple">
<li><p>Calling <a class="reference internal" href="../threads/index.html#c.k_yield" title="k_yield"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_yield()</span></code></a> puts the thread at the back of the scheduler’s
prioritized list of ready threads, and then invokes the scheduler.
All ready threads whose priority is higher or equal to that of the
yielding thread are then allowed to execute before the yielding thread is
rescheduled. If no such ready threads exist, the scheduler immediately
reschedules the yielding thread without context switching.</p></li>
<li><p>Calling <a class="reference internal" href="../threads/index.html#c.k_sleep" title="k_sleep"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_sleep()</span></code></a> makes the thread unready for a specified
time period. Ready threads of <em>all</em> priorities are then allowed to execute;
however, there is no guarantee that threads whose priority is lower
than that of the sleeping thread will actually be scheduled before
the sleeping thread becomes ready once again.</p></li>
</ul>
</div>
<div class="section" id="preemptive-time-slicing">
<h3>Preemptive Time Slicing<a class="headerlink" href="#preemptive-time-slicing" title="Permalink to this headline">¶</a></h3>
<p>Once a preemptive thread becomes the current thread, it remains
the current thread until a higher priority thread becomes ready,
or until the thread performs an action that makes it unready.
Consequently, if a preemptive thread performs lengthy computations,
it may cause an unacceptable delay in the scheduling of other threads,
including those of equal priority.</p>
<blockquote>
<div><img alt="../../../_images/preemptive.svg" class="align-center" src="../../../_images/preemptive.svg" /></div></blockquote>
<p>To overcome such problems, a preemptive thread can perform cooperative
time slicing (as described above), or the scheduler’s time slicing capability
can be used to allow other threads of the same priority to execute.</p>
<img alt="../../../_images/timeslicing.svg" class="align-center" src="../../../_images/timeslicing.svg" /><p>The scheduler divides time into a series of <strong>time slices</strong>, where slices
are measured in system clock ticks. The time slice size is configurable,
but this size can be changed while the application is running.</p>
<p>At the end of every time slice, the scheduler checks to see if the current
thread is preemptible and, if so, implicitly invokes <a class="reference internal" href="../threads/index.html#c.k_yield" title="k_yield"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_yield()</span></code></a>
on behalf of the thread. This gives other ready threads of the same priority
the opportunity to execute before the current thread is scheduled again.
If no threads of equal priority are ready, the current thread remains
the current thread.</p>
<p>Threads with a priority higher than specified limit are exempt from preemptive
time slicing, and are never preempted by a thread of equal priority.
This allows an application to use preemptive time slicing
only when dealing with lower priority threads that are less time-sensitive.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The kernel’s time slicing algorithm does <em>not</em> ensure that a set
of equal-priority threads receive an equitable amount of CPU time,
since it does not measure the amount of time a thread actually gets to
execute. However, the algorithm <em>does</em> ensure that a thread never executes
for longer than a single time slice without being required to yield.</p>
</div>
</div>
<div class="section" id="scheduler-locking">
<h3>Scheduler Locking<a class="headerlink" href="#scheduler-locking" title="Permalink to this headline">¶</a></h3>
<p>A preemptible thread that does not wish to be preempted while performing
a critical operation can instruct the scheduler to temporarily treat it
as a cooperative thread by calling <a class="reference internal" href="../threads/index.html#c.k_sched_lock" title="k_sched_lock"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_sched_lock()</span></code></a>. This prevents
other threads from interfering while the critical operation is being performed.</p>
<p>Once the critical operation is complete the preemptible thread must call
<a class="reference internal" href="../threads/index.html#c.k_sched_unlock" title="k_sched_unlock"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_sched_unlock()</span></code></a> to restore its normal, preemptible status.</p>
<p>If a thread calls <a class="reference internal" href="../threads/index.html#c.k_sched_lock" title="k_sched_lock"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_sched_lock()</span></code></a> and subsequently performs an
action that makes it unready, the scheduler will switch the locking thread out
and allow other threads to execute. When the locking thread again
becomes the current thread, its non-preemptible status is maintained.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Locking out the scheduler is a more efficient way for a preemptible thread
to prevent preemption than changing its priority level to a negative value.</p>
</div>
</div>
<div class="section" id="thread-sleeping">
<span id="id1"></span><h3>Thread Sleeping<a class="headerlink" href="#thread-sleeping" title="Permalink to this headline">¶</a></h3>
<p>A thread can call <a class="reference internal" href="../threads/index.html#c.k_sleep" title="k_sleep"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_sleep()</span></code></a> to delay its processing
for a specified time period. During the time the thread is sleeping
the CPU is relinquished to allow other ready threads to execute.
Once the specified delay has elapsed the thread becomes ready
and is eligible to be scheduled once again.</p>
<p>A sleeping thread can be woken up prematurely by another thread using
<a class="reference internal" href="../threads/index.html#c.k_wakeup" title="k_wakeup"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_wakeup()</span></code></a>. This technique can sometimes be used
to permit the secondary thread to signal the sleeping thread
that something has occurred <em>without</em> requiring the threads
to define a kernel synchronization object, such as a semaphore.
Waking up a thread that is not sleeping is allowed, but has no effect.</p>
</div>
<div class="section" id="busy-waiting">
<span id="id2"></span><h3>Busy Waiting<a class="headerlink" href="#busy-waiting" title="Permalink to this headline">¶</a></h3>
<p>A thread can call <a class="reference internal" href="../threads/index.html#c.k_busy_wait" title="k_busy_wait"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_busy_wait()</span></code></a> to perform a <code class="docutils literal notranslate"><span class="pre">busy</span> <span class="pre">wait</span></code>
that delays its processing for a specified time period
<em>without</em> relinquishing the CPU to another ready thread.</p>
<p>A busy wait is typically used instead of thread sleeping
when the required delay is too short to warrant having the scheduler
context switch from the current thread to another thread and then back again.</p>
</div>
</div>
<div class="section" id="suggested-uses">
<h2>Suggested Uses<a class="headerlink" href="#suggested-uses" title="Permalink to this headline">¶</a></h2>
<p>Use cooperative threads for device drivers and other performance-critical work.</p>
<p>Use cooperative threads to implement mutually exclusion without the need
for a kernel object, such as a mutex.</p>
<p>Use preemptive threads to give priority to time-sensitive processing
over less time-sensitive processing.</p>
</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>