<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fatal Errors &mdash; Zephyr Project Documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script type="module" src="../../../_static/js/dark-mode-toggle.min.mjs"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-831873-47"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="Thread Local Storage (TLS)" href="thread_local_storage.html" />
    <link rel="prev" title="Version" href="version.html" />
  <meta name="color-scheme" content="dark light">
  
  <link rel="stylesheet" href="../../../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
  <link rel="stylesheet" href="../../../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0-rc3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Release Versions</dt>
        
          <dd><a href="/">latest</a></dd>
        
          <dd><a href="/2.7.0/">2.7.0</a></dd>
        
          <dd><a href="/2.6.0/">2.6.0</a></dd>
        
          <dd><a href="/2.5.0/">2.5.0</a></dd>
        
          <dd><a href="/2.4.0/">2.4.0</a></dd>
        
          <dd><a href="/2.3.0/">2.3.0</a></dd>
        
          <dd><a href="/1.14.1/">1.14.1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="/latest/zephyr.pdf">PDF</a></dd>
      </dl>
      <dl>
        <dt>zephyrproject.org Links</dt>
          <dd>
            <a href="https://www.zephyrproject.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/sdk-ng/releases">SDK</a>
          </dd>
          <dd>
            <a href="https://github.com/zephyrproject-rtos/zephyr/releases">Releases</a>
          </dd>
      </dl>
    </div>
  </div>
  
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html">API Status and Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../audio/index.html">Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/notify.html">Asynchronous Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../canbus/index.html">Controller Area Network (CAN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto/index.html">Crypto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../devicetree/index.html">Devicetree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../drivers/index.html">Device Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../display/index.html">Display Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edac/index.html">Error Detection And Correction (EDAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../file_system/index.html">File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iterable_sections/index.html">Iterable Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/formatted_output.html">Formatted Output</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Kernel Services</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../index.html#scheduling-interrupts-and-synchronization">Scheduling, Interrupts, and Synchronization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#data-passing">Data Passing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#memory-management">Memory Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#timing">Timing</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#other">Other</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="cpu_idle.html">CPU Idling</a></li>
<li class="toctree-l4"><a class="reference internal" href="atomic.html">Atomic Services</a></li>
<li class="toctree-l4"><a class="reference internal" href="float.html">Floating Point Services</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx_support.html">C++ Support for Applications</a></li>
<li class="toctree-l4"><a class="reference internal" href="version.html">Version</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Fatal Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="thread_local_storage.html">Thread Local Storage (TLS)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../libc/index.html">C standard library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/index.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../memory_management/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/index.html">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data_structures/index.html">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modbus/index.html">Modbus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../peripherals/index.html">Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../random/index.html">Random Number Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../resource_management/index.html">Resource Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shell/index.html">Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/index.html">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../task_wdt/index.html">Task Watchdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc/timeutil.html">Time Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usb/index.html">USB device support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usermode/index.html">User Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../util/index.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../settings/index.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timing_functions/index.html">Executing Time Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../virtualization/index.html">Virtualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

  
  <div class="toctree-wrapper compound">
    <p class="caption"><span class="caption-text">Reference</span></p>
    <ul>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/doxygen/html/index.html">API</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/kconfig/index.html">Kconfig Options</a>
      </li>
      
      <li class="toctree-l1">
        <a class="reference internal" href="/latest/reference/devicetree/bindings.html">Devicetree Bindings</a>
      </li>
      
    </ul>
  </div>
  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- Docs / Latest -->
  
  

  <li><a href="../../../index.html">Docs / Latest</a> &raquo;</li>
  
     <li><a href="../../index.html">API Reference</a> &raquo;</li>
  
     <li><a href="../index.html">Kernel Services</a> &raquo;</li>
  
  <li>Fatal Errors</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
      
      
        <a href="https://github.com/zephyrproject-rtos/zephyr/blob/main/doc/reference/kernel/other/fatal.rst" class="fa fa-github"> Open on GitHub</a>
      
    
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
    <div class="wy-alert wy-alert-danger">
     This is the documentation for the latest (main) development branch of
     Zephyr. If you are looking for the documentation of previous releases, use
     the drop-down menu on the left and select the desired version.
    </div>
  
  
           <div itemprop="articleBody">
             
  <div class="section" id="fatal-errors">
<span id="fatal"></span><h1>Fatal Errors<a class="headerlink" href="#fatal-errors" title="Permalink to this headline">¶</a></h1>
<div class="section" id="software-errors-triggered-in-source-code">
<h2>Software Errors Triggered in Source Code<a class="headerlink" href="#software-errors-triggered-in-source-code" title="Permalink to this headline">¶</a></h2>
<p>Zephyr provides several methods for inducing fatal error conditions through
either build-time checks, conditionally compiled assertions, or deliberately
invoked panic or oops conditions.</p>
<div class="section" id="runtime-assertions">
<h3>Runtime Assertions<a class="headerlink" href="#runtime-assertions" title="Permalink to this headline">¶</a></h3>
<p>Zephyr provides some macros to perform runtime assertions which may be
conditionally compiled. Their definitions may be found in
<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/include/sys/__assert.h">include/sys/__assert.h</a>.</p>
<p>Assertions are enabled by setting the <code class="docutils literal notranslate"><span class="pre">__ASSERT_ON</span></code> preprocessor symbol to a
non-zero value. There are two ways to do this:</p>
<ul class="simple">
<li><p>Use the <a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_ASSERT"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_ASSERT</span></code></a> and <a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_ASSERT_LEVEL"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_ASSERT_LEVEL</span></code></a> kconfig
options.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">-D__ASSERT_ON=&lt;level&gt;</span></code> to the project’s CFLAGS, either on the
build command line or in a CMakeLists.txt.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">__ASSERT_ON</span></code> method takes precedence over the kconfig option if both are
used.</p>
<p>Specifying an assertion level of 1 causes the compiler to issue warnings that
the kernel contains debug-type <code class="docutils literal notranslate"><span class="pre">__ASSERT()</span></code> statements; this reminder is
issued since assertion code is not normally present in a final product.
Specifying assertion level 2 suppresses these warnings.</p>
<p>Assertions are enabled by default when running Zephyr test cases, as
configured by the <a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_TEST"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_TEST</span></code></a> option.</p>
<p>The policy for what to do when encountering a failed assertion is controlled
by the implementation of <code class="xref c c-func docutils literal notranslate"><span class="pre">assert_post_action()</span></code>. Zephyr provides
a default implementation with weak linkage which invokes a kernel oops if
the thread that failed the assertion was running in user mode, and a kernel
panic otherwise.</p>
<div class="section" id="assert">
<h4>__ASSERT()<a class="headerlink" href="#assert" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">__ASSERT()</span></code> macro can be used inside kernel and application code to
perform optional runtime checks which will induce a fatal error if the
check does not pass. The macro takes a string message which will be printed
to provide context to the assertion. In addition, the kernel will print
a text representation of the expression code that was evaluated, and the
file and line number where the assertion can be found.</p>
<p>For example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">__ASSERT</span><span class="p">(</span><span class="n">foo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xF0CACC1A</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Invalid value of foo, got 0x%x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>If at runtime <code class="docutils literal notranslate"><span class="pre">foo</span></code> had some unexpected value, the error produced may
look like the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ASSERTION FAIL [foo == 0xF0CACC1A] @ ZEPHYR_BASE/tests/kernel/fatal/src/main.c:367
        Invalid value of foo, got 0xdeadbeef
[00:00:00.000,000] &lt;err&gt; os: r0/a1:  0x00000004  r1/a2:  0x0000016f  r2/a3:  0x00000000
[00:00:00.000,000] &lt;err&gt; os: r3/a4:  0x00000000 r12/ip:  0x00000000 r14/lr:  0x00000a6d
[00:00:00.000,000] &lt;err&gt; os:  xpsr:  0x61000000
[00:00:00.000,000] &lt;err&gt; os: Faulting instruction address (r15/pc): 0x00009fe4
[00:00:00.000,000] &lt;err&gt; os: &gt;&gt;&gt; ZEPHYR FATAL ERROR 4: Kernel panic
[00:00:00.000,000] &lt;err&gt; os: Current thread: 0x20000414 (main)
[00:00:00.000,000] &lt;err&gt; os: Halting system
</pre></div>
</div>
</div>
<div class="section" id="assert-eval">
<h4>__ASSERT_EVAL()<a class="headerlink" href="#assert-eval" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">__ASSERT_EVAL()</span></code> macro can also be used inside kernel and application
code, with special semantics for the evaluation of its arguments.</p>
<p>It makes use of the <code class="docutils literal notranslate"><span class="pre">__ASSERT()</span></code> macro, but has some extra flexibility. It
allows the developer to specify different actions depending whether the
<code class="docutils literal notranslate"><span class="pre">__ASSERT()</span></code> macro is enabled or not.  This can be particularly useful to
prevent the compiler from generating comments (errors, warnings or remarks)
about variables that are only used with <code class="docutils literal notranslate"><span class="pre">__ASSERT()</span></code> being assigned a value,
but otherwise unused when the <code class="docutils literal notranslate"><span class="pre">__ASSERT()</span></code> macro is disabled.</p>
<p>Consider the following example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span><span class="w"></span>
<span class="n">__ASSERT</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo() returned zero!&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">__ASSERT()</span></code> is disabled, then ‘x’ is assigned a value, but never used.
This type of situation can be resolved using the __ASSERT_EVAL() macro.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">__ASSERT_EVAL</span><span class="w"> </span><span class="p">((</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">foo</span><span class="p">(),</span><span class="w"></span>
<span class="w">               </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">(),</span><span class="w"></span>
<span class="w">               </span><span class="n">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="s">&quot;foo() returned zero!&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The first parameter tells <code class="docutils literal notranslate"><span class="pre">__ASSERT_EVAL()</span></code> what to do if <code class="docutils literal notranslate"><span class="pre">__ASSERT()</span></code> is
disabled.  The second parameter tells <code class="docutils literal notranslate"><span class="pre">__ASSERT_EVAL()</span></code> what to do if
<code class="docutils literal notranslate"><span class="pre">__ASSERT()</span></code> is enabled.  The third and fourth parameters are the parameters
it passes to <code class="docutils literal notranslate"><span class="pre">__ASSERT()</span></code>.</p>
</div>
<div class="section" id="assert-no-msg">
<h4>__ASSERT_NO_MSG()<a class="headerlink" href="#assert-no-msg" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">__ASSERT_NO_MSG()</span></code> macro can be used to perform an assertion that
reports the failed test and its location, but lacks additional debugging
information provided to assist the user in diagnosing the problem; its use is
discouraged.</p>
</div>
</div>
<div class="section" id="build-assertions">
<h3>Build Assertions<a class="headerlink" href="#build-assertions" title="Permalink to this headline">¶</a></h3>
<p>Zephyr provides two macros for performing build-time assertion checks.
These are evaluated completely at compile-time, and are always checked.</p>
<div class="section" id="build-assert">
<h4>BUILD_ASSERT()<a class="headerlink" href="#build-assert" title="Permalink to this headline">¶</a></h4>
<p>This has the same semantics as C’s <code class="docutils literal notranslate"><span class="pre">_Static_assert</span></code> or C++’s
<code class="docutils literal notranslate"><span class="pre">static_assert</span></code>. If the evaluation fails, a build error will be generated by
the compiler. If the compiler supports it, the provided message will be printed
to provide further context.</p>
<p>Unlike <code class="docutils literal notranslate"><span class="pre">__ASSERT()</span></code>, the message must be a static string, without
<code class="xref c c-func docutils literal notranslate"><span class="pre">printf()</span></code>-like format codes or extra arguments.</p>
<p>For example, suppose this check fails:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">BUILD_ASSERT</span><span class="p">(</span><span class="n">FOO</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Invalid value of FOO&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>With GCC, the output resembles:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tests/kernel/fatal/src/main.c: In function &#39;test_main&#39;:
include/toolchain/gcc.h:28:37: error: static assertion failed: &quot;Invalid value of FOO&quot;
 #define BUILD_ASSERT(EXPR, MSG) _Static_assert(EXPR, &quot;&quot; MSG)
                                 ^~~~~~~~~~~~~~
tests/kernel/fatal/src/main.c:370:2: note: in expansion of macro &#39;BUILD_ASSERT&#39;
  BUILD_ASSERT(FOO == 2000,
  ^~~~~~~~~~~~~~~~
</pre></div>
</div>
</div>
</div>
<div class="section" id="kernel-oops">
<h3>Kernel Oops<a class="headerlink" href="#kernel-oops" title="Permalink to this headline">¶</a></h3>
<p>A kernel oops is a software triggered fatal error invoked by
<code class="xref c c-func docutils literal notranslate"><span class="pre">k_oops()</span></code>.  This should be used to indicate an unrecoverable condition
in application logic.</p>
<p>The fatal error reason code generated will be <code class="docutils literal notranslate"><span class="pre">K_ERR_KERNEL_OOPS</span></code>.</p>
</div>
<div class="section" id="kernel-panic">
<h3>Kernel Panic<a class="headerlink" href="#kernel-panic" title="Permalink to this headline">¶</a></h3>
<p>A kernel error is a software triggered fatal error invoked by
<code class="xref c c-func docutils literal notranslate"><span class="pre">k_panic()</span></code>.  This should be used to indicate that the Zephyr kernel is
in an unrecoverable state. Implementations of
<a class="reference internal" href="#c.k_sys_fatal_error_handler" title="k_sys_fatal_error_handler"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_sys_fatal_error_handler()</span></code></a> should not return if the kernel
encounters a panic condition, as the entire system needs to be reset.</p>
<p>Threads running in user mode are not permitted to invoke <code class="xref c c-func docutils literal notranslate"><span class="pre">k_panic()</span></code>,
and doing so will generate a kernel oops instead. Otherwise, the fatal error
reason code generated will be <code class="docutils literal notranslate"><span class="pre">K_ERR_KERNEL_PANIC</span></code>.</p>
</div>
</div>
<div class="section" id="exceptions">
<h2>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="spurious-interrupts">
<h3>Spurious Interrupts<a class="headerlink" href="#spurious-interrupts" title="Permalink to this headline">¶</a></h3>
<p>If the CPU receives a hardware interrupt on an interrupt line that has not had
a handler installed with <code class="docutils literal notranslate"><span class="pre">IRQ_CONNECT()</span></code> or <a class="reference internal" href="interrupts.html#c.irq_connect_dynamic" title="irq_connect_dynamic"><code class="xref c c-func docutils literal notranslate"><span class="pre">irq_connect_dynamic()</span></code></a>,
then the kernel will generate a fatal error with the reason code
<code class="docutils literal notranslate"><span class="pre">K_ERR_SPURIOUS_IRQ()</span></code>.</p>
</div>
<div class="section" id="stack-overflows">
<h3>Stack Overflows<a class="headerlink" href="#stack-overflows" title="Permalink to this headline">¶</a></h3>
<p>In the event that a thread pushes more data onto its execution stack than its
stack buffer provides, the kernel may be able to detect this situation and
generate a fatal error with a reason code of <code class="docutils literal notranslate"><span class="pre">K_ERR_STACK_CHK_FAIL</span></code>.</p>
<p>If a thread is running in user mode, then stack overflows are always caught,
as the thread will simply not have permission to write to adjacent memory
addresses outside of the stack buffer. Because this is enforced by the
memory protection hardware, there is no risk of data corruption to memory
that the thread would not otherwise be able to write to.</p>
<p>If a thread is running in supervisor mode, or if <a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_USERSPACE"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_USERSPACE</span></code></a> is
not enabled, depending on configuration stack overflows may or may not be
caught.  <a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_HW_STACK_PROTECTION"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_HW_STACK_PROTECTION</span></code></a> is supported on some
architectures and will catch stack overflows in supervisor mode, including
when handling a system call on behalf of a user thread. Typically this is
implemented via dedicated CPU features, or read-only MMU/MPU guard regions
placed immediately adjacent to the stack buffer. Stack overflows caught in this
way can detect the overflow, but cannot guarantee against data corruption and
should be treated as a very serious condition impacting the health of the
entire system.</p>
<p>If a platform lacks memory management hardware support,
<a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_STACK_SENTINEL"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_STACK_SENTINEL</span></code></a> is a software-only stack overflow detection
feature which periodically checks if a sentinel value at the end of the stack
buffer has been corrupted. It does not require hardware support, but provides
no protection against data corruption. Since the checks are typically done at
interrupt exit, the overflow may be detected a nontrivial amount of time after
the stack actually overflowed.</p>
<p>Finally, Zephyr supports GCC compiler stack canaries via
<a class="reference internal" href="../../kconfig/dummy-syms.html#std-kconfig-CONFIG_STACK_CANARIES"><code class="xref std std-kconfig docutils literal notranslate"><span class="pre">CONFIG_STACK_CANARIES</span></code></a>.  If enabled, the compiler will insert a canary
value randomly generated at boot into function stack frames, checking that the
canary has not been overwritten at function exit. If the check fails, the
compiler invokes <code class="xref c c-func docutils literal notranslate"><span class="pre">__stack_chk_fail()</span></code>, whose Zephyr implementation
invokes a fatal stack overflow error. An error in this case does not indicate
that the entire stack buffer has overflowed, but instead that the current
function stack frame has been corrupted. See the compiler documentation for
more details.</p>
</div>
<div class="section" id="other-exceptions">
<h3>Other Exceptions<a class="headerlink" href="#other-exceptions" title="Permalink to this headline">¶</a></h3>
<p>Any other type of unhandled CPU exception will generate an error code of
<code class="docutils literal notranslate"><span class="pre">K_ERR_CPU_EXCEPTION</span></code>.</p>
</div>
</div>
<div class="section" id="fatal-error-handling">
<h2>Fatal Error Handling<a class="headerlink" href="#fatal-error-handling" title="Permalink to this headline">¶</a></h2>
<p>The policy for what to do when encountering a fatal error is determined by the
implementation of the <a class="reference internal" href="#c.k_sys_fatal_error_handler" title="k_sys_fatal_error_handler"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_sys_fatal_error_handler()</span></code></a> function.  This
function has a default implementation with weak linkage that calls
<code class="docutils literal notranslate"><span class="pre">LOG_PANIC()</span></code> to dump all pending logging messages and then unconditionally
halts the system with <a class="reference internal" href="#c.k_fatal_halt" title="k_fatal_halt"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_fatal_halt()</span></code></a>.</p>
<p>Applications are free to implement their own error handling policy by
overriding the implementation of <a class="reference internal" href="#c.k_sys_fatal_error_handler" title="k_sys_fatal_error_handler"><code class="xref c c-func docutils literal notranslate"><span class="pre">k_sys_fatal_error_handler()</span></code></a>.
If the implementation returns, the faulting thread will be aborted and
the system will otherwise continue to function. See the documentation for
this function for additional details and constraints.</p>
</div>
<div class="section" id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__fatal__apis"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">fatal_apis</span></span></dt>
<dd><div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-enums">Enums</p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.k_fatal_error_reason">
<span class="target" id="group__fatal__apis_1ga5b7e799fa19549ef9416a2d6cba29b52"></span><span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_fatal_error_reason</span></span></span><a class="headerlink" href="#c.k_fatal_error_reason" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><em>Values:</em></p>
<dl class="c enumerator">
<dt class="sig sig-object c" id="c.k_fatal_error_reason.K_ERR_CPU_EXCEPTION">
<span class="target" id="group__fatal__apis_1gga5b7e799fa19549ef9416a2d6cba29b52af9ac087d07f036fae2e689a2afc8d88b"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">K_ERR_CPU_EXCEPTION</span></span></span><a class="headerlink" href="#c.k_fatal_error_reason.K_ERR_CPU_EXCEPTION" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Generic CPU exception, not covered by other codes </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.k_fatal_error_reason.K_ERR_SPURIOUS_IRQ">
<span class="target" id="group__fatal__apis_1gga5b7e799fa19549ef9416a2d6cba29b52a473dca11c5f93f5059a119a8e66e2db3"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">K_ERR_SPURIOUS_IRQ</span></span></span><a class="headerlink" href="#c.k_fatal_error_reason.K_ERR_SPURIOUS_IRQ" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Unhandled hardware interrupt </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.k_fatal_error_reason.K_ERR_STACK_CHK_FAIL">
<span class="target" id="group__fatal__apis_1gga5b7e799fa19549ef9416a2d6cba29b52a4156a6495ca0fe0867a17a91efc42e91"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">K_ERR_STACK_CHK_FAIL</span></span></span><a class="headerlink" href="#c.k_fatal_error_reason.K_ERR_STACK_CHK_FAIL" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Faulting context overflowed its stack buffer </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.k_fatal_error_reason.K_ERR_KERNEL_OOPS">
<span class="target" id="group__fatal__apis_1gga5b7e799fa19549ef9416a2d6cba29b52ad6bc280fafebf22e2c97481cc4a5b7c3"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">K_ERR_KERNEL_OOPS</span></span></span><a class="headerlink" href="#c.k_fatal_error_reason.K_ERR_KERNEL_OOPS" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Moderate severity software error </p>
</dd></dl>

<dl class="c enumerator">
<dt class="sig sig-object c" id="c.k_fatal_error_reason.K_ERR_KERNEL_PANIC">
<span class="target" id="group__fatal__apis_1gga5b7e799fa19549ef9416a2d6cba29b52a6ea29e224a1bc958a961420471711617"></span><span class="k"><span class="pre">enumerator</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">K_ERR_KERNEL_PANIC</span></span></span><a class="headerlink" href="#c.k_fatal_error_reason.K_ERR_KERNEL_PANIC" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>High severity software error </p>
</dd></dl>

</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-functions">Functions</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.k_fatal_halt">
<span class="target" id="group__fatal__apis_1gaa8c0b43a2360e5319d7910e8e0ceb951"></span><span class="pre">FUNC_NORETURN</span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_fatal_halt</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">reason</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_fatal_halt" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Halt the system on a fatal error. </p>
<p>Invokes architecture-specific code to power off or halt the system in a low power state. Lacking that, lock interrupts and sit in an idle loop.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reason</strong> – Fatal exception reason code </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.k_sys_fatal_error_handler">
<span class="target" id="group__fatal__apis_1gab6dfd75572a84729df534fde49ef7d85"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">k_sys_fatal_error_handler</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">reason</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">z_arch_esf_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">esf</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.k_sys_fatal_error_handler" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Fatal error policy handler. </p>
<p>This function is not invoked by application code, but is declared as a weak symbol so that applications may introduce their own policy.</p>
<p>The default implementation of this function halts the system unconditionally. Depending on architecture support, this may be a simple infinite loop, power off the hardware, or exit an emulator.</p>
<p>If this function returns, then the currently executing thread will be aborted.</p>
<p>A few notes for custom implementations:</p>
<p><ul class="simple">
<li><p>If the error is determined to be unrecoverable, <a class="reference internal" href="../../logging/index.html#group__log__ctrl_1ga9ee5a99e0487e3f1e6d289b12c19ad5a"><span class="std std-ref">LOG_PANIC()</span></a> should be invoked to flush any pending logging buffers.</p></li>
<li><p>K_ERR_KERNEL_PANIC indicates a severe unrecoverable error in the kernel itself, and should not be considered recoverable. There is an assertion in z_fatal_error() to enforce this.</p></li>
<li><p>Even outside of a kernel panic, unless the fault occurred in user mode, the kernel itself may be in an inconsistent state, with API calls to kernel objects possibly exhibiting undefined behavior or triggering another exception.</p></li>
</ul>
</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reason</strong> – The reason for the fatal error </p></li>
<li><p><strong>esf</strong> – Exception context, with details and partial or full register state when the error occurred. May in some cases be NULL. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</dd></dl>

</div>
</div>


           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">Copyright</a> 2015-2021 Zephyr Project members and individual contributors.
      <span class="lastupdated">Last updated on Feb 21, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>